/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Embedded source of the Unity Editor Bridge C# plugin (base64 encoded).
 * Auto-deployed into the user's Unity project at Assets/Editor/GameDevIDEBridge.cs.
 *
 * The readable source is at: unity-editor-plugin/GameDevIDEBridge.cs
 * To regenerate after editing the C# file, run from the repo root:
 *   node scripts/generate-bridge-plugin-source.js
 */

import { VSBuffer } from '../../../../base/common/buffer.js';

/** Version marker â€” bump when the plugin changes to trigger re-deploy */
export const BRIDGE_PLUGIN_VERSION = '1.3.2';

/** Path relative to Unity project root where the plugin is installed */
export const BRIDGE_PLUGIN_INSTALL_PATH = 'Assets/Editor/GameDevIDEBridge.cs';

/** Base64-encoded C# source of the Unity Editor Bridge plugin */
const BRIDGE_PLUGIN_BASE64 = '' +
	'LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIEdhbWVEZXYgSURFIEJyaWRnZSDigJQgVW5pdHkgRWRpdG9yIFBsdWdpbiAgKEFVVE8t' +
	'SU5TVEFMTEVEIGJ5IEdhbWVEZXYgSURFKQogKgogKiAgVGhpcyBmaWxlIGlzIGF1dG9tYXRpY2FsbHkgbWFuYWdlZCBieSBHYW1l' +
	'RGV2IElERS4gRG8gbm90IGVkaXQgbWFudWFsbHkuCiAqICBJdCBvcGVucyBhIFdlYlNvY2tldCBzZXJ2ZXIgb24gbG9jYWxob3N0' +
	'IHNvIHRoZSBJREUgY2FuIGNvbW11bmljYXRlIHdpdGgKICogIHRoZSBydW5uaW5nIFVuaXR5IEVkaXRvciB0byBjcmVhdGUgR2Ft' +
	'ZU9iamVjdHMsIHNjZW5lcywgcHJlZmFicywgZXRjLgogKgogKiAgUHJvdG9jb2wgdmVyc2lvbjogMS4wCiAqICBQbHVnaW4gdmVy' +
	'c2lvbjogMS4zLjIKICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgp1c2luZyBVbml0eUVuZ2luZTsKdXNpbmcgVW5pdHlFZGl0b3I7CnVz' +
	'aW5nIFVuaXR5RWRpdG9yLlNjZW5lTWFuYWdlbWVudDsKdXNpbmcgVW5pdHlFbmdpbmUuU2NlbmVNYW5hZ2VtZW50Owp1c2luZyBT' +
	'eXN0ZW07CnVzaW5nIFN5c3RlbS5JTzsKdXNpbmcgU3lzdGVtLk5ldDsKdXNpbmcgU3lzdGVtLk5ldC5Tb2NrZXRzOwp1c2luZyBT' +
	'eXN0ZW0uTmV0LldlYlNvY2tldHM7CnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHk7CnVzaW5nIFN5c3RlbS5UZXh0' +
	'Owp1c2luZyBTeXN0ZW0uVGV4dC5SZWd1bGFyRXhwcmVzc2lvbnM7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7CnVzaW5nIFN5c3Rl' +
	'bS5UaHJlYWRpbmcuVGFza3M7CnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5Db25jdXJyZW50Owp1c2luZyBTeXN0ZW0uQ29sbGVj' +
	'dGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247CnVzaW5nIFN5c3RlbS5MaW5xOwoKW0luaXRpYWxpemVPbkxv' +
	'YWRdCnB1YmxpYyBzdGF0aWMgY2xhc3MgR2FtZURldklERUJyaWRnZQp7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBQUk9UT0NP' +
	'TF9WRVJTSU9OID0gIjEuMCI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRElSID0gIkxpYnJhcnkvR2FtZURl' +
	'dklERSI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRklMRSA9ICJMaWJyYXJ5L0dhbWVEZXZJREUvYnJpZGdl' +
	'Lmpzb24iOwoKICAgIHByaXZhdGUgc3RhdGljIFRjcExpc3RlbmVyIF9saXN0ZW5lcjsKICAgIHByaXZhdGUgc3RhdGljIFRjcENs' +
	'aWVudCBfdGNwQ2xpZW50OwogICAgcHJpdmF0ZSBzdGF0aWMgTmV0d29ya1N0cmVhbSBfY2xpZW50U3RyZWFtOwogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UgX2N0czsKICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENvbmN1cnJl' +
	'bnRRdWV1ZTxzdHJpbmc+IF9pbmNvbWluZ01lc3NhZ2VzID0gbmV3IENvbmN1cnJlbnRRdWV1ZTxzdHJpbmc+KCk7CiAgICBwcml2' +
	'YXRlIHN0YXRpYyByZWFkb25seSBDb25jdXJyZW50UXVldWU8c3RyaW5nPiBfb3V0Z29pbmdNZXNzYWdlcyA9IG5ldyBDb25jdXJy' +
	'ZW50UXVldWU8c3RyaW5nPigpOwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IF9wb3J0OwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBf' +
	'cnVubmluZzsKICAgIHByaXZhdGUgc3RhdGljIGJvb2wgX2NsaWVudENvbm5lY3RlZDsKICAgIHByaXZhdGUgc3RhdGljIGRvdWJs' +
	'ZSBfbGFzdERpc2NvdmVyeVJlZnJlc2g7CgogICAgc3RhdGljIEdhbWVEZXZJREVCcmlkZ2UoKQogICAgewogICAgICAgIEVkaXRv' +
	'ckFwcGxpY2F0aW9uLnVwZGF0ZSArPSBQcm9jZXNzTWVzc2FnZXM7CiAgICAgICAgRWRpdG9yQXBwbGljYXRpb24ucXVpdHRpbmcg' +
	'Kz0gU2h1dGRvd247CiAgICAgICAgQXNzZW1ibHlSZWxvYWRFdmVudHMuYmVmb3JlQXNzZW1ibHlSZWxvYWQgKz0gT25CZWZvcmVS' +
	'ZWxvYWQ7CiAgICAgICAgQXBwbGljYXRpb24ubG9nTWVzc2FnZVJlY2VpdmVkICs9IE9uTG9nTWVzc2FnZTsKICAgICAgICBFZGl0' +
	'b3JBcHBsaWNhdGlvbi5wbGF5TW9kZVN0YXRlQ2hhbmdlZCArPSBPblBsYXlNb2RlQ2hhbmdlZDsKICAgICAgICBTdGFydFNlcnZl' +
	'cigpOwogICAgfQoKICAgIC8vIC0tLSBTZXJ2ZXIgTGlmZWN5Y2xlIChUY3BMaXN0ZW5lciArIG1hbnVhbCBXZWJTb2NrZXQgaGFu' +
	'ZHNoYWtlKSAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyB2b2lkIFN0YXJ0U2VydmVyKCkKICAgIHsKICAgICAgICBpZiAo' +
	'X3J1bm5pbmcpIHJldHVybjsKCiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICBfY3RzID0gbmV3IENhbmNlbGxhdGlv' +
	'blRva2VuU291cmNlKCk7CgogICAgICAgICAgICAvLyBCaW5kIHRvIHBvcnQgMCBmb3IgYXV0by1hc3NpZ25tZW50CiAgICAgICAg' +
	'ICAgIF9saXN0ZW5lciA9IG5ldyBUY3BMaXN0ZW5lcihJUEFkZHJlc3MuTG9vcGJhY2ssIDApOwogICAgICAgICAgICBfbGlzdGVu' +
	'ZXIuU3RhcnQoKTsKICAgICAgICAgICAgX3BvcnQgPSAoKElQRW5kUG9pbnQpX2xpc3RlbmVyLkxvY2FsRW5kcG9pbnQpLlBvcnQ7' +
	'CiAgICAgICAgICAgIF9ydW5uaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgIFdyaXRlRGlzY292ZXJ5RmlsZSgpOwogICAgICAgICAg' +
	'ICBEZWJ1Zy5Mb2coJCJbR2FtZURldklERSBCcmlkZ2VdIFN0YXJ0ZWQgb24gcG9ydCB7X3BvcnR9ICh2e1BST1RPQ09MX1ZFUlNJ' +
	'T059KSIpOwoKICAgICAgICAgICAgLy8gQWNjZXB0IGNvbm5lY3Rpb25zIGluIGJhY2tncm91bmQKICAgICAgICAgICAgYXdhaXQg' +
	'QWNjZXB0Q29ubmVjdGlvbnMoX2N0cy5Ub2tlbik7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAg' +
	'ICAgewogICAgICAgICAgICBEZWJ1Zy5Mb2dFcnJvcigkIltHYW1lRGV2SURFIEJyaWRnZV0gRmFpbGVkIHRvIHN0YXJ0OiB7ZXgu' +
	'TWVzc2FnZX0iKTsKICAgICAgICAgICAgX3J1bm5pbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0' +
	'aWMgYXN5bmMgVGFzayBBY2NlcHRDb25uZWN0aW9ucyhDYW5jZWxsYXRpb25Ub2tlbiB0b2tlbikKICAgIHsKICAgICAgICB3aGls' +
	'ZSAoIXRva2VuLklzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkICYmIF9ydW5uaW5nKQogICAgICAgIHsKICAgICAgICAgICAgdHJ5CiAg' +
	'ICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBjbGllbnQgPSBhd2FpdCBfbGlzdGVuZXIuQWNjZXB0VGNwQ2xpZW50QXN5' +
	'bmMoKTsKICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBjbGllbnQuR2V0U3RyZWFtKCk7CgogICAgICAgICAgICAgICAgLy8g' +
	'UmVhZCB0aGUgSFRUUCB1cGdyYWRlIHJlcXVlc3QKICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgYnl0ZVs0MDk2XTsK' +
	'ICAgICAgICAgICAgICAgIGludCBieXRlc1JlYWQgPSBhd2FpdCBzdHJlYW0uUmVhZEFzeW5jKGJ1ZmZlciwgMCwgYnVmZmVyLkxl' +
	'bmd0aCwgdG9rZW4pOwogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBFbmNvZGluZy5VVEY4LkdldFN0cmluZyhidWZmZXIs' +
	'IDAsIGJ5dGVzUmVhZCk7CgogICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QuQ29udGFpbnMoIlVwZ3JhZGU6IHdlYnNvY2tldCIp' +
	'IHx8IHJlcXVlc3QuQ29udGFpbnMoIlVwZ3JhZGU6IFdlYlNvY2tldCIpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAg' +
	'ICAgICAgIC8vIE9ubHkgYWxsb3cgb25lIGNsaWVudCBhdCBhIHRpbWUKICAgICAgICAgICAgICAgICAgICBpZiAoX2NsaWVudENv' +
	'bm5lY3RlZCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWplY3QgPSBFbmNvZGlu' +
	'Zy5VVEY4LkdldEJ5dGVzKCJIVFRQLzEuMSA0MDkgQ29uZmxpY3RcclxuXHJcbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBh' +
	'd2FpdCBzdHJlYW0uV3JpdGVBc3luYyhyZWplY3QsIDAsIHJlamVjdC5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgY2xpZW50LkNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAg' +
	'IH0KCiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBXZWJTb2NrZXQgaGFuZHNoYWtlCiAgICAgICAgICAgICAgICAgICAg' +
	'aWYgKFBlcmZvcm1XZWJTb2NrZXRIYW5kc2hha2Uoc3RyZWFtLCByZXF1ZXN0KSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAg' +
	'ICAgICAgICAgICAgICAgICAgIF90Y3BDbGllbnQgPSBjbGllbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jbGllbnRTdHJl' +
	'YW0gPSBzdHJlYW07CiAgICAgICAgICAgICAgICAgICAgICAgIF9jbGllbnRDb25uZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAg' +
	'ICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURFIEJyaWRnZV0gSURFIGNvbm5lY3RlZCIpOwoKICAgICAgICAgICAgICAg' +
	'ICAgICAgICAgXyA9IFJlY2VpdmVNZXNzYWdlcyhzdHJlYW0sIHRva2VuKTsKICAgICAgICAgICAgICAgICAgICAgICAgXyA9IFNl' +
	'bmRNZXNzYWdlcyhzdHJlYW0sIHRva2VuKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQog' +
	'ICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50LkNsb3NlKCk7CiAgICAgICAgICAgICAg' +
	'ICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAg' +
	'ICAgICAgICAgIC8vIFNpbXBsZSBoZWFsdGggY2hlY2sKICAgICAgICAgICAgICAgICAgICB2YXIgYm9keSA9ICJ7XCJzdGF0dXNc' +
	'IjpcIm9rXCIsXCJ2ZXJzaW9uXCI6XCIiICsgUFJPVE9DT0xfVkVSU0lPTiArICJcIn0iOwogICAgICAgICAgICAgICAgICAgIHZh' +
	'ciByZXNwb25zZSA9ICJIVFRQLzEuMSAyMDAgT0tcclxuQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uXHJcbkNvbnRlbnQt' +
	'TGVuZ3RoOiAiICsgYm9keS5MZW5ndGggKyAiXHJcbkNvbm5lY3Rpb246IGNsb3NlXHJcblxyXG4iICsgYm9keTsKICAgICAgICAg' +
	'ICAgICAgICAgICB2YXIgcmVzcG9uc2VCeXRlcyA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMocmVzcG9uc2UpOwogICAgICAgICAg' +
	'ICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHJlc3BvbnNlQnl0ZXMsIDAsIHJlc3BvbnNlQnl0ZXMuTGVuZ3RoLCB0' +
	'b2tlbik7CiAgICAgICAgICAgICAgICAgICAgY2xpZW50LkNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K' +
	'ICAgICAgICAgICAgY2F0Y2ggKE9iamVjdERpc3Bvc2VkRXhjZXB0aW9uKSB7IGJyZWFrOyB9CiAgICAgICAgICAgIGNhdGNoIChT' +
	'b2NrZXRFeGNlcHRpb24pIHsgYnJlYWs7IH0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICAgICAgewog' +
	'ICAgICAgICAgICAgICAgaWYgKCF0b2tlbi5Jc0NhbmNlbGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgICAgICAgICBEZWJ1' +
	'Zy5Mb2dXYXJuaW5nKCQiW0dhbWVEZXZJREUgQnJpZGdlXSBDb25uZWN0aW9uIGVycm9yOiB7ZXguTWVzc2FnZX0iKTsKICAgICAg' +
	'ICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sIFBlcmZvcm1XZWJTb2NrZXRIYW5kc2hha2Uo' +
	'TmV0d29ya1N0cmVhbSBzdHJlYW0sIHN0cmluZyByZXF1ZXN0KQogICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAg' +
	'ICAgLy8gRXh0cmFjdCBTZWMtV2ViU29ja2V0LUtleSBmcm9tIHRoZSByZXF1ZXN0IGhlYWRlcnMKICAgICAgICAgICAgdmFyIGtl' +
	'eU1hdGNoID0gUmVnZXguTWF0Y2gocmVxdWVzdCwgQCJTZWMtV2ViU29ja2V0LUtleTpccyooLis/KVxyXG4iKTsKICAgICAgICAg' +
	'ICAgaWYgKCFrZXlNYXRjaC5TdWNjZXNzKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICB2YXIga2V5ID0ga2V5TWF0Y2guR3Jv' +
	'dXBzWzFdLlZhbHVlLlRyaW0oKTsKICAgICAgICAgICAgdmFyIGFjY2VwdEtleSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoCiAg' +
	'ICAgICAgICAgICAgICBTSEExLkNyZWF0ZSgpLkNvbXB1dGVIYXNoKAogICAgICAgICAgICAgICAgICAgIEVuY29kaW5nLlVURjgu' +
	'R2V0Qnl0ZXMoa2V5ICsgIjI1OEVBRkE1LUU5MTQtNDdEQS05NUNBLUM1QUIwREM4NUIxMSIpCiAgICAgICAgICAgICAgICApCiAg' +
	'ICAgICAgICAgICk7CgogICAgICAgICAgICB2YXIgcmVzcG9uc2UgPQogICAgICAgICAgICAgICAgIkhUVFAvMS4xIDEwMSBTd2l0' +
	'Y2hpbmcgUHJvdG9jb2xzXHJcbiIgKwogICAgICAgICAgICAgICAgIlVwZ3JhZGU6IHdlYnNvY2tldFxyXG4iICsKICAgICAgICAg' +
	'ICAgICAgICJDb25uZWN0aW9uOiBVcGdyYWRlXHJcbiIgKwogICAgICAgICAgICAgICAgIlNlYy1XZWJTb2NrZXQtQWNjZXB0OiAi' +
	'ICsgYWNjZXB0S2V5ICsgIlxyXG5cclxuIjsKCiAgICAgICAgICAgIHZhciByZXNwb25zZUJ5dGVzID0gRW5jb2RpbmcuVVRGOC5H' +
	'ZXRCeXRlcyhyZXNwb25zZSk7CiAgICAgICAgICAgIHN0cmVhbS5Xcml0ZShyZXNwb25zZUJ5dGVzLCAwLCByZXNwb25zZUJ5dGVz' +
	'Lkxlbmd0aCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQog' +
	'ICAgICAgIHsKICAgICAgICAgICAgRGVidWcuTG9nV2FybmluZygkIltHYW1lRGV2SURFIEJyaWRnZV0gSGFuZHNoYWtlIGZhaWxl' +
	'ZDoge2V4Lk1lc3NhZ2V9Iik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgYXN5bmMgVGFzayBSZWNlaXZlTWVzc2FnZXMoTmV0d29ya1N0cmVhbSBzdHJlYW0sIENhbmNlbGxhdGlvblRva2VuIHRv' +
	'a2VuKQogICAgewogICAgICAgIHZhciBidWZmZXIgPSBuZXcgYnl0ZVs4MTkyXTsKCiAgICAgICAgdHJ5CiAgICAgICAgewogICAg' +
	'ICAgICAgICB3aGlsZSAoX2NsaWVudENvbm5lY3RlZCAmJiAhdG9rZW4uSXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQpCiAgICAgICAg' +
	'ICAgIHsKICAgICAgICAgICAgICAgIGlmICghc3RyZWFtLkRhdGFBdmFpbGFibGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAg' +
	'ICAgICAgICAgICAgYXdhaXQgVGFzay5EZWxheSg4LCB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg' +
	'ICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaW50IGJ5dGVzUmVhZCA9IGF3YWl0IHN0cmVhbS5SZWFkQXN5bmMoYnVmZmVy' +
	'LCAwLCBidWZmZXIuTGVuZ3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkID09IDApCiAgICAgICAgICAg' +
	'ICAgICB7CiAgICAgICAgICAgICAgICAgICAgRGVidWcuTG9nKCJbR2FtZURldklERSBCcmlkZ2VdIElERSBkaXNjb25uZWN0ZWQi' +
	'KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBEZWNvZGUg' +
	'V2ViU29ja2V0IGZyYW1lKHMpCiAgICAgICAgICAgICAgICBpbnQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgICAgIHdoaWxlIChv' +
	'ZmZzZXQgPCBieXRlc1JlYWQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZyYW1lID0gRGVjb2Rl' +
	'V2ViU29ja2V0RnJhbWUoYnVmZmVyLCBvZmZzZXQsIGJ5dGVzUmVhZCAtIG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgaWYg' +
	'KGZyYW1lID09IG51bGwpIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZnJhbWUuVG90YWxMZW5ndGg7Cgog' +
	'ICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZS5PcGNvZGUgPT0gMHg4KSAvLyBDbG9zZQogICAgICAgICAgICAgICAgICAgIHsK' +
	'ICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2VuZCBjbG9zZSBmcmFtZSBiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgIHZh' +
	'ciBjbG9zZUZyYW1lID0gbmV3IGJ5dGVbXSB7IDB4ODgsIDB4MDAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3Ry' +
	'ZWFtLldyaXRlQXN5bmMoY2xvc2VGcmFtZSwgMCwgY2xvc2VGcmFtZS5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgRGVidWcuTG9nKCJbR2FtZURldklERSBCcmlkZ2VdIElERSBkaXNjb25uZWN0ZWQgKGNsb3NlIGZyYW1lKSIpOwogICAg' +
	'ICAgICAgICAgICAgICAgICAgICBEaXNjb25uZWN0Q2xpZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg' +
	'ICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZS5PcGNvZGUgPT0gMHg5KSAvLyBQaW5nCiAg' +
	'ICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIHBvbmcKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgdmFyIHBvbmcgPSBFbmNvZGVXZWJTb2NrZXRGcmFtZShmcmFtZS5QYXlsb2FkLCAweEEpOwogICAgICAgICAgICAgICAg' +
	'ICAgICAgICBhd2FpdCBzdHJlYW0uV3JpdGVBc3luYyhwb25nLCAwLCBwb25nLkxlbmd0aCwgdG9rZW4pOwogICAgICAgICAgICAg' +
	'ICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZS5P' +
	'cGNvZGUgPT0gMHgxIHx8IGZyYW1lLk9wY29kZSA9PSAweDIpIC8vIFRleHQgb3IgQmluYXJ5CiAgICAgICAgICAgICAgICAgICAg' +
	'ewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKGZyYW1lLlBheWxv' +
	'YWQpOwogICAgICAgICAgICAgICAgICAgICAgICBfaW5jb21pbmdNZXNzYWdlcy5FbnF1ZXVlKG1lc3NhZ2UpOwogICAgICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoSU9FeGNl' +
	'cHRpb24pIHsgLyogQ2xpZW50IGRpc2Nvbm5lY3RlZCAqLyB9CiAgICAgICAgY2F0Y2ggKE9wZXJhdGlvbkNhbmNlbGVkRXhjZXB0' +
	'aW9uKSB7IC8qIFNodXR0aW5nIGRvd24gKi8gfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAgICAg' +
	'ICAgICBEZWJ1Zy5Mb2dXYXJuaW5nKCQiW0dhbWVEZXZJREUgQnJpZGdlXSBSZWNlaXZlIGVycm9yOiB7ZXguTWVzc2FnZX0iKTsK' +
	'ICAgICAgICB9CgogICAgICAgIERpc2Nvbm5lY3RDbGllbnQoKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNr' +
	'IFNlbmRNZXNzYWdlcyhOZXR3b3JrU3RyZWFtIHN0cmVhbSwgQ2FuY2VsbGF0aW9uVG9rZW4gdG9rZW4pCiAgICB7CiAgICAgICAg' +
	'dHJ5CiAgICAgICAgewogICAgICAgICAgICB3aGlsZSAoX2NsaWVudENvbm5lY3RlZCAmJiAhdG9rZW4uSXNDYW5jZWxsYXRpb25S' +
	'ZXF1ZXN0ZWQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChfb3V0Z29pbmdNZXNzYWdlcy5UcnlEZXF1ZXVlKG91' +
	'dCB2YXIgbWVzc2FnZSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBFbmNvZGlu' +
	'Zy5VVEY4LkdldEJ5dGVzKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IEVuY29kZVdlYlNvY2tldEZy' +
	'YW1lKHBheWxvYWQsIDB4MSk7IC8vIFRleHQgZnJhbWUKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYW0uV3JpdGVBc3lu' +
	'YyhmcmFtZSwgMCwgZnJhbWUuTGVuZ3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAg' +
	'ICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGFzay5EZWxheSgxNiwgdG9rZW4pOyAvLyB+NjBIeiBw' +
	'b2xsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKElPRXhjZXB0aW9uKSB7' +
	'IH0KICAgICAgICBjYXRjaCAoT3BlcmF0aW9uQ2FuY2VsZWRFeGNlcHRpb24pIHsgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj' +
	'IHZvaWQgRGlzY29ubmVjdENsaWVudCgpCiAgICB7CiAgICAgICAgX2NsaWVudENvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgIHRy' +
	'eSB7IF9jbGllbnRTdHJlYW0/LkNsb3NlKCk7IH0gY2F0Y2ggeyB9CiAgICAgICAgdHJ5IHsgX3RjcENsaWVudD8uQ2xvc2UoKTsg' +
	'fSBjYXRjaCB7IH0KICAgICAgICBfY2xpZW50U3RyZWFtID0gbnVsbDsKICAgICAgICBfdGNwQ2xpZW50ID0gbnVsbDsKICAgIH0K' +
	'CiAgICAvLyAtLS0gV2ViU29ja2V0IEZyYW1lIEVuY29kaW5nL0RlY29kaW5nIC0tLQoKICAgIHByaXZhdGUgY2xhc3MgV2ViU29j' +
	'a2V0RnJhbWUKICAgIHsKICAgICAgICBwdWJsaWMgYnl0ZSBPcGNvZGU7CiAgICAgICAgcHVibGljIGJ5dGVbXSBQYXlsb2FkOwog' +
	'ICAgICAgIHB1YmxpYyBpbnQgVG90YWxMZW5ndGg7IC8vIFRvdGFsIGJ5dGVzIGNvbnN1bWVkIGZyb20gYnVmZmVyCiAgICB9Cgog' +
	'ICAgcHJpdmF0ZSBzdGF0aWMgV2ViU29ja2V0RnJhbWUgRGVjb2RlV2ViU29ja2V0RnJhbWUoYnl0ZVtdIGJ1ZmZlciwgaW50IG9m' +
	'ZnNldCwgaW50IGxlbmd0aCkKICAgIHsKICAgICAgICBpZiAobGVuZ3RoIDwgMikgcmV0dXJuIG51bGw7CgogICAgICAgIHZhciBv' +
	'cGNvZGUgPSAoYnl0ZSkoYnVmZmVyW29mZnNldF0gJiAweDBGKTsKICAgICAgICB2YXIgbWFza2VkID0gKGJ1ZmZlcltvZmZzZXQg' +
	'KyAxXSAmIDB4ODApICE9IDA7CiAgICAgICAgbG9uZyBwYXlsb2FkTGVuID0gYnVmZmVyW29mZnNldCArIDFdICYgMHg3RjsKICAg' +
	'ICAgICBpbnQgaGVhZGVyTGVuID0gMjsKCiAgICAgICAgaWYgKHBheWxvYWRMZW4gPT0gMTI2KQogICAgICAgIHsKICAgICAgICAg' +
	'ICAgaWYgKGxlbmd0aCA8IDQpIHJldHVybiBudWxsOwogICAgICAgICAgICBwYXlsb2FkTGVuID0gKGJ1ZmZlcltvZmZzZXQgKyAy' +
	'XSA8PCA4KSB8IGJ1ZmZlcltvZmZzZXQgKyAzXTsKICAgICAgICAgICAgaGVhZGVyTGVuID0gNDsKICAgICAgICB9CiAgICAgICAg' +
	'ZWxzZSBpZiAocGF5bG9hZExlbiA9PSAxMjcpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgMTApIHJldHVybiBu' +
	'dWxsOwogICAgICAgICAgICBwYXlsb2FkTGVuID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA4OyBpKyspCiAg' +
	'ICAgICAgICAgICAgICBwYXlsb2FkTGVuID0gKHBheWxvYWRMZW4gPDwgOCkgfCBidWZmZXJbb2Zmc2V0ICsgMiArIGldOwogICAg' +
	'ICAgICAgICBoZWFkZXJMZW4gPSAxMDsKICAgICAgICB9CgogICAgICAgIGJ5dGVbXSBtYXNrS2V5ID0gbnVsbDsKICAgICAgICBp' +
	'ZiAobWFza2VkKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGxlbmd0aCA8IGhlYWRlckxlbiArIDQpIHJldHVybiBudWxsOwog' +
	'ICAgICAgICAgICBtYXNrS2V5ID0gbmV3IGJ5dGVbNF07CiAgICAgICAgICAgIEFycmF5LkNvcHkoYnVmZmVyLCBvZmZzZXQgKyBo' +
	'ZWFkZXJMZW4sIG1hc2tLZXksIDAsIDQpOwogICAgICAgICAgICBoZWFkZXJMZW4gKz0gNDsKICAgICAgICB9CgogICAgICAgIGlm' +
	'IChsZW5ndGggPCBoZWFkZXJMZW4gKyBwYXlsb2FkTGVuKSByZXR1cm4gbnVsbDsKCiAgICAgICAgdmFyIHBheWxvYWQgPSBuZXcg' +
	'Ynl0ZVtwYXlsb2FkTGVuXTsKICAgICAgICBBcnJheS5Db3B5KGJ1ZmZlciwgb2Zmc2V0ICsgaGVhZGVyTGVuLCBwYXlsb2FkLCAw' +
	'LCAoaW50KXBheWxvYWRMZW4pOwoKICAgICAgICBpZiAobWFza2VkICYmIG1hc2tLZXkgIT0gbnVsbCkKICAgICAgICB7CiAgICAg' +
	'ICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGF5bG9hZC5MZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHBheWxvYWRbaV0g' +
	'Xj0gbWFza0tleVtpICUgNF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV3IFdlYlNvY2tldEZyYW1lCiAgICAgICAgewog' +
	'ICAgICAgICAgICBPcGNvZGUgPSBvcGNvZGUsCiAgICAgICAgICAgIFBheWxvYWQgPSBwYXlsb2FkLAogICAgICAgICAgICBUb3Rh' +
	'bExlbmd0aCA9IGhlYWRlckxlbiArIChpbnQpcGF5bG9hZExlbgogICAgICAgIH07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMg' +
	'Ynl0ZVtdIEVuY29kZVdlYlNvY2tldEZyYW1lKGJ5dGVbXSBwYXlsb2FkLCBieXRlIG9wY29kZSkKICAgIHsKICAgICAgICB2YXIg' +
	'bGVuID0gcGF5bG9hZC5MZW5ndGg7CiAgICAgICAgYnl0ZVtdIGZyYW1lOwoKICAgICAgICBpZiAobGVuIDwgMTI2KQogICAgICAg' +
	'IHsKICAgICAgICAgICAgZnJhbWUgPSBuZXcgYnl0ZVsyICsgbGVuXTsKICAgICAgICAgICAgZnJhbWVbMF0gPSAoYnl0ZSkoMHg4' +
	'MCB8IG9wY29kZSk7IC8vIEZJTiArIG9wY29kZQogICAgICAgICAgICBmcmFtZVsxXSA9IChieXRlKWxlbjsKICAgICAgICAgICAg' +
	'QXJyYXkuQ29weShwYXlsb2FkLCAwLCBmcmFtZSwgMiwgbGVuKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAobGVuIDwgNjU1' +
	'MzYpCiAgICAgICAgewogICAgICAgICAgICBmcmFtZSA9IG5ldyBieXRlWzQgKyBsZW5dOwogICAgICAgICAgICBmcmFtZVswXSA9' +
	'IChieXRlKSgweDgwIHwgb3Bjb2RlKTsKICAgICAgICAgICAgZnJhbWVbMV0gPSAxMjY7CiAgICAgICAgICAgIGZyYW1lWzJdID0g' +
	'KGJ5dGUpKGxlbiA+PiA4KTsKICAgICAgICAgICAgZnJhbWVbM10gPSAoYnl0ZSkobGVuICYgMHhGRik7CiAgICAgICAgICAgIEFy' +
	'cmF5LkNvcHkocGF5bG9hZCwgMCwgZnJhbWUsIDQsIGxlbik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAg' +
	'ICAgICAgIGZyYW1lID0gbmV3IGJ5dGVbMTAgKyBsZW5dOwogICAgICAgICAgICBmcmFtZVswXSA9IChieXRlKSgweDgwIHwgb3Bj' +
	'b2RlKTsKICAgICAgICAgICAgZnJhbWVbMV0gPSAxMjc7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgODsgaSsrKQog' +
	'ICAgICAgICAgICAgICAgZnJhbWVbMiArIGldID0gKGJ5dGUpKChsZW4gPj4gKDU2IC0gaSAqIDgpKSAmIDB4RkYpOwogICAgICAg' +
	'ICAgICBBcnJheS5Db3B5KHBheWxvYWQsIDAsIGZyYW1lLCAxMCwgbGVuKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmcmFt' +
	'ZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFdyaXRlRGlzY292ZXJ5RmlsZSgpCiAgICB7CiAgICAgICAgdHJ5CiAg' +
	'ICAgICAgewogICAgICAgICAgICBpZiAoIURpcmVjdG9yeS5FeGlzdHMoRElTQ09WRVJZX0RJUikpCiAgICAgICAgICAgICAgICBE' +
	'aXJlY3RvcnkuQ3JlYXRlRGlyZWN0b3J5KERJU0NPVkVSWV9ESVIpOwoKICAgICAgICAgICAgdmFyIGpzb24gPSAkInt7XCJwb3J0' +
	'XCI6e19wb3J0fSxcInBpZFwiOntTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2Vzcy5HZXRDdXJyZW50UHJvY2VzcygpLklkfSxcInZl' +
	'cnNpb25cIjpcIntQUk9UT0NPTF9WRVJTSU9OfVwiLFwidGltZXN0YW1wXCI6e0RhdGVUaW1lT2Zmc2V0LlV0Y05vdy5Ub1VuaXhU' +
	'aW1lU2Vjb25kcygpfX19IjsKICAgICAgICAgICAgRmlsZS5Xcml0ZUFsbFRleHQoRElTQ09WRVJZX0ZJTEUsIGpzb24pOwogICAg' +
	'ICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgIHsKICAgICAgICAgICAgRGVidWcuTG9nRXJyb3IoJCJb' +
	'R2FtZURldklERSBCcmlkZ2VdIEZhaWxlZCB0byB3cml0ZSBkaXNjb3ZlcnkgZmlsZToge2V4Lk1lc3NhZ2V9Iik7CiAgICAgICAg' +
	'fQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgU2h1dGRvd24oKQogICAgewogICAgICAgIF9ydW5uaW5nID0gZmFsc2U7' +
	'CiAgICAgICAgX2N0cz8uQ2FuY2VsKCk7CgogICAgICAgIERpc2Nvbm5lY3RDbGllbnQoKTsKCiAgICAgICAgdHJ5IHsgX2xpc3Rl' +
	'bmVyPy5TdG9wKCk7IH0KICAgICAgICBjYXRjaCB7IH0KCiAgICAgICAgdHJ5IHsgaWYgKEZpbGUuRXhpc3RzKERJU0NPVkVSWV9G' +
	'SUxFKSkgRmlsZS5EZWxldGUoRElTQ09WRVJZX0ZJTEUpOyB9CiAgICAgICAgY2F0Y2ggeyB9CgogICAgICAgIERlYnVnLkxvZygi' +
	'W0dhbWVEZXZJREUgQnJpZGdlXSBTdG9wcGVkIik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBPbkJlZm9yZVJlbG9h' +
	'ZCgpCiAgICB7CiAgICAgICAgLy8gQ2xlYW4gdXAgYmVmb3JlIGRvbWFpbiByZWxvYWQgKHNjcmlwdCByZWNvbXBpbGF0aW9uKQog' +
	'ICAgICAgIFNodXRkb3duKCk7CiAgICB9CgogICAgLy8gLS0tIFVuaXR5IEV2ZW50IEZvcndhcmRpbmcgLS0tCgogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgdm9pZCBPbkxvZ01lc3NhZ2Uoc3RyaW5nIGNvbmRpdGlvbiwgc3RyaW5nIHN0YWNrVHJhY2UsIExvZ1R5cGUgdHlw' +
	'ZSkKICAgIHsKICAgICAgICBpZiAoIV9jbGllbnRDb25uZWN0ZWQpIHJldHVybjsKCiAgICAgICAgdmFyIGxvZ1R5cGUgPSB0eXBl' +
	'IHN3aXRjaAogICAgICAgIHsKICAgICAgICAgICAgTG9nVHlwZS5FcnJvciA9PiAiRXJyb3IiLAogICAgICAgICAgICBMb2dUeXBl' +
	'Lldhcm5pbmcgPT4gIldhcm5pbmciLAogICAgICAgICAgICBMb2dUeXBlLkV4Y2VwdGlvbiA9PiAiRXhjZXB0aW9uIiwKICAgICAg' +
	'ICAgICAgTG9nVHlwZS5Bc3NlcnQgPT4gIkFzc2VydCIsCiAgICAgICAgICAgIF8gPT4gIkxvZyIKICAgICAgICB9OwoKICAgICAg' +
	'ICB2YXIgZXZlbnRKc29uID0gJCJ7e1wiaWRcIjpcIntHdWlkLk5ld0d1aWQoKX1cIixcInR5cGVcIjpcImV2ZW50XCIsXCJldmVu' +
	'dFwiOlwiY29uc29sZS5sb2dcIixcImRhdGFcIjp7e1wibWVzc2FnZVwiOntFc2NhcGVKc29uKGNvbmRpdGlvbil9LFwic3RhY2tU' +
	'cmFjZVwiOntFc2NhcGVKc29uKHN0YWNrVHJhY2UgPz8gIiIpfSxcImxvZ1R5cGVcIjpcIntsb2dUeXBlfVwiLFwidGltZXN0YW1w' +
	'XCI6e0RhdGVUaW1lT2Zmc2V0LlV0Y05vdy5Ub1VuaXhUaW1lTWlsbGlzZWNvbmRzKCl9fX19fSI7CiAgICAgICAgX291dGdvaW5n' +
	'TWVzc2FnZXMuRW5xdWV1ZShldmVudEpzb24pOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgT25QbGF5TW9kZUNoYW5n' +
	'ZWQoUGxheU1vZGVTdGF0ZUNoYW5nZSBzdGF0ZSkKICAgIHsKICAgICAgICBpZiAoIV9jbGllbnRDb25uZWN0ZWQpIHJldHVybjsK' +
	'CiAgICAgICAgdmFyIHBsYXlTdGF0ZSA9IHN0YXRlIHN3aXRjaAogICAgICAgIHsKICAgICAgICAgICAgUGxheU1vZGVTdGF0ZUNo' +
	'YW5nZS5FbnRlcmVkUGxheU1vZGUgPT4gInBsYXlpbmciLAogICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkV4aXRpbmdQ' +
	'bGF5TW9kZSA9PiAic3RvcHBlZCIsCiAgICAgICAgICAgIFBsYXlNb2RlU3RhdGVDaGFuZ2UuRW50ZXJlZEVkaXRNb2RlID0+ICJz' +
	'dG9wcGVkIiwKICAgICAgICAgICAgUGxheU1vZGVTdGF0ZUNoYW5nZS5FeGl0aW5nRWRpdE1vZGUgPT4gInBsYXlpbmciLAogICAg' +
	'ICAgICAgICBfID0+ICJzdG9wcGVkIgogICAgICAgIH07CgogICAgICAgIHZhciBldmVudEpzb24gPSAkInt7XCJpZFwiOlwie0d1' +
	'aWQuTmV3R3VpZCgpfVwiLFwidHlwZVwiOlwiZXZlbnRcIixcImV2ZW50XCI6XCJwbGF5TW9kZUNoYW5nZWRcIixcImRhdGFcIjp7' +
	'e1wic3RhdGVcIjpcIntwbGF5U3RhdGV9XCJ9fX19IjsKICAgICAgICBfb3V0Z29pbmdNZXNzYWdlcy5FbnF1ZXVlKGV2ZW50SnNv' +
	'bik7CiAgICB9CgogICAgLy8gLS0tIE1lc3NhZ2UgUHJvY2Vzc2luZyAoTWFpbiBUaHJlYWQpIC0tLQoKICAgIHByaXZhdGUgc3Rh' +
	'dGljIHZvaWQgUHJvY2Vzc01lc3NhZ2VzKCkKICAgIHsKICAgICAgICAvLyBSZWZyZXNoIGRpc2NvdmVyeSBmaWxlIGV2ZXJ5IDMw' +
	'IHNlY29uZHMgc28gdGhlIElERSBrbm93cyB3ZSdyZSBhbGl2ZQogICAgICAgIGlmIChfcnVubmluZyAmJiBFZGl0b3JBcHBsaWNh' +
	'dGlvbi50aW1lU2luY2VTdGFydHVwIC0gX2xhc3REaXNjb3ZlcnlSZWZyZXNoID4gMzAuMCkKICAgICAgICB7CiAgICAgICAgICAg' +
	'IF9sYXN0RGlzY292ZXJ5UmVmcmVzaCA9IEVkaXRvckFwcGxpY2F0aW9uLnRpbWVTaW5jZVN0YXJ0dXA7CiAgICAgICAgICAgIFdy' +
	'aXRlRGlzY292ZXJ5RmlsZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gUHJvY2VzcyB1cCB0byAxMCBtZXNzYWdlcyBwZXIgZnJh' +
	'bWUgdG8gYXZvaWQgYmxvY2tpbmcKICAgICAgICBpbnQgcHJvY2Vzc2VkID0gMDsKICAgICAgICB3aGlsZSAoX2luY29taW5nTWVz' +
	'c2FnZXMuVHJ5RGVxdWV1ZShvdXQgdmFyIG1lc3NhZ2UpICYmIHByb2Nlc3NlZCA8IDEwKQogICAgICAgIHsKICAgICAgICAgICAg' +
	'cHJvY2Vzc2VkKys7CiAgICAgICAgICAgIHN0cmluZyByZXF1ZXN0SWQgPSAidW5rbm93biI7CiAgICAgICAgICAgIHRyeQogICAg' +
	'ICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IFBhcnNlUmVxdWVzdChtZXNzYWdlKTsKICAgICAgICAgICAg' +
	'ICAgIHJlcXVlc3RJZCA9IHJlcXVlc3QuaWQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBIYW5kbGVDb21tYW5kKHJl' +
	'cXVlc3QpOwogICAgICAgICAgICAgICAgX291dGdvaW5nTWVzc2FnZXMuRW5xdWV1ZShyZXNwb25zZSk7CiAgICAgICAgICAgIH0K' +
	'ICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgRGVidWcuTG9nRXJy' +
	'b3IoJCJbR2FtZURldklERSBCcmlkZ2VdIEVycm9yIHByb2Nlc3NpbmcgbWVzc2FnZToge2V4Lk1lc3NhZ2V9Iik7CiAgICAgICAg' +
	'ICAgICAgICBfb3V0Z29pbmdNZXNzYWdlcy5FbnF1ZXVlKE1ha2VFcnJvcihyZXF1ZXN0SWQsIGV4Lk1lc3NhZ2UpKTsKICAgICAg' +
	'ICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gPHN1bW1hcnk+CiAgICAvLy8gTWFudWFsbHkgcGFyc2UgYSBKU09OIHJl' +
	'cXVlc3Qgc2luY2UgVW5pdHkncyBKc29uVXRpbGl0eSBjYW4ndCBoYW5kbGUKICAgIC8vLyBuZXN0ZWQgZGljdGlvbmFyaWVzIG9y' +
	'IHRoZSAncGFyYW1zJyBmaWVsZCBwcm9wZXJseS4KICAgIC8vLyA8L3N1bW1hcnk+CiAgICBwcml2YXRlIHN0YXRpYyBTZXJpYWxp' +
	'emFibGVSZXF1ZXN0IFBhcnNlUmVxdWVzdChzdHJpbmcganNvbikKICAgIHsKICAgICAgICB2YXIgcmVxID0gbmV3IFNlcmlhbGl6' +
	'YWJsZVJlcXVlc3QoKTsKICAgICAgICByZXEuaWQgPSBFeHRyYWN0SnNvblN0cmluZyhqc29uLCAiaWQiKSA/PyBHdWlkLk5ld0d1' +
	'aWQoKS5Ub1N0cmluZygpOwogICAgICAgIHJlcS50eXBlID0gRXh0cmFjdEpzb25TdHJpbmcoanNvbiwgInR5cGUiKSA/PyAicmVx' +
	'dWVzdCI7CiAgICAgICAgcmVxLmNhdGVnb3J5ID0gRXh0cmFjdEpzb25TdHJpbmcoanNvbiwgImNhdGVnb3J5IikgPz8gIiI7CiAg' +
	'ICAgICAgcmVxLmFjdGlvbiA9IEV4dHJhY3RKc29uU3RyaW5nKGpzb24sICJhY3Rpb24iKSA/PyAiIjsKCiAgICAgICAgLy8gRXh0' +
	'cmFjdCB0aGUgcGFyYW1zIG9iamVjdCBhcyBhIHJhdyBKU09OIHN1YnN0cmluZwogICAgICAgIHZhciBwYXJhbXNJZHggPSBqc29u' +
	'LkluZGV4T2YoIlwicGFyYW1zXCIiKTsKICAgICAgICBpZiAocGFyYW1zSWR4ID49IDApCiAgICAgICAgewogICAgICAgICAgICB2' +
	'YXIgY29sb25JZHggPSBqc29uLkluZGV4T2YoJzonLCBwYXJhbXNJZHgpOwogICAgICAgICAgICBpZiAoY29sb25JZHggPj0gMCkK' +
	'ICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVxLnBhcmFtc0pzb24gPSBFeHRyYWN0SnNvbk9iamVjdChqc29uLCBjb2xv' +
	'bklkeCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVxOwogICAgfQoKICAgIHByaXZhdGUg' +
	'c3RhdGljIHN0cmluZyBFeHRyYWN0SnNvblN0cmluZyhzdHJpbmcganNvbiwgc3RyaW5nIGtleSkKICAgIHsKICAgICAgICB2YXIg' +
	'cGF0dGVybiA9ICQiXCJ7a2V5fVwiIjsKICAgICAgICB2YXIgaWR4ID0ganNvbi5JbmRleE9mKHBhdHRlcm4pOwogICAgICAgIGlm' +
	'IChpZHggPCAwKSByZXR1cm4gbnVsbDsKCiAgICAgICAgdmFyIGNvbG9uSWR4ID0ganNvbi5JbmRleE9mKCc6JywgaWR4ICsgcGF0' +
	'dGVybi5MZW5ndGgpOwogICAgICAgIGlmIChjb2xvbklkeCA8IDApIHJldHVybiBudWxsOwoKICAgICAgICAvLyBTa2lwIHdoaXRl' +
	'c3BhY2UKICAgICAgICB2YXIgc3RhcnRJZHggPSBjb2xvbklkeCArIDE7CiAgICAgICAgd2hpbGUgKHN0YXJ0SWR4IDwganNvbi5M' +
	'ZW5ndGggJiYgY2hhci5Jc1doaXRlU3BhY2UoanNvbltzdGFydElkeF0pKSBzdGFydElkeCsrOwoKICAgICAgICBpZiAoc3RhcnRJ' +
	'ZHggPj0ganNvbi5MZW5ndGggfHwganNvbltzdGFydElkeF0gIT0gJyInKSByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gUmVhZCB1' +
	'bnRpbCBjbG9zaW5nIHF1b3RlIChoYW5kbGluZyBlc2NhcGVzKQogICAgICAgIHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7' +
	'CiAgICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0SWR4ICsgMTsgaSA8IGpzb24uTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAg' +
	'ICAgICBpZiAoanNvbltpXSA9PSAnXFwnICYmIGkgKyAxIDwganNvbi5MZW5ndGgpCiAgICAgICAgICAgIHsKICAgICAgICAgICAg' +
	'ICAgIHNiLkFwcGVuZChqc29uW2kgKyAxXSk7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg' +
	'ZWxzZSBpZiAoanNvbltpXSA9PSAnIicpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9' +
	'CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc2IuQXBwZW5kKGpzb25baV0pOwogICAgICAg' +
	'ICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzYi5Ub1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0' +
	'cmluZyBFeHRyYWN0SnNvbk9iamVjdChzdHJpbmcganNvbiwgaW50IHN0YXJ0SWR4KQogICAgewogICAgICAgIC8vIFNraXAgd2hp' +
	'dGVzcGFjZQogICAgICAgIHdoaWxlIChzdGFydElkeCA8IGpzb24uTGVuZ3RoICYmIGNoYXIuSXNXaGl0ZVNwYWNlKGpzb25bc3Rh' +
	'cnRJZHhdKSkgc3RhcnRJZHgrKzsKICAgICAgICBpZiAoc3RhcnRJZHggPj0ganNvbi5MZW5ndGggfHwganNvbltzdGFydElkeF0g' +
	'IT0gJ3snKSByZXR1cm4gInt9IjsKCiAgICAgICAgdmFyIGRlcHRoID0gMDsKICAgICAgICB2YXIgaW5TdHJpbmcgPSBmYWxzZTsK' +
	'ICAgICAgICBmb3IgKGludCBpID0gc3RhcnRJZHg7IGkgPCBqc29uLkxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAg' +
	'aWYgKGpzb25baV0gPT0gJyInICYmIChpID09IDAgfHwganNvbltpIC0gMV0gIT0gJ1xcJykpCiAgICAgICAgICAgICAgICBpblN0' +
	'cmluZyA9ICFpblN0cmluZzsKICAgICAgICAgICAgZWxzZSBpZiAoIWluU3RyaW5nKQogICAgICAgICAgICB7CiAgICAgICAgICAg' +
	'ICAgICBpZiAoanNvbltpXSA9PSAneycpIGRlcHRoKys7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChqc29uW2ldID09ICd9JykK' +
	'ICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBkZXB0aC0tOwogICAgICAgICAgICAgICAgICAgIGlmIChkZXB0' +
	'aCA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5TdWJzdHJpbmcoc3RhcnRJZHgsIGkgLSBzdGFydElk' +
	'eCArIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAie30iOwogICAg' +
	'fQoKICAgIC8vIC0tLSBDb21tYW5kIERpc3BhdGNoIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVDb21tYW5k' +
	'KFNlcmlhbGl6YWJsZVJlcXVlc3QgcmVxdWVzdCkKICAgIHsKICAgICAgICB2YXIga2V5ID0gJCJ7cmVxdWVzdC5jYXRlZ29yeX0u' +
	'e3JlcXVlc3QuYWN0aW9ufSI7CiAgICAgICAgdmFyIHAgPSByZXF1ZXN0LkdldFBhcmFtcygpOwoKICAgICAgICBzd2l0Y2ggKGtl' +
	'eSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIC0tLSBTY2VuZSAtLS0KICAgICAgICAgICAgY2FzZSAic2NlbmUuZ2V0QWN0aXZl' +
	'IjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVHZXRBY3RpdmVTY2VuZShyZXF1ZXN0LmlkKTsKICAgICAgICAgICAgY2Fz' +
	'ZSAic2NlbmUuZ2V0SGllcmFyY2h5IjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVHZXRIaWVyYXJjaHkocmVxdWVzdC5p' +
	'ZCk7CiAgICAgICAgICAgIGNhc2UgInNjZW5lLmNyZWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlU2Nl' +
	'bmUocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgInNjZW5lLnNhdmUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhh' +
	'bmRsZVNhdmVTY2VuZShyZXF1ZXN0LmlkKTsKCiAgICAgICAgICAgIC8vIC0tLSBHYW1lT2JqZWN0IC0tLQogICAgICAgICAgICBj' +
	'YXNlICJnYW1lT2JqZWN0LmNyZWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlR2FtZU9iamVjdChyZXF1' +
	'ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5jcmVhdGVQcmltaXRpdmUiOgogICAgICAgICAgICAgICAg' +
	'cmV0dXJuIEhhbmRsZUNyZWF0ZVByaW1pdGl2ZShyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5m' +
	'aW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVGaW5kR2FtZU9iamVjdChyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAg' +
	'ICAgY2FzZSAiZ2FtZU9iamVjdC5kZXN0cm95IjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVEZXN0cm95R2FtZU9iamVj' +
	'dChyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5zZXRBY3RpdmUiOgogICAgICAgICAgICAgICAg' +
	'cmV0dXJuIEhhbmRsZVNldEFjdGl2ZShyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5zZXRUcmFu' +
	'c2Zvcm0iOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZVNldFRyYW5zZm9ybShyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAg' +
	'ICAgY2FzZSAiZ2FtZU9iamVjdC5nZXRTZWxlY3RlZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlR2V0U2VsZWN0ZWQo' +
	'cmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0gQ29tcG9uZW50IC0tLQogICAgICAgICAgICBjYXNlICJjb21wb25lbnQu' +
	'YWRkIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVBZGRDb21wb25lbnQocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAg' +
	'IGNhc2UgImNvbXBvbmVudC5yZW1vdmUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZVJlbW92ZUNvbXBvbmVudChyZXF1' +
	'ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiY29tcG9uZW50LmdldEFsbCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFu' +
	'ZGxlR2V0Q29tcG9uZW50cyhyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiY29tcG9uZW50LnNldFByb3BlcnR5IjoK' +
	'ICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRQcm9wZXJ0eShyZXF1ZXN0LmlkLCBwKTsKCiAgICAgICAgICAgIC8vIC0t' +
	'LSBQcmVmYWIgLS0tCiAgICAgICAgICAgIGNhc2UgInByZWZhYi5jcmVhdGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRs' +
	'ZUNyZWF0ZVByZWZhYihyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAicHJlZmFiLmluc3RhbnRpYXRlIjoKICAgICAg' +
	'ICAgICAgICAgIHJldHVybiBIYW5kbGVJbnN0YW50aWF0ZVByZWZhYihyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAi' +
	'cHJlZmFiLmdldEFsbCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlR2V0QWxsUHJlZmFicyhyZXF1ZXN0LmlkKTsKCiAg' +
	'ICAgICAgICAgIC8vIC0tLSBBc3NldCAtLS0KICAgICAgICAgICAgY2FzZSAiYXNzZXQuY3JlYXRlIjoKICAgICAgICAgICAgICAg' +
	'IHJldHVybiBIYW5kbGVDcmVhdGVBc3NldChyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiYXNzZXQuZmluZCI6CiAg' +
	'ICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlRmluZEFzc2V0cyhyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiYXNz' +
	'ZXQuaW1wb3J0IjoKICAgICAgICAgICAgICAgIEFzc2V0RGF0YWJhc2UuUmVmcmVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7fSIpOwoKICAgICAgICAgICAgLy8gLS0tIFByb2plY3QgLS0tCiAgICAgICAgICAg' +
	'IGNhc2UgInByb2plY3QuZ2V0SW5mbyI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlR2V0UHJvamVjdEluZm8ocmVxdWVz' +
	'dC5pZCk7CiAgICAgICAgICAgIGNhc2UgInByb2plY3QucmVmcmVzaCI6CiAgICAgICAgICAgICAgICBBc3NldERhdGFiYXNlLlJl' +
	'ZnJlc2goKTsKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAie30iKTsKCiAgICAgICAgICAg' +
	'IC8vIC0tLSBFZGl0b3IgLS0tCiAgICAgICAgICAgIGNhc2UgImVkaXRvci5nZXRQbGF5TW9kZSI6CiAgICAgICAgICAgICAgICBy' +
	'ZXR1cm4gSGFuZGxlR2V0UGxheU1vZGUocmVxdWVzdC5pZCk7CiAgICAgICAgICAgIGNhc2UgImVkaXRvci5wbGF5IjoKICAgICAg' +
	'ICAgICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLmlzUGxheWluZyA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1' +
	'Y2Nlc3MocmVxdWVzdC5pZCwgIntcInN0YXRlXCI6XCJwbGF5aW5nXCJ9Iik7CiAgICAgICAgICAgIGNhc2UgImVkaXRvci5wYXVz' +
	'ZSI6CiAgICAgICAgICAgICAgICBFZGl0b3JBcHBsaWNhdGlvbi5pc1BhdXNlZCA9ICFFZGl0b3JBcHBsaWNhdGlvbi5pc1BhdXNl' +
	'ZDsKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAkInt7XCJwYXVzZWRcIjp7RWRpdG9yQXBw' +
	'bGljYXRpb24uaXNQYXVzZWQuVG9TdHJpbmcoKS5Ub0xvd2VyKCl9fX0iKTsKICAgICAgICAgICAgY2FzZSAiZWRpdG9yLnN0b3Ai' +
	'OgogICAgICAgICAgICAgICAgRWRpdG9yQXBwbGljYXRpb24uaXNQbGF5aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1' +
	'cm4gTWFrZVN1Y2Nlc3MocmVxdWVzdC5pZCwgIntcInN0YXRlXCI6XCJzdG9wcGVkXCJ9Iik7CiAgICAgICAgICAgIGNhc2UgImVk' +
	'aXRvci5leGVjdXRlTWVudUl0ZW0iOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUV4ZWN1dGVNZW51SXRlbShyZXF1ZXN0' +
	'LmlkLCBwKTsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKHJlcXVlc3QuaWQs' +
	'ICQiVW5rbm93biBjb21tYW5kOiB7a2V5fSIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyAtLS0gU2NlbmUgSGFuZGxlcnMgLS0t' +
	'CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldEFjdGl2ZVNjZW5lKHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2' +
	'YXIgc2NlbmUgPSBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQi' +
	'e3tcIm5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0VzY2FwZUpzb24oc2NlbmUucGF0aCl9LFwicm9v' +
	'dENvdW50XCI6e3NjZW5lLnJvb3RDb3VudH0sXCJpc0RpcnR5XCI6e3NjZW5lLmlzRGlydHkuVG9TdHJpbmcoKS5Ub0xvd2VyKCl9' +
	'fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0SGllcmFyY2h5KHN0cmluZyBpZCkKICAgIHsK' +
	'ICAgICAgICB2YXIgc2NlbmUgPSBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKTsKICAgICAgICB2YXIgcm9vdHMgPSBzY2Vu' +
	'ZS5HZXRSb290R2FtZU9iamVjdHMoKTsKICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFw' +
	'cGVuZCgie1wic2NlbmVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihzY2VuZS5uYW1lKSk7CiAgICAgICAgc2Iu' +
	'QXBwZW5kKCIsXCJoaWVyYXJjaHlcIjpbIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByb290cy5MZW5ndGg7IGkrKykK' +
	'ICAgICAgICB7CiAgICAgICAgICAgIGlmIChpID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIEJ1aWxkSGllcmFyY2h5' +
	'SnNvbihyb290c1tpXSwgc2IpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAgICAgICAgcmV0dXJuIE1ha2VT' +
	'dWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIEJ1aWxkSGllcmFyY2h5SnNv' +
	'bihHYW1lT2JqZWN0IGdvLCBTdHJpbmdCdWlsZGVyIHNiKQogICAgewogICAgICAgIHNiLkFwcGVuZCgie1wibmFtZVwiOiIpOwog' +
	'ICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKGdvLm5hbWUpKTsKICAgICAgICBzYi5BcHBlbmQoIixcImFjdGl2ZVwiOiIpOwog' +
	'ICAgICAgIHNiLkFwcGVuZChnby5hY3RpdmVTZWxmLlRvU3RyaW5nKCkuVG9Mb3dlcigpKTsKICAgICAgICBzYi5BcHBlbmQoIixc' +
	'ImNvbXBvbmVudHNcIjpbIik7CiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBnby5HZXRDb21wb25lbnRzPENvbXBvbmVudD4oKTsK' +
	'ICAgICAgICBmb3IgKGludCBjID0gMDsgYyA8IGNvbXBvbmVudHMuTGVuZ3RoOyBjKyspCiAgICAgICAgewogICAgICAgICAgICBp' +
	'ZiAoY29tcG9uZW50c1tjXSA9PSBudWxsKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGMgPiAwKSBzYi5BcHBlbmQoIiwiKTsK' +
	'ICAgICAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24oY29tcG9uZW50c1tjXS5HZXRUeXBlKCkuTmFtZSkpOwogICAgICAgIH0K' +
	'ICAgICAgICBzYi5BcHBlbmQoIl0sXCJjaGlsZHJlblwiOlsiKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdvLnRyYW5z' +
	'Zm9ybS5jaGlsZENvdW50OyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIpOwogICAg' +
	'ICAgICAgICBCdWlsZEhpZXJhcmNoeUpzb24oZ28udHJhbnNmb3JtLkdldENoaWxkKGkpLmdhbWVPYmplY3QsIHNiKTsKICAgICAg' +
	'ICB9CiAgICAgICAgc2IuQXBwZW5kKCJdfSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVDcmVhdGVT' +
	'Y2VuZShzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5hbWUgPSBwLkdl' +
	'dFZhbHVlT3JEZWZhdWx0KCJuYW1lIiwgIk5ldyBTY2VuZSIpOwogICAgICAgIHZhciBzY2VuZSA9IEVkaXRvclNjZW5lTWFuYWdl' +
	'ci5OZXdTY2VuZShOZXdTY2VuZVNldHVwLkRlZmF1bHRHYW1lT2JqZWN0cywgTmV3U2NlbmVNb2RlLlNpbmdsZSk7CiAgICAgICAg' +
	'aWYgKHAuVHJ5R2V0VmFsdWUoInBhdGgiLCBvdXQgdmFyIHBhdGgpKQogICAgICAgIHsKICAgICAgICAgICAgRWRpdG9yU2NlbmVN' +
	'YW5hZ2VyLlNhdmVTY2VuZShzY2VuZSwgcGF0aCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7' +
	'e1wibmFtZVwiOntFc2NhcGVKc29uKHNjZW5lLm5hbWUpfSxcInBhdGhcIjp7RXNjYXBlSnNvbihzY2VuZS5wYXRoKX19fSIpOwog' +
	'ICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVTYXZlU2NlbmUoc3RyaW5nIGlkKQogICAgewogICAgICAgIHZh' +
	'ciBzY2VuZSA9IFNjZW5lTWFuYWdlci5HZXRBY3RpdmVTY2VuZSgpOwogICAgICAgIEVkaXRvclNjZW5lTWFuYWdlci5TYXZlU2Nl' +
	'bmUoc2NlbmUpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKHNjZW5lLm5h' +
	'bWUpfSxcInBhdGhcIjp7RXNjYXBlSnNvbihzY2VuZS5wYXRoKX19fSIpOwogICAgfQoKICAgIC8vIC0tLSBHYW1lT2JqZWN0IEhh' +
	'bmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVDcmVhdGVHYW1lT2JqZWN0KHN0cmluZyBpZCwgRGlj' +
	'dGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5h' +
	'bWUiLCAiR2FtZU9iamVjdCIpOwoKICAgICAgICAvLyBSZXNvbHZlIHBhcmVudCBmaXJzdCBzbyB3ZSBjYW4gZGVjaWRlIHdoZXRo' +
	'ZXIgYSBSZWN0VHJhbnNmb3JtIGlzIG5lZWRlZAogICAgICAgIEdhbWVPYmplY3QgcGFyZW50R28gPSBudWxsOwogICAgICAgIGlm' +
	'IChwLlRyeUdldFZhbHVlKCJwYXJlbnRQYXRoIiwgb3V0IHZhciBwYXJlbnRQYXRoKSAmJiAhc3RyaW5nLklzTnVsbE9yRW1wdHko' +
	'cGFyZW50UGF0aCkpCiAgICAgICAgICAgIHBhcmVudEdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGFyZW50UGF0aCk7CgogICAg' +
	'ICAgIC8vIElmIHRoZSBwYXJlbnQgbGl2ZXMgaW5zaWRlIGEgQ2FudmFzIGhpZXJhcmNoeSB0aGUgbmV3IG9iamVjdCBtdXN0IHVz' +
	'ZSBSZWN0VHJhbnNmb3JtCiAgICAgICAgLy8gc28gdGhhdCBVbml0eSdzIFVJIGxheW91dCBzeXN0ZW0gY2FuIHBvc2l0aW9uIGl0' +
	'IGNvcnJlY3RseS4KICAgICAgICBib29sIG5lZWRzUmVjdCA9IHBhcmVudEdvICE9IG51bGwgJiYgSXNJbkNhbnZhc0hpZXJhcmNo' +
	'eShwYXJlbnRHby50cmFuc2Zvcm0pOwogICAgICAgIHZhciBnbyA9IG5lZWRzUmVjdCA/IG5ldyBHYW1lT2JqZWN0KG5hbWUsIHR5' +
	'cGVvZihSZWN0VHJhbnNmb3JtKSkgOiBuZXcgR2FtZU9iamVjdChuYW1lKTsKCiAgICAgICAgaWYgKHBhcmVudEdvICE9IG51bGwp' +
	'CiAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5TZXRQYXJlbnQocGFyZW50R28udHJhbnNmb3JtLCBmYWxzZSk7CgogICAgICAgIFVu' +
	'ZG8uUmVnaXN0ZXJDcmVhdGVkT2JqZWN0VW5kbyhnbywgJCJDcmVhdGUge25hbWV9Iik7CiAgICAgICAgU2VsZWN0aW9uLmFjdGl2' +
	'ZUdhbWVPYmplY3QgPSBnbzsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihn' +
	'by5uYW1lKX0sXCJpbnN0YW5jZUlkXCI6e2dvLkdldEluc3RhbmNlSUQoKX19fSIpOwogICAgfQoKICAgIC8vLyA8c3VtbWFyeT5S' +
	'ZXR1cm5zIHRydWUgaWYgPHBhcmFtcmVmIG5hbWU9InQiLz4gaXMgdGhlIENhbnZhcyBpdHNlbGYgb3IgYW55IG9mIGl0cyBkZXNj' +
	'ZW5kYW50cy48L3N1bW1hcnk+CiAgICBwcml2YXRlIHN0YXRpYyBib29sIElzSW5DYW52YXNIaWVyYXJjaHkoVHJhbnNmb3JtIHQp' +
	'CiAgICB7CiAgICAgICAgd2hpbGUgKHQgIT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIGlmICh0LkdldENvbXBvbmVudDxD' +
	'YW52YXM+KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB0ID0gdC5wYXJlbnQ7CiAg' +
	'ICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRl' +
	'UHJpbWl0aXZlKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgbmFtZSA9' +
	'IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiUHJpbWl0aXZlIik7CiAgICAgICAgdmFyIHR5cGVTdHIgPSBwLkdldFZhbHVl' +
	'T3JEZWZhdWx0KCJwcmltaXRpdmVUeXBlIiwgIkN1YmUiKTsKCiAgICAgICAgaWYgKCFFbnVtLlRyeVBhcnNlPFByaW1pdGl2ZVR5' +
	'cGU+KHR5cGVTdHIsIHRydWUsIG91dCB2YXIgcHJpbWl0aXZlVHlwZSkpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQs' +
	'ICQiVW5rbm93biBwcmltaXRpdmUgdHlwZToge3R5cGVTdHJ9LiBWYWxpZDogU3BoZXJlLCBDYXBzdWxlLCBDeWxpbmRlciwgQ3Vi' +
	'ZSwgUGxhbmUsIFF1YWQiKTsKCiAgICAgICAgdmFyIGdvID0gR2FtZU9iamVjdC5DcmVhdGVQcmltaXRpdmUocHJpbWl0aXZlVHlw' +
	'ZSk7CiAgICAgICAgZ28ubmFtZSA9IG5hbWU7CgogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJwYXJlbnRQYXRoIiwgb3V0IHZh' +
	'ciBwYXJlbnRQYXRoKSAmJiAhc3RyaW5nLklzTnVsbE9yRW1wdHkocGFyZW50UGF0aCkpCiAgICAgICAgewogICAgICAgICAgICB2' +
	'YXIgcGFyZW50ID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGFyZW50UGF0aCk7CiAgICAgICAgICAgIGlmIChwYXJlbnQgIT0gbnVs' +
	'bCkKICAgICAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5TZXRQYXJlbnQocGFyZW50LnRyYW5zZm9ybSwgZmFsc2UpOwogICAgICAg' +
	'IH0KCiAgICAgICAgVW5kby5SZWdpc3RlckNyZWF0ZWRPYmplY3RVbmRvKGdvLCAkIkNyZWF0ZSB7bmFtZX0iKTsKICAgICAgICBT' +
	'ZWxlY3Rpb24uYWN0aXZlR2FtZU9iamVjdCA9IGdvOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwi' +
	'OntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImluc3RhbmNlSWRcIjp7Z28uR2V0SW5zdGFuY2VJRCgpfX19Iik7CiAgICB9CgogICAg' +
	'cHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUZpbmRHYW1lT2JqZWN0KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0' +
	'cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiIik7CiAgICAgICAg' +
	'dmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgobmFtZSk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJl' +
	'dHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtuYW1lfSIpOwoKICAgICAgICByZXR1cm4gTWFrZVN1' +
	'Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJpbnN0YW5jZUlkXCI6e2dvLkdldEluc3RhbmNl' +
	'SUQoKX0sXCJhY3RpdmVcIjp7Z28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93ZXIoKX19fSIpOwogICAgfQoKICAgIHByaXZh' +
	'dGUgc3RhdGljIHN0cmluZyBIYW5kbGVEZXN0cm95R2FtZU9iamVjdChzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJp' +
	'bmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIsIHAuR2V0' +
	'VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiIikpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKG5hbWUpOwog' +
	'ICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZv' +
	'dW5kOiB7bmFtZX0iKTsKCiAgICAgICAgVW5kby5EZXN0cm95T2JqZWN0SW1tZWRpYXRlKGdvKTsKICAgICAgICByZXR1cm4gTWFr' +
	'ZVN1Y2Nlc3MoaWQsICJ7fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVTZXRBY3RpdmUoc3RyaW5n' +
	'IGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVm' +
	'YXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAg' +
	'ICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91' +
	'bmQ6IHtwYXRofSIpOwoKICAgICAgICB2YXIgYWN0aXZlID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiYWN0aXZlIiwgInRydWUiKSA9' +
	'PSAidHJ1ZSI7CiAgICAgICAgVW5kby5SZWNvcmRPYmplY3QoZ28sICQiU2V0IEFjdGl2ZSB7Z28ubmFtZX0iKTsKICAgICAgICBn' +
	'by5TZXRBY3RpdmUoYWN0aXZlKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNv' +
	'bihnby5uYW1lKX0sXCJhY3RpdmVcIjp7Z28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93ZXIoKX19fSIpOwogICAgfQoKICAg' +
	'IHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVTZXRUcmFuc2Zvcm0oc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3Ry' +
	'aW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7' +
	'CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAg' +
	'ICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRofSIpOwoKICAgICAgICBVbmRv' +
	'LlJlY29yZE9iamVjdChnby50cmFuc2Zvcm0sICQiVHJhbnNmb3JtIHtnby5uYW1lfSIpOwoKICAgICAgICBpZiAocC5UcnlHZXRW' +
	'YWx1ZSgicG9zaXRpb24iLCBvdXQgdmFyIHBvc1N0cikpCiAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5wb3NpdGlvbiA9IFBhcnNl' +
	'VmVjdG9yMyhwb3NTdHIpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJyb3RhdGlvbiIsIG91dCB2YXIgcm90U3RyKSkKICAg' +
	'ICAgICAgICAgZ28udHJhbnNmb3JtLmV1bGVyQW5nbGVzID0gUGFyc2VWZWN0b3IzKHJvdFN0cik7CiAgICAgICAgaWYgKHAuVHJ5' +
	'R2V0VmFsdWUoInNjYWxlIiwgb3V0IHZhciBzY2FsZVN0cikpCiAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5sb2NhbFNjYWxlID0g' +
	'UGFyc2VWZWN0b3IzKHNjYWxlU3RyKTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2Fw' +
	'ZUpzb24oZ28ubmFtZSl9LFwicG9zaXRpb25cIjpcIntnby50cmFuc2Zvcm0ucG9zaXRpb259XCIsXCJyb3RhdGlvblwiOlwie2dv' +
	'LnRyYW5zZm9ybS5ldWxlckFuZ2xlc31cIixcInNjYWxlXCI6XCJ7Z28udHJhbnNmb3JtLmxvY2FsU2NhbGV9XCJ9fSIpOwogICAg' +
	'fQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRTZWxlY3RlZChzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFy' +
	'IHNlbGVjdGVkID0gU2VsZWN0aW9uLmdhbWVPYmplY3RzOwogICAgICAgIHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAg' +
	'ICAgICAgc2IuQXBwZW5kKCJ7XCJzZWxlY3RlZFwiOlsiKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlbGVjdGVkLkxl' +
	'bmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgc2Iu' +
	'QXBwZW5kKEVzY2FwZUpzb24oc2VsZWN0ZWRbaV0ubmFtZSkpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAg' +
	'ICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICAvLyAtLS0gQ29tcG9uZW50IEhh' +
	'bmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVBZGRDb21wb25lbnQoc3RyaW5nIGlkLCBEaWN0aW9u' +
	'YXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9i' +
	'amVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAgICAgICAgaWYgKGdv' +
	'ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRofSIp' +
	'OwoKICAgICAgICB2YXIgdHlwZU5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJjb21wb25lbnRUeXBlIiwgIiIpOwogICAgICAg' +
	'IHZhciB0eXBlID0gRmluZENvbXBvbmVudFR5cGUodHlwZU5hbWUpOwogICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAg' +
	'ICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiQ29tcG9uZW50IHR5cGUgbm90IGZvdW5kOiB7dHlwZU5hbWV9Iik7CgogICAgICAg' +
	'IFVuZG8uQWRkQ29tcG9uZW50KGdvLCB0eXBlKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcImdhbWVPYmpl' +
	'Y3RcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJjb21wb25lbnRcIjp7RXNjYXBlSnNvbih0eXBlLk5hbWUpfX19Iik7CiAgICB9' +
	'CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZVJlbW92ZUNvbXBvbmVudChzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3Ry' +
	'aW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0' +
	'aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVs' +
	'bCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAg' +
	'ICAgIHZhciB0eXBlTmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImNvbXBvbmVudFR5cGUiLCAiIik7CiAgICAgICAgdmFyIGNv' +
	'bXAgPSBnby5HZXRDb21wb25lbnQodHlwZU5hbWUpOwogICAgICAgIGlmIChjb21wID09IG51bGwpCiAgICAgICAgICAgIHJldHVy' +
	'biBNYWtlRXJyb3IoaWQsICQiQ29tcG9uZW50IG5vdCBmb3VuZDoge3R5cGVOYW1lfSBvbiB7Z28ubmFtZX0iKTsKCiAgICAgICAg' +
	'VW5kby5EZXN0cm95T2JqZWN0SW1tZWRpYXRlKGNvbXApOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgInt9Iik7CiAg' +
	'ICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldENvbXBvbmVudHMoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0' +
	'cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBh' +
	'dGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAgICAgICAgaWYgKGdvID09IG51' +
	'bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRofSIpOwoKICAg' +
	'ICAgICB2YXIgY29tcG9uZW50cyA9IGdvLkdldENvbXBvbmVudHM8Q29tcG9uZW50PigpOwogICAgICAgIHZhciBzYiA9IG5ldyBT' +
	'dHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJjb21wb25lbnRzXCI6WyIpOwogICAgICAgIGZvciAoaW50IGkg' +
	'PSAwOyBpIDwgY29tcG9uZW50cy5MZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChjb21wb25lbnRzW2ldID09' +
	'IG51bGwpIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIpOwogICAgICAgICAgICBzYi5BcHBl' +
	'bmQoRXNjYXBlSnNvbihjb21wb25lbnRzW2ldLkdldFR5cGUoKS5OYW1lKSk7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgi' +
	'XX0iKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsIHNiLlRvU3RyaW5nKCkpOwogICAgfQoKICAgIHByaXZhdGUgc3Rh' +
	'dGljIHN0cmluZyBIYW5kbGVTZXRQcm9wZXJ0eShzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7' +
	'CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIg' +
	'Z28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu' +
	'IE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAgIHZhciB0eXBlTmFtZSA9IHAu' +
	'R2V0VmFsdWVPckRlZmF1bHQoImNvbXBvbmVudFR5cGUiLCAiIik7CiAgICAgICAgdmFyIGNvbXAgPSBnby5HZXRDb21wb25lbnQo' +
	'dHlwZU5hbWUpOwogICAgICAgIGlmIChjb21wID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiQ29t' +
	'cG9uZW50IG5vdCBmb3VuZDoge3R5cGVOYW1lfSBvbiB7Z28ubmFtZX0iKTsKCiAgICAgICAgdmFyIHByb3BOYW1lID0gcC5HZXRW' +
	'YWx1ZU9yRGVmYXVsdCgicHJvcGVydHlOYW1lIiwgIiIpOwogICAgICAgIHZhciB2YWx1ZVN0ciA9IHAuR2V0VmFsdWVPckRlZmF1' +
	'bHQoInZhbHVlIiwgIiIpOwoKICAgICAgICBVbmRvLlJlY29yZE9iamVjdChjb21wLCAkIlNldCB7cHJvcE5hbWV9IG9uIHtnby5u' +
	'YW1lfSIpOwoKICAgICAgICAvLyBUcnkgc2V0dGluZyB2aWEgU2VyaWFsaXplZE9iamVjdCBmb3IgcHJvcGVyIHVuZG8gc3VwcG9y' +
	'dAogICAgICAgIHZhciBzbyA9IG5ldyBTZXJpYWxpemVkT2JqZWN0KGNvbXApOwogICAgICAgIHZhciBwcm9wID0gc28uRmluZFBy' +
	'b3BlcnR5KHByb3BOYW1lKTsKICAgICAgICBpZiAocHJvcCAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgU2V0U2VyaWFs' +
	'aXplZFByb3BlcnR5VmFsdWUocHJvcCwgdmFsdWVTdHIpOwogICAgICAgICAgICBzby5BcHBseU1vZGlmaWVkUHJvcGVydGllcygp' +
	'OwogICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInByb3BlcnR5XCI6e0VzY2FwZUpzb24ocHJvcE5hbWUp' +
	'fSxcInNldFwiOnRydWV9fSIpOwogICAgICAgIH0KCiAgICAgICAgLy8gRmFsbGJhY2s6IHJlZmxlY3Rpb24gd2l0aCBzbWFydCB0' +
	'eXBlIGNvbnZlcnNpb24KICAgICAgICB2YXIgZmllbGQgPSBjb21wLkdldFR5cGUoKS5HZXRGaWVsZChwcm9wTmFtZSwgQmluZGlu' +
	'Z0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuSW5zdGFuY2UpOwogICAgICAgIGlm' +
	'IChmaWVsZCAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNvbnZlcnRlZCA9IFNtYXJ0Q29udmVydCh2YWx1ZVN0' +
	'ciwgZmllbGQuRmllbGRUeXBlKTsKICAgICAgICAgICAgZmllbGQuU2V0VmFsdWUoY29tcCwgY29udmVydGVkKTsKICAgICAgICAg' +
	'ICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJwcm9wZXJ0eVwiOntFc2NhcGVKc29uKHByb3BOYW1lKX0sXCJzZXRcIjp0' +
	'cnVlfX0iKTsKICAgICAgICB9CgogICAgICAgIHZhciBwcm9wZXJ0eSA9IGNvbXAuR2V0VHlwZSgpLkdldFByb3BlcnR5KHByb3BO' +
	'YW1lLCBCaW5kaW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLkluc3RhbmNlKTsKICAgICAgICBpZiAocHJvcGVydHkgIT0g' +
	'bnVsbCAmJiBwcm9wZXJ0eS5DYW5Xcml0ZSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBjb252ZXJ0ZWQgPSBTbWFydENvbnZl' +
	'cnQodmFsdWVTdHIsIHByb3BlcnR5LlByb3BlcnR5VHlwZSk7CiAgICAgICAgICAgIHByb3BlcnR5LlNldFZhbHVlKGNvbXAsIGNv' +
	'bnZlcnRlZCk7CiAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wicHJvcGVydHlcIjp7RXNjYXBlSnNvbihw' +
	'cm9wTmFtZSl9LFwic2V0XCI6dHJ1ZX19Iik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIlByb3Bl' +
	'cnR5IG5vdCBmb3VuZDoge3Byb3BOYW1lfSBvbiB7dHlwZU5hbWV9Iik7CiAgICB9CgogICAgLy8gLS0tIFByZWZhYiBIYW5kbGVy' +
	'cyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRlUHJlZmFiKHN0cmluZyBpZCwgRGljdGlvbmFyeTxz' +
	'dHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgZ29QYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVj' +
	'dFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgoZ29QYXRoKTsKICAgICAgICBpZiAoZ28g' +
	'PT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge2dvUGF0aH0i' +
	'KTsKCiAgICAgICAgdmFyIGFzc2V0UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImFzc2V0UGF0aCIsICQiQXNzZXRzL1ByZWZh' +
	'YnMve2dvLm5hbWV9LnByZWZhYiIpOwoKICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0cwogICAgICAgIHZhciBkaXIg' +
	'PSBQYXRoLkdldERpcmVjdG9yeU5hbWUoYXNzZXRQYXRoKTsKICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KGRpcikg' +
	'JiYgIUFzc2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihkaXIpKQogICAgICAgIHsKICAgICAgICAgICAgQ3JlYXRlRm9sZGVyUmVj' +
	'dXJzaXZlKGRpcik7CiAgICAgICAgfQoKICAgICAgICB2YXIgcHJlZmFiID0gUHJlZmFiVXRpbGl0eS5TYXZlQXNQcmVmYWJBc3Nl' +
	'dChnbywgYXNzZXRQYXRoKTsKICAgICAgICBpZiAocHJlZmFiID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3Io' +
	'aWQsICQiRmFpbGVkIHRvIGNyZWF0ZSBwcmVmYWIgYXQge2Fzc2V0UGF0aH0iKTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNz' +
	'KGlkLCAkInt7XCJwYXRoXCI6e0VzY2FwZUpzb24oYXNzZXRQYXRoKX0sXCJuYW1lXCI6e0VzY2FwZUpzb24ocHJlZmFiLm5hbWUp' +
	'fX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUluc3RhbnRpYXRlUHJlZmFiKHN0cmluZyBpZCwg' +
	'RGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcHJlZmFiUGF0aCA9IHAuR2V0VmFsdWVPckRl' +
	'ZmF1bHQoInByZWZhYlBhdGgiLCAiIik7CiAgICAgICAgdmFyIHByZWZhYiA9IEFzc2V0RGF0YWJhc2UuTG9hZEFzc2V0QXRQYXRo' +
	'PEdhbWVPYmplY3Q+KHByZWZhYlBhdGgpOwogICAgICAgIGlmIChwcmVmYWIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1h' +
	'a2VFcnJvcihpZCwgJCJQcmVmYWIgbm90IGZvdW5kIGF0OiB7cHJlZmFiUGF0aH0iKTsKCiAgICAgICAgdmFyIGluc3RhbmNlID0g' +
	'KEdhbWVPYmplY3QpUHJlZmFiVXRpbGl0eS5JbnN0YW50aWF0ZVByZWZhYihwcmVmYWIpOwogICAgICAgIFVuZG8uUmVnaXN0ZXJD' +
	'cmVhdGVkT2JqZWN0VW5kbyhpbnN0YW5jZSwgJCJJbnN0YW50aWF0ZSB7cHJlZmFiLm5hbWV9Iik7CiAgICAgICAgU2VsZWN0aW9u' +
	'LmFjdGl2ZUdhbWVPYmplY3QgPSBpbnN0YW5jZTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6' +
	'e0VzY2FwZUpzb24oaW5zdGFuY2UubmFtZSl9LFwiaW5zdGFuY2VJZFwiOntpbnN0YW5jZS5HZXRJbnN0YW5jZUlEKCl9fX0iKTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0QWxsUHJlZmFicyhzdHJpbmcgaWQpCiAgICB7CiAgICAg' +
	'ICAgdmFyIGd1aWRzID0gQXNzZXREYXRhYmFzZS5GaW5kQXNzZXRzKCJ0OlByZWZhYiIpOwogICAgICAgIHZhciBzYiA9IG5ldyBT' +
	'dHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJwcmVmYWJzXCI6WyIpOwogICAgICAgIGZvciAoaW50IGkgPSAw' +
	'OyBpIDwgZ3VpZHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIpOwog' +
	'ICAgICAgICAgICB2YXIgcGF0aCA9IEFzc2V0RGF0YWJhc2UuR1VJRFRvQXNzZXRQYXRoKGd1aWRzW2ldKTsKICAgICAgICAgICAg' +
	'c2IuQXBwZW5kKEVzY2FwZUpzb24ocGF0aCkpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAgICAgICAgcmV0' +
	'dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICAvLyAtLS0gQXNzZXQgSGFuZGxlcnMgLS0tCgog' +
	'ICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0ZUFzc2V0KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0' +
	'cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgYXNzZXRUeXBlID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiYXNzZXRUeXBlIiwgIk1h' +
	'dGVyaWFsIik7CiAgICAgICAgdmFyIGFzc2V0UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoInBhdGgiLCAiIik7CgogICAgICAg' +
	'IGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShhc3NldFBhdGgpKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAicGF0' +
	'aCBpcyByZXF1aXJlZCIpOwoKICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0cwogICAgICAgIHZhciBkaXIgPSBQYXRo' +
	'LkdldERpcmVjdG9yeU5hbWUoYXNzZXRQYXRoKTsKICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KGRpcikgJiYgIUFz' +
	'c2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihkaXIpKQogICAgICAgIHsKICAgICAgICAgICAgQ3JlYXRlRm9sZGVyUmVjdXJzaXZl' +
	'KGRpcik7CiAgICAgICAgfQoKICAgICAgICBVbml0eUVuZ2luZS5PYmplY3QgYXNzZXQgPSBudWxsOwogICAgICAgIHN3aXRjaCAo' +
	'YXNzZXRUeXBlLlRvTG93ZXIoKSkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgIm1hdGVyaWFsIjoKICAgICAgICAgICAgICAg' +
	'IHZhciBzaGFkZXIgPSBTaGFkZXIuRmluZChwLkdldFZhbHVlT3JEZWZhdWx0KCJzaGFkZXIiLCAiU3RhbmRhcmQiKSk7CiAgICAg' +
	'ICAgICAgICAgICBhc3NldCA9IG5ldyBNYXRlcmlhbChzaGFkZXIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg' +
	'IGNhc2UgInBoeXNpY21hdGVyaWFsIjoKICAgICAgICAgICAgICAgIGFzc2V0ID0gbmV3IFBoeXNpY01hdGVyaWFsKCk7CiAgICAg' +
	'ICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQs' +
	'ICQiVW5zdXBwb3J0ZWQgYXNzZXQgdHlwZToge2Fzc2V0VHlwZX0uIFN1cHBvcnRlZDogTWF0ZXJpYWwsIFBoeXNpY01hdGVyaWFs' +
	'Iik7CiAgICAgICAgfQoKICAgICAgICBBc3NldERhdGFiYXNlLkNyZWF0ZUFzc2V0KGFzc2V0LCBhc3NldFBhdGgpOwogICAgICAg' +
	'IEFzc2V0RGF0YWJhc2UuUmVmcmVzaCgpOwoKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInBhdGhcIjp7RXNj' +
	'YXBlSnNvbihhc3NldFBhdGgpfSxcInR5cGVcIjp7RXNjYXBlSnNvbihhc3NldFR5cGUpfX19Iik7CiAgICB9CgogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUZpbmRBc3NldHMoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQog' +
	'ICAgewogICAgICAgIHZhciBmaWx0ZXIgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJmaWx0ZXIiLCAiIik7CiAgICAgICAgdmFyIGd1' +
	'aWRzID0gQXNzZXREYXRhYmFzZS5GaW5kQXNzZXRzKGZpbHRlcik7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIo' +
	'KTsKICAgICAgICBzYi5BcHBlbmQoIntcImFzc2V0c1wiOlsiKTsKICAgICAgICB2YXIgY291bnQgPSBNYXRoLk1pbihndWlkcy5M' +
	'ZW5ndGgsIDUwKTsgLy8gQ2FwIGF0IDUwCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKQogICAgICAgIHsK' +
	'ICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgdmFyIHBhdGggPSBBc3NldERhdGFiYXNl' +
	'LkdVSURUb0Fzc2V0UGF0aChndWlkc1tpXSk7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKHBhdGgpKTsKICAgICAg' +
	'ICB9CiAgICAgICAgc2IuQXBwZW5kKCQiXSxcInRvdGFsXCI6e2d1aWRzLkxlbmd0aH19fSIpOwogICAgICAgIHJldHVybiBNYWtl' +
	'U3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgLy8gLS0tIFByb2plY3QgLyBFZGl0b3IgSGFuZGxlcnMgLS0t' +
	'CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFByb2plY3RJbmZvKHN0cmluZyBpZCkKICAgIHsKICAgICAgICBy' +
	'ZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihBcHBsaWNhdGlvbi5wcm9kdWN0TmFtZSl9LFwi' +
	'dW5pdHlWZXJzaW9uXCI6e0VzY2FwZUpzb24oQXBwbGljYXRpb24udW5pdHlWZXJzaW9uKX0sXCJwbGF0Zm9ybVwiOntFc2NhcGVK' +
	'c29uKEVkaXRvclVzZXJCdWlsZFNldHRpbmdzLmFjdGl2ZUJ1aWxkVGFyZ2V0LlRvU3RyaW5nKCkpfX19Iik7CiAgICB9CgogICAg' +
	'cHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFBsYXlNb2RlKHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2YXIgc3RhdGUg' +
	'PSBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcKICAgICAgICAgICAgPyAoRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQgPyAi' +
	'cGF1c2VkIiA6ICJwbGF5aW5nIikKICAgICAgICAgICAgOiAic3RvcHBlZCI7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlk' +
	'LCAkInt7XCJzdGF0ZVwiOlwie3N0YXRlfVwifX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlRXhl' +
	'Y3V0ZU1lbnVJdGVtKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgbWVu' +
	'dVBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJtZW51UGF0aCIsICIiKTsKICAgICAgICBpZiAoc3RyaW5nLklzTnVsbE9yRW1w' +
	'dHkobWVudVBhdGgpKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAibWVudVBhdGggaXMgcmVxdWlyZWQiKTsKCiAg' +
	'ICAgICAgdmFyIHJlc3VsdCA9IEVkaXRvckFwcGxpY2F0aW9uLkV4ZWN1dGVNZW51SXRlbShtZW51UGF0aCk7CiAgICAgICAgcmV0' +
	'dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJleGVjdXRlZFwiOntyZXN1bHQuVG9TdHJpbmcoKS5Ub0xvd2VyKCl9LFwibWVudVBh' +
	'dGhcIjp7RXNjYXBlSnNvbihtZW51UGF0aCl9fX0iKTsKICAgIH0KCiAgICAvLyAtLS0gVXRpbGl0aWVzIC0tLQoKICAgIC8vLyA8' +
	'c3VtbWFyeT4KICAgIC8vLyBGaW5kIGEgR2FtZU9iamVjdCBieSBoaWVyYXJjaHkgcGF0aCwgaW5jbHVkaW5nIGluYWN0aXZlIG9i' +
	'amVjdHMuCiAgICAvLy8gVW5pdHkncyBHYW1lT2JqZWN0LkZpbmQoKSBvbmx5IGZpbmRzIGFjdGl2ZSBvYmplY3RzLCB3aGljaCBm' +
	'YWlscyB3aGVuCiAgICAvLy8gYSBwYXJlbnQgaGFzIGJlZW4gc2V0IGluYWN0aXZlLiBUaGlzIG1ldGhvZCB3YWxrcyB0aGUgaGll' +
	'cmFyY2h5IG1hbnVhbGx5LgogICAgLy8vIElmIHRoZSBwYXRoIGNvbnRhaW5zIG5vICcvJyBzZXBhcmF0b3IgYW5kIG5vIHJvb3Qg' +
	'b2JqZWN0IG1hdGNoZXMsIGZhbGxzCiAgICAvLy8gYmFjayB0byBhIGZ1bGwtc2NlbmUgbmFtZSBzZWFyY2ggc28gYWdlbnRzIGNh' +
	'biB1c2UgYmFyZSBuYW1lcyBsaWtlCiAgICAvLy8gIk1haW4gTWVudSBQYW5lbCIgZXZlbiB3aGVuIHRoZSBvYmplY3QgaXMgYSBj' +
	'aGlsZCBvciBpbmFjdGl2ZS4KICAgIC8vLyA8L3N1bW1hcnk+CiAgICBwcml2YXRlIHN0YXRpYyBHYW1lT2JqZWN0IEZpbmRHYW1l' +
	'T2JqZWN0QnlQYXRoKHN0cmluZyBwYXRoKQogICAgewogICAgICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShwYXRoKSkgcmV0' +
	'dXJuIG51bGw7CgogICAgICAgIC8vIEZpcnN0IHRyeSB0aGUgZmFzdCBwYXRoIOKAlCBVbml0eSdzIGJ1aWx0LWluIChvbmx5IHdv' +
	'cmtzIGZvciBhY3RpdmUgb2JqZWN0cykKICAgICAgICB2YXIgZm91bmQgPSBHYW1lT2JqZWN0LkZpbmQocGF0aCk7CiAgICAgICAg' +
	'aWYgKGZvdW5kICE9IG51bGwpIHJldHVybiBmb3VuZDsKCiAgICAgICAgLy8gU2xvdyBwYXRoOiBtYW51YWxseSB3YWxrIHRoZSBo' +
	'aWVyYXJjaHkgKHdvcmtzIGZvciBpbmFjdGl2ZSBvYmplY3RzIHRvbykKICAgICAgICB2YXIgcGFydHMgPSBwYXRoLlNwbGl0KCcv' +
	'Jyk7CiAgICAgICAgdmFyIHJvb3ROYW1lID0gcGFydHNbMF07CgogICAgICAgIC8vIFNlYXJjaCB0aHJvdWdoIGFsbCBzY2VuZSBy' +
	'b290IG9iamVjdHMKICAgICAgICB2YXIgc2NlbmUgPSBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKTsKICAgICAgICB2YXIg' +
	'cm9vdHMgPSBzY2VuZS5HZXRSb290R2FtZU9iamVjdHMoKTsKICAgICAgICBHYW1lT2JqZWN0IHJvb3QgPSBudWxsOwogICAgICAg' +
	'IGZvcmVhY2ggKHZhciByIGluIHJvb3RzKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHIubmFtZSA9PSByb290TmFtZSkKICAg' +
	'ICAgICAgICAgewogICAgICAgICAgICAgICAgcm9vdCA9IHI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog' +
	'ICAgICAgIH0KCiAgICAgICAgaWYgKHJvb3QgPT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIC8vIExhc3QgcmVzb3J0IGZv' +
	'ciBzaW5nbGUtbmFtZSBxdWVyaWVzOiBkZWVwIHNlYXJjaCBhY3Jvc3MgZXZlcnkgb2JqZWN0IGluIHRoZSBzY2VuZS4KICAgICAg' +
	'ICAgICAgLy8gSGFuZGxlcyBpbmFjdGl2ZSBjaGlsZHJlbiAoZS5nLiBhIHBhbmVsIGhpZGRlbiB1bmRlciBDYW52YXMpIHRoYXQg' +
	'bmVpdGhlcgogICAgICAgICAgICAvLyBHYW1lT2JqZWN0LkZpbmQgbm9yIHJvb3Qtb25seSBlbnVtZXJhdGlvbiBjYW4gbG9jYXRl' +
	'LgogICAgICAgICAgICBpZiAocGFydHMuTGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gRmluZEdhbWVPYmplY3RC' +
	'eU5hbWVJblNjZW5lKHJvb3ROYW1lKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAocGFy' +
	'dHMuTGVuZ3RoID09IDEpIHJldHVybiByb290OwoKICAgICAgICAvLyBXYWxrIGRvd24gdGhlIHBhdGggdXNpbmcgVHJhbnNmb3Jt' +
	'LkZpbmQgKHN1cHBvcnRzICcvJyBwYXRocyBhbmQgZmluZHMgaW5hY3RpdmUgY2hpbGRyZW4pCiAgICAgICAgdmFyIHN1YlBhdGgg' +
	'PSBzdHJpbmcuSm9pbigiLyIsIHBhcnRzLCAxLCBwYXJ0cy5MZW5ndGggLSAxKTsKICAgICAgICB2YXIgY2hpbGQgPSByb290LnRy' +
	'YW5zZm9ybS5GaW5kKHN1YlBhdGgpOwogICAgICAgIHJldHVybiBjaGlsZCAhPSBudWxsID8gY2hpbGQuZ2FtZU9iamVjdCA6IG51' +
	'bGw7CiAgICB9CgogICAgLy8vIDxzdW1tYXJ5PgogICAgLy8vIFJlY3Vyc2l2ZWx5IHNlYXJjaCBldmVyeSBHYW1lT2JqZWN0IGlu' +
	'IHRoZSBhY3RpdmUgc2NlbmUgKGluY2x1ZGluZyBpbmFjdGl2ZSkKICAgIC8vLyBhbmQgcmV0dXJuIHRoZSBmaXJzdCBvbmUgd2hv' +
	'c2UgbmFtZSBtYXRjaGVzIGV4YWN0bHkuCiAgICAvLy8gPC9zdW1tYXJ5PgogICAgcHJpdmF0ZSBzdGF0aWMgR2FtZU9iamVjdCBG' +
	'aW5kR2FtZU9iamVjdEJ5TmFtZUluU2NlbmUoc3RyaW5nIG5hbWUpCiAgICB7CiAgICAgICAgZm9yZWFjaCAodmFyIHJvb3QgaW4g' +
	'U2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5lKCkuR2V0Um9vdEdhbWVPYmplY3RzKCkpCiAgICAgICAgewogICAgICAgICAgICB2' +
	'YXIgcmVzdWx0ID0gRmluZEluSGllcmFyY2h5QnlOYW1lKHJvb3QudHJhbnNmb3JtLCBuYW1lKTsKICAgICAgICAgICAgaWYgKHJl' +
	'c3VsdCAhPSBudWxsKSByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcml2' +
	'YXRlIHN0YXRpYyBHYW1lT2JqZWN0IEZpbmRJbkhpZXJhcmNoeUJ5TmFtZShUcmFuc2Zvcm0gdCwgc3RyaW5nIG5hbWUpCiAgICB7' +
	'CiAgICAgICAgaWYgKHQubmFtZSA9PSBuYW1lKSByZXR1cm4gdC5nYW1lT2JqZWN0OwogICAgICAgIGZvcmVhY2ggKFRyYW5zZm9y' +
	'bSBjaGlsZCBpbiB0KQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEZpbmRJbkhpZXJhcmNoeUJ5TmFtZShjaGls' +
	'ZCwgbmFtZSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAg' +
	'cmV0dXJuIG51bGw7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgVHlwZSBGaW5kQ29tcG9uZW50VHlwZShzdHJpbmcgdHlwZU5h' +
	'bWUpCiAgICB7CiAgICAgICAgLy8gQ29tbW9uIG5hbWVzcGFjZSBwcmVmaXhlcyBmb3IgVW5pdHkgY29tcG9uZW50IHR5cGVzLgog' +
	'ICAgICAgIC8vIFVJIGNvbXBvbmVudHMgbGl2ZSBpbiBVbml0eUVuZ2luZS5VSSwgVE1Qcm8sIEV2ZW50U3lzdGVtcyDigJQgbm90' +
	'IGp1c3QgVW5pdHlFbmdpbmUuCiAgICAgICAgc3RyaW5nW10gbmFtZXNwYWNlUHJlZml4ZXMgPSBuZXdbXQogICAgICAgIHsKICAg' +
	'ICAgICAgICAgIlVuaXR5RW5naW5lLiIsICAgICAgICAgICAgICAvLyBSaWdpZGJvZHksIENhbnZhcywgQXVkaW9Tb3VyY2UsIGV0' +
	'Yy4KICAgICAgICAgICAgIlVuaXR5RW5naW5lLlVJLiIsICAgICAgICAgICAvLyBCdXR0b24sIEltYWdlLCBTbGlkZXIsIENhbnZh' +
	'c1NjYWxlciwgR3JhcGhpY1JheWNhc3RlciwgVmVydGljYWxMYXlvdXRHcm91cCwgZXRjLgogICAgICAgICAgICAiVW5pdHlFbmdp' +
	'bmUuRXZlbnRTeXN0ZW1zLiIsIC8vIEV2ZW50U3lzdGVtLCBTdGFuZGFsb25lSW5wdXRNb2R1bGUsIGV0Yy4KICAgICAgICAgICAg' +
	'IlRNUHJvLiIsICAgICAgICAgICAgICAgICAgICAvLyBUZXh0TWVzaFByb1VHVUksIFRNUF9JbnB1dEZpZWxkLCBldGMuCiAgICAg' +
	'ICAgICAgICIiLCAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3VzdG9tIHNjcmlwdHMgKGJhcmUgY2xhc3MgbmFtZSBpbiBB' +
	'c3NlbWJseS1DU2hhcnApCiAgICAgICAgfTsKCiAgICAgICAgZm9yZWFjaCAodmFyIGFzc2VtYmx5IGluIEFwcERvbWFpbi5DdXJy' +
	'ZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSkKICAgICAgICB7CiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBwcmVmaXggaW4gbmFt' +
	'ZXNwYWNlUHJlZml4ZXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBmdWxsTmFtZSA9IHByZWZpeCArIHR5cGVO' +
	'YW1lOwogICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBhc3NlbWJseS5HZXRUeXBlKGZ1bGxOYW1lKTsKICAgICAgICAgICAgICAg' +
	'IGlmICh0eXBlICE9IG51bGwgJiYgdHlwZW9mKENvbXBvbmVudCkuSXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAg' +
	'ICAgICAgICByZXR1cm4gdHlwZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog' +
	'ICAgLy8vIDxzdW1tYXJ5PgogICAgLy8vIFNtYXJ0IHR5cGUgY29udmVyc2lvbiB0aGF0IGhhbmRsZXMgZW51bXMsIFZlY3RvcjIs' +
	'IFZlY3RvcjMsIENvbG9yLCBwcmltaXRpdmVzLAogICAgLy8vIGFuZCBVbml0eSBPYmplY3QgcmVmZXJlbmNlcyAoR2FtZU9iamVj' +
	'dC9Db21wb25lbnQgYnkgc2NlbmUgcGF0aCwgYXNzZXRzIGJ5IGFzc2V0IHBhdGgpLgogICAgLy8vIEZhbGxzIGJhY2sgdG8gQ29u' +
	'dmVydC5DaGFuZ2VUeXBlIGZvciBzaW1wbGUgdHlwZXMuCiAgICAvLy8gPC9zdW1tYXJ5PgogICAgcHJpdmF0ZSBzdGF0aWMgb2Jq' +
	'ZWN0IFNtYXJ0Q29udmVydChzdHJpbmcgdmFsdWVTdHIsIFR5cGUgdGFyZ2V0VHlwZSkKICAgIHsKICAgICAgICAvLyBIYW5kbGUg' +
	'bnVsbGFibGUKICAgICAgICB2YXIgdW5kZXJseWluZ1R5cGUgPSBOdWxsYWJsZS5HZXRVbmRlcmx5aW5nVHlwZSh0YXJnZXRUeXBl' +
	'KTsKICAgICAgICBpZiAodW5kZXJseWluZ1R5cGUgIT0gbnVsbCkKICAgICAgICAgICAgdGFyZ2V0VHlwZSA9IHVuZGVybHlpbmdU' +
	'eXBlOwoKICAgICAgICAvLyBHYW1lT2JqZWN0IHJlZmVyZW5jZSDigJQgcmVzb2x2ZSBieSBzY2VuZSBwYXRoL25hbWUsIHRoZW4g' +
	'YXNzZXQgZGF0YWJhc2UKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2YoR2FtZU9iamVjdCkpCiAgICAgICAgewogICAg' +
	'ICAgICAgICB2YXIgcmVmR28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aCh2YWx1ZVN0cik7CiAgICAgICAgICAgIGlmIChyZWZHbyAh' +
	'PSBudWxsKSByZXR1cm4gcmVmR287CiAgICAgICAgICAgIHZhciBhc3NldCA9IEFzc2V0RGF0YWJhc2UuTG9hZEFzc2V0QXRQYXRo' +
	'PEdhbWVPYmplY3Q+KHZhbHVlU3RyKTsKICAgICAgICAgICAgaWYgKGFzc2V0ICE9IG51bGwpIHJldHVybiBhc3NldDsKICAgICAg' +
	'ICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAkIkNhbm5vdCBhc3NpZ24g' +
	'cmVmZXJlbmNlOiAne3ZhbHVlU3RyfScgd2FzIG5vdCBmb3VuZCBpbiB0aGUgc2NlbmUgaGllcmFyY2h5IG9yIHRoZSBhc3NldCBk' +
	'YXRhYmFzZS4iKTsKICAgICAgICB9CgogICAgICAgIC8vIENvbXBvbmVudCByZWZlcmVuY2Ug4oCUIGZpbmQgdGhlIEdhbWVPYmpl' +
	'Y3QgdGhlbiBnZXQgdGhlIGNvbXBvbmVudAogICAgICAgIGlmICh0eXBlb2YoQ29tcG9uZW50KS5Jc0Fzc2lnbmFibGVGcm9tKHRh' +
	'cmdldFR5cGUpKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlZkdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgodmFsdWVTdHIp' +
	'OwogICAgICAgICAgICBpZiAocmVmR28gIT0gbnVsbCkgcmV0dXJuIHJlZkdvLkdldENvbXBvbmVudCh0YXJnZXRUeXBlKTsKICAg' +
	'ICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAkIkNhbm5vdCBhc3Np' +
	'Z24gcmVmZXJlbmNlOiAne3ZhbHVlU3RyfScgd2FzIG5vdCBmb3VuZCBpbiB0aGUgc2NlbmUgaGllcmFyY2h5LiIpOwogICAgICAg' +
	'IH0KCiAgICAgICAgLy8gT3RoZXIgVW5pdHlFbmdpbmUuT2JqZWN0IChTcHJpdGUsIE1hdGVyaWFsLCBBdWRpb0NsaXAsIGV0Yy4p' +
	'IOKAlCBsb2FkIGZyb20gYXNzZXQgREIKICAgICAgICBpZiAodHlwZW9mKFVuaXR5RW5naW5lLk9iamVjdCkuSXNBc3NpZ25hYmxl' +
	'RnJvbSh0YXJnZXRUeXBlKSkKICAgICAgICAgICAgcmV0dXJuIEFzc2V0RGF0YWJhc2UuTG9hZEFzc2V0QXRQYXRoKHZhbHVlU3Ry' +
	'LCB0YXJnZXRUeXBlKTsKCiAgICAgICAgLy8gRW51bSB0eXBlcyAoUmVuZGVyTW9kZSwgU2NhbGVNb2RlLCBUZXh0QWxpZ25tZW50' +
	'T3B0aW9ucywgZXRjLikKICAgICAgICBpZiAodGFyZ2V0VHlwZS5Jc0VudW0pCiAgICAgICAgewogICAgICAgICAgICAvLyBUcnkg' +
	'cGFyc2luZyBieSBuYW1lIGZpcnN0IChlLmcuICJTY3JlZW5TcGFjZU92ZXJsYXkiLCAiU2NhbGVXaXRoU2NyZWVuU2l6ZSIpCiAg' +
	'ICAgICAgICAgIGlmIChFbnVtLlRyeVBhcnNlKHRhcmdldFR5cGUsIHZhbHVlU3RyLCB0cnVlLCBvdXQgdmFyIGVudW1WYWwpKQog' +
	'ICAgICAgICAgICAgICAgcmV0dXJuIGVudW1WYWw7CiAgICAgICAgICAgIC8vIFRyeSBwYXJzaW5nIGFzIGludGVnZXIKICAgICAg' +
	'ICAgICAgaWYgKGludC5UcnlQYXJzZSh2YWx1ZVN0ciwgb3V0IHZhciBpbnRWYWwpKQogICAgICAgICAgICAgICAgcmV0dXJuIEVu' +
	'dW0uVG9PYmplY3QodGFyZ2V0VHlwZSwgaW50VmFsKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDYXN0RXhjZXB0aW9u' +
	'KCQiQ2Fubm90IGNvbnZlcnQgJ3t2YWx1ZVN0cn0nIHRvIHt0YXJnZXRUeXBlLk5hbWV9LiBWYWxpZCB2YWx1ZXM6IHtzdHJpbmcu' +
	'Sm9pbigiLCAiLCBFbnVtLkdldE5hbWVzKHRhcmdldFR5cGUpKX0iKTsKICAgICAgICB9CgogICAgICAgIC8vIFZlY3RvcjIKICAg' +
	'ICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2YoVmVjdG9yMikpCiAgICAgICAgICAgIHJldHVybiBQYXJzZVZlY3RvcjIodmFs' +
	'dWVTdHIpOwoKICAgICAgICAvLyBWZWN0b3IzCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKFZlY3RvcjMpKQogICAg' +
	'ICAgICAgICByZXR1cm4gUGFyc2VWZWN0b3IzKHZhbHVlU3RyKTsKCiAgICAgICAgLy8gVmVjdG9yNAogICAgICAgIGlmICh0YXJn' +
	'ZXRUeXBlID09IHR5cGVvZihWZWN0b3I0KSkKICAgICAgICAgICAgcmV0dXJuIFBhcnNlVmVjdG9yNCh2YWx1ZVN0cik7CgogICAg' +
	'ICAgIC8vIENvbG9yCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKENvbG9yKSkKICAgICAgICAgICAgcmV0dXJuIFBh' +
	'cnNlQ29sb3IodmFsdWVTdHIpOwoKICAgICAgICAvLyBCb29sCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKGJvb2wp' +
	'KQogICAgICAgICAgICByZXR1cm4gdmFsdWVTdHIuVG9Mb3dlcigpID09ICJ0cnVlIiB8fCB2YWx1ZVN0ciA9PSAiMSI7CgogICAg' +
	'ICAgIC8vIEludAogICAgICAgIGlmICh0YXJnZXRUeXBlID09IHR5cGVvZihpbnQpKQogICAgICAgIHsKICAgICAgICAgICAgaW50' +
	'LlRyeVBhcnNlKHZhbHVlU3RyLCBvdXQgdmFyIHYpOwogICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICB9CgogICAgICAgIC8v' +
	'IEZsb2F0CiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKGZsb2F0KSkKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0' +
	'LlRyeVBhcnNlKHZhbHVlU3RyLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxp' +
	'emF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgdik7CiAgICAgICAgICAgIHJldHVybiB2OwogICAg' +
	'ICAgIH0KCiAgICAgICAgLy8gU3RyaW5nCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKHN0cmluZykpCiAgICAgICAg' +
	'ICAgIHJldHVybiB2YWx1ZVN0cjsKCiAgICAgICAgLy8gRmFsbGJhY2sKICAgICAgICByZXR1cm4gQ29udmVydC5DaGFuZ2VUeXBl' +
	'KHZhbHVlU3RyLCB0YXJnZXRUeXBlKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IyIFBhcnNlVmVjdG9yMihzdHJp' +
	'bmcgc3RyKQogICAgewogICAgICAgIHN0ciA9IHN0ci5UcmltKCdbJywgJ10nLCAnKCcsICcpJykuVHJpbSgpOwogICAgICAgIHZh' +
	'ciBwYXJ0cyA9IHN0ci5TcGxpdCgnLCcpOwogICAgICAgIGlmIChwYXJ0cy5MZW5ndGggPj0gMikKICAgICAgICB7CiAgICAgICAg' +
	'ICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzBdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0' +
	'LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHgpOwogICAgICAgICAg' +
	'ICBmbG9hdC5UcnlQYXJzZShwYXJ0c1sxXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwg' +
	'U3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB5KTsKICAgICAgICAgICAg' +
	'cmV0dXJuIG5ldyBWZWN0b3IyKHgsIHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gVmVjdG9yMi56ZXJvOwogICAgfQoKICAg' +
	'IHByaXZhdGUgc3RhdGljIFZlY3RvcjMgUGFyc2VWZWN0b3IzKHN0cmluZyBzdHIpCiAgICB7CiAgICAgICAgLy8gSGFuZGxlIGJv' +
	'dGggIlt4LHksel0iIGFuZCAieCx5LHoiIGZvcm1hdHMKICAgICAgICBzdHIgPSBzdHIuVHJpbSgnWycsICddJywgJygnLCAnKScp' +
	'LlRyaW0oKTsKICAgICAgICB2YXIgcGFydHMgPSBzdHIuU3BsaXQoJywnKTsKICAgICAgICBpZiAocGFydHMuTGVuZ3RoID49IDMp' +
	'CiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1swXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9u' +
	'Lk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0' +
	'IHZhciB4KTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMV0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5O' +
	'dW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2' +
	'YXIgeSk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzJdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVt' +
	'YmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFy' +
	'IHopOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjMoeCwgeSwgeik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBWZWN0' +
	'b3IzLnplcm87CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgVmVjdG9yNCBQYXJzZVZlY3RvcjQoc3RyaW5nIHN0cikKICAgIHsK' +
	'ICAgICAgICBzdHIgPSBzdHIuVHJpbSgnWycsICddJywgJygnLCAnKScpLlRyaW0oKTsKICAgICAgICB2YXIgcGFydHMgPSBzdHIu' +
	'U3BsaXQoJywnKTsKICAgICAgICBpZiAocGFydHMuTGVuZ3RoID49IDQpCiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5UcnlQ' +
	'YXJzZShwYXJ0c1swXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2Jh' +
	'bGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB4KTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFy' +
	'c2UocGFydHNbMV0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxp' +
	'emF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgeSk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNl' +
	'KHBhcnRzWzJdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXph' +
	'dGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHopOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShw' +
	'YXJ0c1szXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRp' +
	'b24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB3KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3I0' +
	'KHgsIHksIHosIHcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gVmVjdG9yNC56ZXJvOwogICAgfQoKICAgIHByaXZhdGUgc3Rh' +
	'dGljIENvbG9yIFBhcnNlQ29sb3Ioc3RyaW5nIHN0cikKICAgIHsKICAgICAgICAvLyBUcnkgaGV4IGNvbG9yICgjUlJHR0JCIG9y' +
	'ICNSUkdHQkJBQSkKICAgICAgICBpZiAoc3RyLlN0YXJ0c1dpdGgoIiMiKSAmJiBDb2xvclV0aWxpdHkuVHJ5UGFyc2VIdG1sU3Ry' +
	'aW5nKHN0ciwgb3V0IHZhciBodG1sQ29sb3IpKQogICAgICAgICAgICByZXR1cm4gaHRtbENvbG9yOwogICAgICAgIC8vIFRyeSBS' +
	'R0JBIGNvbXBvbmVudHMKICAgICAgICBzdHIgPSBzdHIuVHJpbSgnWycsICddJywgJygnLCAnKScpLlRyaW0oKTsKICAgICAgICB2' +
	'YXIgcGFydHMgPSBzdHIuU3BsaXQoJywnKTsKICAgICAgICBpZiAocGFydHMuTGVuZ3RoID49IDMpCiAgICAgICAgewogICAgICAg' +
	'ICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1swXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9h' +
	'dCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciByKTsKICAgICAgICAg' +
	'ICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMV0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQs' +
	'IFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgZyk7CiAgICAgICAgICAg' +
	'IGZsb2F0LlRyeVBhcnNlKHBhcnRzWzJdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBT' +
	'eXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIGIpOwogICAgICAgICAgICBm' +
	'bG9hdCBhID0gMWY7CiAgICAgICAgICAgIGlmIChwYXJ0cy5MZW5ndGggPj0gNCkKICAgICAgICAgICAgICAgIGZsb2F0LlRyeVBh' +
	'cnNlKHBhcnRzWzNdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFs' +
	'aXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgYSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3Io' +
	'ciwgZywgYiwgYSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBDb2xvci53aGl0ZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp' +
	'YyB2b2lkIFNldFNlcmlhbGl6ZWRQcm9wZXJ0eVZhbHVlKFNlcmlhbGl6ZWRQcm9wZXJ0eSBwcm9wLCBzdHJpbmcgdmFsdWUpCiAg' +
	'ICB7CiAgICAgICAgc3dpdGNoIChwcm9wLnByb3BlcnR5VHlwZSkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXpl' +
	'ZFByb3BlcnR5VHlwZS5JbnRlZ2VyOgogICAgICAgICAgICAgICAgaWYgKGludC5UcnlQYXJzZSh2YWx1ZSwgb3V0IHZhciBpbnRW' +
	'YWwpKQogICAgICAgICAgICAgICAgICAgIHByb3AuaW50VmFsdWUgPSBpbnRWYWw7CiAgICAgICAgICAgICAgICBicmVhazsKICAg' +
	'ICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkZsb2F0OgogICAgICAgICAgICAgICAgaWYgKGZsb2F0LlRyeVBh' +
	'cnNlKHZhbHVlLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1' +
	'bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgZmxvYXRWYWwpKQogICAgICAgICAgICAgICAgICAgIHByb3AuZmxv' +
	'YXRWYWx1ZSA9IGZsb2F0VmFsOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3Bl' +
	'cnR5VHlwZS5Cb29sZWFuOgogICAgICAgICAgICAgICAgcHJvcC5ib29sVmFsdWUgPSB2YWx1ZS5Ub0xvd2VyKCkgPT0gInRydWUi' +
	'IHx8IHZhbHVlID09ICIxIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0' +
	'eVR5cGUuU3RyaW5nOgogICAgICAgICAgICAgICAgcHJvcC5zdHJpbmdWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgYnJl' +
	'YWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5FbnVtOgogICAgICAgICAgICAgICAgLy8gVHJ5IG5h' +
	'bWUgZmlyc3QsIHRoZW4gaW50ZWdlcgogICAgICAgICAgICAgICAgdmFyIGVudW1OYW1lcyA9IHByb3AuZW51bU5hbWVzOwogICAg' +
	'ICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlbnVtTmFtZXMuTGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICB7CiAg' +
	'ICAgICAgICAgICAgICAgICAgaWYgKHN0cmluZy5FcXVhbHMoZW51bU5hbWVzW2ldLCB2YWx1ZSwgU3RyaW5nQ29tcGFyaXNvbi5P' +
	'cmRpbmFsSWdub3JlQ2FzZSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9wLmVudW1W' +
	'YWx1ZUluZGV4ID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbnQuVHJ5UGFyc2UodmFsdWUsIG91dCB2YXIgZW51bUludCkpCiAgICAg' +
	'ICAgICAgICAgICAgICAgcHJvcC5lbnVtVmFsdWVJbmRleCA9IGVudW1JbnQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg' +
	'ICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLlZlY3RvcjI6CiAgICAgICAgICAgICAgICBwcm9wLnZlY3RvcjJWYWx1' +
	'ZSA9IFBhcnNlVmVjdG9yMih2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVk' +
	'UHJvcGVydHlUeXBlLlZlY3RvcjM6CiAgICAgICAgICAgICAgICBwcm9wLnZlY3RvcjNWYWx1ZSA9IFBhcnNlVmVjdG9yMyh2YWx1' +
	'ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkNvbG9yOgog' +
	'ICAgICAgICAgICAgICAgcHJvcC5jb2xvclZhbHVlID0gUGFyc2VDb2xvcih2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsK' +
	'ICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLk9iamVjdFJlZmVyZW5jZToKICAgICAgICAgICAgewogICAg' +
	'ICAgICAgICAgICAgLy8gdmFsdWUgaXMgYSBzY2VuZSBwYXRoL25hbWUgKGUuZy4gIk1haW4gTWVudSBQYW5lbCIsICJDYW52YXMv' +
	'UGFuZWwiKSBvciBhbgogICAgICAgICAgICAgICAgLy8gYXNzZXQgcGF0aCAoIkFzc2V0cy8uLi4iKS4gVHJ5IHNjZW5lIGZpcnN0' +
	'LCB0aGVuIGFzc2V0IGRhdGFiYXNlLgogICAgICAgICAgICAgICAgdmFyIHJlZkdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgodmFs' +
	'dWUpOwogICAgICAgICAgICAgICAgaWYgKHJlZkdvICE9IG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg' +
	'ICAgLy8gcHJvcC50eXBlIHJldHVybnMgZS5nLiAiUFB0cjwkQnV0dG9uPiIsICJQUHRyPCRHYW1lT2JqZWN0PiIsICJQUHRyPCRU' +
	'cmFuc2Zvcm0+IgogICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IFJlZ2V4Lk1hdGNoKHByb3AudHlwZSwgQCJQUHRyPFwk' +
	'KC4rKT4iKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZXhwZWN0ZWRUeXBlTmFtZSA9IG1hdGNoLlN1Y2Nlc3MgPyBtYXRjaC5H' +
	'cm91cHNbMV0uVmFsdWUgOiBwcm9wLnR5cGU7CgogICAgICAgICAgICAgICAgICAgIGlmIChleHBlY3RlZFR5cGVOYW1lID09ICJH' +
	'YW1lT2JqZWN0IikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb3Aub2JqZWN0UmVmZXJl' +
	'bmNlVmFsdWUgPSByZWZHbzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg' +
	'ICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIHJlc29sdmUgdGhlIGV4cGVjdGVkIGNvbXBvbmVu' +
	'dC9vYmplY3QgdHlwZQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcFR5cGUgPSBGaW5kQ29tcG9uZW50VHlwZShleHBl' +
	'Y3RlZFR5cGVOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBUeXBlICE9IG51bGwpCiAgICAgICAgICAgICAg' +
	'ICAgICAgICAgICAgICBwcm9wLm9iamVjdFJlZmVyZW5jZVZhbHVlID0gcmVmR28uR2V0Q29tcG9uZW50KGNvbXBUeXBlKTsKICAg' +
	'ICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcC5vYmplY3RSZWZlcmVuY2VW' +
	'YWx1ZSA9IHJlZkdvOyAvLyBiZXN0LWVmZm9ydCBmYWxsYmFjawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg' +
	'IH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAvLyBUcnkgbG9hZGlu' +
	'ZyBmcm9tIHRoZSBhc3NldCBkYXRhYmFzZSAoc3ByaXRlcywgcHJlZmFicywgbWF0ZXJpYWxz4oCmKQogICAgICAgICAgICAgICAg' +
	'ICAgIHZhciBhc3NldCA9IEFzc2V0RGF0YWJhc2UuTG9hZE1haW5Bc3NldEF0UGF0aCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAg' +
	'ICAgaWYgKGFzc2V0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9wLm9i' +
	'amVjdFJlZmVyZW5jZVZhbHVlID0gYXNzZXQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UK' +
	'ICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5laXRoZXIgc2NlbmUgbm9yIGFzc2V0IGRh' +
	'dGFiYXNlIHJlc29sdmVkIHRoZSByZWZlcmVuY2UuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRocm93IHNvIHRoZSBjYWxs' +
	'ZXIgcmV0dXJucyBhIHByb3BlciBlcnJvciBpbnN0ZWFkIG9mIHNpbGVudGx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxl' +
	'YXZpbmcgdGhlIGZpZWxkIG51bGwgYW5kIHJldHVybmluZyBzdWNjZXNzLgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu' +
	'ZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQiQ2Fubm90IGFzc2lnbiBy' +
	'ZWZlcmVuY2U6ICd7dmFsdWV9JyB3YXMgbm90IGZvdW5kIGluIHRoZSBzY2VuZSBoaWVyYXJjaHkgb3IgdGhlIGFzc2V0IGRhdGFi' +
	'YXNlLiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQiTWFrZSBzdXJlIHRoZSBHYW1lT2JqZWN0IG5hbWUgb3IgcGF0' +
	'aCBpcyBjb3JyZWN0LiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJy' +
	'ZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQ3JlYXRlRm9sZGVyUmVj' +
	'dXJzaXZlKHN0cmluZyBwYXRoKQogICAgewogICAgICAgIHZhciBwYXJ0cyA9IHBhdGguUmVwbGFjZSgiXFwiLCAiLyIpLlNwbGl0' +
	'KCcvJyk7CiAgICAgICAgdmFyIGN1cnJlbnQgPSBwYXJ0c1swXTsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBhcnRzLkxl' +
	'bmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIG5leHQgPSBjdXJyZW50ICsgIi8iICsgcGFydHNbaV07CiAgICAg' +
	'ICAgICAgIGlmICghQXNzZXREYXRhYmFzZS5Jc1ZhbGlkRm9sZGVyKG5leHQpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAg' +
	'ICBBc3NldERhdGFiYXNlLkNyZWF0ZUZvbGRlcihjdXJyZW50LCBwYXJ0c1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg' +
	'Y3VycmVudCA9IG5leHQ7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBFc2NhcGVKc29uKHN0cmlu' +
	'ZyBzKQogICAgewogICAgICAgIGlmIChzID09IG51bGwpIHJldHVybiAibnVsbCI7CiAgICAgICAgcmV0dXJuICJcIiIgKyBzLlJl' +
	'cGxhY2UoIlxcIiwgIlxcXFwiKS5SZXBsYWNlKCJcIiIsICJcXFwiIikuUmVwbGFjZSgiXG4iLCAiXFxuIikuUmVwbGFjZSgiXHIi' +
	'LCAiXFxyIikuUmVwbGFjZSgiXHQiLCAiXFx0IikgKyAiXCIiOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBNYWtl' +
	'U3VjY2VzcyhzdHJpbmcgaWQsIHN0cmluZyByZXN1bHRKc29uKQogICAgewogICAgICAgIHJldHVybiAkInt7XCJpZFwiOntFc2Nh' +
	'cGVKc29uKGlkKX0sXCJ0eXBlXCI6XCJyZXNwb25zZVwiLFwic3VjY2Vzc1wiOnRydWUsXCJyZXN1bHRcIjp7cmVzdWx0SnNvbn19' +
	'fSI7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIE1ha2VFcnJvcihzdHJpbmcgaWQsIHN0cmluZyBlcnJvcikKICAg' +
	'IHsKICAgICAgICByZXR1cm4gJCJ7e1wiaWRcIjp7RXNjYXBlSnNvbihpZCl9LFwidHlwZVwiOlwicmVzcG9uc2VcIixcInN1Y2Nl' +
	'c3NcIjpmYWxzZSxcImVycm9yXCI6e0VzY2FwZUpzb24oZXJyb3IpfX19IjsKICAgIH0KCiAgICAvLyAtLS0gU2VyaWFsaXphdGlv' +
	'biBIZWxwZXJzIC0tLQogICAgLy8gSnNvblV0aWxpdHkgbmVlZHMgc2VyaWFsaXphYmxlIGNsYXNzZXMgZm9yIEZyb21Kc29uCgog' +
	'ICAgW1NlcmlhbGl6YWJsZV0KICAgIHByaXZhdGUgY2xhc3MgU2VyaWFsaXphYmxlUmVxdWVzdAogICAgewogICAgICAgIHB1Ymxp' +
	'YyBzdHJpbmcgaWQ7CiAgICAgICAgcHVibGljIHN0cmluZyB0eXBlOwogICAgICAgIHB1YmxpYyBzdHJpbmcgY2F0ZWdvcnk7CiAg' +
	'ICAgICAgcHVibGljIHN0cmluZyBhY3Rpb247CiAgICAgICAgcHVibGljIHN0cmluZyBwYXJhbXNKc29uOyAvLyBQYXJhbXMgYXMg' +
	'cmF3IEpTT04gc3RyaW5nCgogICAgICAgIC8vLyA8c3VtbWFyeT4KICAgICAgICAvLy8gUGFyc2UgcGFyYW1zIGZyb20gdGhlIHJh' +
	'dyBKU09OLiBTaW5jZSBVbml0eSdzIEpzb25VdGlsaXR5IGRvZXNuJ3QgaGFuZGxlCiAgICAgICAgLy8vIERpY3Rpb25hcnkgb3Ig' +
	'ZHluYW1pYyBvYmplY3RzLCB3ZSBkbyBtYW51YWwgcGFyc2luZyBmb3IgdGhlIHNpbXBsZSBrZXktdmFsdWUgcGFyYW1zLgogICAg' +
	'ICAgIC8vLyA8L3N1bW1hcnk+CiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IEdldFBhcmFtcygpCiAg' +
	'ICAgICAgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCk7CiAgICAgICAg' +
	'ICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShwYXJhbXNKc29uKSkgcmV0dXJuIHJlc3VsdDsKCiAgICAgICAgICAgIC8vIFNp' +
	'bXBsZSBKU09OIG9iamVjdCBwYXJzZXIgZm9yIGZsYXQga2V5LXZhbHVlIHBhaXJzCiAgICAgICAgICAgIHZhciBqc29uID0gcGFy' +
	'YW1zSnNvbi5UcmltKCk7CiAgICAgICAgICAgIGlmICghanNvbi5TdGFydHNXaXRoKCJ7IikpIHJldHVybiByZXN1bHQ7CgogICAg' +
	'ICAgICAgICBqc29uID0ganNvbi5TdWJzdHJpbmcoMSwganNvbi5MZW5ndGggLSAyKS5UcmltKCk7CiAgICAgICAgICAgIGlmIChz' +
	'dHJpbmcuSXNOdWxsT3JFbXB0eShqc29uKSkgcmV0dXJuIHJlc3VsdDsKCiAgICAgICAgICAgIC8vIFNwbGl0IGJ5IGNvbW1hcyB0' +
	'aGF0IGFyZW4ndCBpbnNpZGUgc3RyaW5ncwogICAgICAgICAgICB2YXIgcGFpcnMgPSBTcGxpdEpzb25QYWlycyhqc29uKTsKICAg' +
	'ICAgICAgICAgZm9yZWFjaCAodmFyIHBhaXIgaW4gcGFpcnMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBjb2xv' +
	'bklkeCA9IHBhaXIuSW5kZXhPZignOicpOwogICAgICAgICAgICAgICAgaWYgKGNvbG9uSWR4IDwgMCkgY29udGludWU7CgogICAg' +
	'ICAgICAgICAgICAgdmFyIGtleSA9IHBhaXIuU3Vic3RyaW5nKDAsIGNvbG9uSWR4KS5UcmltKCkuVHJpbSgnIicpOwogICAgICAg' +
	'ICAgICAgICAgdmFyIHZhbCA9IHBhaXIuU3Vic3RyaW5nKGNvbG9uSWR4ICsgMSkuVHJpbSgpLlRyaW0oJyInKTsKCiAgICAgICAg' +
	'ICAgICAgICAvLyBIYW5kbGUgYXJyYXkgdmFsdWVzIChrZWVwIGFzIHN0cmluZyBmb3Igbm93KQogICAgICAgICAgICAgICAgaWYg' +
	'KHZhbC5TdGFydHNXaXRoKCJbIikpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsLlRyaW0oKTsKCiAgICAgICAgICAgICAg' +
	'ICByZXN1bHRba2V5XSA9IHZhbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9Cgog' +
	'ICAgICAgIHByaXZhdGUgc3RhdGljIExpc3Q8c3RyaW5nPiBTcGxpdEpzb25QYWlycyhzdHJpbmcganNvbikKICAgICAgICB7CiAg' +
	'ICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgTGlzdDxzdHJpbmc+KCk7CiAgICAgICAgICAgIHZhciBkZXB0aCA9IDA7CiAgICAg' +
	'ICAgICAgIHZhciBpblN0cmluZyA9IGZhbHNlOwogICAgICAgICAgICB2YXIgc3RhcnQgPSAwOwoKICAgICAgICAgICAgZm9yIChp' +
	'bnQgaSA9IDA7IGkgPCBqc29uLkxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGpzb25b' +
	'aV07CiAgICAgICAgICAgICAgICBpZiAoYyA9PSAnIicgJiYgKGkgPT0gMCB8fCBqc29uW2kgLSAxXSAhPSAnXFwnKSkKICAgICAg' +
	'ICAgICAgICAgICAgICBpblN0cmluZyA9ICFpblN0cmluZzsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFpblN0cmluZykKICAg' +
	'ICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSAneycgfHwgYyA9PSAnWycpIGRlcHRoKys7CiAgICAg' +
	'ICAgICAgICAgICAgICAgZWxzZSBpZiAoYyA9PSAnfScgfHwgYyA9PSAnXScpIGRlcHRoLS07CiAgICAgICAgICAgICAgICAgICAg' +
	'ZWxzZSBpZiAoYyA9PSAnLCcgJiYgZGVwdGggPT0gMCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAg' +
	'ICAgIHJlc3VsdC5BZGQoanNvbi5TdWJzdHJpbmcoc3RhcnQsIGkgLSBzdGFydCkuVHJpbSgpKTsKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgc3RhcnQgPSBpICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K' +
	'ICAgICAgICAgICAgaWYgKHN0YXJ0IDwganNvbi5MZW5ndGgpCiAgICAgICAgICAgICAgICByZXN1bHQuQWRkKGpzb24uU3Vic3Ry' +
	'aW5nKHN0YXJ0KS5UcmltKCkpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9Cgp9Cg==';

/** Decode and return the C# plugin source */
export function getBridgePluginSource(): string {
	return VSBuffer.wrap(Uint8Array.from(atob(BRIDGE_PLUGIN_BASE64), c => c.charCodeAt(0))).toString();
}
