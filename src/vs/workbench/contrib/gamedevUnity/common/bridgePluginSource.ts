/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Embedded source of the Unity Editor Bridge C# plugin (base64 encoded).
 * Auto-deployed into the user's Unity project at Assets/Editor/GameDevIDEBridge.cs.
 *
 * The readable source is at: unity-editor-plugin/GameDevIDEBridge.cs
 * To regenerate after editing the C# file, run from the repo root:
 *   node scripts/generate-bridge-plugin-source.js
 */

import { VSBuffer } from '../../../../base/common/buffer.js';

/** Version marker â€” bump when the plugin changes to trigger re-deploy */
export const BRIDGE_PLUGIN_VERSION = '1.3.1';

/** Path relative to Unity project root where the plugin is installed */
export const BRIDGE_PLUGIN_INSTALL_PATH = 'Assets/Editor/GameDevIDEBridge.cs';

/** Base64-encoded C# source of the Unity Editor Bridge plugin */
const BRIDGE_PLUGIN_BASE64 = '' +
	'LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIEdhbWVEZXYgSURFIEJyaWRnZSDigJQgVW5pdHkgRWRpdG9yIFBsdWdpbiAgKEFVVE8t' +
	'SU5TVEFMTEVEIGJ5IEdhbWVEZXYgSURFKQogKgogKiAgVGhpcyBmaWxlIGlzIGF1dG9tYXRpY2FsbHkgbWFuYWdlZCBieSBHYW1l' +
	'RGV2IElERS4gRG8gbm90IGVkaXQgbWFudWFsbHkuCiAqICBJdCBvcGVucyBhIFdlYlNvY2tldCBzZXJ2ZXIgb24gbG9jYWxob3N0' +
	'IHNvIHRoZSBJREUgY2FuIGNvbW11bmljYXRlIHdpdGgKICogIHRoZSBydW5uaW5nIFVuaXR5IEVkaXRvciB0byBjcmVhdGUgR2Ft' +
	'ZU9iamVjdHMsIHNjZW5lcywgcHJlZmFicywgZXRjLgogKgogKiAgUHJvdG9jb2wgdmVyc2lvbjogMS4wCiAqICBQbHVnaW4gdmVy' +
	'c2lvbjogMS4zLjEKICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgp1c2luZyBVbml0eUVuZ2luZTsKdXNpbmcgVW5pdHlFZGl0b3I7CnVz' +
	'aW5nIFVuaXR5RWRpdG9yLlNjZW5lTWFuYWdlbWVudDsKdXNpbmcgVW5pdHlFbmdpbmUuU2NlbmVNYW5hZ2VtZW50Owp1c2luZyBT' +
	'eXN0ZW07CnVzaW5nIFN5c3RlbS5JTzsKdXNpbmcgU3lzdGVtLk5ldDsKdXNpbmcgU3lzdGVtLk5ldC5Tb2NrZXRzOwp1c2luZyBT' +
	'eXN0ZW0uTmV0LldlYlNvY2tldHM7CnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHk7CnVzaW5nIFN5c3RlbS5UZXh0' +
	'Owp1c2luZyBTeXN0ZW0uVGV4dC5SZWd1bGFyRXhwcmVzc2lvbnM7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7CnVzaW5nIFN5c3Rl' +
	'bS5UaHJlYWRpbmcuVGFza3M7CnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5Db25jdXJyZW50Owp1c2luZyBTeXN0ZW0uQ29sbGVj' +
	'dGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247CnVzaW5nIFN5c3RlbS5MaW5xOwoKW0luaXRpYWxpemVPbkxv' +
	'YWRdCnB1YmxpYyBzdGF0aWMgY2xhc3MgR2FtZURldklERUJyaWRnZQp7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBQUk9UT0NP' +
	'TF9WRVJTSU9OID0gIjEuMCI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRElSID0gIkxpYnJhcnkvR2FtZURl' +
	'dklERSI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRklMRSA9ICJMaWJyYXJ5L0dhbWVEZXZJREUvYnJpZGdl' +
	'Lmpzb24iOwoKICAgIHByaXZhdGUgc3RhdGljIFRjcExpc3RlbmVyIF9saXN0ZW5lcjsKICAgIHByaXZhdGUgc3RhdGljIFRjcENs' +
	'aWVudCBfdGNwQ2xpZW50OwogICAgcHJpdmF0ZSBzdGF0aWMgTmV0d29ya1N0cmVhbSBfY2xpZW50U3RyZWFtOwogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UgX2N0czsKICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENvbmN1cnJl' +
	'bnRRdWV1ZTxzdHJpbmc+IF9pbmNvbWluZ01lc3NhZ2VzID0gbmV3IENvbmN1cnJlbnRRdWV1ZTxzdHJpbmc+KCk7CiAgICBwcml2' +
	'YXRlIHN0YXRpYyByZWFkb25seSBDb25jdXJyZW50UXVldWU8c3RyaW5nPiBfb3V0Z29pbmdNZXNzYWdlcyA9IG5ldyBDb25jdXJy' +
	'ZW50UXVldWU8c3RyaW5nPigpOwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IF9wb3J0OwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBf' +
	'cnVubmluZzsKICAgIHByaXZhdGUgc3RhdGljIGJvb2wgX2NsaWVudENvbm5lY3RlZDsKCiAgICBzdGF0aWMgR2FtZURldklERUJy' +
	'aWRnZSgpCiAgICB7CiAgICAgICAgRWRpdG9yQXBwbGljYXRpb24udXBkYXRlICs9IFByb2Nlc3NNZXNzYWdlczsKICAgICAgICBF' +
	'ZGl0b3JBcHBsaWNhdGlvbi5xdWl0dGluZyArPSBTaHV0ZG93bjsKICAgICAgICBBc3NlbWJseVJlbG9hZEV2ZW50cy5iZWZvcmVB' +
	'c3NlbWJseVJlbG9hZCArPSBPbkJlZm9yZVJlbG9hZDsKICAgICAgICBBcHBsaWNhdGlvbi5sb2dNZXNzYWdlUmVjZWl2ZWQgKz0g' +
	'T25Mb2dNZXNzYWdlOwogICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLnBsYXlNb2RlU3RhdGVDaGFuZ2VkICs9IE9uUGxheU1vZGVD' +
	'aGFuZ2VkOwogICAgICAgIFN0YXJ0U2VydmVyKCk7CiAgICB9CgogICAgLy8gLS0tIFNlcnZlciBMaWZlY3ljbGUgKFRjcExpc3Rl' +
	'bmVyICsgbWFudWFsIFdlYlNvY2tldCBoYW5kc2hha2UpIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIGFzeW5jIHZvaWQgU3RhcnRT' +
	'ZXJ2ZXIoKQogICAgewogICAgICAgIGlmIChfcnVubmluZykgcmV0dXJuOwoKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAg' +
	'ICAgIF9jdHMgPSBuZXcgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTsKCiAgICAgICAgICAgIC8vIEJpbmQgdG8gcG9ydCAwIGZv' +
	'ciBhdXRvLWFzc2lnbm1lbnQKICAgICAgICAgICAgX2xpc3RlbmVyID0gbmV3IFRjcExpc3RlbmVyKElQQWRkcmVzcy5Mb29wYmFj' +
	'aywgMCk7CiAgICAgICAgICAgIF9saXN0ZW5lci5TdGFydCgpOwogICAgICAgICAgICBfcG9ydCA9ICgoSVBFbmRQb2ludClfbGlz' +
	'dGVuZXIuTG9jYWxFbmRwb2ludCkuUG9ydDsKICAgICAgICAgICAgX3J1bm5pbmcgPSB0cnVlOwoKICAgICAgICAgICAgV3JpdGVE' +
	'aXNjb3ZlcnlGaWxlKCk7CiAgICAgICAgICAgIERlYnVnLkxvZygkIltHYW1lRGV2SURFIEJyaWRnZV0gU3RhcnRlZCBvbiBwb3J0' +
	'IHtfcG9ydH0gKHZ7UFJPVE9DT0xfVkVSU0lPTn0pIik7CgogICAgICAgICAgICAvLyBBY2NlcHQgY29ubmVjdGlvbnMgaW4gYmFj' +
	'a2dyb3VuZAogICAgICAgICAgICBhd2FpdCBBY2NlcHRDb25uZWN0aW9ucyhfY3RzLlRva2VuKTsKICAgICAgICB9CiAgICAgICAg' +
	'Y2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIERlYnVnLkxvZ0Vycm9yKCQiW0dhbWVEZXZJREUgQnJp' +
	'ZGdlXSBGYWlsZWQgdG8gc3RhcnQ6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICBfcnVubmluZyA9IGZhbHNlOwogICAgICAg' +
	'IH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIEFjY2VwdENvbm5lY3Rpb25zKENhbmNlbGxhdGlvblRva2Vu' +
	'IHRva2VuKQogICAgewogICAgICAgIHdoaWxlICghdG9rZW4uSXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQgJiYgX3J1bm5pbmcpCiAg' +
	'ICAgICAgewogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IGF3YWl0IF9s' +
	'aXN0ZW5lci5BY2NlcHRUY3BDbGllbnRBc3luYygpOwogICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9IGNsaWVudC5HZXRTdHJl' +
	'YW0oKTsKCiAgICAgICAgICAgICAgICAvLyBSZWFkIHRoZSBIVFRQIHVwZ3JhZGUgcmVxdWVzdAogICAgICAgICAgICAgICAgdmFy' +
	'IGJ1ZmZlciA9IG5ldyBieXRlWzQwOTZdOwogICAgICAgICAgICAgICAgaW50IGJ5dGVzUmVhZCA9IGF3YWl0IHN0cmVhbS5SZWFk' +
	'QXN5bmMoYnVmZmVyLCAwLCBidWZmZXIuTGVuZ3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IEVuY29k' +
	'aW5nLlVURjguR2V0U3RyaW5nKGJ1ZmZlciwgMCwgYnl0ZXNSZWFkKTsKCiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5Db250' +
	'YWlucygiVXBncmFkZTogd2Vic29ja2V0IikgfHwgcmVxdWVzdC5Db250YWlucygiVXBncmFkZTogV2ViU29ja2V0IikpCiAgICAg' +
	'ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBhbGxvdyBvbmUgY2xpZW50IGF0IGEgdGltZQogICAgICAg' +
	'ICAgICAgICAgICAgIGlmIChfY2xpZW50Q29ubmVjdGVkKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgdmFyIHJlamVjdCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoIkhUVFAvMS4xIDQwOSBDb25mbGljdFxyXG5cclxuIik7' +
	'CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHJlamVjdCwgMCwgcmVqZWN0Lkxlbmd0aCwg' +
	'dG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQuQ2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29u' +
	'dGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIFdlYlNvY2tldCBoYW5k' +
	'c2hha2UKICAgICAgICAgICAgICAgICAgICBpZiAoUGVyZm9ybVdlYlNvY2tldEhhbmRzaGFrZShzdHJlYW0sIHJlcXVlc3QpKQog' +
	'ICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RjcENsaWVudCA9IGNsaWVudDsKICAgICAgICAg' +
	'ICAgICAgICAgICAgICAgX2NsaWVudFN0cmVhbSA9IHN0cmVhbTsKICAgICAgICAgICAgICAgICAgICAgICAgX2NsaWVudENvbm5l' +
	'Y3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLkxvZygiW0dhbWVEZXZJREUgQnJpZGdlXSBJREUgY29u' +
	'bmVjdGVkIik7CgogICAgICAgICAgICAgICAgICAgICAgICBfID0gUmVjZWl2ZU1lc3NhZ2VzKHN0cmVhbSwgdG9rZW4pOwogICAg' +
	'ICAgICAgICAgICAgICAgICAgICBfID0gU2VuZE1lc3NhZ2VzKHN0cmVhbSwgdG9rZW4pOwogICAgICAgICAgICAgICAgICAgIH0K' +
	'ICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjbGll' +
	'bnQuQ2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAg' +
	'ICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2ltcGxlIGhlYWx0aCBjaGVjawogICAgICAgICAgICAgICAg' +
	'ICAgIHZhciBib2R5ID0gIntcInN0YXR1c1wiOlwib2tcIixcInZlcnNpb25cIjpcIiIgKyBQUk9UT0NPTF9WRVJTSU9OICsgIlwi' +
	'fSI7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gIkhUVFAvMS4xIDIwMCBPS1xyXG5Db250ZW50LVR5cGU6IGFw' +
	'cGxpY2F0aW9uL2pzb25cclxuQ29udGVudC1MZW5ndGg6ICIgKyBib2R5Lkxlbmd0aCArICJcclxuQ29ubmVjdGlvbjogY2xvc2Vc' +
	'clxuXHJcbiIgKyBib2R5OwogICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUJ5dGVzID0gRW5jb2RpbmcuVVRGOC5HZXRC' +
	'eXRlcyhyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3RyZWFtLldyaXRlQXN5bmMocmVzcG9uc2VCeXRlcywg' +
	'MCwgcmVzcG9uc2VCeXRlcy5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgICAgICBjbGllbnQuQ2xvc2UoKTsKICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoT2JqZWN0RGlzcG9zZWRFeGNlcHRpb24pIHsgYnJl' +
	'YWs7IH0KICAgICAgICAgICAgY2F0Y2ggKFNvY2tldEV4Y2VwdGlvbikgeyBicmVhazsgfQogICAgICAgICAgICBjYXRjaCAoRXhj' +
	'ZXB0aW9uIGV4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIXRva2VuLklzQ2FuY2VsbGF0aW9uUmVxdWVzdGVk' +
	'KQogICAgICAgICAgICAgICAgICAgIERlYnVnLkxvZ1dhcm5pbmcoJCJbR2FtZURldklERSBCcmlkZ2VdIENvbm5lY3Rpb24gZXJy' +
	'b3I6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGJvb2wg' +
	'UGVyZm9ybVdlYlNvY2tldEhhbmRzaGFrZShOZXR3b3JrU3RyZWFtIHN0cmVhbSwgc3RyaW5nIHJlcXVlc3QpCiAgICB7CiAgICAg' +
	'ICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICAvLyBFeHRyYWN0IFNlYy1XZWJTb2NrZXQtS2V5IGZyb20gdGhlIHJlcXVlc3Qg' +
	'aGVhZGVycwogICAgICAgICAgICB2YXIga2V5TWF0Y2ggPSBSZWdleC5NYXRjaChyZXF1ZXN0LCBAIlNlYy1XZWJTb2NrZXQtS2V5' +
	'OlxzKiguKz8pXHJcbiIpOwogICAgICAgICAgICBpZiAoIWtleU1hdGNoLlN1Y2Nlc3MpIHJldHVybiBmYWxzZTsKCiAgICAgICAg' +
	'ICAgIHZhciBrZXkgPSBrZXlNYXRjaC5Hcm91cHNbMV0uVmFsdWUuVHJpbSgpOwogICAgICAgICAgICB2YXIgYWNjZXB0S2V5ID0g' +
	'Q29udmVydC5Ub0Jhc2U2NFN0cmluZygKICAgICAgICAgICAgICAgIFNIQTEuQ3JlYXRlKCkuQ29tcHV0ZUhhc2goCiAgICAgICAg' +
	'ICAgICAgICAgICAgRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhrZXkgKyAiMjU4RUFGQTUtRTkxNC00N0RBLTk1Q0EtQzVBQjBEQzg1' +
	'QjExIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHZhciByZXNwb25zZSA9CiAgICAgICAg' +
	'ICAgICAgICAiSFRUUC8xLjEgMTAxIFN3aXRjaGluZyBQcm90b2NvbHNcclxuIiArCiAgICAgICAgICAgICAgICAiVXBncmFkZTog' +
	'd2Vic29ja2V0XHJcbiIgKwogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb246IFVwZ3JhZGVcclxuIiArCiAgICAgICAgICAgICAg' +
	'ICAiU2VjLVdlYlNvY2tldC1BY2NlcHQ6ICIgKyBhY2NlcHRLZXkgKyAiXHJcblxyXG4iOwoKICAgICAgICAgICAgdmFyIHJlc3Bv' +
	'bnNlQnl0ZXMgPSBFbmNvZGluZy5VVEY4LkdldEJ5dGVzKHJlc3BvbnNlKTsKICAgICAgICAgICAgc3RyZWFtLldyaXRlKHJlc3Bv' +
	'bnNlQnl0ZXMsIDAsIHJlc3BvbnNlQnl0ZXMuTGVuZ3RoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAg' +
	'ICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAgICAgICAgICBEZWJ1Zy5Mb2dXYXJuaW5nKCQiW0dhbWVEZXZJ' +
	'REUgQnJpZGdlXSBIYW5kc2hha2UgZmFpbGVkOiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg' +
	'ICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIFJlY2VpdmVNZXNzYWdlcyhOZXR3b3JrU3RyZWFtIHN0' +
	'cmVhbSwgQ2FuY2VsbGF0aW9uVG9rZW4gdG9rZW4pCiAgICB7CiAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBieXRlWzgxOTJdOwoK' +
	'ICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIHdoaWxlIChfY2xpZW50Q29ubmVjdGVkICYmICF0b2tlbi5Jc0NhbmNl' +
	'bGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCFzdHJlYW0uRGF0YUF2YWlsYWJsZSkK' +
	'ICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDgsIHRva2VuKTsKICAgICAgICAg' +
	'ICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbnQgYnl0ZXNSZWFkID0gYXdh' +
	'aXQgc3RyZWFtLlJlYWRBc3luYyhidWZmZXIsIDAsIGJ1ZmZlci5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgIGlmIChi' +
	'eXRlc1JlYWQgPT0gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURF' +
	'IEJyaWRnZV0gSURFIGRpc2Nvbm5lY3RlZCIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoK' +
	'ICAgICAgICAgICAgICAgIC8vIERlY29kZSBXZWJTb2NrZXQgZnJhbWUocykKICAgICAgICAgICAgICAgIGludCBvZmZzZXQgPSAw' +
	'OwogICAgICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IGJ5dGVzUmVhZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAg' +
	'ICAgICAgICB2YXIgZnJhbWUgPSBEZWNvZGVXZWJTb2NrZXRGcmFtZShidWZmZXIsIG9mZnNldCwgYnl0ZXNSZWFkIC0gb2Zmc2V0' +
	'KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUgPT0gbnVsbCkgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIG9mZnNl' +
	'dCArPSBmcmFtZS5Ub3RhbExlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1lLk9wY29kZSA9PSAweDgpIC8vIENs' +
	'b3NlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGNsb3NlIGZyYW1lIGJhY2sK' +
	'ICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsb3NlRnJhbWUgPSBuZXcgYnl0ZVtdIHsgMHg4OCwgMHgwMCB9OwogICAgICAg' +
	'ICAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYW0uV3JpdGVBc3luYyhjbG9zZUZyYW1lLCAwLCBjbG9zZUZyYW1lLkxlbmd0aCwg' +
	'dG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURFIEJyaWRnZV0gSURFIGRpc2Nvbm5l' +
	'Y3RlZCAoY2xvc2UgZnJhbWUpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIERpc2Nvbm5lY3RDbGllbnQoKTsKICAgICAgICAg' +
	'ICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1l' +
	'Lk9wY29kZSA9PSAweDkpIC8vIFBpbmcKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNl' +
	'bmQgcG9uZwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9uZyA9IEVuY29kZVdlYlNvY2tldEZyYW1lKGZyYW1lLlBheWxv' +
	'YWQsIDB4QSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHBvbmcsIDAsIHBvbmcuTGVu' +
	'Z3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAg' +
	'ICAgICAgICAgICAgICAgaWYgKGZyYW1lLk9wY29kZSA9PSAweDEgfHwgZnJhbWUuT3Bjb2RlID09IDB4MikgLy8gVGV4dCBvciBC' +
	'aW5hcnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gRW5jb2Rpbmcu' +
	'VVRGOC5HZXRTdHJpbmcoZnJhbWUuUGF5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pbmNvbWluZ01lc3NhZ2VzLkVu' +
	'cXVldWUobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg' +
	'ICAgfQogICAgICAgIGNhdGNoIChJT0V4Y2VwdGlvbikgeyAvKiBDbGllbnQgZGlzY29ubmVjdGVkICovIH0KICAgICAgICBjYXRj' +
	'aCAoT3BlcmF0aW9uQ2FuY2VsZWRFeGNlcHRpb24pIHsgLyogU2h1dHRpbmcgZG93biAqLyB9CiAgICAgICAgY2F0Y2ggKEV4Y2Vw' +
	'dGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIERlYnVnLkxvZ1dhcm5pbmcoJCJbR2FtZURldklERSBCcmlkZ2VdIFJlY2Vp' +
	'dmUgZXJyb3I6IHtleC5NZXNzYWdlfSIpOwogICAgICAgIH0KCiAgICAgICAgRGlzY29ubmVjdENsaWVudCgpOwogICAgfQoKICAg' +
	'IHByaXZhdGUgc3RhdGljIGFzeW5jIFRhc2sgU2VuZE1lc3NhZ2VzKE5ldHdvcmtTdHJlYW0gc3RyZWFtLCBDYW5jZWxsYXRpb25U' +
	'b2tlbiB0b2tlbikKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIHdoaWxlIChfY2xpZW50Q29ubmVjdGVk' +
	'ICYmICF0b2tlbi5Jc0NhbmNlbGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKF9vdXRn' +
	'b2luZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZhciBtZXNzYWdlKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'ICAgICB2YXIgcGF5bG9hZCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgdmFy' +
	'IGZyYW1lID0gRW5jb2RlV2ViU29ja2V0RnJhbWUocGF5bG9hZCwgMHgxKTsgLy8gVGV4dCBmcmFtZQogICAgICAgICAgICAgICAg' +
	'ICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKGZyYW1lLCAwLCBmcmFtZS5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAg' +
	'IH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRl' +
	'bGF5KDE2LCB0b2tlbik7IC8vIH42MEh6IHBvbGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg' +
	'ICAgICBjYXRjaCAoSU9FeGNlcHRpb24pIHsgfQogICAgICAgIGNhdGNoIChPcGVyYXRpb25DYW5jZWxlZEV4Y2VwdGlvbikgeyB9' +
	'CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBEaXNjb25uZWN0Q2xpZW50KCkKICAgIHsKICAgICAgICBfY2xpZW50Q29u' +
	'bmVjdGVkID0gZmFsc2U7CiAgICAgICAgdHJ5IHsgX2NsaWVudFN0cmVhbT8uQ2xvc2UoKTsgfSBjYXRjaCB7IH0KICAgICAgICB0' +
	'cnkgeyBfdGNwQ2xpZW50Py5DbG9zZSgpOyB9IGNhdGNoIHsgfQogICAgICAgIF9jbGllbnRTdHJlYW0gPSBudWxsOwogICAgICAg' +
	'IF90Y3BDbGllbnQgPSBudWxsOwogICAgfQoKICAgIC8vIC0tLSBXZWJTb2NrZXQgRnJhbWUgRW5jb2RpbmcvRGVjb2RpbmcgLS0t' +
	'CgogICAgcHJpdmF0ZSBjbGFzcyBXZWJTb2NrZXRGcmFtZQogICAgewogICAgICAgIHB1YmxpYyBieXRlIE9wY29kZTsKICAgICAg' +
	'ICBwdWJsaWMgYnl0ZVtdIFBheWxvYWQ7CiAgICAgICAgcHVibGljIGludCBUb3RhbExlbmd0aDsgLy8gVG90YWwgYnl0ZXMgY29u' +
	'c3VtZWQgZnJvbSBidWZmZXIKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBXZWJTb2NrZXRGcmFtZSBEZWNvZGVXZWJTb2NrZXRG' +
	'cmFtZShieXRlW10gYnVmZmVyLCBpbnQgb2Zmc2V0LCBpbnQgbGVuZ3RoKQogICAgewogICAgICAgIGlmIChsZW5ndGggPCAyKSBy' +
	'ZXR1cm4gbnVsbDsKCiAgICAgICAgdmFyIG9wY29kZSA9IChieXRlKShidWZmZXJbb2Zmc2V0XSAmIDB4MEYpOwogICAgICAgIHZh' +
	'ciBtYXNrZWQgPSAoYnVmZmVyW29mZnNldCArIDFdICYgMHg4MCkgIT0gMDsKICAgICAgICBsb25nIHBheWxvYWRMZW4gPSBidWZm' +
	'ZXJbb2Zmc2V0ICsgMV0gJiAweDdGOwogICAgICAgIGludCBoZWFkZXJMZW4gPSAyOwoKICAgICAgICBpZiAocGF5bG9hZExlbiA9' +
	'PSAxMjYpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgNCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHBheWxv' +
	'YWRMZW4gPSAoYnVmZmVyW29mZnNldCArIDJdIDw8IDgpIHwgYnVmZmVyW29mZnNldCArIDNdOwogICAgICAgICAgICBoZWFkZXJM' +
	'ZW4gPSA0OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwYXlsb2FkTGVuID09IDEyNykKICAgICAgICB7CiAgICAgICAgICAg' +
	'IGlmIChsZW5ndGggPCAxMCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHBheWxvYWRMZW4gPSAwOwogICAgICAgICAgICBmb3Ig' +
	'KGludCBpID0gMDsgaSA8IDg7IGkrKykKICAgICAgICAgICAgICAgIHBheWxvYWRMZW4gPSAocGF5bG9hZExlbiA8PCA4KSB8IGJ1' +
	'ZmZlcltvZmZzZXQgKyAyICsgaV07CiAgICAgICAgICAgIGhlYWRlckxlbiA9IDEwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZVtd' +
	'IG1hc2tLZXkgPSBudWxsOwogICAgICAgIGlmIChtYXNrZWQpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgaGVh' +
	'ZGVyTGVuICsgNCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIG1hc2tLZXkgPSBuZXcgYnl0ZVs0XTsKICAgICAgICAgICAgQXJy' +
	'YXkuQ29weShidWZmZXIsIG9mZnNldCArIGhlYWRlckxlbiwgbWFza0tleSwgMCwgNCk7CiAgICAgICAgICAgIGhlYWRlckxlbiAr' +
	'PSA0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGxlbmd0aCA8IGhlYWRlckxlbiArIHBheWxvYWRMZW4pIHJldHVybiBudWxsOwoK' +
	'ICAgICAgICB2YXIgcGF5bG9hZCA9IG5ldyBieXRlW3BheWxvYWRMZW5dOwogICAgICAgIEFycmF5LkNvcHkoYnVmZmVyLCBvZmZz' +
	'ZXQgKyBoZWFkZXJMZW4sIHBheWxvYWQsIDAsIChpbnQpcGF5bG9hZExlbik7CgogICAgICAgIGlmIChtYXNrZWQgJiYgbWFza0tl' +
	'eSAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXlsb2FkLkxlbmd0aDsgaSsrKQog' +
	'ICAgICAgICAgICAgICAgcGF5bG9hZFtpXSBePSBtYXNrS2V5W2kgJSA0XTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXcg' +
	'V2ViU29ja2V0RnJhbWUKICAgICAgICB7CiAgICAgICAgICAgIE9wY29kZSA9IG9wY29kZSwKICAgICAgICAgICAgUGF5bG9hZCA9' +
	'IHBheWxvYWQsCiAgICAgICAgICAgIFRvdGFsTGVuZ3RoID0gaGVhZGVyTGVuICsgKGludClwYXlsb2FkTGVuCiAgICAgICAgfTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBieXRlW10gRW5jb2RlV2ViU29ja2V0RnJhbWUoYnl0ZVtdIHBheWxvYWQsIGJ5dGUg' +
	'b3Bjb2RlKQogICAgewogICAgICAgIHZhciBsZW4gPSBwYXlsb2FkLkxlbmd0aDsKICAgICAgICBieXRlW10gZnJhbWU7CgogICAg' +
	'ICAgIGlmIChsZW4gPCAxMjYpCiAgICAgICAgewogICAgICAgICAgICBmcmFtZSA9IG5ldyBieXRlWzIgKyBsZW5dOwogICAgICAg' +
	'ICAgICBmcmFtZVswXSA9IChieXRlKSgweDgwIHwgb3Bjb2RlKTsgLy8gRklOICsgb3Bjb2RlCiAgICAgICAgICAgIGZyYW1lWzFd' +
	'ID0gKGJ5dGUpbGVuOwogICAgICAgICAgICBBcnJheS5Db3B5KHBheWxvYWQsIDAsIGZyYW1lLCAyLCBsZW4pOwogICAgICAgIH0K' +
	'ICAgICAgICBlbHNlIGlmIChsZW4gPCA2NTUzNikKICAgICAgICB7CiAgICAgICAgICAgIGZyYW1lID0gbmV3IGJ5dGVbNCArIGxl' +
	'bl07CiAgICAgICAgICAgIGZyYW1lWzBdID0gKGJ5dGUpKDB4ODAgfCBvcGNvZGUpOwogICAgICAgICAgICBmcmFtZVsxXSA9IDEy' +
	'NjsKICAgICAgICAgICAgZnJhbWVbMl0gPSAoYnl0ZSkobGVuID4+IDgpOwogICAgICAgICAgICBmcmFtZVszXSA9IChieXRlKShs' +
	'ZW4gJiAweEZGKTsKICAgICAgICAgICAgQXJyYXkuQ29weShwYXlsb2FkLCAwLCBmcmFtZSwgNCwgbGVuKTsKICAgICAgICB9CiAg' +
	'ICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgZnJhbWUgPSBuZXcgYnl0ZVsxMCArIGxlbl07CiAgICAgICAgICAgIGZy' +
	'YW1lWzBdID0gKGJ5dGUpKDB4ODAgfCBvcGNvZGUpOwogICAgICAgICAgICBmcmFtZVsxXSA9IDEyNzsKICAgICAgICAgICAgZm9y' +
	'IChpbnQgaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgICAgICBmcmFtZVsyICsgaV0gPSAoYnl0ZSkoKGxlbiA+PiAoNTYg' +
	'LSBpICogOCkpICYgMHhGRik7CiAgICAgICAgICAgIEFycmF5LkNvcHkocGF5bG9hZCwgMCwgZnJhbWUsIDEwLCBsZW4pOwogICAg' +
	'ICAgIH0KCiAgICAgICAgcmV0dXJuIGZyYW1lOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgV3JpdGVEaXNjb3ZlcnlG' +
	'aWxlKCkKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGlmICghRGlyZWN0b3J5LkV4aXN0cyhESVNDT1ZF' +
	'UllfRElSKSkKICAgICAgICAgICAgICAgIERpcmVjdG9yeS5DcmVhdGVEaXJlY3RvcnkoRElTQ09WRVJZX0RJUik7CgogICAgICAg' +
	'ICAgICB2YXIganNvbiA9ICQie3tcInBvcnRcIjp7X3BvcnR9LFwicGlkXCI6e1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLkdl' +
	'dEN1cnJlbnRQcm9jZXNzKCkuSWR9LFwidmVyc2lvblwiOlwie1BST1RPQ09MX1ZFUlNJT059XCIsXCJ0aW1lc3RhbXBcIjp7RGF0' +
	'ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVTZWNvbmRzKCl9fX0iOwogICAgICAgICAgICBGaWxlLldyaXRlQWxsVGV4dChE' +
	'SVNDT1ZFUllfRklMRSwganNvbik7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAg' +
	'ICAgICAgICBEZWJ1Zy5Mb2dFcnJvcigkIltHYW1lRGV2SURFIEJyaWRnZV0gRmFpbGVkIHRvIHdyaXRlIGRpc2NvdmVyeSBmaWxl' +
	'OiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTaHV0ZG93bigpCiAgICB7' +
	'CiAgICAgICAgX3J1bm5pbmcgPSBmYWxzZTsKICAgICAgICBfY3RzPy5DYW5jZWwoKTsKCiAgICAgICAgRGlzY29ubmVjdENsaWVu' +
	'dCgpOwoKICAgICAgICB0cnkgeyBfbGlzdGVuZXI/LlN0b3AoKTsgfQogICAgICAgIGNhdGNoIHsgfQoKICAgICAgICB0cnkgeyBp' +
	'ZiAoRmlsZS5FeGlzdHMoRElTQ09WRVJZX0ZJTEUpKSBGaWxlLkRlbGV0ZShESVNDT1ZFUllfRklMRSk7IH0KICAgICAgICBjYXRj' +
	'aCB7IH0KCiAgICAgICAgRGVidWcuTG9nKCJbR2FtZURldklERSBCcmlkZ2VdIFN0b3BwZWQiKTsKICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyB2b2lkIE9uQmVmb3JlUmVsb2FkKCkKICAgIHsKICAgICAgICAvLyBDbGVhbiB1cCBiZWZvcmUgZG9tYWluIHJlbG9h' +
	'ZCAoc2NyaXB0IHJlY29tcGlsYXRpb24pCiAgICAgICAgU2h1dGRvd24oKTsKICAgIH0KCiAgICAvLyAtLS0gVW5pdHkgRXZlbnQg' +
	'Rm9yd2FyZGluZyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIE9uTG9nTWVzc2FnZShzdHJpbmcgY29uZGl0aW9uLCBzdHJp' +
	'bmcgc3RhY2tUcmFjZSwgTG9nVHlwZSB0eXBlKQogICAgewogICAgICAgIGlmICghX2NsaWVudENvbm5lY3RlZCkgcmV0dXJuOwoK' +
	'ICAgICAgICB2YXIgbG9nVHlwZSA9IHR5cGUgc3dpdGNoCiAgICAgICAgewogICAgICAgICAgICBMb2dUeXBlLkVycm9yID0+ICJF' +
	'cnJvciIsCiAgICAgICAgICAgIExvZ1R5cGUuV2FybmluZyA9PiAiV2FybmluZyIsCiAgICAgICAgICAgIExvZ1R5cGUuRXhjZXB0' +
	'aW9uID0+ICJFeGNlcHRpb24iLAogICAgICAgICAgICBMb2dUeXBlLkFzc2VydCA9PiAiQXNzZXJ0IiwKICAgICAgICAgICAgXyA9' +
	'PiAiTG9nIgogICAgICAgIH07CgogICAgICAgIHZhciBldmVudEpzb24gPSAkInt7XCJpZFwiOlwie0d1aWQuTmV3R3VpZCgpfVwi' +
	'LFwidHlwZVwiOlwiZXZlbnRcIixcImV2ZW50XCI6XCJjb25zb2xlLmxvZ1wiLFwiZGF0YVwiOnt7XCJtZXNzYWdlXCI6e0VzY2Fw' +
	'ZUpzb24oY29uZGl0aW9uKX0sXCJzdGFja1RyYWNlXCI6e0VzY2FwZUpzb24oc3RhY2tUcmFjZSA/PyAiIil9LFwibG9nVHlwZVwi' +
	'Olwie2xvZ1R5cGV9XCIsXCJ0aW1lc3RhbXBcIjp7RGF0ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVNaWxsaXNlY29uZHMo' +
	'KX19fX19IjsKICAgICAgICBfb3V0Z29pbmdNZXNzYWdlcy5FbnF1ZXVlKGV2ZW50SnNvbik7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBPblBsYXlNb2RlQ2hhbmdlZChQbGF5TW9kZVN0YXRlQ2hhbmdlIHN0YXRlKQogICAgewogICAgICAgIGlmICgh' +
	'X2NsaWVudENvbm5lY3RlZCkgcmV0dXJuOwoKICAgICAgICB2YXIgcGxheVN0YXRlID0gc3RhdGUgc3dpdGNoCiAgICAgICAgewog' +
	'ICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkVudGVyZWRQbGF5TW9kZSA9PiAicGxheWluZyIsCiAgICAgICAgICAgIFBs' +
	'YXlNb2RlU3RhdGVDaGFuZ2UuRXhpdGluZ1BsYXlNb2RlID0+ICJzdG9wcGVkIiwKICAgICAgICAgICAgUGxheU1vZGVTdGF0ZUNo' +
	'YW5nZS5FbnRlcmVkRWRpdE1vZGUgPT4gInN0b3BwZWQiLAogICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkV4aXRpbmdF' +
	'ZGl0TW9kZSA9PiAicGxheWluZyIsCiAgICAgICAgICAgIF8gPT4gInN0b3BwZWQiCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGV2' +
	'ZW50SnNvbiA9ICQie3tcImlkXCI6XCJ7R3VpZC5OZXdHdWlkKCl9XCIsXCJ0eXBlXCI6XCJldmVudFwiLFwiZXZlbnRcIjpcInBs' +
	'YXlNb2RlQ2hhbmdlZFwiLFwiZGF0YVwiOnt7XCJzdGF0ZVwiOlwie3BsYXlTdGF0ZX1cIn19fX0iOwogICAgICAgIF9vdXRnb2lu' +
	'Z01lc3NhZ2VzLkVucXVldWUoZXZlbnRKc29uKTsKICAgIH0KCiAgICAvLyAtLS0gTWVzc2FnZSBQcm9jZXNzaW5nIChNYWluIFRo' +
	'cmVhZCkgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBQcm9jZXNzTWVzc2FnZXMoKQogICAgewogICAgICAgIC8vIFByb2Nl' +
	'c3MgdXAgdG8gMTAgbWVzc2FnZXMgcGVyIGZyYW1lIHRvIGF2b2lkIGJsb2NraW5nCiAgICAgICAgaW50IHByb2Nlc3NlZCA9IDA7' +
	'CiAgICAgICAgd2hpbGUgKF9pbmNvbWluZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZhciBtZXNzYWdlKSAmJiBwcm9jZXNzZWQg' +
	'PCAxMCkKICAgICAgICB7CiAgICAgICAgICAgIHByb2Nlc3NlZCsrOwogICAgICAgICAgICBzdHJpbmcgcmVxdWVzdElkID0gInVu' +
	'a25vd24iOwogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBQYXJzZVJl' +
	'cXVlc3QobWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXF1ZXN0SWQgPSByZXF1ZXN0LmlkOwogICAgICAgICAgICAgICAgdmFy' +
	'IHJlc3BvbnNlID0gSGFuZGxlQ29tbWFuZChyZXF1ZXN0KTsKICAgICAgICAgICAgICAgIF9vdXRnb2luZ01lc3NhZ2VzLkVucXVl' +
	'dWUocmVzcG9uc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgIHsK' +
	'ICAgICAgICAgICAgICAgIERlYnVnLkxvZ0Vycm9yKCQiW0dhbWVEZXZJREUgQnJpZGdlXSBFcnJvciBwcm9jZXNzaW5nIG1lc3Nh' +
	'Z2U6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICAgICAgX291dGdvaW5nTWVzc2FnZXMuRW5xdWV1ZShNYWtlRXJyb3IocmVx' +
	'dWVzdElkLCBleC5NZXNzYWdlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIDxzdW1tYXJ5PgogICAg' +
	'Ly8vIE1hbnVhbGx5IHBhcnNlIGEgSlNPTiByZXF1ZXN0IHNpbmNlIFVuaXR5J3MgSnNvblV0aWxpdHkgY2FuJ3QgaGFuZGxlCiAg' +
	'ICAvLy8gbmVzdGVkIGRpY3Rpb25hcmllcyBvciB0aGUgJ3BhcmFtcycgZmllbGQgcHJvcGVybHkuCiAgICAvLy8gPC9zdW1tYXJ5' +
	'PgogICAgcHJpdmF0ZSBzdGF0aWMgU2VyaWFsaXphYmxlUmVxdWVzdCBQYXJzZVJlcXVlc3Qoc3RyaW5nIGpzb24pCiAgICB7CiAg' +
	'ICAgICAgdmFyIHJlcSA9IG5ldyBTZXJpYWxpemFibGVSZXF1ZXN0KCk7CiAgICAgICAgcmVxLmlkID0gRXh0cmFjdEpzb25TdHJp' +
	'bmcoanNvbiwgImlkIikgPz8gR3VpZC5OZXdHdWlkKCkuVG9TdHJpbmcoKTsKICAgICAgICByZXEudHlwZSA9IEV4dHJhY3RKc29u' +
	'U3RyaW5nKGpzb24sICJ0eXBlIikgPz8gInJlcXVlc3QiOwogICAgICAgIHJlcS5jYXRlZ29yeSA9IEV4dHJhY3RKc29uU3RyaW5n' +
	'KGpzb24sICJjYXRlZ29yeSIpID8/ICIiOwogICAgICAgIHJlcS5hY3Rpb24gPSBFeHRyYWN0SnNvblN0cmluZyhqc29uLCAiYWN0' +
	'aW9uIikgPz8gIiI7CgogICAgICAgIC8vIEV4dHJhY3QgdGhlIHBhcmFtcyBvYmplY3QgYXMgYSByYXcgSlNPTiBzdWJzdHJpbmcK' +
	'ICAgICAgICB2YXIgcGFyYW1zSWR4ID0ganNvbi5JbmRleE9mKCJcInBhcmFtc1wiIik7CiAgICAgICAgaWYgKHBhcmFtc0lkeCA+' +
	'PSAwKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNvbG9uSWR4ID0ganNvbi5JbmRleE9mKCc6JywgcGFyYW1zSWR4KTsKICAg' +
	'ICAgICAgICAgaWYgKGNvbG9uSWR4ID49IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlcS5wYXJhbXNKc29uID0g' +
	'RXh0cmFjdEpzb25PYmplY3QoanNvbiwgY29sb25JZHggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0' +
	'dXJuIHJlcTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRXh0cmFjdEpzb25TdHJpbmcoc3RyaW5nIGpzb24sIHN0' +
	'cmluZyBrZXkpCiAgICB7CiAgICAgICAgdmFyIHBhdHRlcm4gPSAkIlwie2tleX1cIiI7CiAgICAgICAgdmFyIGlkeCA9IGpzb24u' +
	'SW5kZXhPZihwYXR0ZXJuKTsKICAgICAgICBpZiAoaWR4IDwgMCkgcmV0dXJuIG51bGw7CgogICAgICAgIHZhciBjb2xvbklkeCA9' +
	'IGpzb24uSW5kZXhPZignOicsIGlkeCArIHBhdHRlcm4uTGVuZ3RoKTsKICAgICAgICBpZiAoY29sb25JZHggPCAwKSByZXR1cm4g' +
	'bnVsbDsKCiAgICAgICAgLy8gU2tpcCB3aGl0ZXNwYWNlCiAgICAgICAgdmFyIHN0YXJ0SWR4ID0gY29sb25JZHggKyAxOwogICAg' +
	'ICAgIHdoaWxlIChzdGFydElkeCA8IGpzb24uTGVuZ3RoICYmIGNoYXIuSXNXaGl0ZVNwYWNlKGpzb25bc3RhcnRJZHhdKSkgc3Rh' +
	'cnRJZHgrKzsKCiAgICAgICAgaWYgKHN0YXJ0SWR4ID49IGpzb24uTGVuZ3RoIHx8IGpzb25bc3RhcnRJZHhdICE9ICciJykgcmV0' +
	'dXJuIG51bGw7CgogICAgICAgIC8vIFJlYWQgdW50aWwgY2xvc2luZyBxdW90ZSAoaGFuZGxpbmcgZXNjYXBlcykKICAgICAgICB2' +
	'YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGZvciAoaW50IGkgPSBzdGFydElkeCArIDE7IGkgPCBqc29uLkxl' +
	'bmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGpzb25baV0gPT0gJ1xcJyAmJiBpICsgMSA8IGpzb24uTGVuZ3Ro' +
	'KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzYi5BcHBlbmQoanNvbltpICsgMV0pOwogICAgICAgICAgICAgICAgaSsr' +
	'OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGpzb25baV0gPT0gJyInKQogICAgICAgICAgICB7CiAgICAgICAg' +
	'ICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'IHNiLkFwcGVuZChqc29uW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2IuVG9TdHJpbmcoKTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRXh0cmFjdEpzb25PYmplY3Qoc3RyaW5nIGpzb24sIGludCBzdGFydElk' +
	'eCkKICAgIHsKICAgICAgICAvLyBTa2lwIHdoaXRlc3BhY2UKICAgICAgICB3aGlsZSAoc3RhcnRJZHggPCBqc29uLkxlbmd0aCAm' +
	'JiBjaGFyLklzV2hpdGVTcGFjZShqc29uW3N0YXJ0SWR4XSkpIHN0YXJ0SWR4Kys7CiAgICAgICAgaWYgKHN0YXJ0SWR4ID49IGpz' +
	'b24uTGVuZ3RoIHx8IGpzb25bc3RhcnRJZHhdICE9ICd7JykgcmV0dXJuICJ7fSI7CgogICAgICAgIHZhciBkZXB0aCA9IDA7CiAg' +
	'ICAgICAgdmFyIGluU3RyaW5nID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0SWR4OyBpIDwganNvbi5MZW5ndGg7' +
	'IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChqc29uW2ldID09ICciJyAmJiAoaSA9PSAwIHx8IGpzb25baSAtIDFdICE9' +
	'ICdcXCcpKQogICAgICAgICAgICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7CiAgICAgICAgICAgIGVsc2UgaWYgKCFpblN0cmlu' +
	'ZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGpzb25baV0gPT0gJ3snKSBkZXB0aCsrOwogICAgICAgICAgICAg' +
	'ICAgZWxzZSBpZiAoanNvbltpXSA9PSAnfScpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTsK' +
	'ICAgICAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb24uU3Vi' +
	'c3RyaW5nKHN0YXJ0SWR4LCBpIC0gc3RhcnRJZHggKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg' +
	'IH0KICAgICAgICByZXR1cm4gInt9IjsKICAgIH0KCiAgICAvLyAtLS0gQ29tbWFuZCBEaXNwYXRjaCAtLS0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyBzdHJpbmcgSGFuZGxlQ29tbWFuZChTZXJpYWxpemFibGVSZXF1ZXN0IHJlcXVlc3QpCiAgICB7CiAgICAgICAgdmFy' +
	'IGtleSA9ICQie3JlcXVlc3QuY2F0ZWdvcnl9LntyZXF1ZXN0LmFjdGlvbn0iOwogICAgICAgIHZhciBwID0gcmVxdWVzdC5HZXRQ' +
	'YXJhbXMoKTsKCiAgICAgICAgc3dpdGNoIChrZXkpCiAgICAgICAgewogICAgICAgICAgICAvLyAtLS0gU2NlbmUgLS0tCiAgICAg' +
	'ICAgICAgIGNhc2UgInNjZW5lLmdldEFjdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlR2V0QWN0aXZlU2NlbmUo' +
	'cmVxdWVzdC5pZCk7CiAgICAgICAgICAgIGNhc2UgInNjZW5lLmdldEhpZXJhcmNoeSI6CiAgICAgICAgICAgICAgICByZXR1cm4g' +
	'SGFuZGxlR2V0SGllcmFyY2h5KHJlcXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJzY2VuZS5jcmVhdGUiOgogICAgICAgICAg' +
	'ICAgICAgcmV0dXJuIEhhbmRsZUNyZWF0ZVNjZW5lKHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJzY2VuZS5zYXZl' +
	'IjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTYXZlU2NlbmUocmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0g' +
	'R2FtZU9iamVjdCAtLS0KICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5jcmVhdGUiOgogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IEhhbmRsZUNyZWF0ZUdhbWVPYmplY3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuY3JlYXRl' +
	'UHJpbWl0aXZlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVDcmVhdGVQcmltaXRpdmUocmVxdWVzdC5pZCwgcCk7CiAg' +
	'ICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZmluZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlRmluZEdhbWVPYmpl' +
	'Y3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZGVzdHJveSI6CiAgICAgICAgICAgICAgICBy' +
	'ZXR1cm4gSGFuZGxlRGVzdHJveUdhbWVPYmplY3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3Qu' +
	'c2V0QWN0aXZlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRBY3RpdmUocmVxdWVzdC5pZCwgcCk7CiAgICAgICAg' +
	'ICAgIGNhc2UgImdhbWVPYmplY3Quc2V0VHJhbnNmb3JtIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRUcmFuc2Zv' +
	'cm0ocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZ2V0U2VsZWN0ZWQiOgogICAgICAgICAgICAg' +
	'ICAgcmV0dXJuIEhhbmRsZUdldFNlbGVjdGVkKHJlcXVlc3QuaWQpOwoKICAgICAgICAgICAgLy8gLS0tIENvbXBvbmVudCAtLS0K' +
	'ICAgICAgICAgICAgY2FzZSAiY29tcG9uZW50LmFkZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQWRkQ29tcG9uZW50' +
	'KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJjb21wb25lbnQucmVtb3ZlIjoKICAgICAgICAgICAgICAgIHJldHVy' +
	'biBIYW5kbGVSZW1vdmVDb21wb25lbnQocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImNvbXBvbmVudC5nZXRBbGwi' +
	'OgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldENvbXBvbmVudHMocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNh' +
	'c2UgImNvbXBvbmVudC5zZXRQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlU2V0UHJvcGVydHkocmVxdWVz' +
	'dC5pZCwgcCk7CgogICAgICAgICAgICAvLyAtLS0gUHJlZmFiIC0tLQogICAgICAgICAgICBjYXNlICJwcmVmYWIuY3JlYXRlIjoK' +
	'ICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVDcmVhdGVQcmVmYWIocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2Ug' +
	'InByZWZhYi5pbnN0YW50aWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlSW5zdGFudGlhdGVQcmVmYWIocmVxdWVz' +
	'dC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgInByZWZhYi5nZXRBbGwiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdl' +
	'dEFsbFByZWZhYnMocmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0gQXNzZXQgLS0tCiAgICAgICAgICAgIGNhc2UgImFz' +
	'c2V0LmNyZWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlQXNzZXQocmVxdWVzdC5pZCwgcCk7CiAgICAg' +
	'ICAgICAgIGNhc2UgImFzc2V0LmZpbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUZpbmRBc3NldHMocmVxdWVzdC5p' +
	'ZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImFzc2V0LmltcG9ydCI6CiAgICAgICAgICAgICAgICBBc3NldERhdGFiYXNlLlJlZnJl' +
	'c2goKTsKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAie30iKTsKCiAgICAgICAgICAgIC8v' +
	'IC0tLSBQcm9qZWN0IC0tLQogICAgICAgICAgICBjYXNlICJwcm9qZWN0LmdldEluZm8iOgogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IEhhbmRsZUdldFByb2plY3RJbmZvKHJlcXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJwcm9qZWN0LnJlZnJlc2giOgogICAg' +
	'ICAgICAgICAgICAgQXNzZXREYXRhYmFzZS5SZWZyZXNoKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVx' +
	'dWVzdC5pZCwgInt9Iik7CgogICAgICAgICAgICAvLyAtLS0gRWRpdG9yIC0tLQogICAgICAgICAgICBjYXNlICJlZGl0b3IuZ2V0' +
	'UGxheU1vZGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldFBsYXlNb2RlKHJlcXVlc3QuaWQpOwogICAgICAgICAg' +
	'ICBjYXNlICJlZGl0b3IucGxheSI6CiAgICAgICAgICAgICAgICBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcgPSB0cnVlOwog' +
	'ICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7XCJzdGF0ZVwiOlwicGxheWluZ1wifSIpOwog' +
	'ICAgICAgICAgICBjYXNlICJlZGl0b3IucGF1c2UiOgogICAgICAgICAgICAgICAgRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQg' +
	'PSAhRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVxdWVzdC5p' +
	'ZCwgJCJ7e1wicGF1c2VkXCI6e0VkaXRvckFwcGxpY2F0aW9uLmlzUGF1c2VkLlRvU3RyaW5nKCkuVG9Mb3dlcigpfX19Iik7CiAg' +
	'ICAgICAgICAgIGNhc2UgImVkaXRvci5zdG9wIjoKICAgICAgICAgICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLmlzUGxheWluZyA9' +
	'IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7XCJzdGF0ZVwiOlwic3RvcHBl' +
	'ZFwifSIpOwogICAgICAgICAgICBjYXNlICJlZGl0b3IuZXhlY3V0ZU1lbnVJdGVtIjoKICAgICAgICAgICAgICAgIHJldHVybiBI' +
	'YW5kbGVFeGVjdXRlTWVudUl0ZW0ocmVxdWVzdC5pZCwgcCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg' +
	'cmV0dXJuIE1ha2VFcnJvcihyZXF1ZXN0LmlkLCAkIlVua25vd24gY29tbWFuZDoge2tleX0iKTsKICAgICAgICB9CiAgICB9Cgog' +
	'ICAgLy8gLS0tIFNjZW5lIEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRBY3RpdmVTY2Vu' +
	'ZShzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5lKCk7CiAgICAg' +
	'ICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oc2NlbmUubmFtZSl9LFwicGF0aFwiOntF' +
	'c2NhcGVKc29uKHNjZW5lLnBhdGgpfSxcInJvb3RDb3VudFwiOntzY2VuZS5yb290Q291bnR9LFwiaXNEaXJ0eVwiOntzY2VuZS5p' +
	'c0RpcnR5LlRvU3RyaW5nKCkuVG9Mb3dlcigpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdl' +
	'dEhpZXJhcmNoeShzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5l' +
	'KCk7CiAgICAgICAgdmFyIHJvb3RzID0gc2NlbmUuR2V0Um9vdEdhbWVPYmplY3RzKCk7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0' +
	'cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcInNjZW5lXCI6Iik7CiAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpz' +
	'b24oc2NlbmUubmFtZSkpOwogICAgICAgIHNiLkFwcGVuZCgiLFwiaGllcmFyY2h5XCI6WyIpOwogICAgICAgIGZvciAoaW50IGkg' +
	'PSAwOyBpIDwgcm9vdHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIp' +
	'OwogICAgICAgICAgICBCdWlsZEhpZXJhcmNoeUpzb24ocm9vdHNbaV0sIHNiKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5k' +
	'KCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBCdWlsZEhpZXJhcmNoeUpzb24oR2FtZU9iamVjdCBnbywgU3RyaW5nQnVpbGRlciBzYikKICAgIHsKICAgICAg' +
	'ICBzYi5BcHBlbmQoIntcIm5hbWVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihnby5uYW1lKSk7CiAgICAgICAg' +
	'c2IuQXBwZW5kKCIsXCJhY3RpdmVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoZ28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93' +
	'ZXIoKSk7CiAgICAgICAgc2IuQXBwZW5kKCIsXCJjb21wb25lbnRzXCI6WyIpOwogICAgICAgIHZhciBjb21wb25lbnRzID0gZ28u' +
	'R2V0Q29tcG9uZW50czxDb21wb25lbnQ+KCk7CiAgICAgICAgZm9yIChpbnQgYyA9IDA7IGMgPCBjb21wb25lbnRzLkxlbmd0aDsg' +
	'YysrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGNvbXBvbmVudHNbY10gPT0gbnVsbCkgY29udGludWU7CiAgICAgICAgICAg' +
	'IGlmIChjID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKGNvbXBvbmVudHNbY10u' +
	'R2V0VHlwZSgpLk5hbWUpKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCJdLFwiY2hpbGRyZW5cIjpbIik7CiAgICAgICAg' +
	'Zm9yIChpbnQgaSA9IDA7IGkgPCBnby50cmFuc2Zvcm0uY2hpbGRDb3VudDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYg' +
	'KGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgQnVpbGRIaWVyYXJjaHlKc29uKGdvLnRyYW5zZm9ybS5HZXRDaGls' +
	'ZChpKS5nYW1lT2JqZWN0LCBzYik7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgiXX0iKTsKICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRlU2NlbmUoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQog' +
	'ICAgewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgibmFtZSIsICJOZXcgU2NlbmUiKTsKICAgICAgICB2' +
	'YXIgc2NlbmUgPSBFZGl0b3JTY2VuZU1hbmFnZXIuTmV3U2NlbmUoTmV3U2NlbmVTZXR1cC5EZWZhdWx0R2FtZU9iamVjdHMsIE5l' +
	'd1NjZW5lTW9kZS5TaW5nbGUpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJwYXRoIiwgb3V0IHZhciBwYXRoKSkKICAgICAg' +
	'ICB7CiAgICAgICAgICAgIEVkaXRvclNjZW5lTWFuYWdlci5TYXZlU2NlbmUoc2NlbmUsIHBhdGgpOwogICAgICAgIH0KICAgICAg' +
	'ICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0Vz' +
	'Y2FwZUpzb24oc2NlbmUucGF0aCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlU2F2ZVNjZW5l' +
	'KHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2YXIgc2NlbmUgPSBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKTsKICAgICAg' +
	'ICBFZGl0b3JTY2VuZU1hbmFnZXIuU2F2ZVNjZW5lKHNjZW5lKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tc' +
	'Im5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0VzY2FwZUpzb24oc2NlbmUucGF0aCl9fX0iKTsKICAg' +
	'IH0KCiAgICAvLyAtLS0gR2FtZU9iamVjdCBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3Jl' +
	'YXRlR2FtZU9iamVjdChzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5h' +
	'bWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJuYW1lIiwgIkdhbWVPYmplY3QiKTsKCiAgICAgICAgLy8gUmVzb2x2ZSBwYXJlbnQg' +
	'Zmlyc3Qgc28gd2UgY2FuIGRlY2lkZSB3aGV0aGVyIGEgUmVjdFRyYW5zZm9ybSBpcyBuZWVkZWQKICAgICAgICBHYW1lT2JqZWN0' +
	'IHBhcmVudEdvID0gbnVsbDsKICAgICAgICBpZiAocC5UcnlHZXRWYWx1ZSgicGFyZW50UGF0aCIsIG91dCB2YXIgcGFyZW50UGF0' +
	'aCkgJiYgIXN0cmluZy5Jc051bGxPckVtcHR5KHBhcmVudFBhdGgpKQogICAgICAgICAgICBwYXJlbnRHbyA9IEZpbmRHYW1lT2Jq' +
	'ZWN0QnlQYXRoKHBhcmVudFBhdGgpOwoKICAgICAgICAvLyBJZiB0aGUgcGFyZW50IGxpdmVzIGluc2lkZSBhIENhbnZhcyBoaWVy' +
	'YXJjaHkgdGhlIG5ldyBvYmplY3QgbXVzdCB1c2UgUmVjdFRyYW5zZm9ybQogICAgICAgIC8vIHNvIHRoYXQgVW5pdHkncyBVSSBs' +
	'YXlvdXQgc3lzdGVtIGNhbiBwb3NpdGlvbiBpdCBjb3JyZWN0bHkuCiAgICAgICAgYm9vbCBuZWVkc1JlY3QgPSBwYXJlbnRHbyAh' +
	'PSBudWxsICYmIElzSW5DYW52YXNIaWVyYXJjaHkocGFyZW50R28udHJhbnNmb3JtKTsKICAgICAgICB2YXIgZ28gPSBuZWVkc1Jl' +
	'Y3QgPyBuZXcgR2FtZU9iamVjdChuYW1lLCB0eXBlb2YoUmVjdFRyYW5zZm9ybSkpIDogbmV3IEdhbWVPYmplY3QobmFtZSk7Cgog' +
	'ICAgICAgIGlmIChwYXJlbnRHbyAhPSBudWxsKQogICAgICAgICAgICBnby50cmFuc2Zvcm0uU2V0UGFyZW50KHBhcmVudEdvLnRy' +
	'YW5zZm9ybSwgZmFsc2UpOwoKICAgICAgICBVbmRvLlJlZ2lzdGVyQ3JlYXRlZE9iamVjdFVuZG8oZ28sICQiQ3JlYXRlIHtuYW1l' +
	'fSIpOwogICAgICAgIFNlbGVjdGlvbi5hY3RpdmVHYW1lT2JqZWN0ID0gZ287CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlk' +
	'LCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwiaW5zdGFuY2VJZFwiOntnby5HZXRJbnN0YW5jZUlEKCl9fX0i' +
	'KTsKICAgIH0KCiAgICAvLy8gPHN1bW1hcnk+UmV0dXJucyB0cnVlIGlmIDxwYXJhbXJlZiBuYW1lPSJ0Ii8+IGlzIHRoZSBDYW52' +
	'YXMgaXRzZWxmIG9yIGFueSBvZiBpdHMgZGVzY2VuZGFudHMuPC9zdW1tYXJ5PgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBJc0lu' +
	'Q2FudmFzSGllcmFyY2h5KFRyYW5zZm9ybSB0KQogICAgewogICAgICAgIHdoaWxlICh0ICE9IG51bGwpCiAgICAgICAgewogICAg' +
	'ICAgICAgICBpZiAodC5HZXRDb21wb25lbnQ8Q2FudmFzPigpICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK' +
	'ICAgICAgICAgICAgdCA9IHQucGFyZW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0ZVByaW1pdGl2ZShzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+' +
	'IHApCiAgICB7CiAgICAgICAgdmFyIG5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJuYW1lIiwgIlByaW1pdGl2ZSIpOwogICAg' +
	'ICAgIHZhciB0eXBlU3RyID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgicHJpbWl0aXZlVHlwZSIsICJDdWJlIik7CgogICAgICAgIGlm' +
	'ICghRW51bS5UcnlQYXJzZTxQcmltaXRpdmVUeXBlPih0eXBlU3RyLCB0cnVlLCBvdXQgdmFyIHByaW1pdGl2ZVR5cGUpKQogICAg' +
	'ICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIlVua25vd24gcHJpbWl0aXZlIHR5cGU6IHt0eXBlU3RyfS4gVmFsaWQ6IFNw' +
	'aGVyZSwgQ2Fwc3VsZSwgQ3lsaW5kZXIsIEN1YmUsIFBsYW5lLCBRdWFkIik7CgogICAgICAgIHZhciBnbyA9IEdhbWVPYmplY3Qu' +
	'Q3JlYXRlUHJpbWl0aXZlKHByaW1pdGl2ZVR5cGUpOwogICAgICAgIGdvLm5hbWUgPSBuYW1lOwoKICAgICAgICBpZiAocC5UcnlH' +
	'ZXRWYWx1ZSgicGFyZW50UGF0aCIsIG91dCB2YXIgcGFyZW50UGF0aCkgJiYgIXN0cmluZy5Jc051bGxPckVtcHR5KHBhcmVudFBh' +
	'dGgpKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHBhcmVudCA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKHBhcmVudFBhdGgpOwog' +
	'ICAgICAgICAgICBpZiAocGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICBnby50cmFuc2Zvcm0uU2V0UGFyZW50KHBhcmVu' +
	'dC50cmFuc2Zvcm0sIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIFVuZG8uUmVnaXN0ZXJDcmVhdGVkT2JqZWN0VW5kbyhnbywg' +
	'JCJDcmVhdGUge25hbWV9Iik7CiAgICAgICAgU2VsZWN0aW9uLmFjdGl2ZUdhbWVPYmplY3QgPSBnbzsKICAgICAgICByZXR1cm4g' +
	'TWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJpbnN0YW5jZUlkXCI6e2dvLkdldElu' +
	'c3RhbmNlSUQoKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVGaW5kR2FtZU9iamVjdChzdHJp' +
	'bmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5hbWUgPSBwLkdldFZhbHVlT3JE' +
	'ZWZhdWx0KCJuYW1lIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKG5hbWUpOwogICAgICAgIGlm' +
	'IChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7bmFt' +
	'ZX0iKTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwi' +
	'aW5zdGFuY2VJZFwiOntnby5HZXRJbnN0YW5jZUlEKCl9LFwiYWN0aXZlXCI6e2dvLmFjdGl2ZVNlbGYuVG9TdHJpbmcoKS5Ub0xv' +
	'd2VyKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlRGVzdHJveUdhbWVPYmplY3Qoc3RyaW5n' +
	'IGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVm' +
	'YXVsdCgiZ2FtZU9iamVjdFBhdGgiLCBwLkdldFZhbHVlT3JEZWZhdWx0KCJuYW1lIiwgIiIpKTsKICAgICAgICB2YXIgZ28gPSBG' +
	'aW5kR2FtZU9iamVjdEJ5UGF0aChuYW1lKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VF' +
	'cnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge25hbWV9Iik7CgogICAgICAgIFVuZG8uRGVzdHJveU9iamVjdEltbWVk' +
	'aWF0ZShnbyk7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAie30iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBz' +
	'dHJpbmcgSGFuZGxlU2V0QWN0aXZlKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAg' +
	'ICB2YXIgcGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZp' +
	'bmRHYW1lT2JqZWN0QnlQYXRoKHBhdGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVy' +
	'cm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7cGF0aH0iKTsKCiAgICAgICAgdmFyIGFjdGl2ZSA9IHAuR2V0VmFsdWVP' +
	'ckRlZmF1bHQoImFjdGl2ZSIsICJ0cnVlIikgPT0gInRydWUiOwogICAgICAgIFVuZG8uUmVjb3JkT2JqZWN0KGdvLCAkIlNldCBB' +
	'Y3RpdmUge2dvLm5hbWV9Iik7CiAgICAgICAgZ28uU2V0QWN0aXZlKGFjdGl2ZSk7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNz' +
	'KGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwiYWN0aXZlXCI6e2dvLmFjdGl2ZVNlbGYuVG9TdHJpbmco' +
	'KS5Ub0xvd2VyKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlU2V0VHJhbnNmb3JtKHN0cmlu' +
	'ZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcGF0aCA9IHAuR2V0VmFsdWVPckRl' +
	'ZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKHBhdGgpOwog' +
	'ICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZv' +
	'dW5kOiB7cGF0aH0iKTsKCiAgICAgICAgVW5kby5SZWNvcmRPYmplY3QoZ28udHJhbnNmb3JtLCAkIlRyYW5zZm9ybSB7Z28ubmFt' +
	'ZX0iKTsKCiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInBvc2l0aW9uIiwgb3V0IHZhciBwb3NTdHIpKQogICAgICAgICAgICBn' +
	'by50cmFuc2Zvcm0ucG9zaXRpb24gPSBQYXJzZVZlY3RvcjMocG9zU3RyKTsKICAgICAgICBpZiAocC5UcnlHZXRWYWx1ZSgicm90' +
	'YXRpb24iLCBvdXQgdmFyIHJvdFN0cikpCiAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5ldWxlckFuZ2xlcyA9IFBhcnNlVmVjdG9y' +
	'Myhyb3RTdHIpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJzY2FsZSIsIG91dCB2YXIgc2NhbGVTdHIpKQogICAgICAgICAg' +
	'ICBnby50cmFuc2Zvcm0ubG9jYWxTY2FsZSA9IFBhcnNlVmVjdG9yMyhzY2FsZVN0cik7CgogICAgICAgIHJldHVybiBNYWtlU3Vj' +
	'Y2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcInBvc2l0aW9uXCI6XCJ7Z28udHJhbnNmb3JtLnBv' +
	'c2l0aW9ufVwiLFwicm90YXRpb25cIjpcIntnby50cmFuc2Zvcm0uZXVsZXJBbmdsZXN9XCIsXCJzY2FsZVwiOlwie2dvLnRyYW5z' +
	'Zm9ybS5sb2NhbFNjYWxlfVwifX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0U2VsZWN0ZWQo' +
	'c3RyaW5nIGlkKQogICAgewogICAgICAgIHZhciBzZWxlY3RlZCA9IFNlbGVjdGlvbi5nYW1lT2JqZWN0czsKICAgICAgICB2YXIg' +
	'c2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFwcGVuZCgie1wic2VsZWN0ZWRcIjpbIik7CiAgICAgICAgZm9y' +
	'IChpbnQgaSA9IDA7IGkgPCBzZWxlY3RlZC5MZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChpID4gMCkgc2Iu' +
	'QXBwZW5kKCIsIik7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKHNlbGVjdGVkW2ldLm5hbWUpKTsKICAgICAgICB9' +
	'CiAgICAgICAgc2IuQXBwZW5kKCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAg' +
	'ICB9CgogICAgLy8gLS0tIENvbXBvbmVudCBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQWRk' +
	'Q29tcG9uZW50KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcGF0aCA9' +
	'IHAuR2V0VmFsdWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0' +
	'QnlQYXRoKHBhdGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdh' +
	'bWVPYmplY3Qgbm90IGZvdW5kOiB7cGF0aH0iKTsKCiAgICAgICAgdmFyIHR5cGVOYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgi' +
	'Y29tcG9uZW50VHlwZSIsICIiKTsKICAgICAgICB2YXIgdHlwZSA9IEZpbmRDb21wb25lbnRUeXBlKHR5cGVOYW1lKTsKICAgICAg' +
	'ICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkNvbXBvbmVudCB0eXBlIG5vdCBm' +
	'b3VuZDoge3R5cGVOYW1lfSIpOwoKICAgICAgICBVbmRvLkFkZENvbXBvbmVudChnbywgdHlwZSk7CiAgICAgICAgcmV0dXJuIE1h' +
	'a2VTdWNjZXNzKGlkLCAkInt7XCJnYW1lT2JqZWN0XCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwiY29tcG9uZW50XCI6e0VzY2Fw' +
	'ZUpzb24odHlwZS5OYW1lKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVSZW1vdmVDb21wb25l' +
	'bnQoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRW' +
	'YWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgo' +
	'cGF0aCk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVj' +
	'dCBub3QgZm91bmQ6IHtwYXRofSIpOwoKICAgICAgICB2YXIgdHlwZU5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJjb21wb25l' +
	'bnRUeXBlIiwgIiIpOwogICAgICAgIHZhciBjb21wID0gZ28uR2V0Q29tcG9uZW50KHR5cGVOYW1lKTsKICAgICAgICBpZiAoY29t' +
	'cCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkNvbXBvbmVudCBub3QgZm91bmQ6IHt0eXBlTmFt' +
	'ZX0gb24ge2dvLm5hbWV9Iik7CgogICAgICAgIFVuZG8uRGVzdHJveU9iamVjdEltbWVkaWF0ZShjb21wKTsKICAgICAgICByZXR1' +
	'cm4gTWFrZVN1Y2Nlc3MoaWQsICJ7fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRDb21wb25l' +
	'bnRzKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcGF0aCA9IHAuR2V0' +
	'VmFsdWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRo' +
	'KHBhdGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmpl' +
	'Y3Qgbm90IGZvdW5kOiB7cGF0aH0iKTsKCiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBnby5HZXRDb21wb25lbnRzPENvbXBvbmVu' +
	'dD4oKTsKICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFwcGVuZCgie1wiY29tcG9uZW50' +
	'c1wiOlsiKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbXBvbmVudHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAg' +
	'ICAgICAgICBpZiAoY29tcG9uZW50c1tpXSA9PSBudWxsKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBl' +
	'bmQoIiwiKTsKICAgICAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24oY29tcG9uZW50c1tpXS5HZXRUeXBlKCkuTmFtZSkpOwog' +
	'ICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmlu' +
	'ZygpKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlU2V0UHJvcGVydHkoc3RyaW5nIGlkLCBEaWN0aW9u' +
	'YXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9i' +
	'amVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAgICAgICAgaWYgKGdv' +
	'ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRofSIp' +
	'OwoKICAgICAgICB2YXIgdHlwZU5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJjb21wb25lbnRUeXBlIiwgIiIpOwogICAgICAg' +
	'IHZhciBjb21wID0gZ28uR2V0Q29tcG9uZW50KHR5cGVOYW1lKTsKICAgICAgICBpZiAoY29tcCA9PSBudWxsKQogICAgICAgICAg' +
	'ICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkNvbXBvbmVudCBub3QgZm91bmQ6IHt0eXBlTmFtZX0gb24ge2dvLm5hbWV9Iik7Cgog' +
	'ICAgICAgIHZhciBwcm9wTmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoInByb3BlcnR5TmFtZSIsICIiKTsKICAgICAgICB2YXIg' +
	'dmFsdWVTdHIgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJ2YWx1ZSIsICIiKTsKCiAgICAgICAgVW5kby5SZWNvcmRPYmplY3QoY29t' +
	'cCwgJCJTZXQge3Byb3BOYW1lfSBvbiB7Z28ubmFtZX0iKTsKCiAgICAgICAgLy8gVHJ5IHNldHRpbmcgdmlhIFNlcmlhbGl6ZWRP' +
	'YmplY3QgZm9yIHByb3BlciB1bmRvIHN1cHBvcnQKICAgICAgICB2YXIgc28gPSBuZXcgU2VyaWFsaXplZE9iamVjdChjb21wKTsK' +
	'ICAgICAgICB2YXIgcHJvcCA9IHNvLkZpbmRQcm9wZXJ0eShwcm9wTmFtZSk7CiAgICAgICAgaWYgKHByb3AgIT0gbnVsbCkKICAg' +
	'ICAgICB7CiAgICAgICAgICAgIFNldFNlcmlhbGl6ZWRQcm9wZXJ0eVZhbHVlKHByb3AsIHZhbHVlU3RyKTsKICAgICAgICAgICAg' +
	'c28uQXBwbHlNb2RpZmllZFByb3BlcnRpZXMoKTsKICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJwcm9w' +
	'ZXJ0eVwiOntFc2NhcGVKc29uKHByb3BOYW1lKX0sXCJzZXRcIjp0cnVlfX0iKTsKICAgICAgICB9CgogICAgICAgIC8vIEZhbGxi' +
	'YWNrOiByZWZsZWN0aW9uIHdpdGggc21hcnQgdHlwZSBjb252ZXJzaW9uCiAgICAgICAgdmFyIGZpZWxkID0gY29tcC5HZXRUeXBl' +
	'KCkuR2V0RmllbGQocHJvcE5hbWUsIEJpbmRpbmdGbGFncy5QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuTm9uUHVibGljIHwgQmluZGlu' +
	'Z0ZsYWdzLkluc3RhbmNlKTsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBjb252' +
	'ZXJ0ZWQgPSBTbWFydENvbnZlcnQodmFsdWVTdHIsIGZpZWxkLkZpZWxkVHlwZSk7CiAgICAgICAgICAgIGZpZWxkLlNldFZhbHVl' +
	'KGNvbXAsIGNvbnZlcnRlZCk7CiAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wicHJvcGVydHlcIjp7RXNj' +
	'YXBlSnNvbihwcm9wTmFtZSl9LFwic2V0XCI6dHJ1ZX19Iik7CiAgICAgICAgfQoKICAgICAgICB2YXIgcHJvcGVydHkgPSBjb21w' +
	'LkdldFR5cGUoKS5HZXRQcm9wZXJ0eShwcm9wTmFtZSwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5JbnN0YW5j' +
	'ZSk7CiAgICAgICAgaWYgKHByb3BlcnR5ICE9IG51bGwgJiYgcHJvcGVydHkuQ2FuV3JpdGUpCiAgICAgICAgewogICAgICAgICAg' +
	'ICB2YXIgY29udmVydGVkID0gU21hcnRDb252ZXJ0KHZhbHVlU3RyLCBwcm9wZXJ0eS5Qcm9wZXJ0eVR5cGUpOwogICAgICAgICAg' +
	'ICBwcm9wZXJ0eS5TZXRWYWx1ZShjb21wLCBjb252ZXJ0ZWQpOwogICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQi' +
	'e3tcInByb3BlcnR5XCI6e0VzY2FwZUpzb24ocHJvcE5hbWUpfSxcInNldFwiOnRydWV9fSIpOwogICAgICAgIH0KCiAgICAgICAg' +
	'cmV0dXJuIE1ha2VFcnJvcihpZCwgJCJQcm9wZXJ0eSBub3QgZm91bmQ6IHtwcm9wTmFtZX0gb24ge3R5cGVOYW1lfSIpOwogICAg' +
	'fQoKICAgIC8vIC0tLSBQcmVmYWIgSGFuZGxlcnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0ZVBy' +
	'ZWZhYihzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIGdvUGF0aCA9IHAu' +
	'R2V0VmFsdWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQ' +
	'YXRoKGdvUGF0aCk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2Ft' +
	'ZU9iamVjdCBub3QgZm91bmQ6IHtnb1BhdGh9Iik7CgogICAgICAgIHZhciBhc3NldFBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0' +
	'KCJhc3NldFBhdGgiLCAkIkFzc2V0cy9QcmVmYWJzL3tnby5uYW1lfS5wcmVmYWIiKTsKCiAgICAgICAgLy8gRW5zdXJlIGRpcmVj' +
	'dG9yeSBleGlzdHMKICAgICAgICB2YXIgZGlyID0gUGF0aC5HZXREaXJlY3RvcnlOYW1lKGFzc2V0UGF0aCk7CiAgICAgICAgaWYg' +
	'KCFzdHJpbmcuSXNOdWxsT3JFbXB0eShkaXIpICYmICFBc3NldERhdGFiYXNlLklzVmFsaWRGb2xkZXIoZGlyKSkKICAgICAgICB7' +
	'CiAgICAgICAgICAgIENyZWF0ZUZvbGRlclJlY3Vyc2l2ZShkaXIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHByZWZhYiA9IFBy' +
	'ZWZhYlV0aWxpdHkuU2F2ZUFzUHJlZmFiQXNzZXQoZ28sIGFzc2V0UGF0aCk7CiAgICAgICAgaWYgKHByZWZhYiA9PSBudWxsKQog' +
	'ICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkZhaWxlZCB0byBjcmVhdGUgcHJlZmFiIGF0IHthc3NldFBhdGh9Iik7' +
	'CgogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wicGF0aFwiOntFc2NhcGVKc29uKGFzc2V0UGF0aCl9LFwibmFt' +
	'ZVwiOntFc2NhcGVKc29uKHByZWZhYi5uYW1lKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVJ' +
	'bnN0YW50aWF0ZVByZWZhYihzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFy' +
	'IHByZWZhYlBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJwcmVmYWJQYXRoIiwgIiIpOwogICAgICAgIHZhciBwcmVmYWIgPSBB' +
	'c3NldERhdGFiYXNlLkxvYWRBc3NldEF0UGF0aDxHYW1lT2JqZWN0PihwcmVmYWJQYXRoKTsKICAgICAgICBpZiAocHJlZmFiID09' +
	'IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiUHJlZmFiIG5vdCBmb3VuZCBhdDoge3ByZWZhYlBhdGh9' +
	'Iik7CgogICAgICAgIHZhciBpbnN0YW5jZSA9IChHYW1lT2JqZWN0KVByZWZhYlV0aWxpdHkuSW5zdGFudGlhdGVQcmVmYWIocHJl' +
	'ZmFiKTsKICAgICAgICBVbmRvLlJlZ2lzdGVyQ3JlYXRlZE9iamVjdFVuZG8oaW5zdGFuY2UsICQiSW5zdGFudGlhdGUge3ByZWZh' +
	'Yi5uYW1lfSIpOwogICAgICAgIFNlbGVjdGlvbi5hY3RpdmVHYW1lT2JqZWN0ID0gaW5zdGFuY2U7CgogICAgICAgIHJldHVybiBN' +
	'YWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGluc3RhbmNlLm5hbWUpfSxcImluc3RhbmNlSWRcIjp7aW5z' +
	'dGFuY2UuR2V0SW5zdGFuY2VJRCgpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldEFsbFBy' +
	'ZWZhYnMoc3RyaW5nIGlkKQogICAgewogICAgICAgIHZhciBndWlkcyA9IEFzc2V0RGF0YWJhc2UuRmluZEFzc2V0cygidDpQcmVm' +
	'YWIiKTsKICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFwcGVuZCgie1wicHJlZmFic1wi' +
	'OlsiKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGd1aWRzLkxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAg' +
	'aWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgdmFyIHBhdGggPSBBc3NldERhdGFiYXNlLkdVSURUb0Fzc2V0' +
	'UGF0aChndWlkc1tpXSk7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKHBhdGgpKTsKICAgICAgICB9CiAgICAgICAg' +
	'c2IuQXBwZW5kKCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAg' +
	'Ly8gLS0tIEFzc2V0IEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVDcmVhdGVBc3NldChzdHJp' +
	'bmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIGFzc2V0VHlwZSA9IHAuR2V0VmFs' +
	'dWVPckRlZmF1bHQoImFzc2V0VHlwZSIsICJNYXRlcmlhbCIpOwogICAgICAgIHZhciBhc3NldFBhdGggPSBwLkdldFZhbHVlT3JE' +
	'ZWZhdWx0KCJwYXRoIiwgIiIpOwoKICAgICAgICBpZiAoc3RyaW5nLklzTnVsbE9yRW1wdHkoYXNzZXRQYXRoKSkKICAgICAgICAg' +
	'ICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgInBhdGggaXMgcmVxdWlyZWQiKTsKCiAgICAgICAgLy8gRW5zdXJlIGRpcmVjdG9yeSBl' +
	'eGlzdHMKICAgICAgICB2YXIgZGlyID0gUGF0aC5HZXREaXJlY3RvcnlOYW1lKGFzc2V0UGF0aCk7CiAgICAgICAgaWYgKCFzdHJp' +
	'bmcuSXNOdWxsT3JFbXB0eShkaXIpICYmICFBc3NldERhdGFiYXNlLklzVmFsaWRGb2xkZXIoZGlyKSkKICAgICAgICB7CiAgICAg' +
	'ICAgICAgIENyZWF0ZUZvbGRlclJlY3Vyc2l2ZShkaXIpOwogICAgICAgIH0KCiAgICAgICAgVW5pdHlFbmdpbmUuT2JqZWN0IGFz' +
	'c2V0ID0gbnVsbDsKICAgICAgICBzd2l0Y2ggKGFzc2V0VHlwZS5Ub0xvd2VyKCkpCiAgICAgICAgewogICAgICAgICAgICBjYXNl' +
	'ICJtYXRlcmlhbCI6CiAgICAgICAgICAgICAgICB2YXIgc2hhZGVyID0gU2hhZGVyLkZpbmQocC5HZXRWYWx1ZU9yRGVmYXVsdCgi' +
	'c2hhZGVyIiwgIlN0YW5kYXJkIikpOwogICAgICAgICAgICAgICAgYXNzZXQgPSBuZXcgTWF0ZXJpYWwoc2hhZGVyKTsKICAgICAg' +
	'ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwaHlzaWNtYXRlcmlhbCI6CiAgICAgICAgICAgICAgICBhc3NldCA9' +
	'IG5ldyBQaHlzaWNNYXRlcmlhbCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg' +
	'ICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIlVuc3VwcG9ydGVkIGFzc2V0IHR5cGU6IHthc3NldFR5cGV9LiBTdXBwb3J0' +
	'ZWQ6IE1hdGVyaWFsLCBQaHlzaWNNYXRlcmlhbCIpOwogICAgICAgIH0KCiAgICAgICAgQXNzZXREYXRhYmFzZS5DcmVhdGVBc3Nl' +
	'dChhc3NldCwgYXNzZXRQYXRoKTsKICAgICAgICBBc3NldERhdGFiYXNlLlJlZnJlc2goKTsKCiAgICAgICAgcmV0dXJuIE1ha2VT' +
	'dWNjZXNzKGlkLCAkInt7XCJwYXRoXCI6e0VzY2FwZUpzb24oYXNzZXRQYXRoKX0sXCJ0eXBlXCI6e0VzY2FwZUpzb24oYXNzZXRU' +
	'eXBlKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVGaW5kQXNzZXRzKHN0cmluZyBpZCwgRGlj' +
	'dGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgZmlsdGVyID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgi' +
	'ZmlsdGVyIiwgIiIpOwogICAgICAgIHZhciBndWlkcyA9IEFzc2V0RGF0YWJhc2UuRmluZEFzc2V0cyhmaWx0ZXIpOwogICAgICAg' +
	'IHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJhc3NldHNcIjpbIik7CiAgICAgICAg' +
	'dmFyIGNvdW50ID0gTWF0aC5NaW4oZ3VpZHMuTGVuZ3RoLCA1MCk7IC8vIENhcCBhdCA1MAogICAgICAgIGZvciAoaW50IGkgPSAw' +
	'OyBpIDwgY291bnQ7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChpID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAg' +
	'ICAgIHZhciBwYXRoID0gQXNzZXREYXRhYmFzZS5HVUlEVG9Bc3NldFBhdGgoZ3VpZHNbaV0pOwogICAgICAgICAgICBzYi5BcHBl' +
	'bmQoRXNjYXBlSnNvbihwYXRoKSk7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgkIl0sXCJ0b3RhbFwiOntndWlkcy5MZW5n' +
	'dGh9fX0iKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsIHNiLlRvU3RyaW5nKCkpOwogICAgfQoKICAgIC8vIC0tLSBQ' +
	'cm9qZWN0IC8gRWRpdG9yIEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRQcm9qZWN0SW5m' +
	'byhzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24o' +
	'QXBwbGljYXRpb24ucHJvZHVjdE5hbWUpfSxcInVuaXR5VmVyc2lvblwiOntFc2NhcGVKc29uKEFwcGxpY2F0aW9uLnVuaXR5VmVy' +
	'c2lvbil9LFwicGxhdGZvcm1cIjp7RXNjYXBlSnNvbihFZGl0b3JVc2VyQnVpbGRTZXR0aW5ncy5hY3RpdmVCdWlsZFRhcmdldC5U' +
	'b1N0cmluZygpKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRQbGF5TW9kZShzdHJpbmcg' +
	'aWQpCiAgICB7CiAgICAgICAgdmFyIHN0YXRlID0gRWRpdG9yQXBwbGljYXRpb24uaXNQbGF5aW5nCiAgICAgICAgICAgID8gKEVk' +
	'aXRvckFwcGxpY2F0aW9uLmlzUGF1c2VkID8gInBhdXNlZCIgOiAicGxheWluZyIpCiAgICAgICAgICAgIDogInN0b3BwZWQiOwog' +
	'ICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wic3RhdGVcIjpcIntzdGF0ZX1cIn19Iik7CiAgICB9CgogICAgcHJp' +
	'dmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUV4ZWN1dGVNZW51SXRlbShzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJp' +
	'bmc+IHApCiAgICB7CiAgICAgICAgdmFyIG1lbnVQYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgibWVudVBhdGgiLCAiIik7CiAg' +
	'ICAgICAgaWYgKHN0cmluZy5Jc051bGxPckVtcHR5KG1lbnVQYXRoKSkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwg' +
	'Im1lbnVQYXRoIGlzIHJlcXVpcmVkIik7CgogICAgICAgIHZhciByZXN1bHQgPSBFZGl0b3JBcHBsaWNhdGlvbi5FeGVjdXRlTWVu' +
	'dUl0ZW0obWVudVBhdGgpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wiZXhlY3V0ZWRcIjp7cmVzdWx0LlRv' +
	'U3RyaW5nKCkuVG9Mb3dlcigpfSxcIm1lbnVQYXRoXCI6e0VzY2FwZUpzb24obWVudVBhdGgpfX19Iik7CiAgICB9CgogICAgLy8g' +
	'LS0tIFV0aWxpdGllcyAtLS0KCiAgICAvLy8gPHN1bW1hcnk+CiAgICAvLy8gRmluZCBhIEdhbWVPYmplY3QgYnkgaGllcmFyY2h5' +
	'IHBhdGgsIGluY2x1ZGluZyBpbmFjdGl2ZSBvYmplY3RzLgogICAgLy8vIFVuaXR5J3MgR2FtZU9iamVjdC5GaW5kKCkgb25seSBm' +
	'aW5kcyBhY3RpdmUgb2JqZWN0cywgd2hpY2ggZmFpbHMgd2hlbgogICAgLy8vIGEgcGFyZW50IGhhcyBiZWVuIHNldCBpbmFjdGl2' +
	'ZS4gVGhpcyBtZXRob2Qgd2Fsa3MgdGhlIGhpZXJhcmNoeSBtYW51YWxseS4KICAgIC8vLyBJZiB0aGUgcGF0aCBjb250YWlucyBu' +
	'byAnLycgc2VwYXJhdG9yIGFuZCBubyByb290IG9iamVjdCBtYXRjaGVzLCBmYWxscwogICAgLy8vIGJhY2sgdG8gYSBmdWxsLXNj' +
	'ZW5lIG5hbWUgc2VhcmNoIHNvIGFnZW50cyBjYW4gdXNlIGJhcmUgbmFtZXMgbGlrZQogICAgLy8vICJNYWluIE1lbnUgUGFuZWwi' +
	'IGV2ZW4gd2hlbiB0aGUgb2JqZWN0IGlzIGEgY2hpbGQgb3IgaW5hY3RpdmUuCiAgICAvLy8gPC9zdW1tYXJ5PgogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgR2FtZU9iamVjdCBGaW5kR2FtZU9iamVjdEJ5UGF0aChzdHJpbmcgcGF0aCkKICAgIHsKICAgICAgICBpZiAoc3Ry' +
	'aW5nLklzTnVsbE9yRW1wdHkocGF0aCkpIHJldHVybiBudWxsOwoKICAgICAgICAvLyBGaXJzdCB0cnkgdGhlIGZhc3QgcGF0aCDi' +
	'gJQgVW5pdHkncyBidWlsdC1pbiAob25seSB3b3JrcyBmb3IgYWN0aXZlIG9iamVjdHMpCiAgICAgICAgdmFyIGZvdW5kID0gR2Ft' +
	'ZU9iamVjdC5GaW5kKHBhdGgpOwogICAgICAgIGlmIChmb3VuZCAhPSBudWxsKSByZXR1cm4gZm91bmQ7CgogICAgICAgIC8vIFNs' +
	'b3cgcGF0aDogbWFudWFsbHkgd2FsayB0aGUgaGllcmFyY2h5ICh3b3JrcyBmb3IgaW5hY3RpdmUgb2JqZWN0cyB0b28pCiAgICAg' +
	'ICAgdmFyIHBhcnRzID0gcGF0aC5TcGxpdCgnLycpOwogICAgICAgIHZhciByb290TmFtZSA9IHBhcnRzWzBdOwoKICAgICAgICAv' +
	'LyBTZWFyY2ggdGhyb3VnaCBhbGwgc2NlbmUgcm9vdCBvYmplY3RzCiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdl' +
	'dEFjdGl2ZVNjZW5lKCk7CiAgICAgICAgdmFyIHJvb3RzID0gc2NlbmUuR2V0Um9vdEdhbWVPYmplY3RzKCk7CiAgICAgICAgR2Ft' +
	'ZU9iamVjdCByb290ID0gbnVsbDsKICAgICAgICBmb3JlYWNoICh2YXIgciBpbiByb290cykKICAgICAgICB7CiAgICAgICAgICAg' +
	'IGlmIChyLm5hbWUgPT0gcm9vdE5hbWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJvb3QgPSByOwogICAgICAgICAg' +
	'ICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChyb290ID09IG51bGwpCiAgICAgICAgewog' +
	'ICAgICAgICAgICAvLyBMYXN0IHJlc29ydCBmb3Igc2luZ2xlLW5hbWUgcXVlcmllczogZGVlcCBzZWFyY2ggYWNyb3NzIGV2ZXJ5' +
	'IG9iamVjdCBpbiB0aGUgc2NlbmUuCiAgICAgICAgICAgIC8vIEhhbmRsZXMgaW5hY3RpdmUgY2hpbGRyZW4gKGUuZy4gYSBwYW5l' +
	'bCBoaWRkZW4gdW5kZXIgQ2FudmFzKSB0aGF0IG5laXRoZXIKICAgICAgICAgICAgLy8gR2FtZU9iamVjdC5GaW5kIG5vciByb290' +
	'LW9ubHkgZW51bWVyYXRpb24gY2FuIGxvY2F0ZS4KICAgICAgICAgICAgaWYgKHBhcnRzLkxlbmd0aCA9PSAxKQogICAgICAgICAg' +
	'ICAgICAgcmV0dXJuIEZpbmRHYW1lT2JqZWN0QnlOYW1lSW5TY2VuZShyb290TmFtZSk7CiAgICAgICAgICAgIHJldHVybiBudWxs' +
	'OwogICAgICAgIH0KCiAgICAgICAgaWYgKHBhcnRzLkxlbmd0aCA9PSAxKSByZXR1cm4gcm9vdDsKCiAgICAgICAgLy8gV2FsayBk' +
	'b3duIHRoZSBwYXRoIHVzaW5nIFRyYW5zZm9ybS5GaW5kIChzdXBwb3J0cyAnLycgcGF0aHMgYW5kIGZpbmRzIGluYWN0aXZlIGNo' +
	'aWxkcmVuKQogICAgICAgIHZhciBzdWJQYXRoID0gc3RyaW5nLkpvaW4oIi8iLCBwYXJ0cywgMSwgcGFydHMuTGVuZ3RoIC0gMSk7' +
	'CiAgICAgICAgdmFyIGNoaWxkID0gcm9vdC50cmFuc2Zvcm0uRmluZChzdWJQYXRoKTsKICAgICAgICByZXR1cm4gY2hpbGQgIT0g' +
	'bnVsbCA/IGNoaWxkLmdhbWVPYmplY3QgOiBudWxsOwogICAgfQoKICAgIC8vLyA8c3VtbWFyeT4KICAgIC8vLyBSZWN1cnNpdmVs' +
	'eSBzZWFyY2ggZXZlcnkgR2FtZU9iamVjdCBpbiB0aGUgYWN0aXZlIHNjZW5lIChpbmNsdWRpbmcgaW5hY3RpdmUpCiAgICAvLy8g' +
	'YW5kIHJldHVybiB0aGUgZmlyc3Qgb25lIHdob3NlIG5hbWUgbWF0Y2hlcyBleGFjdGx5LgogICAgLy8vIDwvc3VtbWFyeT4KICAg' +
	'IHByaXZhdGUgc3RhdGljIEdhbWVPYmplY3QgRmluZEdhbWVPYmplY3RCeU5hbWVJblNjZW5lKHN0cmluZyBuYW1lKQogICAgewog' +
	'ICAgICAgIGZvcmVhY2ggKHZhciByb290IGluIFNjZW5lTWFuYWdlci5HZXRBY3RpdmVTY2VuZSgpLkdldFJvb3RHYW1lT2JqZWN0' +
	'cygpKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEZpbmRJbkhpZXJhcmNoeUJ5TmFtZShyb290LnRyYW5zZm9y' +
	'bSwgbmFtZSk7CiAgICAgICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAg' +
	'cmV0dXJuIG51bGw7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgR2FtZU9iamVjdCBGaW5kSW5IaWVyYXJjaHlCeU5hbWUoVHJh' +
	'bnNmb3JtIHQsIHN0cmluZyBuYW1lKQogICAgewogICAgICAgIGlmICh0Lm5hbWUgPT0gbmFtZSkgcmV0dXJuIHQuZ2FtZU9iamVj' +
	'dDsKICAgICAgICBmb3JlYWNoIChUcmFuc2Zvcm0gY2hpbGQgaW4gdCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciByZXN1bHQg' +
	'PSBGaW5kSW5IaWVyYXJjaHlCeU5hbWUoY2hpbGQsIG5hbWUpOwogICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwpIHJldHVy' +
	'biByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIFR5cGUgRmlu' +
	'ZENvbXBvbmVudFR5cGUoc3RyaW5nIHR5cGVOYW1lKQogICAgewogICAgICAgIC8vIENvbW1vbiBuYW1lc3BhY2UgcHJlZml4ZXMg' +
	'Zm9yIFVuaXR5IGNvbXBvbmVudCB0eXBlcy4KICAgICAgICAvLyBVSSBjb21wb25lbnRzIGxpdmUgaW4gVW5pdHlFbmdpbmUuVUks' +
	'IFRNUHJvLCBFdmVudFN5c3RlbXMg4oCUIG5vdCBqdXN0IFVuaXR5RW5naW5lLgogICAgICAgIHN0cmluZ1tdIG5hbWVzcGFjZVBy' +
	'ZWZpeGVzID0gbmV3W10KICAgICAgICB7CiAgICAgICAgICAgICJVbml0eUVuZ2luZS4iLCAgICAgICAgICAgICAgLy8gUmlnaWRi' +
	'b2R5LCBDYW52YXMsIEF1ZGlvU291cmNlLCBldGMuCiAgICAgICAgICAgICJVbml0eUVuZ2luZS5VSS4iLCAgICAgICAgICAgLy8g' +
	'QnV0dG9uLCBJbWFnZSwgU2xpZGVyLCBDYW52YXNTY2FsZXIsIEdyYXBoaWNSYXljYXN0ZXIsIFZlcnRpY2FsTGF5b3V0R3JvdXAs' +
	'IGV0Yy4KICAgICAgICAgICAgIlVuaXR5RW5naW5lLkV2ZW50U3lzdGVtcy4iLCAvLyBFdmVudFN5c3RlbSwgU3RhbmRhbG9uZUlu' +
	'cHV0TW9kdWxlLCBldGMuCiAgICAgICAgICAgICJUTVByby4iLCAgICAgICAgICAgICAgICAgICAgLy8gVGV4dE1lc2hQcm9VR1VJ' +
	'LCBUTVBfSW5wdXRGaWVsZCwgZXRjLgogICAgICAgICAgICAiIiwgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN1c3RvbSBz' +
	'Y3JpcHRzIChiYXJlIGNsYXNzIG5hbWUgaW4gQXNzZW1ibHktQ1NoYXJwKQogICAgICAgIH07CgogICAgICAgIGZvcmVhY2ggKHZh' +
	'ciBhc3NlbWJseSBpbiBBcHBEb21haW4uQ3VycmVudERvbWFpbi5HZXRBc3NlbWJsaWVzKCkpCiAgICAgICAgewogICAgICAgICAg' +
	'ICBmb3JlYWNoICh2YXIgcHJlZml4IGluIG5hbWVzcGFjZVByZWZpeGVzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2' +
	'YXIgZnVsbE5hbWUgPSBwcmVmaXggKyB0eXBlTmFtZTsKICAgICAgICAgICAgICAgIHZhciB0eXBlID0gYXNzZW1ibHkuR2V0VHlw' +
	'ZShmdWxsTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAodHlwZSAhPSBudWxsICYmIHR5cGVvZihDb21wb25lbnQpLklzQXNzaWdu' +
	'YWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog' +
	'ICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8vLyA8c3VtbWFyeT4KICAgIC8vLyBTbWFydCB0eXBlIGNvbnZlcnNpb24g' +
	'dGhhdCBoYW5kbGVzIGVudW1zLCBWZWN0b3IyLCBWZWN0b3IzLCBDb2xvciwgcHJpbWl0aXZlcywKICAgIC8vLyBhbmQgVW5pdHkg' +
	'T2JqZWN0IHJlZmVyZW5jZXMgKEdhbWVPYmplY3QvQ29tcG9uZW50IGJ5IHNjZW5lIHBhdGgsIGFzc2V0cyBieSBhc3NldCBwYXRo' +
	'KS4KICAgIC8vLyBGYWxscyBiYWNrIHRvIENvbnZlcnQuQ2hhbmdlVHlwZSBmb3Igc2ltcGxlIHR5cGVzLgogICAgLy8vIDwvc3Vt' +
	'bWFyeT4KICAgIHByaXZhdGUgc3RhdGljIG9iamVjdCBTbWFydENvbnZlcnQoc3RyaW5nIHZhbHVlU3RyLCBUeXBlIHRhcmdldFR5' +
	'cGUpCiAgICB7CiAgICAgICAgLy8gSGFuZGxlIG51bGxhYmxlCiAgICAgICAgdmFyIHVuZGVybHlpbmdUeXBlID0gTnVsbGFibGUu' +
	'R2V0VW5kZXJseWluZ1R5cGUodGFyZ2V0VHlwZSk7CiAgICAgICAgaWYgKHVuZGVybHlpbmdUeXBlICE9IG51bGwpCiAgICAgICAg' +
	'ICAgIHRhcmdldFR5cGUgPSB1bmRlcmx5aW5nVHlwZTsKCiAgICAgICAgLy8gR2FtZU9iamVjdCByZWZlcmVuY2Ug4oCUIHJlc29s' +
	'dmUgYnkgc2NlbmUgcGF0aC9uYW1lLCB0aGVuIGFzc2V0IGRhdGFiYXNlCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9m' +
	'KEdhbWVPYmplY3QpKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlZkdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgodmFsdWVT' +
	'dHIpOwogICAgICAgICAgICBpZiAocmVmR28gIT0gbnVsbCkgcmV0dXJuIHJlZkdvOwogICAgICAgICAgICB2YXIgYXNzZXQgPSBB' +
	'c3NldERhdGFiYXNlLkxvYWRBc3NldEF0UGF0aDxHYW1lT2JqZWN0Pih2YWx1ZVN0cik7CiAgICAgICAgICAgIGlmIChhc3NldCAh' +
	'PSBudWxsKSByZXR1cm4gYXNzZXQ7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKAogICAg' +
	'ICAgICAgICAgICAgJCJDYW5ub3QgYXNzaWduIHJlZmVyZW5jZTogJ3t2YWx1ZVN0cn0nIHdhcyBub3QgZm91bmQgaW4gdGhlIHNj' +
	'ZW5lIGhpZXJhcmNoeSBvciB0aGUgYXNzZXQgZGF0YWJhc2UuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBDb21wb25lbnQgcmVm' +
	'ZXJlbmNlIOKAlCBmaW5kIHRoZSBHYW1lT2JqZWN0IHRoZW4gZ2V0IHRoZSBjb21wb25lbnQKICAgICAgICBpZiAodHlwZW9mKENv' +
	'bXBvbmVudCkuSXNBc3NpZ25hYmxlRnJvbSh0YXJnZXRUeXBlKSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciByZWZHbyA9IEZp' +
	'bmRHYW1lT2JqZWN0QnlQYXRoKHZhbHVlU3RyKTsKICAgICAgICAgICAgaWYgKHJlZkdvICE9IG51bGwpIHJldHVybiByZWZHby5H' +
	'ZXRDb21wb25lbnQodGFyZ2V0VHlwZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKAog' +
	'ICAgICAgICAgICAgICAgJCJDYW5ub3QgYXNzaWduIHJlZmVyZW5jZTogJ3t2YWx1ZVN0cn0nIHdhcyBub3QgZm91bmQgaW4gdGhl' +
	'IHNjZW5lIGhpZXJhcmNoeS4iKTsKICAgICAgICB9CgogICAgICAgIC8vIE90aGVyIFVuaXR5RW5naW5lLk9iamVjdCAoU3ByaXRl' +
	'LCBNYXRlcmlhbCwgQXVkaW9DbGlwLCBldGMuKSDigJQgbG9hZCBmcm9tIGFzc2V0IERCCiAgICAgICAgaWYgKHR5cGVvZihVbml0' +
	'eUVuZ2luZS5PYmplY3QpLklzQXNzaWduYWJsZUZyb20odGFyZ2V0VHlwZSkpCiAgICAgICAgICAgIHJldHVybiBBc3NldERhdGFi' +
	'YXNlLkxvYWRBc3NldEF0UGF0aCh2YWx1ZVN0ciwgdGFyZ2V0VHlwZSk7CgogICAgICAgIC8vIEVudW0gdHlwZXMgKFJlbmRlck1v' +
	'ZGUsIFNjYWxlTW9kZSwgVGV4dEFsaWdubWVudE9wdGlvbnMsIGV0Yy4pCiAgICAgICAgaWYgKHRhcmdldFR5cGUuSXNFbnVtKQog' +
	'ICAgICAgIHsKICAgICAgICAgICAgLy8gVHJ5IHBhcnNpbmcgYnkgbmFtZSBmaXJzdCAoZS5nLiAiU2NyZWVuU3BhY2VPdmVybGF5' +
	'IiwgIlNjYWxlV2l0aFNjcmVlblNpemUiKQogICAgICAgICAgICBpZiAoRW51bS5UcnlQYXJzZSh0YXJnZXRUeXBlLCB2YWx1ZVN0' +
	'ciwgdHJ1ZSwgb3V0IHZhciBlbnVtVmFsKSkKICAgICAgICAgICAgICAgIHJldHVybiBlbnVtVmFsOwogICAgICAgICAgICAvLyBU' +
	'cnkgcGFyc2luZyBhcyBpbnRlZ2VyCiAgICAgICAgICAgIGlmIChpbnQuVHJ5UGFyc2UodmFsdWVTdHIsIG91dCB2YXIgaW50VmFs' +
	'KSkKICAgICAgICAgICAgICAgIHJldHVybiBFbnVtLlRvT2JqZWN0KHRhcmdldFR5cGUsIGludFZhbCk7CiAgICAgICAgICAgIHRo' +
	'cm93IG5ldyBJbnZhbGlkQ2FzdEV4Y2VwdGlvbigkIkNhbm5vdCBjb252ZXJ0ICd7dmFsdWVTdHJ9JyB0byB7dGFyZ2V0VHlwZS5O' +
	'YW1lfS4gVmFsaWQgdmFsdWVzOiB7c3RyaW5nLkpvaW4oIiwgIiwgRW51bS5HZXROYW1lcyh0YXJnZXRUeXBlKSl9Iik7CiAgICAg' +
	'ICAgfQoKICAgICAgICAvLyBWZWN0b3IyCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKFZlY3RvcjIpKQogICAgICAg' +
	'ICAgICByZXR1cm4gUGFyc2VWZWN0b3IyKHZhbHVlU3RyKTsKCiAgICAgICAgLy8gVmVjdG9yMwogICAgICAgIGlmICh0YXJnZXRU' +
	'eXBlID09IHR5cGVvZihWZWN0b3IzKSkKICAgICAgICAgICAgcmV0dXJuIFBhcnNlVmVjdG9yMyh2YWx1ZVN0cik7CgogICAgICAg' +
	'IC8vIFZlY3RvcjQKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2YoVmVjdG9yNCkpCiAgICAgICAgICAgIHJldHVybiBQ' +
	'YXJzZVZlY3RvcjQodmFsdWVTdHIpOwoKICAgICAgICAvLyBDb2xvcgogICAgICAgIGlmICh0YXJnZXRUeXBlID09IHR5cGVvZihD' +
	'b2xvcikpCiAgICAgICAgICAgIHJldHVybiBQYXJzZUNvbG9yKHZhbHVlU3RyKTsKCiAgICAgICAgLy8gQm9vbAogICAgICAgIGlm' +
	'ICh0YXJnZXRUeXBlID09IHR5cGVvZihib29sKSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlU3RyLlRvTG93ZXIoKSA9PSAidHJ1' +
	'ZSIgfHwgdmFsdWVTdHIgPT0gIjEiOwoKICAgICAgICAvLyBJbnQKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2YoaW50' +
	'KSkKICAgICAgICB7CiAgICAgICAgICAgIGludC5UcnlQYXJzZSh2YWx1ZVN0ciwgb3V0IHZhciB2KTsKICAgICAgICAgICAgcmV0' +
	'dXJuIHY7CiAgICAgICAgfQoKICAgICAgICAvLyBGbG9hdAogICAgICAgIGlmICh0YXJnZXRUeXBlID09IHR5cGVvZihmbG9hdCkp' +
	'CiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZSh2YWx1ZVN0ciwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVy' +
	'U3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHYp' +
	'OwogICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICB9CgogICAgICAgIC8vIFN0cmluZwogICAgICAgIGlmICh0YXJnZXRUeXBl' +
	'ID09IHR5cGVvZihzdHJpbmcpKQogICAgICAgICAgICByZXR1cm4gdmFsdWVTdHI7CgogICAgICAgIC8vIEZhbGxiYWNrCiAgICAg' +
	'ICAgcmV0dXJuIENvbnZlcnQuQ2hhbmdlVHlwZSh2YWx1ZVN0ciwgdGFyZ2V0VHlwZSk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0' +
	'aWMgVmVjdG9yMiBQYXJzZVZlY3RvcjIoc3RyaW5nIHN0cikKICAgIHsKICAgICAgICBzdHIgPSBzdHIuVHJpbSgnWycsICddJywg' +
	'JygnLCAnKScpLlRyaW0oKTsKICAgICAgICB2YXIgcGFydHMgPSBzdHIuU3BsaXQoJywnKTsKICAgICAgICBpZiAocGFydHMuTGVu' +
	'Z3RoID49IDIpCiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1swXS5UcmltKCksIFN5c3RlbS5HbG9i' +
	'YWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3Vs' +
	'dHVyZSwgb3V0IHZhciB4KTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMV0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFs' +
	'aXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1' +
	'cmUsIG91dCB2YXIgeSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih4LCB5KTsKICAgICAgICB9CiAgICAgICAgcmV0' +
	'dXJuIFZlY3RvcjIuemVybzsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzIFBhcnNlVmVjdG9yMyhzdHJpbmcgc3Ry' +
	'KQogICAgewogICAgICAgIC8vIEhhbmRsZSBib3RoICJbeCx5LHpdIiBhbmQgIngseSx6IiBmb3JtYXRzCiAgICAgICAgc3RyID0g' +
	'c3RyLlRyaW0oJ1snLCAnXScsICcoJywgJyknKS5UcmltKCk7CiAgICAgICAgdmFyIHBhcnRzID0gc3RyLlNwbGl0KCcsJyk7CiAg' +
	'ICAgICAgaWYgKHBhcnRzLkxlbmd0aCA+PSAzKQogICAgICAgIHsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMF0u' +
	'VHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1' +
	'cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgeCk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzFdLlRy' +
	'aW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJl' +
	'SW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHkpOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1syXS5Ucmlt' +
	'KCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUlu' +
	'Zm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB6KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IzKHgsIHksIHopOwog' +
	'ICAgICAgIH0KICAgICAgICByZXR1cm4gVmVjdG9yMy56ZXJvOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIFZlY3RvcjQgUGFy' +
	'c2VWZWN0b3I0KHN0cmluZyBzdHIpCiAgICB7CiAgICAgICAgc3RyID0gc3RyLlRyaW0oJ1snLCAnXScsICcoJywgJyknKS5Ucmlt' +
	'KCk7CiAgICAgICAgdmFyIHBhcnRzID0gc3RyLlNwbGl0KCcsJyk7CiAgICAgICAgaWYgKHBhcnRzLkxlbmd0aCA+PSA0KQogICAg' +
	'ICAgIHsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMF0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1i' +
	'ZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIg' +
	'eCk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzFdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVy' +
	'U3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHkp' +
	'OwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1syXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0' +
	'eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB6KTsK' +
	'ICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbM10uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHls' +
	'ZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgdyk7CiAg' +
	'ICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yNCh4LCB5LCB6LCB3KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFZlY3RvcjQu' +
	'emVybzsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBDb2xvciBQYXJzZUNvbG9yKHN0cmluZyBzdHIpCiAgICB7CiAgICAgICAg' +
	'Ly8gVHJ5IGhleCBjb2xvciAoI1JSR0dCQiBvciAjUlJHR0JCQUEpCiAgICAgICAgaWYgKHN0ci5TdGFydHNXaXRoKCIjIikgJiYg' +
	'Q29sb3JVdGlsaXR5LlRyeVBhcnNlSHRtbFN0cmluZyhzdHIsIG91dCB2YXIgaHRtbENvbG9yKSkKICAgICAgICAgICAgcmV0dXJu' +
	'IGh0bWxDb2xvcjsKICAgICAgICAvLyBUcnkgUkdCQSBjb21wb25lbnRzCiAgICAgICAgc3RyID0gc3RyLlRyaW0oJ1snLCAnXScs' +
	'ICcoJywgJyknKS5UcmltKCk7CiAgICAgICAgdmFyIHBhcnRzID0gc3RyLlNwbGl0KCcsJyk7CiAgICAgICAgaWYgKHBhcnRzLkxl' +
	'bmd0aCA+PSAzKQogICAgICAgIHsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMF0uVHJpbSgpLCBTeXN0ZW0uR2xv' +
	'YmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1' +
	'bHR1cmUsIG91dCB2YXIgcik7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzFdLlRyaW0oKSwgU3lzdGVtLkdsb2Jh' +
	'bGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0' +
	'dXJlLCBvdXQgdmFyIGcpOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1syXS5UcmltKCksIFN5c3RlbS5HbG9iYWxp' +
	'emF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVy' +
	'ZSwgb3V0IHZhciBiKTsKICAgICAgICAgICAgZmxvYXQgYSA9IDFmOwogICAgICAgICAgICBpZiAocGFydHMuTGVuZ3RoID49IDQp' +
	'CiAgICAgICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1szXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJl' +
	'clN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IGEpOwog' +
	'ICAgICAgICAgICByZXR1cm4gbmV3IENvbG9yKHIsIGcsIGIsIGEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQ29sb3Iud2hp' +
	'dGU7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTZXRTZXJpYWxpemVkUHJvcGVydHlWYWx1ZShTZXJpYWxpemVkUHJv' +
	'cGVydHkgcHJvcCwgc3RyaW5nIHZhbHVlKQogICAgewogICAgICAgIHN3aXRjaCAocHJvcC5wcm9wZXJ0eVR5cGUpCiAgICAgICAg' +
	'ewogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuSW50ZWdlcjoKICAgICAgICAgICAgICAgIGlmIChpbnQu' +
	'VHJ5UGFyc2UodmFsdWUsIG91dCB2YXIgaW50VmFsKSkKICAgICAgICAgICAgICAgICAgICBwcm9wLmludFZhbHVlID0gaW50VmFs' +
	'OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5GbG9hdDoKICAg' +
	'ICAgICAgICAgICAgIGlmIChmbG9hdC5UcnlQYXJzZSh2YWx1ZSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZs' +
	'b2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIGZsb2F0VmFsKSkK' +
	'ICAgICAgICAgICAgICAgICAgICBwcm9wLmZsb2F0VmFsdWUgPSBmbG9hdFZhbDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg' +
	'ICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuQm9vbGVhbjoKICAgICAgICAgICAgICAgIHByb3AuYm9vbFZhbHVl' +
	'ID0gdmFsdWUuVG9Mb3dlcigpID09ICJ0cnVlIiB8fCB2YWx1ZSA9PSAiMSI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg' +
	'ICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLlN0cmluZzoKICAgICAgICAgICAgICAgIHByb3Auc3RyaW5nVmFsdWUg' +
	'PSB2YWx1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuRW51' +
	'bToKICAgICAgICAgICAgICAgIC8vIFRyeSBuYW1lIGZpcnN0LCB0aGVuIGludGVnZXIKICAgICAgICAgICAgICAgIHZhciBlbnVt' +
	'TmFtZXMgPSBwcm9wLmVudW1OYW1lczsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZW51bU5hbWVzLkxlbmd0' +
	'aDsgaSsrKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmcuRXF1YWxzKGVudW1OYW1lc1tp' +
	'XSwgdmFsdWUsIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAg' +
	'ICAgICAgICAgICAgICAgICAgcHJvcC5lbnVtVmFsdWVJbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK' +
	'ICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaW50LlRyeVBhcnNlKHZh' +
	'bHVlLCBvdXQgdmFyIGVudW1JbnQpKQogICAgICAgICAgICAgICAgICAgIHByb3AuZW51bVZhbHVlSW5kZXggPSBlbnVtSW50Owog' +
	'ICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5WZWN0b3IyOgogICAg' +
	'ICAgICAgICAgICAgcHJvcC52ZWN0b3IyVmFsdWUgPSBQYXJzZVZlY3RvcjIodmFsdWUpOwogICAgICAgICAgICAgICAgYnJlYWs7' +
	'CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5WZWN0b3IzOgogICAgICAgICAgICAgICAgcHJvcC52ZWN0' +
	'b3IzVmFsdWUgPSBQYXJzZVZlY3RvcjModmFsdWUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2Vy' +
	'aWFsaXplZFByb3BlcnR5VHlwZS5Db2xvcjoKICAgICAgICAgICAgICAgIHByb3AuY29sb3JWYWx1ZSA9IFBhcnNlQ29sb3IodmFs' +
	'dWUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5PYmplY3RS' +
	'ZWZlcmVuY2U6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIHZhbHVlIGlzIGEgc2NlbmUgcGF0aC9uYW1lIChlLmcu' +
	'ICJNYWluIE1lbnUgUGFuZWwiLCAiQ2FudmFzL1BhbmVsIikgb3IgYW4KICAgICAgICAgICAgICAgIC8vIGFzc2V0IHBhdGggKCJB' +
	'c3NldHMvLi4uIikuIFRyeSBzY2VuZSBmaXJzdCwgdGhlbiBhc3NldCBkYXRhYmFzZS4KICAgICAgICAgICAgICAgIHZhciByZWZH' +
	'byA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmIChyZWZHbyAhPSBudWxsKQogICAgICAg' +
	'ICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIC8vIHByb3AudHlwZSByZXR1cm5zIGUuZy4gIlBQdHI8JEJ1dHRvbj4iLCAi' +
	'UFB0cjwkR2FtZU9iamVjdD4iLCAiUFB0cjwkVHJhbnNmb3JtPiIKICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBSZWdl' +
	'eC5NYXRjaChwcm9wLnR5cGUsIEAiUFB0cjxcJCguKyk+Iik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGVjdGVkVHlwZU5h' +
	'bWUgPSBtYXRjaC5TdWNjZXNzID8gbWF0Y2guR3JvdXBzWzFdLlZhbHVlIDogcHJvcC50eXBlOwoKICAgICAgICAgICAgICAgICAg' +
	'ICBpZiAoZXhwZWN0ZWRUeXBlTmFtZSA9PSAiR2FtZU9iamVjdCIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAg' +
	'ICAgICAgICAgICBwcm9wLm9iamVjdFJlZmVyZW5jZVZhbHVlID0gcmVmR287CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg' +
	'ICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBy' +
	'ZXNvbHZlIHRoZSBleHBlY3RlZCBjb21wb25lbnQvb2JqZWN0IHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBU' +
	'eXBlID0gRmluZENvbXBvbmVudFR5cGUoZXhwZWN0ZWRUeXBlTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21w' +
	'VHlwZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcC5vYmplY3RSZWZlcmVuY2VWYWx1ZSA9IHJlZkdv' +
	'LkdldENvbXBvbmVudChjb21wVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgIHByb3Aub2JqZWN0UmVmZXJlbmNlVmFsdWUgPSByZWZHbzsgLy8gYmVzdC1lZmZvcnQgZmFsbGJhY2sKICAgICAgICAg' +
	'ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAg' +
	'ICAgICAgICAgICAgICAgLy8gVHJ5IGxvYWRpbmcgZnJvbSB0aGUgYXNzZXQgZGF0YWJhc2UgKHNwcml0ZXMsIHByZWZhYnMsIG1h' +
	'dGVyaWFsc+KApikKICAgICAgICAgICAgICAgICAgICB2YXIgYXNzZXQgPSBBc3NldERhdGFiYXNlLkxvYWRNYWluQXNzZXRBdFBh' +
	'dGgodmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChhc3NldCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHsKICAg' +
	'ICAgICAgICAgICAgICAgICAgICAgcHJvcC5vYmplY3RSZWZlcmVuY2VWYWx1ZSA9IGFzc2V0OwogICAgICAgICAgICAgICAgICAg' +
	'IH0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAv' +
	'LyBOZWl0aGVyIHNjZW5lIG5vciBhc3NldCBkYXRhYmFzZSByZXNvbHZlZCB0aGUgcmVmZXJlbmNlLgogICAgICAgICAgICAgICAg' +
	'ICAgICAgICAvLyBUaHJvdyBzbyB0aGUgY2FsbGVyIHJldHVybnMgYSBwcm9wZXIgZXJyb3IgaW5zdGVhZCBvZiBzaWxlbnRseQog' +
	'ICAgICAgICAgICAgICAgICAgICAgICAvLyBsZWF2aW5nIHRoZSBmaWVsZCBudWxsIGFuZCByZXR1cm5pbmcgc3VjY2Vzcy4KICAg' +
	'ICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRPcGVyYXRpb25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg' +
	'ICAgICAgICAgICAkIkNhbm5vdCBhc3NpZ24gcmVmZXJlbmNlOiAne3ZhbHVlfScgd2FzIG5vdCBmb3VuZCBpbiB0aGUgc2NlbmUg' +
	'aGllcmFyY2h5IG9yIHRoZSBhc3NldCBkYXRhYmFzZS4gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkIk1ha2Ugc3Vy' +
	'ZSB0aGUgR2FtZU9iamVjdCBuYW1lIG9yIHBhdGggaXMgY29ycmVjdC4iKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg' +
	'ICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyB2b2lkIENyZWF0ZUZvbGRlclJlY3Vyc2l2ZShzdHJpbmcgcGF0aCkKICAgIHsKICAgICAgICB2YXIgcGFydHMgPSBw' +
	'YXRoLlJlcGxhY2UoIlxcIiwgIi8iKS5TcGxpdCgnLycpOwogICAgICAgIHZhciBjdXJyZW50ID0gcGFydHNbMF07CiAgICAgICAg' +
	'Zm9yIChpbnQgaSA9IDE7IGkgPCBwYXJ0cy5MZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIHZhciBuZXh0ID0gY3Vy' +
	'cmVudCArICIvIiArIHBhcnRzW2ldOwogICAgICAgICAgICBpZiAoIUFzc2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihuZXh0KSkK' +
	'ICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQXNzZXREYXRhYmFzZS5DcmVhdGVGb2xkZXIoY3VycmVudCwgcGFydHNbaV0p' +
	'OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnQgPSBuZXh0OwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0' +
	'YXRpYyBzdHJpbmcgRXNjYXBlSnNvbihzdHJpbmcgcykKICAgIHsKICAgICAgICBpZiAocyA9PSBudWxsKSByZXR1cm4gIm51bGwi' +
	'OwogICAgICAgIHJldHVybiAiXCIiICsgcy5SZXBsYWNlKCJcXCIsICJcXFxcIikuUmVwbGFjZSgiXCIiLCAiXFxcIiIpLlJlcGxh' +
	'Y2UoIlxuIiwgIlxcbiIpLlJlcGxhY2UoIlxyIiwgIlxcciIpLlJlcGxhY2UoIlx0IiwgIlxcdCIpICsgIlwiIjsKICAgIH0KCiAg' +
	'ICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgTWFrZVN1Y2Nlc3Moc3RyaW5nIGlkLCBzdHJpbmcgcmVzdWx0SnNvbikKICAgIHsKICAg' +
	'ICAgICByZXR1cm4gJCJ7e1wiaWRcIjp7RXNjYXBlSnNvbihpZCl9LFwidHlwZVwiOlwicmVzcG9uc2VcIixcInN1Y2Nlc3NcIjp0' +
	'cnVlLFwicmVzdWx0XCI6e3Jlc3VsdEpzb259fX0iOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBNYWtlRXJyb3Io' +
	'c3RyaW5nIGlkLCBzdHJpbmcgZXJyb3IpCiAgICB7CiAgICAgICAgcmV0dXJuICQie3tcImlkXCI6e0VzY2FwZUpzb24oaWQpfSxc' +
	'InR5cGVcIjpcInJlc3BvbnNlXCIsXCJzdWNjZXNzXCI6ZmFsc2UsXCJlcnJvclwiOntFc2NhcGVKc29uKGVycm9yKX19fSI7CiAg' +
	'ICB9CgogICAgLy8gLS0tIFNlcmlhbGl6YXRpb24gSGVscGVycyAtLS0KICAgIC8vIEpzb25VdGlsaXR5IG5lZWRzIHNlcmlhbGl6' +
	'YWJsZSBjbGFzc2VzIGZvciBGcm9tSnNvbgoKICAgIFtTZXJpYWxpemFibGVdCiAgICBwcml2YXRlIGNsYXNzIFNlcmlhbGl6YWJs' +
	'ZVJlcXVlc3QKICAgIHsKICAgICAgICBwdWJsaWMgc3RyaW5nIGlkOwogICAgICAgIHB1YmxpYyBzdHJpbmcgdHlwZTsKICAgICAg' +
	'ICBwdWJsaWMgc3RyaW5nIGNhdGVnb3J5OwogICAgICAgIHB1YmxpYyBzdHJpbmcgYWN0aW9uOwogICAgICAgIHB1YmxpYyBzdHJp' +
	'bmcgcGFyYW1zSnNvbjsgLy8gUGFyYW1zIGFzIHJhdyBKU09OIHN0cmluZwoKICAgICAgICAvLy8gPHN1bW1hcnk+CiAgICAgICAg' +
	'Ly8vIFBhcnNlIHBhcmFtcyBmcm9tIHRoZSByYXcgSlNPTi4gU2luY2UgVW5pdHkncyBKc29uVXRpbGl0eSBkb2Vzbid0IGhhbmRs' +
	'ZQogICAgICAgIC8vLyBEaWN0aW9uYXJ5IG9yIGR5bmFtaWMgb2JqZWN0cywgd2UgZG8gbWFudWFsIHBhcnNpbmcgZm9yIHRoZSBz' +
	'aW1wbGUga2V5LXZhbHVlIHBhcmFtcy4KICAgICAgICAvLy8gPC9zdW1tYXJ5PgogICAgICAgIHB1YmxpYyBEaWN0aW9uYXJ5PHN0' +
	'cmluZywgc3RyaW5nPiBHZXRQYXJhbXMoKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBEaWN0aW9uYXJ5' +
	'PHN0cmluZywgc3RyaW5nPigpOwogICAgICAgICAgICBpZiAoc3RyaW5nLklzTnVsbE9yRW1wdHkocGFyYW1zSnNvbikpIHJldHVy' +
	'biByZXN1bHQ7CgogICAgICAgICAgICAvLyBTaW1wbGUgSlNPTiBvYmplY3QgcGFyc2VyIGZvciBmbGF0IGtleS12YWx1ZSBwYWly' +
	'cwogICAgICAgICAgICB2YXIganNvbiA9IHBhcmFtc0pzb24uVHJpbSgpOwogICAgICAgICAgICBpZiAoIWpzb24uU3RhcnRzV2l0' +
	'aCgieyIpKSByZXR1cm4gcmVzdWx0OwoKICAgICAgICAgICAganNvbiA9IGpzb24uU3Vic3RyaW5nKDEsIGpzb24uTGVuZ3RoIC0g' +
	'MikuVHJpbSgpOwogICAgICAgICAgICBpZiAoc3RyaW5nLklzTnVsbE9yRW1wdHkoanNvbikpIHJldHVybiByZXN1bHQ7CgogICAg' +
	'ICAgICAgICAvLyBTcGxpdCBieSBjb21tYXMgdGhhdCBhcmVuJ3QgaW5zaWRlIHN0cmluZ3MKICAgICAgICAgICAgdmFyIHBhaXJz' +
	'ID0gU3BsaXRKc29uUGFpcnMoanNvbik7CiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBwYWlyIGluIHBhaXJzKQogICAgICAgICAg' +
	'ICB7CiAgICAgICAgICAgICAgICB2YXIgY29sb25JZHggPSBwYWlyLkluZGV4T2YoJzonKTsKICAgICAgICAgICAgICAgIGlmIChj' +
	'b2xvbklkeCA8IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBwYWlyLlN1YnN0cmluZygwLCBjb2xvbklk' +
	'eCkuVHJpbSgpLlRyaW0oJyInKTsKICAgICAgICAgICAgICAgIHZhciB2YWwgPSBwYWlyLlN1YnN0cmluZyhjb2xvbklkeCArIDEp' +
	'LlRyaW0oKS5UcmltKCciJyk7CgogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGFycmF5IHZhbHVlcyAoa2VlcCBhcyBzdHJpbmcg' +
	'Zm9yIG5vdykKICAgICAgICAgICAgICAgIGlmICh2YWwuU3RhcnRzV2l0aCgiWyIpKQogICAgICAgICAgICAgICAgICAgIHZhbCA9' +
	'IHZhbC5UcmltKCk7CgogICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg' +
	'IHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBMaXN0PHN0cmluZz4gU3BsaXRKc29uUGFp' +
	'cnMoc3RyaW5nIGpzb24pCiAgICAgICAgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IExpc3Q8c3RyaW5nPigpOwogICAg' +
	'ICAgICAgICB2YXIgZGVwdGggPSAwOwogICAgICAgICAgICB2YXIgaW5TdHJpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIHN0' +
	'YXJ0ID0gMDsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwganNvbi5MZW5ndGg7IGkrKykKICAgICAgICAgICAgewog' +
	'ICAgICAgICAgICAgICAgdmFyIGMgPSBqc29uW2ldOwogICAgICAgICAgICAgICAgaWYgKGMgPT0gJyInICYmIChpID09IDAgfHwg' +
	'anNvbltpIC0gMV0gIT0gJ1xcJykpCiAgICAgICAgICAgICAgICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7CiAgICAgICAgICAg' +
	'ICAgICBlbHNlIGlmICghaW5TdHJpbmcpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT0gJ3sn' +
	'IHx8IGMgPT0gJ1snKSBkZXB0aCsrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGMgPT0gJ30nIHx8IGMgPT0gJ10nKSBk' +
	'ZXB0aC0tOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGMgPT0gJywnICYmIGRlcHRoID09IDApCiAgICAgICAgICAgICAg' +
	'ICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuQWRkKGpzb24uU3Vic3RyaW5nKHN0YXJ0LCBpIC0gc3RhcnQp' +
	'LlRyaW0oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAg' +
	'ICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGFydCA8IGpzb24uTGVuZ3RoKQogICAgICAgICAg' +
	'ICAgICAgcmVzdWx0LkFkZChqc29uLlN1YnN0cmluZyhzdGFydCkuVHJpbSgpKTsKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7' +
	'CiAgICAgICAgfQogICAgfQoKfQo=';

/** Decode and return the C# plugin source */
export function getBridgePluginSource(): string {
	return VSBuffer.wrap(Uint8Array.from(atob(BRIDGE_PLUGIN_BASE64), c => c.charCodeAt(0))).toString();
}
