/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Embedded source of the Unity Editor Bridge C# plugin (base64 encoded).
 * Auto-deployed into the user's Unity project at Assets/Editor/GameDevIDEBridge.cs.
 *
 * The readable source is at: unity-editor-plugin/GameDevIDEBridge.cs
 * To regenerate after editing the C# file, run from the repo root:
 *   node scripts/generate-bridge-plugin-source.js
 */

import { VSBuffer } from '../../../../base/common/buffer.js';

/** Version marker â€” bump when the plugin changes to trigger re-deploy */
export const BRIDGE_PLUGIN_VERSION = '1.2.0';

/** Path relative to Unity project root where the plugin is installed */
export const BRIDGE_PLUGIN_INSTALL_PATH = 'Assets/Editor/GameDevIDEBridge.cs';

/** Base64-encoded C# source of the Unity Editor Bridge plugin */
const BRIDGE_PLUGIN_BASE64 = '' +
	'LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIEdhbWVEZXYgSURFIEJyaWRnZSDigJQgVW5pdHkgRWRpdG9yIFBsdWdpbiAgKEFVVE8t' +
	'SU5TVEFMTEVEIGJ5IEdhbWVEZXYgSURFKQogKgogKiAgVGhpcyBmaWxlIGlzIGF1dG9tYXRpY2FsbHkgbWFuYWdlZCBieSBHYW1l' +
	'RGV2IElERS4gRG8gbm90IGVkaXQgbWFudWFsbHkuCiAqICBJdCBvcGVucyBhIFdlYlNvY2tldCBzZXJ2ZXIgb24gbG9jYWxob3N0' +
	'IHNvIHRoZSBJREUgY2FuIGNvbW11bmljYXRlIHdpdGgKICogIHRoZSBydW5uaW5nIFVuaXR5IEVkaXRvciB0byBjcmVhdGUgR2Ft' +
	'ZU9iamVjdHMsIHNjZW5lcywgcHJlZmFicywgZXRjLgogKgogKiAgUHJvdG9jb2wgdmVyc2lvbjogMS4wCiAqICBQbHVnaW4gdmVy' +
	'c2lvbjogMS4yLjAKICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgp1c2luZyBVbml0eUVuZ2luZTsKdXNpbmcgVW5pdHlFZGl0b3I7CnVz' +
	'aW5nIFVuaXR5RWRpdG9yLlNjZW5lTWFuYWdlbWVudDsKdXNpbmcgVW5pdHlFbmdpbmUuU2NlbmVNYW5hZ2VtZW50Owp1c2luZyBT' +
	'eXN0ZW07CnVzaW5nIFN5c3RlbS5JTzsKdXNpbmcgU3lzdGVtLk5ldDsKdXNpbmcgU3lzdGVtLk5ldC5Tb2NrZXRzOwp1c2luZyBT' +
	'eXN0ZW0uTmV0LldlYlNvY2tldHM7CnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHk7CnVzaW5nIFN5c3RlbS5UZXh0' +
	'Owp1c2luZyBTeXN0ZW0uVGV4dC5SZWd1bGFyRXhwcmVzc2lvbnM7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7CnVzaW5nIFN5c3Rl' +
	'bS5UaHJlYWRpbmcuVGFza3M7CnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5Db25jdXJyZW50Owp1c2luZyBTeXN0ZW0uQ29sbGVj' +
	'dGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247CnVzaW5nIFN5c3RlbS5MaW5xOwoKW0luaXRpYWxpemVPbkxv' +
	'YWRdCnB1YmxpYyBzdGF0aWMgY2xhc3MgR2FtZURldklERUJyaWRnZQp7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBQUk9UT0NP' +
	'TF9WRVJTSU9OID0gIjEuMCI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRElSID0gIkxpYnJhcnkvR2FtZURl' +
	'dklERSI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRklMRSA9ICJMaWJyYXJ5L0dhbWVEZXZJREUvYnJpZGdl' +
	'Lmpzb24iOwoKICAgIHByaXZhdGUgc3RhdGljIFRjcExpc3RlbmVyIF9saXN0ZW5lcjsKICAgIHByaXZhdGUgc3RhdGljIFRjcENs' +
	'aWVudCBfdGNwQ2xpZW50OwogICAgcHJpdmF0ZSBzdGF0aWMgTmV0d29ya1N0cmVhbSBfY2xpZW50U3RyZWFtOwogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UgX2N0czsKICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENvbmN1cnJl' +
	'bnRRdWV1ZTxzdHJpbmc+IF9pbmNvbWluZ01lc3NhZ2VzID0gbmV3IENvbmN1cnJlbnRRdWV1ZTxzdHJpbmc+KCk7CiAgICBwcml2' +
	'YXRlIHN0YXRpYyByZWFkb25seSBDb25jdXJyZW50UXVldWU8c3RyaW5nPiBfb3V0Z29pbmdNZXNzYWdlcyA9IG5ldyBDb25jdXJy' +
	'ZW50UXVldWU8c3RyaW5nPigpOwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IF9wb3J0OwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBf' +
	'cnVubmluZzsKICAgIHByaXZhdGUgc3RhdGljIGJvb2wgX2NsaWVudENvbm5lY3RlZDsKCiAgICBzdGF0aWMgR2FtZURldklERUJy' +
	'aWRnZSgpCiAgICB7CiAgICAgICAgRWRpdG9yQXBwbGljYXRpb24udXBkYXRlICs9IFByb2Nlc3NNZXNzYWdlczsKICAgICAgICBF' +
	'ZGl0b3JBcHBsaWNhdGlvbi5xdWl0dGluZyArPSBTaHV0ZG93bjsKICAgICAgICBBc3NlbWJseVJlbG9hZEV2ZW50cy5iZWZvcmVB' +
	'c3NlbWJseVJlbG9hZCArPSBPbkJlZm9yZVJlbG9hZDsKICAgICAgICBBcHBsaWNhdGlvbi5sb2dNZXNzYWdlUmVjZWl2ZWQgKz0g' +
	'T25Mb2dNZXNzYWdlOwogICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLnBsYXlNb2RlU3RhdGVDaGFuZ2VkICs9IE9uUGxheU1vZGVD' +
	'aGFuZ2VkOwogICAgICAgIFN0YXJ0U2VydmVyKCk7CiAgICB9CgogICAgLy8gLS0tIFNlcnZlciBMaWZlY3ljbGUgKFRjcExpc3Rl' +
	'bmVyICsgbWFudWFsIFdlYlNvY2tldCBoYW5kc2hha2UpIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIGFzeW5jIHZvaWQgU3RhcnRT' +
	'ZXJ2ZXIoKQogICAgewogICAgICAgIGlmIChfcnVubmluZykgcmV0dXJuOwoKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAg' +
	'ICAgIF9jdHMgPSBuZXcgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTsKCiAgICAgICAgICAgIC8vIEJpbmQgdG8gcG9ydCAwIGZv' +
	'ciBhdXRvLWFzc2lnbm1lbnQKICAgICAgICAgICAgX2xpc3RlbmVyID0gbmV3IFRjcExpc3RlbmVyKElQQWRkcmVzcy5Mb29wYmFj' +
	'aywgMCk7CiAgICAgICAgICAgIF9saXN0ZW5lci5TdGFydCgpOwogICAgICAgICAgICBfcG9ydCA9ICgoSVBFbmRQb2ludClfbGlz' +
	'dGVuZXIuTG9jYWxFbmRwb2ludCkuUG9ydDsKICAgICAgICAgICAgX3J1bm5pbmcgPSB0cnVlOwoKICAgICAgICAgICAgV3JpdGVE' +
	'aXNjb3ZlcnlGaWxlKCk7CiAgICAgICAgICAgIERlYnVnLkxvZygkIltHYW1lRGV2SURFIEJyaWRnZV0gU3RhcnRlZCBvbiBwb3J0' +
	'IHtfcG9ydH0gKHZ7UFJPVE9DT0xfVkVSU0lPTn0pIik7CgogICAgICAgICAgICAvLyBBY2NlcHQgY29ubmVjdGlvbnMgaW4gYmFj' +
	'a2dyb3VuZAogICAgICAgICAgICBhd2FpdCBBY2NlcHRDb25uZWN0aW9ucyhfY3RzLlRva2VuKTsKICAgICAgICB9CiAgICAgICAg' +
	'Y2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIERlYnVnLkxvZ0Vycm9yKCQiW0dhbWVEZXZJREUgQnJp' +
	'ZGdlXSBGYWlsZWQgdG8gc3RhcnQ6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICBfcnVubmluZyA9IGZhbHNlOwogICAgICAg' +
	'IH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIEFjY2VwdENvbm5lY3Rpb25zKENhbmNlbGxhdGlvblRva2Vu' +
	'IHRva2VuKQogICAgewogICAgICAgIHdoaWxlICghdG9rZW4uSXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQgJiYgX3J1bm5pbmcpCiAg' +
	'ICAgICAgewogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IGF3YWl0IF9s' +
	'aXN0ZW5lci5BY2NlcHRUY3BDbGllbnRBc3luYygpOwogICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9IGNsaWVudC5HZXRTdHJl' +
	'YW0oKTsKCiAgICAgICAgICAgICAgICAvLyBSZWFkIHRoZSBIVFRQIHVwZ3JhZGUgcmVxdWVzdAogICAgICAgICAgICAgICAgdmFy' +
	'IGJ1ZmZlciA9IG5ldyBieXRlWzQwOTZdOwogICAgICAgICAgICAgICAgaW50IGJ5dGVzUmVhZCA9IGF3YWl0IHN0cmVhbS5SZWFk' +
	'QXN5bmMoYnVmZmVyLCAwLCBidWZmZXIuTGVuZ3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IEVuY29k' +
	'aW5nLlVURjguR2V0U3RyaW5nKGJ1ZmZlciwgMCwgYnl0ZXNSZWFkKTsKCiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5Db250' +
	'YWlucygiVXBncmFkZTogd2Vic29ja2V0IikgfHwgcmVxdWVzdC5Db250YWlucygiVXBncmFkZTogV2ViU29ja2V0IikpCiAgICAg' +
	'ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBhbGxvdyBvbmUgY2xpZW50IGF0IGEgdGltZQogICAgICAg' +
	'ICAgICAgICAgICAgIGlmIChfY2xpZW50Q29ubmVjdGVkKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgdmFyIHJlamVjdCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoIkhUVFAvMS4xIDQwOSBDb25mbGljdFxyXG5cclxuIik7' +
	'CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHJlamVjdCwgMCwgcmVqZWN0Lkxlbmd0aCwg' +
	'dG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQuQ2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29u' +
	'dGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIFdlYlNvY2tldCBoYW5k' +
	'c2hha2UKICAgICAgICAgICAgICAgICAgICBpZiAoUGVyZm9ybVdlYlNvY2tldEhhbmRzaGFrZShzdHJlYW0sIHJlcXVlc3QpKQog' +
	'ICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RjcENsaWVudCA9IGNsaWVudDsKICAgICAgICAg' +
	'ICAgICAgICAgICAgICAgX2NsaWVudFN0cmVhbSA9IHN0cmVhbTsKICAgICAgICAgICAgICAgICAgICAgICAgX2NsaWVudENvbm5l' +
	'Y3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLkxvZygiW0dhbWVEZXZJREUgQnJpZGdlXSBJREUgY29u' +
	'bmVjdGVkIik7CgogICAgICAgICAgICAgICAgICAgICAgICBfID0gUmVjZWl2ZU1lc3NhZ2VzKHN0cmVhbSwgdG9rZW4pOwogICAg' +
	'ICAgICAgICAgICAgICAgICAgICBfID0gU2VuZE1lc3NhZ2VzKHN0cmVhbSwgdG9rZW4pOwogICAgICAgICAgICAgICAgICAgIH0K' +
	'ICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjbGll' +
	'bnQuQ2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAg' +
	'ICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2ltcGxlIGhlYWx0aCBjaGVjawogICAgICAgICAgICAgICAg' +
	'ICAgIHZhciBib2R5ID0gIntcInN0YXR1c1wiOlwib2tcIixcInZlcnNpb25cIjpcIiIgKyBQUk9UT0NPTF9WRVJTSU9OICsgIlwi' +
	'fSI7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gIkhUVFAvMS4xIDIwMCBPS1xyXG5Db250ZW50LVR5cGU6IGFw' +
	'cGxpY2F0aW9uL2pzb25cclxuQ29udGVudC1MZW5ndGg6ICIgKyBib2R5Lkxlbmd0aCArICJcclxuQ29ubmVjdGlvbjogY2xvc2Vc' +
	'clxuXHJcbiIgKyBib2R5OwogICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUJ5dGVzID0gRW5jb2RpbmcuVVRGOC5HZXRC' +
	'eXRlcyhyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3RyZWFtLldyaXRlQXN5bmMocmVzcG9uc2VCeXRlcywg' +
	'MCwgcmVzcG9uc2VCeXRlcy5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgICAgICBjbGllbnQuQ2xvc2UoKTsKICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoT2JqZWN0RGlzcG9zZWRFeGNlcHRpb24pIHsgYnJl' +
	'YWs7IH0KICAgICAgICAgICAgY2F0Y2ggKFNvY2tldEV4Y2VwdGlvbikgeyBicmVhazsgfQogICAgICAgICAgICBjYXRjaCAoRXhj' +
	'ZXB0aW9uIGV4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIXRva2VuLklzQ2FuY2VsbGF0aW9uUmVxdWVzdGVk' +
	'KQogICAgICAgICAgICAgICAgICAgIERlYnVnLkxvZ1dhcm5pbmcoJCJbR2FtZURldklERSBCcmlkZ2VdIENvbm5lY3Rpb24gZXJy' +
	'b3I6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGJvb2wg' +
	'UGVyZm9ybVdlYlNvY2tldEhhbmRzaGFrZShOZXR3b3JrU3RyZWFtIHN0cmVhbSwgc3RyaW5nIHJlcXVlc3QpCiAgICB7CiAgICAg' +
	'ICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICAvLyBFeHRyYWN0IFNlYy1XZWJTb2NrZXQtS2V5IGZyb20gdGhlIHJlcXVlc3Qg' +
	'aGVhZGVycwogICAgICAgICAgICB2YXIga2V5TWF0Y2ggPSBSZWdleC5NYXRjaChyZXF1ZXN0LCBAIlNlYy1XZWJTb2NrZXQtS2V5' +
	'OlxzKiguKz8pXHJcbiIpOwogICAgICAgICAgICBpZiAoIWtleU1hdGNoLlN1Y2Nlc3MpIHJldHVybiBmYWxzZTsKCiAgICAgICAg' +
	'ICAgIHZhciBrZXkgPSBrZXlNYXRjaC5Hcm91cHNbMV0uVmFsdWUuVHJpbSgpOwogICAgICAgICAgICB2YXIgYWNjZXB0S2V5ID0g' +
	'Q29udmVydC5Ub0Jhc2U2NFN0cmluZygKICAgICAgICAgICAgICAgIFNIQTEuQ3JlYXRlKCkuQ29tcHV0ZUhhc2goCiAgICAgICAg' +
	'ICAgICAgICAgICAgRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhrZXkgKyAiMjU4RUFGQTUtRTkxNC00N0RBLTk1Q0EtQzVBQjBEQzg1' +
	'QjExIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHZhciByZXNwb25zZSA9CiAgICAgICAg' +
	'ICAgICAgICAiSFRUUC8xLjEgMTAxIFN3aXRjaGluZyBQcm90b2NvbHNcclxuIiArCiAgICAgICAgICAgICAgICAiVXBncmFkZTog' +
	'd2Vic29ja2V0XHJcbiIgKwogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb246IFVwZ3JhZGVcclxuIiArCiAgICAgICAgICAgICAg' +
	'ICAiU2VjLVdlYlNvY2tldC1BY2NlcHQ6ICIgKyBhY2NlcHRLZXkgKyAiXHJcblxyXG4iOwoKICAgICAgICAgICAgdmFyIHJlc3Bv' +
	'bnNlQnl0ZXMgPSBFbmNvZGluZy5VVEY4LkdldEJ5dGVzKHJlc3BvbnNlKTsKICAgICAgICAgICAgc3RyZWFtLldyaXRlKHJlc3Bv' +
	'bnNlQnl0ZXMsIDAsIHJlc3BvbnNlQnl0ZXMuTGVuZ3RoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAg' +
	'ICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAgICAgICAgICBEZWJ1Zy5Mb2dXYXJuaW5nKCQiW0dhbWVEZXZJ' +
	'REUgQnJpZGdlXSBIYW5kc2hha2UgZmFpbGVkOiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg' +
	'ICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIFJlY2VpdmVNZXNzYWdlcyhOZXR3b3JrU3RyZWFtIHN0' +
	'cmVhbSwgQ2FuY2VsbGF0aW9uVG9rZW4gdG9rZW4pCiAgICB7CiAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBieXRlWzgxOTJdOwoK' +
	'ICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIHdoaWxlIChfY2xpZW50Q29ubmVjdGVkICYmICF0b2tlbi5Jc0NhbmNl' +
	'bGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCFzdHJlYW0uRGF0YUF2YWlsYWJsZSkK' +
	'ICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDgsIHRva2VuKTsKICAgICAgICAg' +
	'ICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbnQgYnl0ZXNSZWFkID0gYXdh' +
	'aXQgc3RyZWFtLlJlYWRBc3luYyhidWZmZXIsIDAsIGJ1ZmZlci5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgIGlmIChi' +
	'eXRlc1JlYWQgPT0gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURF' +
	'IEJyaWRnZV0gSURFIGRpc2Nvbm5lY3RlZCIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoK' +
	'ICAgICAgICAgICAgICAgIC8vIERlY29kZSBXZWJTb2NrZXQgZnJhbWUocykKICAgICAgICAgICAgICAgIGludCBvZmZzZXQgPSAw' +
	'OwogICAgICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IGJ5dGVzUmVhZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAg' +
	'ICAgICAgICB2YXIgZnJhbWUgPSBEZWNvZGVXZWJTb2NrZXRGcmFtZShidWZmZXIsIG9mZnNldCwgYnl0ZXNSZWFkIC0gb2Zmc2V0' +
	'KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUgPT0gbnVsbCkgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIG9mZnNl' +
	'dCArPSBmcmFtZS5Ub3RhbExlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1lLk9wY29kZSA9PSAweDgpIC8vIENs' +
	'b3NlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGNsb3NlIGZyYW1lIGJhY2sK' +
	'ICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsb3NlRnJhbWUgPSBuZXcgYnl0ZVtdIHsgMHg4OCwgMHgwMCB9OwogICAgICAg' +
	'ICAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYW0uV3JpdGVBc3luYyhjbG9zZUZyYW1lLCAwLCBjbG9zZUZyYW1lLkxlbmd0aCwg' +
	'dG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURFIEJyaWRnZV0gSURFIGRpc2Nvbm5l' +
	'Y3RlZCAoY2xvc2UgZnJhbWUpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIERpc2Nvbm5lY3RDbGllbnQoKTsKICAgICAgICAg' +
	'ICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1l' +
	'Lk9wY29kZSA9PSAweDkpIC8vIFBpbmcKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNl' +
	'bmQgcG9uZwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9uZyA9IEVuY29kZVdlYlNvY2tldEZyYW1lKGZyYW1lLlBheWxv' +
	'YWQsIDB4QSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHBvbmcsIDAsIHBvbmcuTGVu' +
	'Z3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAg' +
	'ICAgICAgICAgICAgICAgaWYgKGZyYW1lLk9wY29kZSA9PSAweDEgfHwgZnJhbWUuT3Bjb2RlID09IDB4MikgLy8gVGV4dCBvciBC' +
	'aW5hcnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gRW5jb2Rpbmcu' +
	'VVRGOC5HZXRTdHJpbmcoZnJhbWUuUGF5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pbmNvbWluZ01lc3NhZ2VzLkVu' +
	'cXVldWUobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg' +
	'ICAgfQogICAgICAgIGNhdGNoIChJT0V4Y2VwdGlvbikgeyAvKiBDbGllbnQgZGlzY29ubmVjdGVkICovIH0KICAgICAgICBjYXRj' +
	'aCAoT3BlcmF0aW9uQ2FuY2VsZWRFeGNlcHRpb24pIHsgLyogU2h1dHRpbmcgZG93biAqLyB9CiAgICAgICAgY2F0Y2ggKEV4Y2Vw' +
	'dGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIERlYnVnLkxvZ1dhcm5pbmcoJCJbR2FtZURldklERSBCcmlkZ2VdIFJlY2Vp' +
	'dmUgZXJyb3I6IHtleC5NZXNzYWdlfSIpOwogICAgICAgIH0KCiAgICAgICAgRGlzY29ubmVjdENsaWVudCgpOwogICAgfQoKICAg' +
	'IHByaXZhdGUgc3RhdGljIGFzeW5jIFRhc2sgU2VuZE1lc3NhZ2VzKE5ldHdvcmtTdHJlYW0gc3RyZWFtLCBDYW5jZWxsYXRpb25U' +
	'b2tlbiB0b2tlbikKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIHdoaWxlIChfY2xpZW50Q29ubmVjdGVk' +
	'ICYmICF0b2tlbi5Jc0NhbmNlbGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKF9vdXRn' +
	'b2luZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZhciBtZXNzYWdlKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'ICAgICB2YXIgcGF5bG9hZCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgdmFy' +
	'IGZyYW1lID0gRW5jb2RlV2ViU29ja2V0RnJhbWUocGF5bG9hZCwgMHgxKTsgLy8gVGV4dCBmcmFtZQogICAgICAgICAgICAgICAg' +
	'ICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKGZyYW1lLCAwLCBmcmFtZS5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAg' +
	'IH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRl' +
	'bGF5KDE2LCB0b2tlbik7IC8vIH42MEh6IHBvbGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg' +
	'ICAgICBjYXRjaCAoSU9FeGNlcHRpb24pIHsgfQogICAgICAgIGNhdGNoIChPcGVyYXRpb25DYW5jZWxlZEV4Y2VwdGlvbikgeyB9' +
	'CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBEaXNjb25uZWN0Q2xpZW50KCkKICAgIHsKICAgICAgICBfY2xpZW50Q29u' +
	'bmVjdGVkID0gZmFsc2U7CiAgICAgICAgdHJ5IHsgX2NsaWVudFN0cmVhbT8uQ2xvc2UoKTsgfSBjYXRjaCB7IH0KICAgICAgICB0' +
	'cnkgeyBfdGNwQ2xpZW50Py5DbG9zZSgpOyB9IGNhdGNoIHsgfQogICAgICAgIF9jbGllbnRTdHJlYW0gPSBudWxsOwogICAgICAg' +
	'IF90Y3BDbGllbnQgPSBudWxsOwogICAgfQoKICAgIC8vIC0tLSBXZWJTb2NrZXQgRnJhbWUgRW5jb2RpbmcvRGVjb2RpbmcgLS0t' +
	'CgogICAgcHJpdmF0ZSBjbGFzcyBXZWJTb2NrZXRGcmFtZQogICAgewogICAgICAgIHB1YmxpYyBieXRlIE9wY29kZTsKICAgICAg' +
	'ICBwdWJsaWMgYnl0ZVtdIFBheWxvYWQ7CiAgICAgICAgcHVibGljIGludCBUb3RhbExlbmd0aDsgLy8gVG90YWwgYnl0ZXMgY29u' +
	'c3VtZWQgZnJvbSBidWZmZXIKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBXZWJTb2NrZXRGcmFtZSBEZWNvZGVXZWJTb2NrZXRG' +
	'cmFtZShieXRlW10gYnVmZmVyLCBpbnQgb2Zmc2V0LCBpbnQgbGVuZ3RoKQogICAgewogICAgICAgIGlmIChsZW5ndGggPCAyKSBy' +
	'ZXR1cm4gbnVsbDsKCiAgICAgICAgdmFyIG9wY29kZSA9IChieXRlKShidWZmZXJbb2Zmc2V0XSAmIDB4MEYpOwogICAgICAgIHZh' +
	'ciBtYXNrZWQgPSAoYnVmZmVyW29mZnNldCArIDFdICYgMHg4MCkgIT0gMDsKICAgICAgICBsb25nIHBheWxvYWRMZW4gPSBidWZm' +
	'ZXJbb2Zmc2V0ICsgMV0gJiAweDdGOwogICAgICAgIGludCBoZWFkZXJMZW4gPSAyOwoKICAgICAgICBpZiAocGF5bG9hZExlbiA9' +
	'PSAxMjYpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgNCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHBheWxv' +
	'YWRMZW4gPSAoYnVmZmVyW29mZnNldCArIDJdIDw8IDgpIHwgYnVmZmVyW29mZnNldCArIDNdOwogICAgICAgICAgICBoZWFkZXJM' +
	'ZW4gPSA0OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwYXlsb2FkTGVuID09IDEyNykKICAgICAgICB7CiAgICAgICAgICAg' +
	'IGlmIChsZW5ndGggPCAxMCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHBheWxvYWRMZW4gPSAwOwogICAgICAgICAgICBmb3Ig' +
	'KGludCBpID0gMDsgaSA8IDg7IGkrKykKICAgICAgICAgICAgICAgIHBheWxvYWRMZW4gPSAocGF5bG9hZExlbiA8PCA4KSB8IGJ1' +
	'ZmZlcltvZmZzZXQgKyAyICsgaV07CiAgICAgICAgICAgIGhlYWRlckxlbiA9IDEwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZVtd' +
	'IG1hc2tLZXkgPSBudWxsOwogICAgICAgIGlmIChtYXNrZWQpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgaGVh' +
	'ZGVyTGVuICsgNCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIG1hc2tLZXkgPSBuZXcgYnl0ZVs0XTsKICAgICAgICAgICAgQXJy' +
	'YXkuQ29weShidWZmZXIsIG9mZnNldCArIGhlYWRlckxlbiwgbWFza0tleSwgMCwgNCk7CiAgICAgICAgICAgIGhlYWRlckxlbiAr' +
	'PSA0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGxlbmd0aCA8IGhlYWRlckxlbiArIHBheWxvYWRMZW4pIHJldHVybiBudWxsOwoK' +
	'ICAgICAgICB2YXIgcGF5bG9hZCA9IG5ldyBieXRlW3BheWxvYWRMZW5dOwogICAgICAgIEFycmF5LkNvcHkoYnVmZmVyLCBvZmZz' +
	'ZXQgKyBoZWFkZXJMZW4sIHBheWxvYWQsIDAsIChpbnQpcGF5bG9hZExlbik7CgogICAgICAgIGlmIChtYXNrZWQgJiYgbWFza0tl' +
	'eSAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXlsb2FkLkxlbmd0aDsgaSsrKQog' +
	'ICAgICAgICAgICAgICAgcGF5bG9hZFtpXSBePSBtYXNrS2V5W2kgJSA0XTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXcg' +
	'V2ViU29ja2V0RnJhbWUKICAgICAgICB7CiAgICAgICAgICAgIE9wY29kZSA9IG9wY29kZSwKICAgICAgICAgICAgUGF5bG9hZCA9' +
	'IHBheWxvYWQsCiAgICAgICAgICAgIFRvdGFsTGVuZ3RoID0gaGVhZGVyTGVuICsgKGludClwYXlsb2FkTGVuCiAgICAgICAgfTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBieXRlW10gRW5jb2RlV2ViU29ja2V0RnJhbWUoYnl0ZVtdIHBheWxvYWQsIGJ5dGUg' +
	'b3Bjb2RlKQogICAgewogICAgICAgIHZhciBsZW4gPSBwYXlsb2FkLkxlbmd0aDsKICAgICAgICBieXRlW10gZnJhbWU7CgogICAg' +
	'ICAgIGlmIChsZW4gPCAxMjYpCiAgICAgICAgewogICAgICAgICAgICBmcmFtZSA9IG5ldyBieXRlWzIgKyBsZW5dOwogICAgICAg' +
	'ICAgICBmcmFtZVswXSA9IChieXRlKSgweDgwIHwgb3Bjb2RlKTsgLy8gRklOICsgb3Bjb2RlCiAgICAgICAgICAgIGZyYW1lWzFd' +
	'ID0gKGJ5dGUpbGVuOwogICAgICAgICAgICBBcnJheS5Db3B5KHBheWxvYWQsIDAsIGZyYW1lLCAyLCBsZW4pOwogICAgICAgIH0K' +
	'ICAgICAgICBlbHNlIGlmIChsZW4gPCA2NTUzNikKICAgICAgICB7CiAgICAgICAgICAgIGZyYW1lID0gbmV3IGJ5dGVbNCArIGxl' +
	'bl07CiAgICAgICAgICAgIGZyYW1lWzBdID0gKGJ5dGUpKDB4ODAgfCBvcGNvZGUpOwogICAgICAgICAgICBmcmFtZVsxXSA9IDEy' +
	'NjsKICAgICAgICAgICAgZnJhbWVbMl0gPSAoYnl0ZSkobGVuID4+IDgpOwogICAgICAgICAgICBmcmFtZVszXSA9IChieXRlKShs' +
	'ZW4gJiAweEZGKTsKICAgICAgICAgICAgQXJyYXkuQ29weShwYXlsb2FkLCAwLCBmcmFtZSwgNCwgbGVuKTsKICAgICAgICB9CiAg' +
	'ICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgZnJhbWUgPSBuZXcgYnl0ZVsxMCArIGxlbl07CiAgICAgICAgICAgIGZy' +
	'YW1lWzBdID0gKGJ5dGUpKDB4ODAgfCBvcGNvZGUpOwogICAgICAgICAgICBmcmFtZVsxXSA9IDEyNzsKICAgICAgICAgICAgZm9y' +
	'IChpbnQgaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgICAgICBmcmFtZVsyICsgaV0gPSAoYnl0ZSkoKGxlbiA+PiAoNTYg' +
	'LSBpICogOCkpICYgMHhGRik7CiAgICAgICAgICAgIEFycmF5LkNvcHkocGF5bG9hZCwgMCwgZnJhbWUsIDEwLCBsZW4pOwogICAg' +
	'ICAgIH0KCiAgICAgICAgcmV0dXJuIGZyYW1lOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgV3JpdGVEaXNjb3ZlcnlG' +
	'aWxlKCkKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGlmICghRGlyZWN0b3J5LkV4aXN0cyhESVNDT1ZF' +
	'UllfRElSKSkKICAgICAgICAgICAgICAgIERpcmVjdG9yeS5DcmVhdGVEaXJlY3RvcnkoRElTQ09WRVJZX0RJUik7CgogICAgICAg' +
	'ICAgICB2YXIganNvbiA9ICQie3tcInBvcnRcIjp7X3BvcnR9LFwicGlkXCI6e1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLkdl' +
	'dEN1cnJlbnRQcm9jZXNzKCkuSWR9LFwidmVyc2lvblwiOlwie1BST1RPQ09MX1ZFUlNJT059XCIsXCJ0aW1lc3RhbXBcIjp7RGF0' +
	'ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVTZWNvbmRzKCl9fX0iOwogICAgICAgICAgICBGaWxlLldyaXRlQWxsVGV4dChE' +
	'SVNDT1ZFUllfRklMRSwganNvbik7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAg' +
	'ICAgICAgICBEZWJ1Zy5Mb2dFcnJvcigkIltHYW1lRGV2SURFIEJyaWRnZV0gRmFpbGVkIHRvIHdyaXRlIGRpc2NvdmVyeSBmaWxl' +
	'OiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTaHV0ZG93bigpCiAgICB7' +
	'CiAgICAgICAgX3J1bm5pbmcgPSBmYWxzZTsKICAgICAgICBfY3RzPy5DYW5jZWwoKTsKCiAgICAgICAgRGlzY29ubmVjdENsaWVu' +
	'dCgpOwoKICAgICAgICB0cnkgeyBfbGlzdGVuZXI/LlN0b3AoKTsgfQogICAgICAgIGNhdGNoIHsgfQoKICAgICAgICB0cnkgeyBp' +
	'ZiAoRmlsZS5FeGlzdHMoRElTQ09WRVJZX0ZJTEUpKSBGaWxlLkRlbGV0ZShESVNDT1ZFUllfRklMRSk7IH0KICAgICAgICBjYXRj' +
	'aCB7IH0KCiAgICAgICAgRGVidWcuTG9nKCJbR2FtZURldklERSBCcmlkZ2VdIFN0b3BwZWQiKTsKICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyB2b2lkIE9uQmVmb3JlUmVsb2FkKCkKICAgIHsKICAgICAgICAvLyBDbGVhbiB1cCBiZWZvcmUgZG9tYWluIHJlbG9h' +
	'ZCAoc2NyaXB0IHJlY29tcGlsYXRpb24pCiAgICAgICAgU2h1dGRvd24oKTsKICAgIH0KCiAgICAvLyAtLS0gVW5pdHkgRXZlbnQg' +
	'Rm9yd2FyZGluZyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIE9uTG9nTWVzc2FnZShzdHJpbmcgY29uZGl0aW9uLCBzdHJp' +
	'bmcgc3RhY2tUcmFjZSwgTG9nVHlwZSB0eXBlKQogICAgewogICAgICAgIGlmICghX2NsaWVudENvbm5lY3RlZCkgcmV0dXJuOwoK' +
	'ICAgICAgICB2YXIgbG9nVHlwZSA9IHR5cGUgc3dpdGNoCiAgICAgICAgewogICAgICAgICAgICBMb2dUeXBlLkVycm9yID0+ICJF' +
	'cnJvciIsCiAgICAgICAgICAgIExvZ1R5cGUuV2FybmluZyA9PiAiV2FybmluZyIsCiAgICAgICAgICAgIExvZ1R5cGUuRXhjZXB0' +
	'aW9uID0+ICJFeGNlcHRpb24iLAogICAgICAgICAgICBMb2dUeXBlLkFzc2VydCA9PiAiQXNzZXJ0IiwKICAgICAgICAgICAgXyA9' +
	'PiAiTG9nIgogICAgICAgIH07CgogICAgICAgIHZhciBldmVudEpzb24gPSAkInt7XCJpZFwiOlwie0d1aWQuTmV3R3VpZCgpfVwi' +
	'LFwidHlwZVwiOlwiZXZlbnRcIixcImV2ZW50XCI6XCJjb25zb2xlLmxvZ1wiLFwiZGF0YVwiOnt7XCJtZXNzYWdlXCI6e0VzY2Fw' +
	'ZUpzb24oY29uZGl0aW9uKX0sXCJzdGFja1RyYWNlXCI6e0VzY2FwZUpzb24oc3RhY2tUcmFjZSA/PyAiIil9LFwibG9nVHlwZVwi' +
	'Olwie2xvZ1R5cGV9XCIsXCJ0aW1lc3RhbXBcIjp7RGF0ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVNaWxsaXNlY29uZHMo' +
	'KX19fX19IjsKICAgICAgICBfb3V0Z29pbmdNZXNzYWdlcy5FbnF1ZXVlKGV2ZW50SnNvbik7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBPblBsYXlNb2RlQ2hhbmdlZChQbGF5TW9kZVN0YXRlQ2hhbmdlIHN0YXRlKQogICAgewogICAgICAgIGlmICgh' +
	'X2NsaWVudENvbm5lY3RlZCkgcmV0dXJuOwoKICAgICAgICB2YXIgcGxheVN0YXRlID0gc3RhdGUgc3dpdGNoCiAgICAgICAgewog' +
	'ICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkVudGVyZWRQbGF5TW9kZSA9PiAicGxheWluZyIsCiAgICAgICAgICAgIFBs' +
	'YXlNb2RlU3RhdGVDaGFuZ2UuRXhpdGluZ1BsYXlNb2RlID0+ICJzdG9wcGVkIiwKICAgICAgICAgICAgUGxheU1vZGVTdGF0ZUNo' +
	'YW5nZS5FbnRlcmVkRWRpdE1vZGUgPT4gInN0b3BwZWQiLAogICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkV4aXRpbmdF' +
	'ZGl0TW9kZSA9PiAicGxheWluZyIsCiAgICAgICAgICAgIF8gPT4gInN0b3BwZWQiCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGV2' +
	'ZW50SnNvbiA9ICQie3tcImlkXCI6XCJ7R3VpZC5OZXdHdWlkKCl9XCIsXCJ0eXBlXCI6XCJldmVudFwiLFwiZXZlbnRcIjpcInBs' +
	'YXlNb2RlQ2hhbmdlZFwiLFwiZGF0YVwiOnt7XCJzdGF0ZVwiOlwie3BsYXlTdGF0ZX1cIn19fX0iOwogICAgICAgIF9vdXRnb2lu' +
	'Z01lc3NhZ2VzLkVucXVldWUoZXZlbnRKc29uKTsKICAgIH0KCiAgICAvLyAtLS0gTWVzc2FnZSBQcm9jZXNzaW5nIChNYWluIFRo' +
	'cmVhZCkgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBQcm9jZXNzTWVzc2FnZXMoKQogICAgewogICAgICAgIC8vIFByb2Nl' +
	'c3MgdXAgdG8gMTAgbWVzc2FnZXMgcGVyIGZyYW1lIHRvIGF2b2lkIGJsb2NraW5nCiAgICAgICAgaW50IHByb2Nlc3NlZCA9IDA7' +
	'CiAgICAgICAgd2hpbGUgKF9pbmNvbWluZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZhciBtZXNzYWdlKSAmJiBwcm9jZXNzZWQg' +
	'PCAxMCkKICAgICAgICB7CiAgICAgICAgICAgIHByb2Nlc3NlZCsrOwogICAgICAgICAgICBzdHJpbmcgcmVxdWVzdElkID0gInVu' +
	'a25vd24iOwogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBQYXJzZVJl' +
	'cXVlc3QobWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXF1ZXN0SWQgPSByZXF1ZXN0LmlkOwogICAgICAgICAgICAgICAgdmFy' +
	'IHJlc3BvbnNlID0gSGFuZGxlQ29tbWFuZChyZXF1ZXN0KTsKICAgICAgICAgICAgICAgIF9vdXRnb2luZ01lc3NhZ2VzLkVucXVl' +
	'dWUocmVzcG9uc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgIHsK' +
	'ICAgICAgICAgICAgICAgIERlYnVnLkxvZ0Vycm9yKCQiW0dhbWVEZXZJREUgQnJpZGdlXSBFcnJvciBwcm9jZXNzaW5nIG1lc3Nh' +
	'Z2U6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICAgICAgX291dGdvaW5nTWVzc2FnZXMuRW5xdWV1ZShNYWtlRXJyb3IocmVx' +
	'dWVzdElkLCBleC5NZXNzYWdlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIDxzdW1tYXJ5PgogICAg' +
	'Ly8vIE1hbnVhbGx5IHBhcnNlIGEgSlNPTiByZXF1ZXN0IHNpbmNlIFVuaXR5J3MgSnNvblV0aWxpdHkgY2FuJ3QgaGFuZGxlCiAg' +
	'ICAvLy8gbmVzdGVkIGRpY3Rpb25hcmllcyBvciB0aGUgJ3BhcmFtcycgZmllbGQgcHJvcGVybHkuCiAgICAvLy8gPC9zdW1tYXJ5' +
	'PgogICAgcHJpdmF0ZSBzdGF0aWMgU2VyaWFsaXphYmxlUmVxdWVzdCBQYXJzZVJlcXVlc3Qoc3RyaW5nIGpzb24pCiAgICB7CiAg' +
	'ICAgICAgdmFyIHJlcSA9IG5ldyBTZXJpYWxpemFibGVSZXF1ZXN0KCk7CiAgICAgICAgcmVxLmlkID0gRXh0cmFjdEpzb25TdHJp' +
	'bmcoanNvbiwgImlkIikgPz8gR3VpZC5OZXdHdWlkKCkuVG9TdHJpbmcoKTsKICAgICAgICByZXEudHlwZSA9IEV4dHJhY3RKc29u' +
	'U3RyaW5nKGpzb24sICJ0eXBlIikgPz8gInJlcXVlc3QiOwogICAgICAgIHJlcS5jYXRlZ29yeSA9IEV4dHJhY3RKc29uU3RyaW5n' +
	'KGpzb24sICJjYXRlZ29yeSIpID8/ICIiOwogICAgICAgIHJlcS5hY3Rpb24gPSBFeHRyYWN0SnNvblN0cmluZyhqc29uLCAiYWN0' +
	'aW9uIikgPz8gIiI7CgogICAgICAgIC8vIEV4dHJhY3QgdGhlIHBhcmFtcyBvYmplY3QgYXMgYSByYXcgSlNPTiBzdWJzdHJpbmcK' +
	'ICAgICAgICB2YXIgcGFyYW1zSWR4ID0ganNvbi5JbmRleE9mKCJcInBhcmFtc1wiIik7CiAgICAgICAgaWYgKHBhcmFtc0lkeCA+' +
	'PSAwKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNvbG9uSWR4ID0ganNvbi5JbmRleE9mKCc6JywgcGFyYW1zSWR4KTsKICAg' +
	'ICAgICAgICAgaWYgKGNvbG9uSWR4ID49IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlcS5wYXJhbXNKc29uID0g' +
	'RXh0cmFjdEpzb25PYmplY3QoanNvbiwgY29sb25JZHggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0' +
	'dXJuIHJlcTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRXh0cmFjdEpzb25TdHJpbmcoc3RyaW5nIGpzb24sIHN0' +
	'cmluZyBrZXkpCiAgICB7CiAgICAgICAgdmFyIHBhdHRlcm4gPSAkIlwie2tleX1cIiI7CiAgICAgICAgdmFyIGlkeCA9IGpzb24u' +
	'SW5kZXhPZihwYXR0ZXJuKTsKICAgICAgICBpZiAoaWR4IDwgMCkgcmV0dXJuIG51bGw7CgogICAgICAgIHZhciBjb2xvbklkeCA9' +
	'IGpzb24uSW5kZXhPZignOicsIGlkeCArIHBhdHRlcm4uTGVuZ3RoKTsKICAgICAgICBpZiAoY29sb25JZHggPCAwKSByZXR1cm4g' +
	'bnVsbDsKCiAgICAgICAgLy8gU2tpcCB3aGl0ZXNwYWNlCiAgICAgICAgdmFyIHN0YXJ0SWR4ID0gY29sb25JZHggKyAxOwogICAg' +
	'ICAgIHdoaWxlIChzdGFydElkeCA8IGpzb24uTGVuZ3RoICYmIGNoYXIuSXNXaGl0ZVNwYWNlKGpzb25bc3RhcnRJZHhdKSkgc3Rh' +
	'cnRJZHgrKzsKCiAgICAgICAgaWYgKHN0YXJ0SWR4ID49IGpzb24uTGVuZ3RoIHx8IGpzb25bc3RhcnRJZHhdICE9ICciJykgcmV0' +
	'dXJuIG51bGw7CgogICAgICAgIC8vIFJlYWQgdW50aWwgY2xvc2luZyBxdW90ZSAoaGFuZGxpbmcgZXNjYXBlcykKICAgICAgICB2' +
	'YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGZvciAoaW50IGkgPSBzdGFydElkeCArIDE7IGkgPCBqc29uLkxl' +
	'bmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGpzb25baV0gPT0gJ1xcJyAmJiBpICsgMSA8IGpzb24uTGVuZ3Ro' +
	'KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzYi5BcHBlbmQoanNvbltpICsgMV0pOwogICAgICAgICAgICAgICAgaSsr' +
	'OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGpzb25baV0gPT0gJyInKQogICAgICAgICAgICB7CiAgICAgICAg' +
	'ICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'IHNiLkFwcGVuZChqc29uW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2IuVG9TdHJpbmcoKTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRXh0cmFjdEpzb25PYmplY3Qoc3RyaW5nIGpzb24sIGludCBzdGFydElk' +
	'eCkKICAgIHsKICAgICAgICAvLyBTa2lwIHdoaXRlc3BhY2UKICAgICAgICB3aGlsZSAoc3RhcnRJZHggPCBqc29uLkxlbmd0aCAm' +
	'JiBjaGFyLklzV2hpdGVTcGFjZShqc29uW3N0YXJ0SWR4XSkpIHN0YXJ0SWR4Kys7CiAgICAgICAgaWYgKHN0YXJ0SWR4ID49IGpz' +
	'b24uTGVuZ3RoIHx8IGpzb25bc3RhcnRJZHhdICE9ICd7JykgcmV0dXJuICJ7fSI7CgogICAgICAgIHZhciBkZXB0aCA9IDA7CiAg' +
	'ICAgICAgdmFyIGluU3RyaW5nID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0SWR4OyBpIDwganNvbi5MZW5ndGg7' +
	'IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChqc29uW2ldID09ICciJyAmJiAoaSA9PSAwIHx8IGpzb25baSAtIDFdICE9' +
	'ICdcXCcpKQogICAgICAgICAgICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7CiAgICAgICAgICAgIGVsc2UgaWYgKCFpblN0cmlu' +
	'ZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGpzb25baV0gPT0gJ3snKSBkZXB0aCsrOwogICAgICAgICAgICAg' +
	'ICAgZWxzZSBpZiAoanNvbltpXSA9PSAnfScpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTsK' +
	'ICAgICAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb24uU3Vi' +
	'c3RyaW5nKHN0YXJ0SWR4LCBpIC0gc3RhcnRJZHggKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg' +
	'IH0KICAgICAgICByZXR1cm4gInt9IjsKICAgIH0KCiAgICAvLyAtLS0gQ29tbWFuZCBEaXNwYXRjaCAtLS0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyBzdHJpbmcgSGFuZGxlQ29tbWFuZChTZXJpYWxpemFibGVSZXF1ZXN0IHJlcXVlc3QpCiAgICB7CiAgICAgICAgdmFy' +
	'IGtleSA9ICQie3JlcXVlc3QuY2F0ZWdvcnl9LntyZXF1ZXN0LmFjdGlvbn0iOwogICAgICAgIHZhciBwID0gcmVxdWVzdC5HZXRQ' +
	'YXJhbXMoKTsKCiAgICAgICAgc3dpdGNoIChrZXkpCiAgICAgICAgewogICAgICAgICAgICAvLyAtLS0gU2NlbmUgLS0tCiAgICAg' +
	'ICAgICAgIGNhc2UgInNjZW5lLmdldEFjdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlR2V0QWN0aXZlU2NlbmUo' +
	'cmVxdWVzdC5pZCk7CiAgICAgICAgICAgIGNhc2UgInNjZW5lLmdldEhpZXJhcmNoeSI6CiAgICAgICAgICAgICAgICByZXR1cm4g' +
	'SGFuZGxlR2V0SGllcmFyY2h5KHJlcXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJzY2VuZS5jcmVhdGUiOgogICAgICAgICAg' +
	'ICAgICAgcmV0dXJuIEhhbmRsZUNyZWF0ZVNjZW5lKHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJzY2VuZS5zYXZl' +
	'IjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTYXZlU2NlbmUocmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0g' +
	'R2FtZU9iamVjdCAtLS0KICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5jcmVhdGUiOgogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IEhhbmRsZUNyZWF0ZUdhbWVPYmplY3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuY3JlYXRl' +
	'UHJpbWl0aXZlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVDcmVhdGVQcmltaXRpdmUocmVxdWVzdC5pZCwgcCk7CiAg' +
	'ICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZmluZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlRmluZEdhbWVPYmpl' +
	'Y3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZGVzdHJveSI6CiAgICAgICAgICAgICAgICBy' +
	'ZXR1cm4gSGFuZGxlRGVzdHJveUdhbWVPYmplY3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3Qu' +
	'c2V0QWN0aXZlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRBY3RpdmUocmVxdWVzdC5pZCwgcCk7CiAgICAgICAg' +
	'ICAgIGNhc2UgImdhbWVPYmplY3Quc2V0VHJhbnNmb3JtIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRUcmFuc2Zv' +
	'cm0ocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZ2V0U2VsZWN0ZWQiOgogICAgICAgICAgICAg' +
	'ICAgcmV0dXJuIEhhbmRsZUdldFNlbGVjdGVkKHJlcXVlc3QuaWQpOwoKICAgICAgICAgICAgLy8gLS0tIENvbXBvbmVudCAtLS0K' +
	'ICAgICAgICAgICAgY2FzZSAiY29tcG9uZW50LmFkZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQWRkQ29tcG9uZW50' +
	'KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJjb21wb25lbnQucmVtb3ZlIjoKICAgICAgICAgICAgICAgIHJldHVy' +
	'biBIYW5kbGVSZW1vdmVDb21wb25lbnQocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImNvbXBvbmVudC5nZXRBbGwi' +
	'OgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldENvbXBvbmVudHMocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNh' +
	'c2UgImNvbXBvbmVudC5zZXRQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlU2V0UHJvcGVydHkocmVxdWVz' +
	'dC5pZCwgcCk7CgogICAgICAgICAgICAvLyAtLS0gUHJlZmFiIC0tLQogICAgICAgICAgICBjYXNlICJwcmVmYWIuY3JlYXRlIjoK' +
	'ICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVDcmVhdGVQcmVmYWIocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2Ug' +
	'InByZWZhYi5pbnN0YW50aWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlSW5zdGFudGlhdGVQcmVmYWIocmVxdWVz' +
	'dC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgInByZWZhYi5nZXRBbGwiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdl' +
	'dEFsbFByZWZhYnMocmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0gQXNzZXQgLS0tCiAgICAgICAgICAgIGNhc2UgImFz' +
	'c2V0LmNyZWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlQXNzZXQocmVxdWVzdC5pZCwgcCk7CiAgICAg' +
	'ICAgICAgIGNhc2UgImFzc2V0LmZpbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUZpbmRBc3NldHMocmVxdWVzdC5p' +
	'ZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImFzc2V0LmltcG9ydCI6CiAgICAgICAgICAgICAgICBBc3NldERhdGFiYXNlLlJlZnJl' +
	'c2goKTsKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAie30iKTsKCiAgICAgICAgICAgIC8v' +
	'IC0tLSBQcm9qZWN0IC0tLQogICAgICAgICAgICBjYXNlICJwcm9qZWN0LmdldEluZm8iOgogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IEhhbmRsZUdldFByb2plY3RJbmZvKHJlcXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJwcm9qZWN0LnJlZnJlc2giOgogICAg' +
	'ICAgICAgICAgICAgQXNzZXREYXRhYmFzZS5SZWZyZXNoKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVx' +
	'dWVzdC5pZCwgInt9Iik7CgogICAgICAgICAgICAvLyAtLS0gRWRpdG9yIC0tLQogICAgICAgICAgICBjYXNlICJlZGl0b3IuZ2V0' +
	'UGxheU1vZGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldFBsYXlNb2RlKHJlcXVlc3QuaWQpOwogICAgICAgICAg' +
	'ICBjYXNlICJlZGl0b3IucGxheSI6CiAgICAgICAgICAgICAgICBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcgPSB0cnVlOwog' +
	'ICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7XCJzdGF0ZVwiOlwicGxheWluZ1wifSIpOwog' +
	'ICAgICAgICAgICBjYXNlICJlZGl0b3IucGF1c2UiOgogICAgICAgICAgICAgICAgRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQg' +
	'PSAhRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVxdWVzdC5p' +
	'ZCwgJCJ7e1wicGF1c2VkXCI6e0VkaXRvckFwcGxpY2F0aW9uLmlzUGF1c2VkLlRvU3RyaW5nKCkuVG9Mb3dlcigpfX19Iik7CiAg' +
	'ICAgICAgICAgIGNhc2UgImVkaXRvci5zdG9wIjoKICAgICAgICAgICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLmlzUGxheWluZyA9' +
	'IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7XCJzdGF0ZVwiOlwic3RvcHBl' +
	'ZFwifSIpOwogICAgICAgICAgICBjYXNlICJlZGl0b3IuZXhlY3V0ZU1lbnVJdGVtIjoKICAgICAgICAgICAgICAgIHJldHVybiBI' +
	'YW5kbGVFeGVjdXRlTWVudUl0ZW0ocmVxdWVzdC5pZCwgcCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg' +
	'cmV0dXJuIE1ha2VFcnJvcihyZXF1ZXN0LmlkLCAkIlVua25vd24gY29tbWFuZDoge2tleX0iKTsKICAgICAgICB9CiAgICB9Cgog' +
	'ICAgLy8gLS0tIFNjZW5lIEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRBY3RpdmVTY2Vu' +
	'ZShzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5lKCk7CiAgICAg' +
	'ICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oc2NlbmUubmFtZSl9LFwicGF0aFwiOntF' +
	'c2NhcGVKc29uKHNjZW5lLnBhdGgpfSxcInJvb3RDb3VudFwiOntzY2VuZS5yb290Q291bnR9LFwiaXNEaXJ0eVwiOntzY2VuZS5p' +
	'c0RpcnR5LlRvU3RyaW5nKCkuVG9Mb3dlcigpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdl' +
	'dEhpZXJhcmNoeShzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5l' +
	'KCk7CiAgICAgICAgdmFyIHJvb3RzID0gc2NlbmUuR2V0Um9vdEdhbWVPYmplY3RzKCk7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0' +
	'cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcInNjZW5lXCI6Iik7CiAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpz' +
	'b24oc2NlbmUubmFtZSkpOwogICAgICAgIHNiLkFwcGVuZCgiLFwiaGllcmFyY2h5XCI6WyIpOwogICAgICAgIGZvciAoaW50IGkg' +
	'PSAwOyBpIDwgcm9vdHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIp' +
	'OwogICAgICAgICAgICBCdWlsZEhpZXJhcmNoeUpzb24ocm9vdHNbaV0sIHNiKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5k' +
	'KCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBCdWlsZEhpZXJhcmNoeUpzb24oR2FtZU9iamVjdCBnbywgU3RyaW5nQnVpbGRlciBzYikKICAgIHsKICAgICAg' +
	'ICBzYi5BcHBlbmQoIntcIm5hbWVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihnby5uYW1lKSk7CiAgICAgICAg' +
	'c2IuQXBwZW5kKCIsXCJhY3RpdmVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoZ28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93' +
	'ZXIoKSk7CiAgICAgICAgc2IuQXBwZW5kKCIsXCJjb21wb25lbnRzXCI6WyIpOwogICAgICAgIHZhciBjb21wb25lbnRzID0gZ28u' +
	'R2V0Q29tcG9uZW50czxDb21wb25lbnQ+KCk7CiAgICAgICAgZm9yIChpbnQgYyA9IDA7IGMgPCBjb21wb25lbnRzLkxlbmd0aDsg' +
	'YysrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGNvbXBvbmVudHNbY10gPT0gbnVsbCkgY29udGludWU7CiAgICAgICAgICAg' +
	'IGlmIChjID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKGNvbXBvbmVudHNbY10u' +
	'R2V0VHlwZSgpLk5hbWUpKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCJdLFwiY2hpbGRyZW5cIjpbIik7CiAgICAgICAg' +
	'Zm9yIChpbnQgaSA9IDA7IGkgPCBnby50cmFuc2Zvcm0uY2hpbGRDb3VudDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYg' +
	'KGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgQnVpbGRIaWVyYXJjaHlKc29uKGdvLnRyYW5zZm9ybS5HZXRDaGls' +
	'ZChpKS5nYW1lT2JqZWN0LCBzYik7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgiXX0iKTsKICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRlU2NlbmUoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQog' +
	'ICAgewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgibmFtZSIsICJOZXcgU2NlbmUiKTsKICAgICAgICB2' +
	'YXIgc2NlbmUgPSBFZGl0b3JTY2VuZU1hbmFnZXIuTmV3U2NlbmUoTmV3U2NlbmVTZXR1cC5EZWZhdWx0R2FtZU9iamVjdHMsIE5l' +
	'd1NjZW5lTW9kZS5TaW5nbGUpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJwYXRoIiwgb3V0IHZhciBwYXRoKSkKICAgICAg' +
	'ICB7CiAgICAgICAgICAgIEVkaXRvclNjZW5lTWFuYWdlci5TYXZlU2NlbmUoc2NlbmUsIHBhdGgpOwogICAgICAgIH0KICAgICAg' +
	'ICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0Vz' +
	'Y2FwZUpzb24oc2NlbmUucGF0aCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlU2F2ZVNjZW5l' +
	'KHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2YXIgc2NlbmUgPSBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKTsKICAgICAg' +
	'ICBFZGl0b3JTY2VuZU1hbmFnZXIuU2F2ZVNjZW5lKHNjZW5lKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tc' +
	'Im5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0VzY2FwZUpzb24oc2NlbmUucGF0aCl9fX0iKTsKICAg' +
	'IH0KCiAgICAvLyAtLS0gR2FtZU9iamVjdCBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3Jl' +
	'YXRlR2FtZU9iamVjdChzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5h' +
	'bWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJuYW1lIiwgIkdhbWVPYmplY3QiKTsKICAgICAgICB2YXIgZ28gPSBuZXcgR2FtZU9i' +
	'amVjdChuYW1lKTsKCiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInBhcmVudFBhdGgiLCBvdXQgdmFyIHBhcmVudFBhdGgpICYm' +
	'ICFzdHJpbmcuSXNOdWxsT3JFbXB0eShwYXJlbnRQYXRoKSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBGaW5k' +
	'R2FtZU9iamVjdEJ5UGF0aChwYXJlbnRQYXRoKTsKICAgICAgICAgICAgaWYgKHBhcmVudCAhPSBudWxsKQogICAgICAgICAgICAg' +
	'ICAgZ28udHJhbnNmb3JtLlNldFBhcmVudChwYXJlbnQudHJhbnNmb3JtLCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBVbmRv' +
	'LlJlZ2lzdGVyQ3JlYXRlZE9iamVjdFVuZG8oZ28sICQiQ3JlYXRlIHtuYW1lfSIpOwogICAgICAgIFNlbGVjdGlvbi5hY3RpdmVH' +
	'YW1lT2JqZWN0ID0gZ287CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28u' +
	'bmFtZSl9LFwiaW5zdGFuY2VJZFwiOntnby5HZXRJbnN0YW5jZUlEKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBz' +
	'dHJpbmcgSGFuZGxlQ3JlYXRlUHJpbWl0aXZlKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsK' +
	'ICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiUHJpbWl0aXZlIik7CiAgICAgICAgdmFyIHR5' +
	'cGVTdHIgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJwcmltaXRpdmVUeXBlIiwgIkN1YmUiKTsKCiAgICAgICAgaWYgKCFFbnVtLlRy' +
	'eVBhcnNlPFByaW1pdGl2ZVR5cGU+KHR5cGVTdHIsIHRydWUsIG91dCB2YXIgcHJpbWl0aXZlVHlwZSkpCiAgICAgICAgICAgIHJl' +
	'dHVybiBNYWtlRXJyb3IoaWQsICQiVW5rbm93biBwcmltaXRpdmUgdHlwZToge3R5cGVTdHJ9LiBWYWxpZDogU3BoZXJlLCBDYXBz' +
	'dWxlLCBDeWxpbmRlciwgQ3ViZSwgUGxhbmUsIFF1YWQiKTsKCiAgICAgICAgdmFyIGdvID0gR2FtZU9iamVjdC5DcmVhdGVQcmlt' +
	'aXRpdmUocHJpbWl0aXZlVHlwZSk7CiAgICAgICAgZ28ubmFtZSA9IG5hbWU7CgogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJw' +
	'YXJlbnRQYXRoIiwgb3V0IHZhciBwYXJlbnRQYXRoKSAmJiAhc3RyaW5nLklzTnVsbE9yRW1wdHkocGFyZW50UGF0aCkpCiAgICAg' +
	'ICAgewogICAgICAgICAgICB2YXIgcGFyZW50ID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGFyZW50UGF0aCk7CiAgICAgICAgICAg' +
	'IGlmIChwYXJlbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5TZXRQYXJlbnQocGFyZW50LnRyYW5zZm9y' +
	'bSwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgVW5kby5SZWdpc3RlckNyZWF0ZWRPYmplY3RVbmRvKGdvLCAkIkNyZWF0ZSB7' +
	'bmFtZX0iKTsKICAgICAgICBTZWxlY3Rpb24uYWN0aXZlR2FtZU9iamVjdCA9IGdvOwogICAgICAgIHJldHVybiBNYWtlU3VjY2Vz' +
	'cyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImluc3RhbmNlSWRcIjp7Z28uR2V0SW5zdGFuY2VJRCgp' +
	'fX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUZpbmRHYW1lT2JqZWN0KHN0cmluZyBpZCwgRGlj' +
	'dGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5h' +
	'bWUiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgobmFtZSk7CiAgICAgICAgaWYgKGdvID09IG51' +
	'bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtuYW1lfSIpOwoKICAg' +
	'ICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJpbnN0YW5jZUlk' +
	'XCI6e2dvLkdldEluc3RhbmNlSUQoKX0sXCJhY3RpdmVcIjp7Z28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93ZXIoKX19fSIp' +
	'OwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVEZXN0cm95R2FtZU9iamVjdChzdHJpbmcgaWQsIERpY3Rp' +
	'b25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1l' +
	'T2JqZWN0UGF0aCIsIHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiIikpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2Jq' +
	'ZWN0QnlQYXRoKG5hbWUpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAk' +
	'IkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7bmFtZX0iKTsKCiAgICAgICAgVW5kby5EZXN0cm95T2JqZWN0SW1tZWRpYXRlKGdvKTsK' +
	'ICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICJ7fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5k' +
	'bGVTZXRBY3RpdmUoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRo' +
	'ID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmpl' +
	'Y3RCeVBhdGgocGF0aCk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQi' +
	'R2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRofSIpOwoKICAgICAgICB2YXIgYWN0aXZlID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgi' +
	'YWN0aXZlIiwgInRydWUiKSA9PSAidHJ1ZSI7CiAgICAgICAgVW5kby5SZWNvcmRPYmplY3QoZ28sICQiU2V0IEFjdGl2ZSB7Z28u' +
	'bmFtZX0iKTsKICAgICAgICBnby5TZXRBY3RpdmUoYWN0aXZlKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tc' +
	'Im5hbWVcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJhY3RpdmVcIjp7Z28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93ZXIo' +
	'KX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVTZXRUcmFuc2Zvcm0oc3RyaW5nIGlkLCBEaWN0' +
	'aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2Ft' +
	'ZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAgICAgICAgaWYg' +
	'KGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRo' +
	'fSIpOwoKICAgICAgICBVbmRvLlJlY29yZE9iamVjdChnby50cmFuc2Zvcm0sICQiVHJhbnNmb3JtIHtnby5uYW1lfSIpOwoKICAg' +
	'ICAgICBpZiAocC5UcnlHZXRWYWx1ZSgicG9zaXRpb24iLCBvdXQgdmFyIHBvc1N0cikpCiAgICAgICAgICAgIGdvLnRyYW5zZm9y' +
	'bS5wb3NpdGlvbiA9IFBhcnNlVmVjdG9yMyhwb3NTdHIpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJyb3RhdGlvbiIsIG91' +
	'dCB2YXIgcm90U3RyKSkKICAgICAgICAgICAgZ28udHJhbnNmb3JtLmV1bGVyQW5nbGVzID0gUGFyc2VWZWN0b3IzKHJvdFN0cik7' +
	'CiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInNjYWxlIiwgb3V0IHZhciBzY2FsZVN0cikpCiAgICAgICAgICAgIGdvLnRyYW5z' +
	'Zm9ybS5sb2NhbFNjYWxlID0gUGFyc2VWZWN0b3IzKHNjYWxlU3RyKTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAk' +
	'Int7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwicG9zaXRpb25cIjpcIntnby50cmFuc2Zvcm0ucG9zaXRpb259XCIs' +
	'XCJyb3RhdGlvblwiOlwie2dvLnRyYW5zZm9ybS5ldWxlckFuZ2xlc31cIixcInNjYWxlXCI6XCJ7Z28udHJhbnNmb3JtLmxvY2Fs' +
	'U2NhbGV9XCJ9fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRTZWxlY3RlZChzdHJpbmcgaWQp' +
	'CiAgICB7CiAgICAgICAgdmFyIHNlbGVjdGVkID0gU2VsZWN0aW9uLmdhbWVPYmplY3RzOwogICAgICAgIHZhciBzYiA9IG5ldyBT' +
	'dHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJzZWxlY3RlZFwiOlsiKTsKICAgICAgICBmb3IgKGludCBpID0g' +
	'MDsgaSA8IHNlbGVjdGVkLkxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwi' +
	'KTsKICAgICAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24oc2VsZWN0ZWRbaV0ubmFtZSkpOwogICAgICAgIH0KICAgICAgICBz' +
	'Yi5BcHBlbmQoIl19Iik7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICAv' +
	'LyAtLS0gQ29tcG9uZW50IEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVBZGRDb21wb25lbnQo' +
	'c3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1' +
	'ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0' +
	'aCk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBu' +
	'b3QgZm91bmQ6IHtwYXRofSIpOwoKICAgICAgICB2YXIgdHlwZU5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJjb21wb25lbnRU' +
	'eXBlIiwgIiIpOwogICAgICAgIHZhciB0eXBlID0gRmluZENvbXBvbmVudFR5cGUodHlwZU5hbWUpOwogICAgICAgIGlmICh0eXBl' +
	'ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiQ29tcG9uZW50IHR5cGUgbm90IGZvdW5kOiB7dHlw' +
	'ZU5hbWV9Iik7CgogICAgICAgIFVuZG8uQWRkQ29tcG9uZW50KGdvLCB0eXBlKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3Mo' +
	'aWQsICQie3tcImdhbWVPYmplY3RcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJjb21wb25lbnRcIjp7RXNjYXBlSnNvbih0eXBl' +
	'Lk5hbWUpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZVJlbW92ZUNvbXBvbmVudChzdHJpbmcg' +
	'aWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZh' +
	'dWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChwYXRoKTsKICAg' +
	'ICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3Vu' +
	'ZDoge3BhdGh9Iik7CgogICAgICAgIHZhciB0eXBlTmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImNvbXBvbmVudFR5cGUiLCAi' +
	'Iik7CiAgICAgICAgdmFyIGNvbXAgPSBnby5HZXRDb21wb25lbnQodHlwZU5hbWUpOwogICAgICAgIGlmIChjb21wID09IG51bGwp' +
	'CiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiQ29tcG9uZW50IG5vdCBmb3VuZDoge3R5cGVOYW1lfSBvbiB7Z28u' +
	'bmFtZX0iKTsKCiAgICAgICAgVW5kby5EZXN0cm95T2JqZWN0SW1tZWRpYXRlKGNvbXApOwogICAgICAgIHJldHVybiBNYWtlU3Vj' +
	'Y2VzcyhpZCwgInt9Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldENvbXBvbmVudHMoc3RyaW5n' +
	'IGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVm' +
	'YXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgocGF0aCk7CiAg' +
	'ICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91' +
	'bmQ6IHtwYXRofSIpOwoKICAgICAgICB2YXIgY29tcG9uZW50cyA9IGdvLkdldENvbXBvbmVudHM8Q29tcG9uZW50PigpOwogICAg' +
	'ICAgIHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJjb21wb25lbnRzXCI6WyIpOwog' +
	'ICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29tcG9uZW50cy5MZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlm' +
	'IChjb21wb25lbnRzW2ldID09IG51bGwpIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIpOwog' +
	'ICAgICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihjb21wb25lbnRzW2ldLkdldFR5cGUoKS5OYW1lKSk7CiAgICAgICAgfQog' +
	'ICAgICAgIHNiLkFwcGVuZCgiXX0iKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsIHNiLlRvU3RyaW5nKCkpOwogICAg' +
	'fQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVTZXRQcm9wZXJ0eShzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5n' +
	'LCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIs' +
	'ICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkK' +
	'ICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAg' +
	'IHZhciB0eXBlTmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImNvbXBvbmVudFR5cGUiLCAiIik7CiAgICAgICAgdmFyIGNvbXAg' +
	'PSBnby5HZXRDb21wb25lbnQodHlwZU5hbWUpOwogICAgICAgIGlmIChjb21wID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBN' +
	'YWtlRXJyb3IoaWQsICQiQ29tcG9uZW50IG5vdCBmb3VuZDoge3R5cGVOYW1lfSBvbiB7Z28ubmFtZX0iKTsKCiAgICAgICAgdmFy' +
	'IHByb3BOYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgicHJvcGVydHlOYW1lIiwgIiIpOwogICAgICAgIHZhciB2YWx1ZVN0ciA9' +
	'IHAuR2V0VmFsdWVPckRlZmF1bHQoInZhbHVlIiwgIiIpOwoKICAgICAgICBVbmRvLlJlY29yZE9iamVjdChjb21wLCAkIlNldCB7' +
	'cHJvcE5hbWV9IG9uIHtnby5uYW1lfSIpOwoKICAgICAgICAvLyBUcnkgc2V0dGluZyB2aWEgU2VyaWFsaXplZE9iamVjdCBmb3Ig' +
	'cHJvcGVyIHVuZG8gc3VwcG9ydAogICAgICAgIHZhciBzbyA9IG5ldyBTZXJpYWxpemVkT2JqZWN0KGNvbXApOwogICAgICAgIHZh' +
	'ciBwcm9wID0gc28uRmluZFByb3BlcnR5KHByb3BOYW1lKTsKICAgICAgICBpZiAocHJvcCAhPSBudWxsKQogICAgICAgIHsKICAg' +
	'ICAgICAgICAgU2V0U2VyaWFsaXplZFByb3BlcnR5VmFsdWUocHJvcCwgdmFsdWVTdHIpOwogICAgICAgICAgICBzby5BcHBseU1v' +
	'ZGlmaWVkUHJvcGVydGllcygpOwogICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInByb3BlcnR5XCI6e0Vz' +
	'Y2FwZUpzb24ocHJvcE5hbWUpfSxcInNldFwiOnRydWV9fSIpOwogICAgICAgIH0KCiAgICAgICAgLy8gRmFsbGJhY2s6IHJlZmxl' +
	'Y3Rpb24gd2l0aCBzbWFydCB0eXBlIGNvbnZlcnNpb24KICAgICAgICB2YXIgZmllbGQgPSBjb21wLkdldFR5cGUoKS5HZXRGaWVs' +
	'ZChwcm9wTmFtZSwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuSW5z' +
	'dGFuY2UpOwogICAgICAgIGlmIChmaWVsZCAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNvbnZlcnRlZCA9IFNt' +
	'YXJ0Q29udmVydCh2YWx1ZVN0ciwgZmllbGQuRmllbGRUeXBlKTsKICAgICAgICAgICAgZmllbGQuU2V0VmFsdWUoY29tcCwgY29u' +
	'dmVydGVkKTsKICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJwcm9wZXJ0eVwiOntFc2NhcGVKc29uKHBy' +
	'b3BOYW1lKX0sXCJzZXRcIjp0cnVlfX0iKTsKICAgICAgICB9CgogICAgICAgIHZhciBwcm9wZXJ0eSA9IGNvbXAuR2V0VHlwZSgp' +
	'LkdldFByb3BlcnR5KHByb3BOYW1lLCBCaW5kaW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLkluc3RhbmNlKTsKICAgICAg' +
	'ICBpZiAocHJvcGVydHkgIT0gbnVsbCAmJiBwcm9wZXJ0eS5DYW5Xcml0ZSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBjb252' +
	'ZXJ0ZWQgPSBTbWFydENvbnZlcnQodmFsdWVTdHIsIHByb3BlcnR5LlByb3BlcnR5VHlwZSk7CiAgICAgICAgICAgIHByb3BlcnR5' +
	'LlNldFZhbHVlKGNvbXAsIGNvbnZlcnRlZCk7CiAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wicHJvcGVy' +
	'dHlcIjp7RXNjYXBlSnNvbihwcm9wTmFtZSl9LFwic2V0XCI6dHJ1ZX19Iik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gTWFr' +
	'ZUVycm9yKGlkLCAkIlByb3BlcnR5IG5vdCBmb3VuZDoge3Byb3BOYW1lfSBvbiB7dHlwZU5hbWV9Iik7CiAgICB9CgogICAgLy8g' +
	'LS0tIFByZWZhYiBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRlUHJlZmFiKHN0cmlu' +
	'ZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgZ29QYXRoID0gcC5HZXRWYWx1ZU9y' +
	'RGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gRmluZEdhbWVPYmplY3RCeVBhdGgoZ29QYXRo' +
	'KTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5v' +
	'dCBmb3VuZDoge2dvUGF0aH0iKTsKCiAgICAgICAgdmFyIGFzc2V0UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImFzc2V0UGF0' +
	'aCIsICQiQXNzZXRzL1ByZWZhYnMve2dvLm5hbWV9LnByZWZhYiIpOwoKICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0' +
	'cwogICAgICAgIHZhciBkaXIgPSBQYXRoLkdldERpcmVjdG9yeU5hbWUoYXNzZXRQYXRoKTsKICAgICAgICBpZiAoIXN0cmluZy5J' +
	'c051bGxPckVtcHR5KGRpcikgJiYgIUFzc2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihkaXIpKQogICAgICAgIHsKICAgICAgICAg' +
	'ICAgQ3JlYXRlRm9sZGVyUmVjdXJzaXZlKGRpcik7CiAgICAgICAgfQoKICAgICAgICB2YXIgcHJlZmFiID0gUHJlZmFiVXRpbGl0' +
	'eS5TYXZlQXNQcmVmYWJBc3NldChnbywgYXNzZXRQYXRoKTsKICAgICAgICBpZiAocHJlZmFiID09IG51bGwpCiAgICAgICAgICAg' +
	'IHJldHVybiBNYWtlRXJyb3IoaWQsICQiRmFpbGVkIHRvIGNyZWF0ZSBwcmVmYWIgYXQge2Fzc2V0UGF0aH0iKTsKCiAgICAgICAg' +
	'cmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJwYXRoXCI6e0VzY2FwZUpzb24oYXNzZXRQYXRoKX0sXCJuYW1lXCI6e0VzY2Fw' +
	'ZUpzb24ocHJlZmFiLm5hbWUpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUluc3RhbnRpYXRl' +
	'UHJlZmFiKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcHJlZmFiUGF0' +
	'aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoInByZWZhYlBhdGgiLCAiIik7CiAgICAgICAgdmFyIHByZWZhYiA9IEFzc2V0RGF0YWJh' +
	'c2UuTG9hZEFzc2V0QXRQYXRoPEdhbWVPYmplY3Q+KHByZWZhYlBhdGgpOwogICAgICAgIGlmIChwcmVmYWIgPT0gbnVsbCkKICAg' +
	'ICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJQcmVmYWIgbm90IGZvdW5kIGF0OiB7cHJlZmFiUGF0aH0iKTsKCiAgICAg' +
	'ICAgdmFyIGluc3RhbmNlID0gKEdhbWVPYmplY3QpUHJlZmFiVXRpbGl0eS5JbnN0YW50aWF0ZVByZWZhYihwcmVmYWIpOwogICAg' +
	'ICAgIFVuZG8uUmVnaXN0ZXJDcmVhdGVkT2JqZWN0VW5kbyhpbnN0YW5jZSwgJCJJbnN0YW50aWF0ZSB7cHJlZmFiLm5hbWV9Iik7' +
	'CiAgICAgICAgU2VsZWN0aW9uLmFjdGl2ZUdhbWVPYmplY3QgPSBpbnN0YW5jZTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNz' +
	'KGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oaW5zdGFuY2UubmFtZSl9LFwiaW5zdGFuY2VJZFwiOntpbnN0YW5jZS5HZXRJ' +
	'bnN0YW5jZUlEKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0QWxsUHJlZmFicyhzdHJp' +
	'bmcgaWQpCiAgICB7CiAgICAgICAgdmFyIGd1aWRzID0gQXNzZXREYXRhYmFzZS5GaW5kQXNzZXRzKCJ0OlByZWZhYiIpOwogICAg' +
	'ICAgIHZhciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJwcmVmYWJzXCI6WyIpOwogICAg' +
	'ICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZ3VpZHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDAp' +
	'IHNiLkFwcGVuZCgiLCIpOwogICAgICAgICAgICB2YXIgcGF0aCA9IEFzc2V0RGF0YWJhc2UuR1VJRFRvQXNzZXRQYXRoKGd1aWRz' +
	'W2ldKTsKICAgICAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24ocGF0aCkpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQo' +
	'Il19Iik7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICAvLyAtLS0gQXNz' +
	'ZXQgSGFuZGxlcnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0ZUFzc2V0KHN0cmluZyBpZCwgRGlj' +
	'dGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgYXNzZXRUeXBlID0gcC5HZXRWYWx1ZU9yRGVmYXVs' +
	'dCgiYXNzZXRUeXBlIiwgIk1hdGVyaWFsIik7CiAgICAgICAgdmFyIGFzc2V0UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoInBh' +
	'dGgiLCAiIik7CgogICAgICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShhc3NldFBhdGgpKQogICAgICAgICAgICByZXR1cm4g' +
	'TWFrZUVycm9yKGlkLCAicGF0aCBpcyByZXF1aXJlZCIpOwoKICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0cwogICAg' +
	'ICAgIHZhciBkaXIgPSBQYXRoLkdldERpcmVjdG9yeU5hbWUoYXNzZXRQYXRoKTsKICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxP' +
	'ckVtcHR5KGRpcikgJiYgIUFzc2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihkaXIpKQogICAgICAgIHsKICAgICAgICAgICAgQ3Jl' +
	'YXRlRm9sZGVyUmVjdXJzaXZlKGRpcik7CiAgICAgICAgfQoKICAgICAgICBVbml0eUVuZ2luZS5PYmplY3QgYXNzZXQgPSBudWxs' +
	'OwogICAgICAgIHN3aXRjaCAoYXNzZXRUeXBlLlRvTG93ZXIoKSkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgIm1hdGVyaWFs' +
	'IjoKICAgICAgICAgICAgICAgIHZhciBzaGFkZXIgPSBTaGFkZXIuRmluZChwLkdldFZhbHVlT3JEZWZhdWx0KCJzaGFkZXIiLCAi' +
	'U3RhbmRhcmQiKSk7CiAgICAgICAgICAgICAgICBhc3NldCA9IG5ldyBNYXRlcmlhbChzaGFkZXIpOwogICAgICAgICAgICAgICAg' +
	'YnJlYWs7CiAgICAgICAgICAgIGNhc2UgInBoeXNpY21hdGVyaWFsIjoKICAgICAgICAgICAgICAgIGFzc2V0ID0gbmV3IFBoeXNp' +
	'Y01hdGVyaWFsKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJl' +
	'dHVybiBNYWtlRXJyb3IoaWQsICQiVW5zdXBwb3J0ZWQgYXNzZXQgdHlwZToge2Fzc2V0VHlwZX0uIFN1cHBvcnRlZDogTWF0ZXJp' +
	'YWwsIFBoeXNpY01hdGVyaWFsIik7CiAgICAgICAgfQoKICAgICAgICBBc3NldERhdGFiYXNlLkNyZWF0ZUFzc2V0KGFzc2V0LCBh' +
	'c3NldFBhdGgpOwogICAgICAgIEFzc2V0RGF0YWJhc2UuUmVmcmVzaCgpOwoKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQs' +
	'ICQie3tcInBhdGhcIjp7RXNjYXBlSnNvbihhc3NldFBhdGgpfSxcInR5cGVcIjp7RXNjYXBlSnNvbihhc3NldFR5cGUpfX19Iik7' +
	'CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUZpbmRBc3NldHMoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0' +
	'cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBmaWx0ZXIgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJmaWx0ZXIiLCAi' +
	'Iik7CiAgICAgICAgdmFyIGd1aWRzID0gQXNzZXREYXRhYmFzZS5GaW5kQXNzZXRzKGZpbHRlcik7CiAgICAgICAgdmFyIHNiID0g' +
	'bmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcImFzc2V0c1wiOlsiKTsKICAgICAgICB2YXIgY291bnQg' +
	'PSBNYXRoLk1pbihndWlkcy5MZW5ndGgsIDUwKTsgLy8gQ2FwIGF0IDUwCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3Vu' +
	'dDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgdmFyIHBh' +
	'dGggPSBBc3NldERhdGFiYXNlLkdVSURUb0Fzc2V0UGF0aChndWlkc1tpXSk7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVK' +
	'c29uKHBhdGgpKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCQiXSxcInRvdGFsXCI6e2d1aWRzLkxlbmd0aH19fSIpOwog' +
	'ICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgLy8gLS0tIFByb2plY3QgLyBF' +
	'ZGl0b3IgSGFuZGxlcnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFByb2plY3RJbmZvKHN0cmluZyBp' +
	'ZCkKICAgIHsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihBcHBsaWNhdGlv' +
	'bi5wcm9kdWN0TmFtZSl9LFwidW5pdHlWZXJzaW9uXCI6e0VzY2FwZUpzb24oQXBwbGljYXRpb24udW5pdHlWZXJzaW9uKX0sXCJw' +
	'bGF0Zm9ybVwiOntFc2NhcGVKc29uKEVkaXRvclVzZXJCdWlsZFNldHRpbmdzLmFjdGl2ZUJ1aWxkVGFyZ2V0LlRvU3RyaW5nKCkp' +
	'fX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFBsYXlNb2RlKHN0cmluZyBpZCkKICAgIHsK' +
	'ICAgICAgICB2YXIgc3RhdGUgPSBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcKICAgICAgICAgICAgPyAoRWRpdG9yQXBwbGlj' +
	'YXRpb24uaXNQYXVzZWQgPyAicGF1c2VkIiA6ICJwbGF5aW5nIikKICAgICAgICAgICAgOiAic3RvcHBlZCI7CiAgICAgICAgcmV0' +
	'dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJzdGF0ZVwiOlwie3N0YXRlfVwifX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp' +
	'YyBzdHJpbmcgSGFuZGxlRXhlY3V0ZU1lbnVJdGVtKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAg' +
	'IHsKICAgICAgICB2YXIgbWVudVBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJtZW51UGF0aCIsICIiKTsKICAgICAgICBpZiAo' +
	'c3RyaW5nLklzTnVsbE9yRW1wdHkobWVudVBhdGgpKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAibWVudVBhdGgg' +
	'aXMgcmVxdWlyZWQiKTsKCiAgICAgICAgdmFyIHJlc3VsdCA9IEVkaXRvckFwcGxpY2F0aW9uLkV4ZWN1dGVNZW51SXRlbShtZW51' +
	'UGF0aCk7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJleGVjdXRlZFwiOntyZXN1bHQuVG9TdHJpbmcoKS5U' +
	'b0xvd2VyKCl9LFwibWVudVBhdGhcIjp7RXNjYXBlSnNvbihtZW51UGF0aCl9fX0iKTsKICAgIH0KCiAgICAvLyAtLS0gVXRpbGl0' +
	'aWVzIC0tLQoKICAgIC8vLyA8c3VtbWFyeT4KICAgIC8vLyBGaW5kIGEgR2FtZU9iamVjdCBieSBoaWVyYXJjaHkgcGF0aCwgaW5j' +
	'bHVkaW5nIGluYWN0aXZlIG9iamVjdHMuCiAgICAvLy8gVW5pdHkncyBHYW1lT2JqZWN0LkZpbmQoKSBvbmx5IGZpbmRzIGFjdGl2' +
	'ZSBvYmplY3RzLCB3aGljaCBmYWlscyB3aGVuCiAgICAvLy8gYSBwYXJlbnQgaGFzIGJlZW4gc2V0IGluYWN0aXZlLiBUaGlzIG1l' +
	'dGhvZCB3YWxrcyB0aGUgaGllcmFyY2h5IG1hbnVhbGx5LgogICAgLy8vIDwvc3VtbWFyeT4KICAgIHByaXZhdGUgc3RhdGljIEdh' +
	'bWVPYmplY3QgRmluZEdhbWVPYmplY3RCeVBhdGgoc3RyaW5nIHBhdGgpCiAgICB7CiAgICAgICAgaWYgKHN0cmluZy5Jc051bGxP' +
	'ckVtcHR5KHBhdGgpKSByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gRmlyc3QgdHJ5IHRoZSBmYXN0IHBhdGgg4oCUIFVuaXR5J3Mg' +
	'YnVpbHQtaW4gKG9ubHkgd29ya3MgZm9yIGFjdGl2ZSBvYmplY3RzKQogICAgICAgIHZhciBmb3VuZCA9IEdhbWVPYmplY3QuRmlu' +
	'ZChwYXRoKTsKICAgICAgICBpZiAoZm91bmQgIT0gbnVsbCkgcmV0dXJuIGZvdW5kOwoKICAgICAgICAvLyBTbG93IHBhdGg6IG1h' +
	'bnVhbGx5IHdhbGsgdGhlIGhpZXJhcmNoeSAod29ya3MgZm9yIGluYWN0aXZlIG9iamVjdHMgdG9vKQogICAgICAgIHZhciBwYXJ0' +
	'cyA9IHBhdGguU3BsaXQoJy8nKTsKICAgICAgICB2YXIgcm9vdE5hbWUgPSBwYXJ0c1swXTsKCiAgICAgICAgLy8gU2VhcmNoIHRo' +
	'cm91Z2ggYWxsIHNjZW5lIHJvb3Qgb2JqZWN0cwogICAgICAgIHZhciBzY2VuZSA9IFNjZW5lTWFuYWdlci5HZXRBY3RpdmVTY2Vu' +
	'ZSgpOwogICAgICAgIHZhciByb290cyA9IHNjZW5lLkdldFJvb3RHYW1lT2JqZWN0cygpOwogICAgICAgIEdhbWVPYmplY3Qgcm9v' +
	'dCA9IG51bGw7CiAgICAgICAgZm9yZWFjaCAodmFyIHIgaW4gcm9vdHMpCiAgICAgICAgewogICAgICAgICAgICBpZiAoci5uYW1l' +
	'ID09IHJvb3ROYW1lKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByb290ID0gcjsKICAgICAgICAgICAgICAgIGJyZWFr' +
	'OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocm9vdCA9PSBudWxsKSByZXR1cm4gbnVsbDsKICAgICAgICBp' +
	'ZiAocGFydHMuTGVuZ3RoID09IDEpIHJldHVybiByb290OwoKICAgICAgICAvLyBXYWxrIGRvd24gdGhlIHBhdGggdXNpbmcgVHJh' +
	'bnNmb3JtLkZpbmQgKHN1cHBvcnRzICcvJyBwYXRocyBhbmQgZmluZHMgaW5hY3RpdmUgY2hpbGRyZW4pCiAgICAgICAgdmFyIHN1' +
	'YlBhdGggPSBzdHJpbmcuSm9pbigiLyIsIHBhcnRzLCAxLCBwYXJ0cy5MZW5ndGggLSAxKTsKICAgICAgICB2YXIgY2hpbGQgPSBy' +
	'b290LnRyYW5zZm9ybS5GaW5kKHN1YlBhdGgpOwogICAgICAgIHJldHVybiBjaGlsZCAhPSBudWxsID8gY2hpbGQuZ2FtZU9iamVj' +
	'dCA6IG51bGw7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgVHlwZSBGaW5kQ29tcG9uZW50VHlwZShzdHJpbmcgdHlwZU5hbWUp' +
	'CiAgICB7CiAgICAgICAgLy8gQ29tbW9uIG5hbWVzcGFjZSBwcmVmaXhlcyBmb3IgVW5pdHkgY29tcG9uZW50IHR5cGVzLgogICAg' +
	'ICAgIC8vIFVJIGNvbXBvbmVudHMgbGl2ZSBpbiBVbml0eUVuZ2luZS5VSSwgVE1Qcm8sIEV2ZW50U3lzdGVtcyDigJQgbm90IGp1' +
	'c3QgVW5pdHlFbmdpbmUuCiAgICAgICAgc3RyaW5nW10gbmFtZXNwYWNlUHJlZml4ZXMgPSBuZXdbXQogICAgICAgIHsKICAgICAg' +
	'ICAgICAgIlVuaXR5RW5naW5lLiIsICAgICAgICAgICAgICAvLyBSaWdpZGJvZHksIENhbnZhcywgQXVkaW9Tb3VyY2UsIGV0Yy4K' +
	'ICAgICAgICAgICAgIlVuaXR5RW5naW5lLlVJLiIsICAgICAgICAgICAvLyBCdXR0b24sIEltYWdlLCBTbGlkZXIsIENhbnZhc1Nj' +
	'YWxlciwgR3JhcGhpY1JheWNhc3RlciwgVmVydGljYWxMYXlvdXRHcm91cCwgZXRjLgogICAgICAgICAgICAiVW5pdHlFbmdpbmUu' +
	'RXZlbnRTeXN0ZW1zLiIsIC8vIEV2ZW50U3lzdGVtLCBTdGFuZGFsb25lSW5wdXRNb2R1bGUsIGV0Yy4KICAgICAgICAgICAgIlRN' +
	'UHJvLiIsICAgICAgICAgICAgICAgICAgICAvLyBUZXh0TWVzaFByb1VHVUksIFRNUF9JbnB1dEZpZWxkLCBldGMuCiAgICAgICAg' +
	'ICAgICIiLCAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3VzdG9tIHNjcmlwdHMgKGJhcmUgY2xhc3MgbmFtZSBpbiBBc3Nl' +
	'bWJseS1DU2hhcnApCiAgICAgICAgfTsKCiAgICAgICAgZm9yZWFjaCAodmFyIGFzc2VtYmx5IGluIEFwcERvbWFpbi5DdXJyZW50' +
	'RG9tYWluLkdldEFzc2VtYmxpZXMoKSkKICAgICAgICB7CiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBwcmVmaXggaW4gbmFtZXNw' +
	'YWNlUHJlZml4ZXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBmdWxsTmFtZSA9IHByZWZpeCArIHR5cGVOYW1l' +
	'OwogICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBhc3NlbWJseS5HZXRUeXBlKGZ1bGxOYW1lKTsKICAgICAgICAgICAgICAgIGlm' +
	'ICh0eXBlICE9IG51bGwgJiYgdHlwZW9mKENvbXBvbmVudCkuSXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgICAg' +
	'ICAgICByZXR1cm4gdHlwZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg' +
	'Ly8vIDxzdW1tYXJ5PgogICAgLy8vIFNtYXJ0IHR5cGUgY29udmVyc2lvbiB0aGF0IGhhbmRsZXMgZW51bXMsIFZlY3RvcjIsIFZl' +
	'Y3RvcjMsIENvbG9yLCBhbmQgcHJpbWl0aXZlcy4KICAgIC8vLyBGYWxscyBiYWNrIHRvIENvbnZlcnQuQ2hhbmdlVHlwZSBmb3Ig' +
	'c2ltcGxlIHR5cGVzLgogICAgLy8vIDwvc3VtbWFyeT4KICAgIHByaXZhdGUgc3RhdGljIG9iamVjdCBTbWFydENvbnZlcnQoc3Ry' +
	'aW5nIHZhbHVlU3RyLCBUeXBlIHRhcmdldFR5cGUpCiAgICB7CiAgICAgICAgLy8gSGFuZGxlIG51bGxhYmxlCiAgICAgICAgdmFy' +
	'IHVuZGVybHlpbmdUeXBlID0gTnVsbGFibGUuR2V0VW5kZXJseWluZ1R5cGUodGFyZ2V0VHlwZSk7CiAgICAgICAgaWYgKHVuZGVy' +
	'bHlpbmdUeXBlICE9IG51bGwpCiAgICAgICAgICAgIHRhcmdldFR5cGUgPSB1bmRlcmx5aW5nVHlwZTsKCiAgICAgICAgLy8gRW51' +
	'bSB0eXBlcyAoUmVuZGVyTW9kZSwgU2NhbGVNb2RlLCBUZXh0QWxpZ25tZW50T3B0aW9ucywgZXRjLikKICAgICAgICBpZiAodGFy' +
	'Z2V0VHlwZS5Jc0VudW0pCiAgICAgICAgewogICAgICAgICAgICAvLyBUcnkgcGFyc2luZyBieSBuYW1lIGZpcnN0IChlLmcuICJT' +
	'Y3JlZW5TcGFjZU92ZXJsYXkiLCAiU2NhbGVXaXRoU2NyZWVuU2l6ZSIpCiAgICAgICAgICAgIGlmIChFbnVtLlRyeVBhcnNlKHRh' +
	'cmdldFR5cGUsIHZhbHVlU3RyLCB0cnVlLCBvdXQgdmFyIGVudW1WYWwpKQogICAgICAgICAgICAgICAgcmV0dXJuIGVudW1WYWw7' +
	'CiAgICAgICAgICAgIC8vIFRyeSBwYXJzaW5nIGFzIGludGVnZXIKICAgICAgICAgICAgaWYgKGludC5UcnlQYXJzZSh2YWx1ZVN0' +
	'ciwgb3V0IHZhciBpbnRWYWwpKQogICAgICAgICAgICAgICAgcmV0dXJuIEVudW0uVG9PYmplY3QodGFyZ2V0VHlwZSwgaW50VmFs' +
	'KTsKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDYXN0RXhjZXB0aW9uKCQiQ2Fubm90IGNvbnZlcnQgJ3t2YWx1ZVN0cn0n' +
	'IHRvIHt0YXJnZXRUeXBlLk5hbWV9LiBWYWxpZCB2YWx1ZXM6IHtzdHJpbmcuSm9pbigiLCAiLCBFbnVtLkdldE5hbWVzKHRhcmdl' +
	'dFR5cGUpKX0iKTsKICAgICAgICB9CgogICAgICAgIC8vIFZlY3RvcjIKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2Yo' +
	'VmVjdG9yMikpCiAgICAgICAgICAgIHJldHVybiBQYXJzZVZlY3RvcjIodmFsdWVTdHIpOwoKICAgICAgICAvLyBWZWN0b3IzCiAg' +
	'ICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKFZlY3RvcjMpKQogICAgICAgICAgICByZXR1cm4gUGFyc2VWZWN0b3IzKHZh' +
	'bHVlU3RyKTsKCiAgICAgICAgLy8gVmVjdG9yNAogICAgICAgIGlmICh0YXJnZXRUeXBlID09IHR5cGVvZihWZWN0b3I0KSkKICAg' +
	'ICAgICAgICAgcmV0dXJuIFBhcnNlVmVjdG9yNCh2YWx1ZVN0cik7CgogICAgICAgIC8vIENvbG9yCiAgICAgICAgaWYgKHRhcmdl' +
	'dFR5cGUgPT0gdHlwZW9mKENvbG9yKSkKICAgICAgICAgICAgcmV0dXJuIFBhcnNlQ29sb3IodmFsdWVTdHIpOwoKICAgICAgICAv' +
	'LyBCb29sCiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKGJvb2wpKQogICAgICAgICAgICByZXR1cm4gdmFsdWVTdHIu' +
	'VG9Mb3dlcigpID09ICJ0cnVlIiB8fCB2YWx1ZVN0ciA9PSAiMSI7CgogICAgICAgIC8vIEludAogICAgICAgIGlmICh0YXJnZXRU' +
	'eXBlID09IHR5cGVvZihpbnQpKQogICAgICAgIHsKICAgICAgICAgICAgaW50LlRyeVBhcnNlKHZhbHVlU3RyLCBvdXQgdmFyIHYp' +
	'OwogICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICB9CgogICAgICAgIC8vIEZsb2F0CiAgICAgICAgaWYgKHRhcmdldFR5cGUg' +
	'PT0gdHlwZW9mKGZsb2F0KSkKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHZhbHVlU3RyLCBTeXN0ZW0uR2xv' +
	'YmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1' +
	'bHR1cmUsIG91dCB2YXIgdik7CiAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgIH0KCiAgICAgICAgLy8gU3RyaW5nCiAgICAg' +
	'ICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKHN0cmluZykpCiAgICAgICAgICAgIHJldHVybiB2YWx1ZVN0cjsKCiAgICAgICAg' +
	'Ly8gRmFsbGJhY2sKICAgICAgICByZXR1cm4gQ29udmVydC5DaGFuZ2VUeXBlKHZhbHVlU3RyLCB0YXJnZXRUeXBlKTsKICAgIH0K' +
	'CiAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IyIFBhcnNlVmVjdG9yMihzdHJpbmcgc3RyKQogICAgewogICAgICAgIHN0ciA9IHN0' +
	'ci5UcmltKCdbJywgJ10nLCAnKCcsICcpJykuVHJpbSgpOwogICAgICAgIHZhciBwYXJ0cyA9IHN0ci5TcGxpdCgnLCcpOwogICAg' +
	'ICAgIGlmIChwYXJ0cy5MZW5ndGggPj0gMikKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzBdLlRy' +
	'aW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJl' +
	'SW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHgpOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1sxXS5Ucmlt' +
	'KCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUlu' +
	'Zm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB5KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHgsIHkpOwogICAg' +
	'ICAgIH0KICAgICAgICByZXR1cm4gVmVjdG9yMi56ZXJvOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIFZlY3RvcjMgUGFyc2VW' +
	'ZWN0b3IzKHN0cmluZyBzdHIpCiAgICB7CiAgICAgICAgLy8gSGFuZGxlIGJvdGggIlt4LHksel0iIGFuZCAieCx5LHoiIGZvcm1h' +
	'dHMKICAgICAgICBzdHIgPSBzdHIuVHJpbSgnWycsICddJywgJygnLCAnKScpLlRyaW0oKTsKICAgICAgICB2YXIgcGFydHMgPSBz' +
	'dHIuU3BsaXQoJywnKTsKICAgICAgICBpZiAocGFydHMuTGVuZ3RoID49IDMpCiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5U' +
	'cnlQYXJzZShwYXJ0c1swXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkds' +
	'b2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB4KTsKICAgICAgICAgICAgZmxvYXQuVHJ5' +
	'UGFyc2UocGFydHNbMV0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9i' +
	'YWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgeSk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBh' +
	'cnNlKHBhcnRzWzJdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFs' +
	'aXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHopOwogICAgICAgICAgICByZXR1cm4gbmV3IFZl' +
	'Y3RvcjMoeCwgeSwgeik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBWZWN0b3IzLnplcm87CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgVmVjdG9yNCBQYXJzZVZlY3RvcjQoc3RyaW5nIHN0cikKICAgIHsKICAgICAgICBzdHIgPSBzdHIuVHJpbSgnWycsICdd' +
	'JywgJygnLCAnKScpLlRyaW0oKTsKICAgICAgICB2YXIgcGFydHMgPSBzdHIuU3BsaXQoJywnKTsKICAgICAgICBpZiAocGFydHMu' +
	'TGVuZ3RoID49IDQpCiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1swXS5UcmltKCksIFN5c3RlbS5H' +
	'bG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50' +
	'Q3VsdHVyZSwgb3V0IHZhciB4KTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMV0uVHJpbSgpLCBTeXN0ZW0uR2xv' +
	'YmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1' +
	'bHR1cmUsIG91dCB2YXIgeSk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzJdLlRyaW0oKSwgU3lzdGVtLkdsb2Jh' +
	'bGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0' +
	'dXJlLCBvdXQgdmFyIHopOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1szXS5UcmltKCksIFN5c3RlbS5HbG9iYWxp' +
	'emF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVy' +
	'ZSwgb3V0IHZhciB3KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3I0KHgsIHksIHosIHcpOwogICAgICAgIH0KICAgICAg' +
	'ICByZXR1cm4gVmVjdG9yNC56ZXJvOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIENvbG9yIFBhcnNlQ29sb3Ioc3RyaW5nIHN0' +
	'cikKICAgIHsKICAgICAgICAvLyBUcnkgaGV4IGNvbG9yICgjUlJHR0JCIG9yICNSUkdHQkJBQSkKICAgICAgICBpZiAoc3RyLlN0' +
	'YXJ0c1dpdGgoIiMiKSAmJiBDb2xvclV0aWxpdHkuVHJ5UGFyc2VIdG1sU3RyaW5nKHN0ciwgb3V0IHZhciBodG1sQ29sb3IpKQog' +
	'ICAgICAgICAgICByZXR1cm4gaHRtbENvbG9yOwogICAgICAgIC8vIFRyeSBSR0JBIGNvbXBvbmVudHMKICAgICAgICBzdHIgPSBz' +
	'dHIuVHJpbSgnWycsICddJywgJygnLCAnKScpLlRyaW0oKTsKICAgICAgICB2YXIgcGFydHMgPSBzdHIuU3BsaXQoJywnKTsKICAg' +
	'ICAgICBpZiAocGFydHMuTGVuZ3RoID49IDMpCiAgICAgICAgewogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1swXS5U' +
	'cmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVy' +
	'ZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciByKTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMV0uVHJp' +
	'bSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJ' +
	'bmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgZyk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzJdLlRyaW0o' +
	'KSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5m' +
	'by5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIGIpOwogICAgICAgICAgICBmbG9hdCBhID0gMWY7CiAgICAgICAgICAgIGlmIChw' +
	'YXJ0cy5MZW5ndGggPj0gNCkKICAgICAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzNdLlRyaW0oKSwgU3lzdGVtLkds' +
	'b2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRD' +
	'dWx0dXJlLCBvdXQgYSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29sb3IociwgZywgYiwgYSk7CiAgICAgICAgfQogICAgICAg' +
	'IHJldHVybiBDb2xvci53aGl0ZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFNldFNlcmlhbGl6ZWRQcm9wZXJ0eVZh' +
	'bHVlKFNlcmlhbGl6ZWRQcm9wZXJ0eSBwcm9wLCBzdHJpbmcgdmFsdWUpCiAgICB7CiAgICAgICAgc3dpdGNoIChwcm9wLnByb3Bl' +
	'cnR5VHlwZSkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5JbnRlZ2VyOgogICAgICAg' +
	'ICAgICAgICAgaWYgKGludC5UcnlQYXJzZSh2YWx1ZSwgb3V0IHZhciBpbnRWYWwpKQogICAgICAgICAgICAgICAgICAgIHByb3Au' +
	'aW50VmFsdWUgPSBpbnRWYWw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVy' +
	'dHlUeXBlLkZsb2F0OgogICAgICAgICAgICAgICAgaWYgKGZsb2F0LlRyeVBhcnNlKHZhbHVlLCBTeXN0ZW0uR2xvYmFsaXphdGlv' +
	'bi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91' +
	'dCB2YXIgZmxvYXRWYWwpKQogICAgICAgICAgICAgICAgICAgIHByb3AuZmxvYXRWYWx1ZSA9IGZsb2F0VmFsOwogICAgICAgICAg' +
	'ICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5Cb29sZWFuOgogICAgICAgICAgICAg' +
	'ICAgcHJvcC5ib29sVmFsdWUgPSB2YWx1ZS5Ub0xvd2VyKCkgPT0gInRydWUiIHx8IHZhbHVlID09ICIxIjsKICAgICAgICAgICAg' +
	'ICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuU3RyaW5nOgogICAgICAgICAgICAgICAg' +
	'cHJvcC5zdHJpbmdWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXpl' +
	'ZFByb3BlcnR5VHlwZS5FbnVtOgogICAgICAgICAgICAgICAgLy8gVHJ5IG5hbWUgZmlyc3QsIHRoZW4gaW50ZWdlcgogICAgICAg' +
	'ICAgICAgICAgdmFyIGVudW1OYW1lcyA9IHByb3AuZW51bU5hbWVzOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg' +
	'PCBlbnVtTmFtZXMuTGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmluZy5F' +
	'cXVhbHMoZW51bU5hbWVzW2ldLCB2YWx1ZSwgU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSkpCiAgICAgICAgICAg' +
	'ICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBwcm9wLmVudW1WYWx1ZUluZGV4ID0gaTsKICAgICAgICAgICAgICAg' +
	'ICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlm' +
	'IChpbnQuVHJ5UGFyc2UodmFsdWUsIG91dCB2YXIgZW51bUludCkpCiAgICAgICAgICAgICAgICAgICAgcHJvcC5lbnVtVmFsdWVJ' +
	'bmRleCA9IGVudW1JbnQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlU' +
	'eXBlLlZlY3RvcjI6CiAgICAgICAgICAgICAgICBwcm9wLnZlY3RvcjJWYWx1ZSA9IFBhcnNlVmVjdG9yMih2YWx1ZSk7CiAgICAg' +
	'ICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLlZlY3RvcjM6CiAgICAgICAg' +
	'ICAgICAgICBwcm9wLnZlY3RvcjNWYWx1ZSA9IFBhcnNlVmVjdG9yMyh2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg' +
	'ICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkNvbG9yOgogICAgICAgICAgICAgICAgcHJvcC5jb2xvclZhbHVl' +
	'ID0gUGFyc2VDb2xvcih2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBDcmVhdGVGb2xkZXJSZWN1cnNpdmUoc3RyaW5nIHBhdGgpCiAgICB7CiAgICAgICAgdmFyIHBhcnRzID0gcGF0' +
	'aC5SZXBsYWNlKCJcXCIsICIvIikuU3BsaXQoJy8nKTsKICAgICAgICB2YXIgY3VycmVudCA9IHBhcnRzWzBdOwogICAgICAgIGZv' +
	'ciAoaW50IGkgPSAxOyBpIDwgcGFydHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICB2YXIgbmV4dCA9IGN1cnJl' +
	'bnQgKyAiLyIgKyBwYXJ0c1tpXTsKICAgICAgICAgICAgaWYgKCFBc3NldERhdGFiYXNlLklzVmFsaWRGb2xkZXIobmV4dCkpCiAg' +
	'ICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEFzc2V0RGF0YWJhc2UuQ3JlYXRlRm9sZGVyKGN1cnJlbnQsIHBhcnRzW2ldKTsK' +
	'ICAgICAgICAgICAgfQogICAgICAgICAgICBjdXJyZW50ID0gbmV4dDsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0' +
	'aWMgc3RyaW5nIEVzY2FwZUpzb24oc3RyaW5nIHMpCiAgICB7CiAgICAgICAgaWYgKHMgPT0gbnVsbCkgcmV0dXJuICJudWxsIjsK' +
	'ICAgICAgICByZXR1cm4gIlwiIiArIHMuUmVwbGFjZSgiXFwiLCAiXFxcXCIpLlJlcGxhY2UoIlwiIiwgIlxcXCIiKS5SZXBsYWNl' +
	'KCJcbiIsICJcXG4iKS5SZXBsYWNlKCJcciIsICJcXHIiKS5SZXBsYWNlKCJcdCIsICJcXHQiKSArICJcIiI7CiAgICB9CgogICAg' +
	'cHJpdmF0ZSBzdGF0aWMgc3RyaW5nIE1ha2VTdWNjZXNzKHN0cmluZyBpZCwgc3RyaW5nIHJlc3VsdEpzb24pCiAgICB7CiAgICAg' +
	'ICAgcmV0dXJuICQie3tcImlkXCI6e0VzY2FwZUpzb24oaWQpfSxcInR5cGVcIjpcInJlc3BvbnNlXCIsXCJzdWNjZXNzXCI6dHJ1' +
	'ZSxcInJlc3VsdFwiOntyZXN1bHRKc29ufX19IjsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgTWFrZUVycm9yKHN0' +
	'cmluZyBpZCwgc3RyaW5nIGVycm9yKQogICAgewogICAgICAgIHJldHVybiAkInt7XCJpZFwiOntFc2NhcGVKc29uKGlkKX0sXCJ0' +
	'eXBlXCI6XCJyZXNwb25zZVwiLFwic3VjY2Vzc1wiOmZhbHNlLFwiZXJyb3JcIjp7RXNjYXBlSnNvbihlcnJvcil9fX0iOwogICAg' +
	'fQoKICAgIC8vIC0tLSBTZXJpYWxpemF0aW9uIEhlbHBlcnMgLS0tCiAgICAvLyBKc29uVXRpbGl0eSBuZWVkcyBzZXJpYWxpemFi' +
	'bGUgY2xhc3NlcyBmb3IgRnJvbUpzb24KCiAgICBbU2VyaWFsaXphYmxlXQogICAgcHJpdmF0ZSBjbGFzcyBTZXJpYWxpemFibGVS' +
	'ZXF1ZXN0CiAgICB7CiAgICAgICAgcHVibGljIHN0cmluZyBpZDsKICAgICAgICBwdWJsaWMgc3RyaW5nIHR5cGU7CiAgICAgICAg' +
	'cHVibGljIHN0cmluZyBjYXRlZ29yeTsKICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbjsKICAgICAgICBwdWJsaWMgc3RyaW5n' +
	'IHBhcmFtc0pzb247IC8vIFBhcmFtcyBhcyByYXcgSlNPTiBzdHJpbmcKCiAgICAgICAgLy8vIDxzdW1tYXJ5PgogICAgICAgIC8v' +
	'LyBQYXJzZSBwYXJhbXMgZnJvbSB0aGUgcmF3IEpTT04uIFNpbmNlIFVuaXR5J3MgSnNvblV0aWxpdHkgZG9lc24ndCBoYW5kbGUK' +
	'ICAgICAgICAvLy8gRGljdGlvbmFyeSBvciBkeW5hbWljIG9iamVjdHMsIHdlIGRvIG1hbnVhbCBwYXJzaW5nIGZvciB0aGUgc2lt' +
	'cGxlIGtleS12YWx1ZSBwYXJhbXMuCiAgICAgICAgLy8vIDwvc3VtbWFyeT4KICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJp' +
	'bmcsIHN0cmluZz4gR2V0UGFyYW1zKCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgRGljdGlvbmFyeTxz' +
	'dHJpbmcsIHN0cmluZz4oKTsKICAgICAgICAgICAgaWYgKHN0cmluZy5Jc051bGxPckVtcHR5KHBhcmFtc0pzb24pKSByZXR1cm4g' +
	'cmVzdWx0OwoKICAgICAgICAgICAgLy8gU2ltcGxlIEpTT04gb2JqZWN0IHBhcnNlciBmb3IgZmxhdCBrZXktdmFsdWUgcGFpcnMK' +
	'ICAgICAgICAgICAgdmFyIGpzb24gPSBwYXJhbXNKc29uLlRyaW0oKTsKICAgICAgICAgICAgaWYgKCFqc29uLlN0YXJ0c1dpdGgo' +
	'InsiKSkgcmV0dXJuIHJlc3VsdDsKCiAgICAgICAgICAgIGpzb24gPSBqc29uLlN1YnN0cmluZygxLCBqc29uLkxlbmd0aCAtIDIp' +
	'LlRyaW0oKTsKICAgICAgICAgICAgaWYgKHN0cmluZy5Jc051bGxPckVtcHR5KGpzb24pKSByZXR1cm4gcmVzdWx0OwoKICAgICAg' +
	'ICAgICAgLy8gU3BsaXQgYnkgY29tbWFzIHRoYXQgYXJlbid0IGluc2lkZSBzdHJpbmdzCiAgICAgICAgICAgIHZhciBwYWlycyA9' +
	'IFNwbGl0SnNvblBhaXJzKGpzb24pOwogICAgICAgICAgICBmb3JlYWNoICh2YXIgcGFpciBpbiBwYWlycykKICAgICAgICAgICAg' +
	'ewogICAgICAgICAgICAgICAgdmFyIGNvbG9uSWR4ID0gcGFpci5JbmRleE9mKCc6Jyk7CiAgICAgICAgICAgICAgICBpZiAoY29s' +
	'b25JZHggPCAwKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICB2YXIga2V5ID0gcGFpci5TdWJzdHJpbmcoMCwgY29sb25JZHgp' +
	'LlRyaW0oKS5UcmltKCciJyk7CiAgICAgICAgICAgICAgICB2YXIgdmFsID0gcGFpci5TdWJzdHJpbmcoY29sb25JZHggKyAxKS5U' +
	'cmltKCkuVHJpbSgnIicpOwoKICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBhcnJheSB2YWx1ZXMgKGtlZXAgYXMgc3RyaW5nIGZv' +
	'ciBub3cpCiAgICAgICAgICAgICAgICBpZiAodmFsLlN0YXJ0c1dpdGgoIlsiKSkKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2' +
	'YWwuVHJpbSgpOwoKICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBy' +
	'ZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgTGlzdDxzdHJpbmc+IFNwbGl0SnNvblBhaXJz' +
	'KHN0cmluZyBqc29uKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBMaXN0PHN0cmluZz4oKTsKICAgICAg' +
	'ICAgICAgdmFyIGRlcHRoID0gMDsKICAgICAgICAgICAgdmFyIGluU3RyaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBzdGFy' +
	'dCA9IDA7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpzb24uTGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAg' +
	'ICAgICAgICAgICAgIHZhciBjID0ganNvbltpXTsKICAgICAgICAgICAgICAgIGlmIChjID09ICciJyAmJiAoaSA9PSAwIHx8IGpz' +
	'b25baSAtIDFdICE9ICdcXCcpKQogICAgICAgICAgICAgICAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nOwogICAgICAgICAgICAg' +
	'ICAgZWxzZSBpZiAoIWluU3RyaW5nKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmIChjID09ICd7JyB8' +
	'fCBjID09ICdbJykgZGVwdGgrKzsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjID09ICd9JyB8fCBjID09ICddJykgZGVw' +
	'dGgtLTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjID09ICcsJyAmJiBkZXB0aCA9PSAwKQogICAgICAgICAgICAgICAg' +
	'ICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LkFkZChqc29uLlN1YnN0cmluZyhzdGFydCwgaSAtIHN0YXJ0KS5U' +
	'cmltKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhcnQgPCBqc29uLkxlbmd0aCkKICAgICAgICAgICAg' +
	'ICAgIHJlc3VsdC5BZGQoanNvbi5TdWJzdHJpbmcoc3RhcnQpLlRyaW0oKSk7CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0Owog' +
	'ICAgICAgIH0KICAgIH0KCn0K';

/** Decode and return the C# plugin source */
export function getBridgePluginSource(): string {
	return VSBuffer.wrap(Uint8Array.from(atob(BRIDGE_PLUGIN_BASE64), c => c.charCodeAt(0))).toString();
}
