/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Embedded source of the Unity Editor Bridge C# plugin (base64 encoded).
 * Auto-deployed into the user's Unity project at Assets/Editor/GameDevIDEBridge.cs.
 *
 * The readable source is at: unity-editor-plugin/GameDevIDEBridge.cs
 * To regenerate after editing the C# file, run from the repo root:
 *   node scripts/generate-bridge-plugin-source.js
 */

import { VSBuffer } from '../../../../base/common/buffer.js';

/** Version marker â€” bump when the plugin changes to trigger re-deploy */
export const BRIDGE_PLUGIN_VERSION = '2.0.0';

/** Path relative to Unity project root where the plugin is installed */
export const BRIDGE_PLUGIN_INSTALL_PATH = 'Assets/Editor/GameDevIDEBridge.cs';

/** Base64-encoded C# source of the Unity Editor Bridge plugin */
const BRIDGE_PLUGIN_BASE64 = '' +
	'LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIEdhbWVEZXYgSURFIEJyaWRnZSDigJQgVW5pdHkgRWRpdG9yIFBsdWdpbiAgKEFVVE8t' +
	'SU5TVEFMTEVEIGJ5IEdhbWVEZXYgSURFKQogKgogKiAgVGhpcyBmaWxlIGlzIGF1dG9tYXRpY2FsbHkgbWFuYWdlZCBieSBHYW1l' +
	'RGV2IElERS4gRG8gbm90IGVkaXQgbWFudWFsbHkuCiAqICBJdCByZWdpc3RlcnMgYSBjaGFubmVsIG9uIFVuaXR5J3MgTVBFIENo' +
	'YW5uZWxTZXJ2aWNlIHNvIHRoZSBJREUgY2FuCiAqICBjb21tdW5pY2F0ZSB3aXRoIHRoZSBydW5uaW5nIFVuaXR5IEVkaXRvciB0' +
	'byBjcmVhdGUgR2FtZU9iamVjdHMsIHNjZW5lcywKICogIHByZWZhYnMsIGV0Yy4gVGhlIGNvbm5lY3Rpb24gc3Vydml2ZXMgZG9t' +
	'YWluIHJlbG9hZHMgKHNjcmlwdCByZWNvbXBpbGF0aW9uKS4KICoKICogIFByb3RvY29sIHZlcnNpb246IDIuMAogKiAgUGx1Z2lu' +
	'IHZlcnNpb246IDIuMC4wCiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKdXNpbmcgVW5pdHlFbmdpbmU7CnVzaW5nIFVuaXR5RWRpdG9y' +
	'Owp1c2luZyBVbml0eUVkaXRvci5TY2VuZU1hbmFnZW1lbnQ7CnVzaW5nIFVuaXR5RW5naW5lLlNjZW5lTWFuYWdlbWVudDsKdXNp' +
	'bmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uSU87CnVzaW5nIFN5c3RlbS5UZXh0Owp1c2luZyBTeXN0ZW0uVGV4dC5SZWd1bGFyRXhw' +
	'cmVzc2lvbnM7CnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5Db25jdXJyZW50Owp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2Vu' +
	'ZXJpYzsKdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247CnVzaW5nIFN5c3RlbS5MaW5xOwp1c2luZyBVbml0eS5NUEU7CgpbSW5pdGlh' +
	'bGl6ZU9uTG9hZF0KcHVibGljIHN0YXRpYyBjbGFzcyBHYW1lRGV2SURFQnJpZGdlCnsKICAgIHByaXZhdGUgY29uc3Qgc3RyaW5n' +
	'IFBST1RPQ09MX1ZFUlNJT04gPSAiMi4wIjsKICAgIHByaXZhdGUgY29uc3Qgc3RyaW5nIENIQU5ORUxfTkFNRSA9ICJnYW1lZGV2' +
	'X2JyaWRnZSI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRElSID0gIkxpYnJhcnkvR2FtZURldklERSI7CiAg' +
	'ICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRklMRSA9ICJMaWJyYXJ5L0dhbWVEZXZJREUvYnJpZGdlLmpzb24iOwoK' +
	'ICAgIHByaXZhdGUgc3RhdGljIEFjdGlvbiBfZGlzY29ubmVjdENoYW5uZWw7CiAgICBwcml2YXRlIHN0YXRpYyBpbnQgX2FjdGl2' +
	'ZUNvbm5lY3Rpb25JZCA9IC0xOwogICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ29uY3VycmVudFF1ZXVlPHN0cmluZz4gX2lu' +
	'Y29taW5nTWVzc2FnZXMgPSBuZXcgQ29uY3VycmVudFF1ZXVlPHN0cmluZz4oKTsKICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5' +
	'IENvbmN1cnJlbnRRdWV1ZTxzdHJpbmc+IF9vdXRnb2luZ01lc3NhZ2VzID0gbmV3IENvbmN1cnJlbnRRdWV1ZTxzdHJpbmc+KCk7' +
	'CgogICAgc3RhdGljIEdhbWVEZXZJREVCcmlkZ2UoKQogICAgewogICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLnVwZGF0ZSArPSBQ' +
	'cm9jZXNzTWVzc2FnZXM7CiAgICAgICAgRWRpdG9yQXBwbGljYXRpb24udXBkYXRlICs9IEZsdXNoT3V0Z29pbmc7CiAgICAgICAg' +
	'RWRpdG9yQXBwbGljYXRpb24ucXVpdHRpbmcgKz0gU2h1dGRvd247CiAgICAgICAgQXBwbGljYXRpb24ubG9nTWVzc2FnZVJlY2Vp' +
	'dmVkICs9IE9uTG9nTWVzc2FnZTsKICAgICAgICBFZGl0b3JBcHBsaWNhdGlvbi5wbGF5TW9kZVN0YXRlQ2hhbmdlZCArPSBPblBs' +
	'YXlNb2RlQ2hhbmdlZDsKICAgICAgICBTdGFydENoYW5uZWwoKTsKICAgIH0KCiAgICAvLyAtLS0gQ2hhbm5lbCBMaWZlY3ljbGUg' +
	'KE1QRSBDaGFubmVsU2VydmljZSkgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTdGFydENoYW5uZWwoKQogICAgewogICAg' +
	'ICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCFDaGFubmVsU2VydmljZS5Jc1J1bm5pbmcoKSkKICAgICAgICAgICAg' +
	'ICAgIENoYW5uZWxTZXJ2aWNlLlN0YXJ0KCk7CgogICAgICAgICAgICBfZGlzY29ubmVjdENoYW5uZWwgPSBDaGFubmVsU2Vydmlj' +
	'ZS5HZXRPckNyZWF0ZUNoYW5uZWwoQ0hBTk5FTF9OQU1FLAogICAgICAgICAgICAgICAgKGludCBjb25uZWN0aW9uSWQsIGJ5dGVb' +
	'XSBkYXRhKSA9PgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIF9hY3RpdmVDb25uZWN0aW9uSWQgPSBjb25u' +
	'ZWN0aW9uSWQ7CiAgICAgICAgICAgICAgICAgICAgX2luY29taW5nTWVzc2FnZXMuRW5xdWV1ZShFbmNvZGluZy5VVEY4LkdldFN0' +
	'cmluZyhkYXRhKSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBwb3J0ID0gQ2hhbm5lbFNlcnZpY2UuR2V0' +
	'UG9ydCgpOwogICAgICAgICAgICBXcml0ZURpc2NvdmVyeUZpbGUocG9ydCk7CiAgICAgICAgICAgIERlYnVnLkxvZygkIltHYW1l' +
	'RGV2SURFIEJyaWRnZV0gQ2hhbm5lbCByZWdpc3RlcmVkIG9uIHBvcnQge3BvcnR9ICh2e1BST1RPQ09MX1ZFUlNJT059KSIpOwog' +
	'ICAgICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgIHsKICAgICAgICAgICAgRGVidWcuTG9nRXJyb3Io' +
	'JCJbR2FtZURldklERSBCcmlkZ2VdIEZhaWxlZCB0byBzdGFydCBjaGFubmVsOiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICB9CiAg' +
	'ICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTZW5kUmVzcG9uc2Uoc3RyaW5nIGpzb24pCiAgICB7CiAgICAgICAgaWYgKF9h' +
	'Y3RpdmVDb25uZWN0aW9uSWQgPCAwKSByZXR1cm47CiAgICAgICAgX291dGdvaW5nTWVzc2FnZXMuRW5xdWV1ZShqc29uKTsKICAg' +
	'IH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIEZsdXNoT3V0Z29pbmcoKQogICAgewogICAgICAgIHdoaWxlIChfb3V0Z29pbmdN' +
	'ZXNzYWdlcy5UcnlEZXF1ZXVlKG91dCB2YXIganNvbikpCiAgICAgICAgewogICAgICAgICAgICBpZiAoX2FjdGl2ZUNvbm5lY3Rp' +
	'b25JZCA8IDApIGJyZWFrOwogICAgICAgICAgICBDaGFubmVsU2VydmljZS5TZW5kKF9hY3RpdmVDb25uZWN0aW9uSWQsIEVuY29k' +
	'aW5nLlVURjguR2V0Qnl0ZXMoanNvbikpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFdyaXRlRGlz' +
	'Y292ZXJ5RmlsZShpbnQgcG9ydCkKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGlmICghRGlyZWN0b3J5' +
	'LkV4aXN0cyhESVNDT1ZFUllfRElSKSkKICAgICAgICAgICAgICAgIERpcmVjdG9yeS5DcmVhdGVEaXJlY3RvcnkoRElTQ09WRVJZ' +
	'X0RJUik7CgogICAgICAgICAgICB2YXIganNvbiA9ICQie3tcInBvcnRcIjp7cG9ydH0sXCJwaWRcIjp7U3lzdGVtLkRpYWdub3N0' +
	'aWNzLlByb2Nlc3MuR2V0Q3VycmVudFByb2Nlc3MoKS5JZH0sXCJ2ZXJzaW9uXCI6XCJ7UFJPVE9DT0xfVkVSU0lPTn1cIixcImNo' +
	'YW5uZWxcIjpcIntDSEFOTkVMX05BTUV9XCIsXCJ0aW1lc3RhbXBcIjp7RGF0ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVT' +
	'ZWNvbmRzKCl9fX0iOwogICAgICAgICAgICBGaWxlLldyaXRlQWxsVGV4dChESVNDT1ZFUllfRklMRSwganNvbik7CiAgICAgICAg' +
	'fQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAgICAgICAgICBEZWJ1Zy5Mb2dFcnJvcigkIltHYW1l' +
	'RGV2SURFIEJyaWRnZV0gRmFpbGVkIHRvIHdyaXRlIGRpc2NvdmVyeSBmaWxlOiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICB9CiAg' +
	'ICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTaHV0ZG93bigpCiAgICB7CiAgICAgICAgdHJ5IHsgX2Rpc2Nvbm5lY3RDaGFu' +
	'bmVsPy5JbnZva2UoKTsgfQogICAgICAgIGNhdGNoIHsgfQoKICAgICAgICBfYWN0aXZlQ29ubmVjdGlvbklkID0gLTE7CgogICAg' +
	'ICAgIHRyeSB7IGlmIChGaWxlLkV4aXN0cyhESVNDT1ZFUllfRklMRSkpIEZpbGUuRGVsZXRlKERJU0NPVkVSWV9GSUxFKTsgfQog' +
	'ICAgICAgIGNhdGNoIHsgfQoKICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURFIEJyaWRnZV0gU3RvcHBlZCIpOwogICAgfQoK' +
	'ICAgIC8vIC0tLSBVbml0eSBFdmVudCBGb3J3YXJkaW5nIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgT25Mb2dNZXNzYWdl' +
	'KHN0cmluZyBjb25kaXRpb24sIHN0cmluZyBzdGFja1RyYWNlLCBMb2dUeXBlIHR5cGUpCiAgICB7CiAgICAgICAgaWYgKF9hY3Rp' +
	'dmVDb25uZWN0aW9uSWQgPCAwKSByZXR1cm47CgogICAgICAgIHZhciBsb2dUeXBlID0gdHlwZSBzd2l0Y2gKICAgICAgICB7CiAg' +
	'ICAgICAgICAgIExvZ1R5cGUuRXJyb3IgPT4gIkVycm9yIiwKICAgICAgICAgICAgTG9nVHlwZS5XYXJuaW5nID0+ICJXYXJuaW5n' +
	'IiwKICAgICAgICAgICAgTG9nVHlwZS5FeGNlcHRpb24gPT4gIkV4Y2VwdGlvbiIsCiAgICAgICAgICAgIExvZ1R5cGUuQXNzZXJ0' +
	'ID0+ICJBc3NlcnQiLAogICAgICAgICAgICBfID0+ICJMb2ciCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGV2ZW50SnNvbiA9ICQi' +
	'e3tcImlkXCI6XCJ7R3VpZC5OZXdHdWlkKCl9XCIsXCJ0eXBlXCI6XCJldmVudFwiLFwiZXZlbnRcIjpcImNvbnNvbGUubG9nXCIs' +
	'XCJkYXRhXCI6e3tcIm1lc3NhZ2VcIjp7RXNjYXBlSnNvbihjb25kaXRpb24pfSxcInN0YWNrVHJhY2VcIjp7RXNjYXBlSnNvbihz' +
	'dGFja1RyYWNlID8/ICIiKX0sXCJsb2dUeXBlXCI6XCJ7bG9nVHlwZX1cIixcInRpbWVzdGFtcFwiOntEYXRlVGltZU9mZnNldC5V' +
	'dGNOb3cuVG9Vbml4VGltZU1pbGxpc2Vjb25kcygpfX19fX0iOwogICAgICAgIFNlbmRSZXNwb25zZShldmVudEpzb24pOwogICAg' +
	'fQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgT25QbGF5TW9kZUNoYW5nZWQoUGxheU1vZGVTdGF0ZUNoYW5nZSBzdGF0ZSkKICAg' +
	'IHsKICAgICAgICBpZiAoX2FjdGl2ZUNvbm5lY3Rpb25JZCA8IDApIHJldHVybjsKCiAgICAgICAgdmFyIHBsYXlTdGF0ZSA9IHN0' +
	'YXRlIHN3aXRjaAogICAgICAgIHsKICAgICAgICAgICAgUGxheU1vZGVTdGF0ZUNoYW5nZS5FbnRlcmVkUGxheU1vZGUgPT4gInBs' +
	'YXlpbmciLAogICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkV4aXRpbmdQbGF5TW9kZSA9PiAic3RvcHBlZCIsCiAgICAg' +
	'ICAgICAgIFBsYXlNb2RlU3RhdGVDaGFuZ2UuRW50ZXJlZEVkaXRNb2RlID0+ICJzdG9wcGVkIiwKICAgICAgICAgICAgUGxheU1v' +
	'ZGVTdGF0ZUNoYW5nZS5FeGl0aW5nRWRpdE1vZGUgPT4gInBsYXlpbmciLAogICAgICAgICAgICBfID0+ICJzdG9wcGVkIgogICAg' +
	'ICAgIH07CgogICAgICAgIHZhciBldmVudEpzb24gPSAkInt7XCJpZFwiOlwie0d1aWQuTmV3R3VpZCgpfVwiLFwidHlwZVwiOlwi' +
	'ZXZlbnRcIixcImV2ZW50XCI6XCJwbGF5TW9kZUNoYW5nZWRcIixcImRhdGFcIjp7e1wic3RhdGVcIjpcIntwbGF5U3RhdGV9XCJ9' +
	'fX19IjsKICAgICAgICBTZW5kUmVzcG9uc2UoZXZlbnRKc29uKTsKICAgIH0KCiAgICAvLyAtLS0gTWVzc2FnZSBQcm9jZXNzaW5n' +
	'IChNYWluIFRocmVhZCkgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBQcm9jZXNzTWVzc2FnZXMoKQogICAgewogICAgICAg' +
	'IC8vIFByb2Nlc3MgdXAgdG8gNTAgbWVzc2FnZXMgcGVyIGZyYW1lIHRvIGhhbmRsZSBjb21tYW5kIGJ1cnN0cyBxdWlja2x5CiAg' +
	'ICAgICAgaW50IHByb2Nlc3NlZCA9IDA7CiAgICAgICAgd2hpbGUgKF9pbmNvbWluZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZh' +
	'ciBtZXNzYWdlKSAmJiBwcm9jZXNzZWQgPCA1MCkKICAgICAgICB7CiAgICAgICAgICAgIHByb2Nlc3NlZCsrOwogICAgICAgICAg' +
	'ICBzdHJpbmcgcmVxdWVzdElkID0gInVua25vd24iOwogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAg' +
	'ICAgdmFyIHJlcXVlc3QgPSBQYXJzZVJlcXVlc3QobWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXF1ZXN0SWQgPSByZXF1ZXN0' +
	'LmlkOwogICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gSGFuZGxlQ29tbWFuZChyZXF1ZXN0KTsKICAgICAgICAgICAgICAg' +
	'IFNlbmRSZXNwb25zZShyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAg' +
	'ICAgICAgICAgewogICAgICAgICAgICAgICAgRGVidWcuTG9nRXJyb3IoJCJbR2FtZURldklERSBCcmlkZ2VdIEVycm9yIHByb2Nl' +
	'c3NpbmcgbWVzc2FnZToge2V4Lk1lc3NhZ2V9Iik7CiAgICAgICAgICAgICAgICBTZW5kUmVzcG9uc2UoTWFrZUVycm9yKHJlcXVl' +
	'c3RJZCwgZXguTWVzc2FnZSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyA8c3VtbWFyeT4KICAgIC8v' +
	'LyBNYW51YWxseSBwYXJzZSBhIEpTT04gcmVxdWVzdCBzaW5jZSBVbml0eSdzIEpzb25VdGlsaXR5IGNhbid0IGhhbmRsZQogICAg' +
	'Ly8vIG5lc3RlZCBkaWN0aW9uYXJpZXMgb3IgdGhlICdwYXJhbXMnIGZpZWxkIHByb3Blcmx5LgogICAgLy8vIDwvc3VtbWFyeT4K' +
	'ICAgIHByaXZhdGUgc3RhdGljIFNlcmlhbGl6YWJsZVJlcXVlc3QgUGFyc2VSZXF1ZXN0KHN0cmluZyBqc29uKQogICAgewogICAg' +
	'ICAgIHZhciByZXEgPSBuZXcgU2VyaWFsaXphYmxlUmVxdWVzdCgpOwogICAgICAgIHJlcS5pZCA9IEV4dHJhY3RKc29uU3RyaW5n' +
	'KGpzb24sICJpZCIpID8/IEd1aWQuTmV3R3VpZCgpLlRvU3RyaW5nKCk7CiAgICAgICAgcmVxLnR5cGUgPSBFeHRyYWN0SnNvblN0' +
	'cmluZyhqc29uLCAidHlwZSIpID8/ICJyZXF1ZXN0IjsKICAgICAgICByZXEuY2F0ZWdvcnkgPSBFeHRyYWN0SnNvblN0cmluZyhq' +
	'c29uLCAiY2F0ZWdvcnkiKSA/PyAiIjsKICAgICAgICByZXEuYWN0aW9uID0gRXh0cmFjdEpzb25TdHJpbmcoanNvbiwgImFjdGlv' +
	'biIpID8/ICIiOwoKICAgICAgICAvLyBFeHRyYWN0IHRoZSBwYXJhbXMgb2JqZWN0IGFzIGEgcmF3IEpTT04gc3Vic3RyaW5nCiAg' +
	'ICAgICAgdmFyIHBhcmFtc0lkeCA9IGpzb24uSW5kZXhPZigiXCJwYXJhbXNcIiIpOwogICAgICAgIGlmIChwYXJhbXNJZHggPj0g' +
	'MCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBjb2xvbklkeCA9IGpzb24uSW5kZXhPZignOicsIHBhcmFtc0lkeCk7CiAgICAg' +
	'ICAgICAgIGlmIChjb2xvbklkeCA+PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXEucGFyYW1zSnNvbiA9IEV4' +
	'dHJhY3RKc29uT2JqZWN0KGpzb24sIGNvbG9uSWR4ICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVy' +
	'biByZXE7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEV4dHJhY3RKc29uU3RyaW5nKHN0cmluZyBqc29uLCBzdHJp' +
	'bmcga2V5KQogICAgewogICAgICAgIHZhciBwYXR0ZXJuID0gJCJcIntrZXl9XCIiOwogICAgICAgIHZhciBpZHggPSBqc29uLklu' +
	'ZGV4T2YocGF0dGVybik7CiAgICAgICAgaWYgKGlkeCA8IDApIHJldHVybiBudWxsOwoKICAgICAgICB2YXIgY29sb25JZHggPSBq' +
	'c29uLkluZGV4T2YoJzonLCBpZHggKyBwYXR0ZXJuLkxlbmd0aCk7CiAgICAgICAgaWYgKGNvbG9uSWR4IDwgMCkgcmV0dXJuIG51' +
	'bGw7CgogICAgICAgIC8vIFNraXAgd2hpdGVzcGFjZQogICAgICAgIHZhciBzdGFydElkeCA9IGNvbG9uSWR4ICsgMTsKICAgICAg' +
	'ICB3aGlsZSAoc3RhcnRJZHggPCBqc29uLkxlbmd0aCAmJiBjaGFyLklzV2hpdGVTcGFjZShqc29uW3N0YXJ0SWR4XSkpIHN0YXJ0' +
	'SWR4Kys7CgogICAgICAgIGlmIChzdGFydElkeCA+PSBqc29uLkxlbmd0aCB8fCBqc29uW3N0YXJ0SWR4XSAhPSAnIicpIHJldHVy' +
	'biBudWxsOwoKICAgICAgICAvLyBSZWFkIHVudGlsIGNsb3NpbmcgcXVvdGUgKGhhbmRsaW5nIGVzY2FwZXMpCiAgICAgICAgdmFy' +
	'IHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBmb3IgKGludCBpID0gc3RhcnRJZHggKyAxOyBpIDwganNvbi5MZW5n' +
	'dGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChqc29uW2ldID09ICdcXCcgJiYgaSArIDEgPCBqc29uLkxlbmd0aCkK' +
	'ICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc2IuQXBwZW5kKGpzb25baSArIDFdKTsKICAgICAgICAgICAgICAgIGkrKzsK' +
	'ICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChqc29uW2ldID09ICciJykKICAgICAgICAgICAgewogICAgICAgICAg' +
	'ICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBz' +
	'Yi5BcHBlbmQoanNvbltpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNiLlRvU3RyaW5nKCk7CiAg' +
	'ICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEV4dHJhY3RKc29uT2JqZWN0KHN0cmluZyBqc29uLCBpbnQgc3RhcnRJZHgp' +
	'CiAgICB7CiAgICAgICAgLy8gU2tpcCB3aGl0ZXNwYWNlCiAgICAgICAgd2hpbGUgKHN0YXJ0SWR4IDwganNvbi5MZW5ndGggJiYg' +
	'Y2hhci5Jc1doaXRlU3BhY2UoanNvbltzdGFydElkeF0pKSBzdGFydElkeCsrOwogICAgICAgIGlmIChzdGFydElkeCA+PSBqc29u' +
	'Lkxlbmd0aCB8fCBqc29uW3N0YXJ0SWR4XSAhPSAneycpIHJldHVybiAie30iOwoKICAgICAgICB2YXIgZGVwdGggPSAwOwogICAg' +
	'ICAgIHZhciBpblN0cmluZyA9IGZhbHNlOwogICAgICAgIGZvciAoaW50IGkgPSBzdGFydElkeDsgaSA8IGpzb24uTGVuZ3RoOyBp' +
	'KyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoanNvbltpXSA9PSAnIicgJiYgKGkgPT0gMCB8fCBqc29uW2kgLSAxXSAhPSAn' +
	'XFwnKSkKICAgICAgICAgICAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nOwogICAgICAgICAgICBlbHNlIGlmICghaW5TdHJpbmcp' +
	'CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChqc29uW2ldID09ICd7JykgZGVwdGgrKzsKICAgICAgICAgICAgICAg' +
	'IGVsc2UgaWYgKGpzb25baV0gPT0gJ30nKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGRlcHRoLS07CiAg' +
	'ICAgICAgICAgICAgICAgICAgaWYgKGRlcHRoID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBqc29uLlN1YnN0' +
	'cmluZyhzdGFydElkeCwgaSAtIHN0YXJ0SWR4ICsgMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9' +
	'CiAgICAgICAgcmV0dXJuICJ7fSI7CiAgICB9CgogICAgLy8gLS0tIENvbW1hbmQgRGlzcGF0Y2ggLS0tCgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgc3RyaW5nIEhhbmRsZUNvbW1hbmQoU2VyaWFsaXphYmxlUmVxdWVzdCByZXF1ZXN0KQogICAgewogICAgICAgIHZhciBr' +
	'ZXkgPSAkIntyZXF1ZXN0LmNhdGVnb3J5fS57cmVxdWVzdC5hY3Rpb259IjsKICAgICAgICB2YXIgcCA9IHJlcXVlc3QuR2V0UGFy' +
	'YW1zKCk7CgogICAgICAgIHN3aXRjaCAoa2V5KQogICAgICAgIHsKICAgICAgICAgICAgLy8gLS0tIFNjZW5lIC0tLQogICAgICAg' +
	'ICAgICBjYXNlICJzY2VuZS5nZXRBY3RpdmUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldEFjdGl2ZVNjZW5lKHJl' +
	'cXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJzY2VuZS5nZXRIaWVyYXJjaHkiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhh' +
	'bmRsZUdldEhpZXJhcmNoeShyZXF1ZXN0LmlkKTsKICAgICAgICAgICAgY2FzZSAic2NlbmUuY3JlYXRlIjoKICAgICAgICAgICAg' +
	'ICAgIHJldHVybiBIYW5kbGVDcmVhdGVTY2VuZShyZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAic2NlbmUuc2F2ZSI6' +
	'CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlU2F2ZVNjZW5lKHJlcXVlc3QuaWQpOwoKICAgICAgICAgICAgLy8gLS0tIEdh' +
	'bWVPYmplY3QgLS0tCiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuY3JlYXRlIjoKICAgICAgICAgICAgICAgIHJldHVybiBI' +
	'YW5kbGVDcmVhdGVHYW1lT2JqZWN0KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJnYW1lT2JqZWN0LmNyZWF0ZVBy' +
	'aW1pdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlUHJpbWl0aXZlKHJlcXVlc3QuaWQsIHApOwogICAg' +
	'ICAgICAgICBjYXNlICJnYW1lT2JqZWN0LmZpbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUZpbmRHYW1lT2JqZWN0' +
	'KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJnYW1lT2JqZWN0LmRlc3Ryb3kiOgogICAgICAgICAgICAgICAgcmV0' +
	'dXJuIEhhbmRsZURlc3Ryb3lHYW1lT2JqZWN0KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJnYW1lT2JqZWN0LnNl' +
	'dEFjdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlU2V0QWN0aXZlKHJlcXVlc3QuaWQsIHApOwogICAgICAgICAg' +
	'ICBjYXNlICJnYW1lT2JqZWN0LnNldFRyYW5zZm9ybSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlU2V0VHJhbnNmb3Jt' +
	'KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJnYW1lT2JqZWN0LmdldFNlbGVjdGVkIjoKICAgICAgICAgICAgICAg' +
	'IHJldHVybiBIYW5kbGVHZXRTZWxlY3RlZChyZXF1ZXN0LmlkKTsKCiAgICAgICAgICAgIC8vIC0tLSBDb21wb25lbnQgLS0tCiAg' +
	'ICAgICAgICAgIGNhc2UgImNvbXBvbmVudC5hZGQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUFkZENvbXBvbmVudChy' +
	'ZXF1ZXN0LmlkLCBwKTsKICAgICAgICAgICAgY2FzZSAiY29tcG9uZW50LnJlbW92ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4g' +
	'SGFuZGxlUmVtb3ZlQ29tcG9uZW50KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJjb21wb25lbnQuZ2V0QWxsIjoK' +
	'ICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVHZXRDb21wb25lbnRzKHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNl' +
	'ICJjb21wb25lbnQuc2V0UHJvcGVydHkiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZVNldFByb3BlcnR5KHJlcXVlc3Qu' +
	'aWQsIHApOwoKICAgICAgICAgICAgLy8gLS0tIFByZWZhYiAtLS0KICAgICAgICAgICAgY2FzZSAicHJlZmFiLmNyZWF0ZSI6CiAg' +
	'ICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlUHJlZmFiKHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJw' +
	'cmVmYWIuaW5zdGFudGlhdGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUluc3RhbnRpYXRlUHJlZmFiKHJlcXVlc3Qu' +
	'aWQsIHApOwogICAgICAgICAgICBjYXNlICJwcmVmYWIuZ2V0QWxsIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVHZXRB' +
	'bGxQcmVmYWJzKHJlcXVlc3QuaWQpOwoKICAgICAgICAgICAgLy8gLS0tIEFzc2V0IC0tLQogICAgICAgICAgICBjYXNlICJhc3Nl' +
	'dC5jcmVhdGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUNyZWF0ZUFzc2V0KHJlcXVlc3QuaWQsIHApOwogICAgICAg' +
	'ICAgICBjYXNlICJhc3NldC5maW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVGaW5kQXNzZXRzKHJlcXVlc3QuaWQs' +
	'IHApOwogICAgICAgICAgICBjYXNlICJhc3NldC5pbXBvcnQiOgogICAgICAgICAgICAgICAgQXNzZXREYXRhYmFzZS5SZWZyZXNo' +
	'KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVxdWVzdC5pZCwgInt9Iik7CgogICAgICAgICAgICAvLyAt' +
	'LS0gUHJvamVjdCAtLS0KICAgICAgICAgICAgY2FzZSAicHJvamVjdC5nZXRJbmZvIjoKICAgICAgICAgICAgICAgIHJldHVybiBI' +
	'YW5kbGVHZXRQcm9qZWN0SW5mbyhyZXF1ZXN0LmlkKTsKICAgICAgICAgICAgY2FzZSAicHJvamVjdC5yZWZyZXNoIjoKICAgICAg' +
	'ICAgICAgICAgIEFzc2V0RGF0YWJhc2UuUmVmcmVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVl' +
	'c3QuaWQsICJ7fSIpOwoKICAgICAgICAgICAgLy8gLS0tIEVkaXRvciAtLS0KICAgICAgICAgICAgY2FzZSAiZWRpdG9yLmdldFBs' +
	'YXlNb2RlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVHZXRQbGF5TW9kZShyZXF1ZXN0LmlkKTsKICAgICAgICAgICAg' +
	'Y2FzZSAiZWRpdG9yLnBsYXkiOgogICAgICAgICAgICAgICAgRWRpdG9yQXBwbGljYXRpb24uaXNQbGF5aW5nID0gdHJ1ZTsKICAg' +
	'ICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAie1wic3RhdGVcIjpcInBsYXlpbmdcIn0iKTsKICAg' +
	'ICAgICAgICAgY2FzZSAiZWRpdG9yLnBhdXNlIjoKICAgICAgICAgICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLmlzUGF1c2VkID0g' +
	'IUVkaXRvckFwcGxpY2F0aW9uLmlzUGF1c2VkOwogICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQs' +
	'ICQie3tcInBhdXNlZFwiOntFZGl0b3JBcHBsaWNhdGlvbi5pc1BhdXNlZC5Ub1N0cmluZygpLlRvTG93ZXIoKX19fSIpOwogICAg' +
	'ICAgICAgICBjYXNlICJlZGl0b3Iuc3RvcCI6CiAgICAgICAgICAgICAgICBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcgPSBm' +
	'YWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAie1wic3RhdGVcIjpcInN0b3BwZWRc' +
	'In0iKTsKICAgICAgICAgICAgY2FzZSAiZWRpdG9yLmV4ZWN1dGVNZW51SXRlbSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFu' +
	'ZGxlRXhlY3V0ZU1lbnVJdGVtKHJlcXVlc3QuaWQsIHApOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJl' +
	'dHVybiBNYWtlRXJyb3IocmVxdWVzdC5pZCwgJCJVbmtub3duIGNvbW1hbmQ6IHtrZXl9Iik7CiAgICAgICAgfQogICAgfQoKICAg' +
	'IC8vIC0tLSBTY2VuZSBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0QWN0aXZlU2NlbmUo' +
	'c3RyaW5nIGlkKQogICAgewogICAgICAgIHZhciBzY2VuZSA9IFNjZW5lTWFuYWdlci5HZXRBY3RpdmVTY2VuZSgpOwogICAgICAg' +
	'IHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKHNjZW5lLm5hbWUpfSxcInBhdGhcIjp7RXNj' +
	'YXBlSnNvbihzY2VuZS5wYXRoKX0sXCJyb290Q291bnRcIjp7c2NlbmUucm9vdENvdW50fSxcImlzRGlydHlcIjp7c2NlbmUuaXNE' +
	'aXJ0eS5Ub1N0cmluZygpLlRvTG93ZXIoKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRI' +
	'aWVyYXJjaHkoc3RyaW5nIGlkKQogICAgewogICAgICAgIHZhciBzY2VuZSA9IFNjZW5lTWFuYWdlci5HZXRBY3RpdmVTY2VuZSgp' +
	'OwogICAgICAgIHZhciByb290cyA9IHNjZW5lLkdldFJvb3RHYW1lT2JqZWN0cygpOwogICAgICAgIHZhciBzYiA9IG5ldyBTdHJp' +
	'bmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJzY2VuZVwiOiIpOwogICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29u' +
	'KHNjZW5lLm5hbWUpKTsKICAgICAgICBzYi5BcHBlbmQoIixcImhpZXJhcmNoeVwiOlsiKTsKICAgICAgICBmb3IgKGludCBpID0g' +
	'MDsgaSA8IHJvb3RzLkxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsK' +
	'ICAgICAgICAgICAgQnVpbGRIaWVyYXJjaHlKc29uKHJvb3RzW2ldLCBzYik7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgi' +
	'XX0iKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsIHNiLlRvU3RyaW5nKCkpOwogICAgfQoKICAgIHByaXZhdGUgc3Rh' +
	'dGljIHZvaWQgQnVpbGRIaWVyYXJjaHlKc29uKEdhbWVPYmplY3QgZ28sIFN0cmluZ0J1aWxkZXIgc2IpCiAgICB7CiAgICAgICAg' +
	'c2IuQXBwZW5kKCJ7XCJuYW1lXCI6Iik7CiAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24oZ28ubmFtZSkpOwogICAgICAgIHNi' +
	'LkFwcGVuZCgiLFwiYWN0aXZlXCI6Iik7CiAgICAgICAgc2IuQXBwZW5kKGdvLmFjdGl2ZVNlbGYuVG9TdHJpbmcoKS5Ub0xvd2Vy' +
	'KCkpOwogICAgICAgIHNiLkFwcGVuZCgiLFwiY29tcG9uZW50c1wiOlsiKTsKICAgICAgICB2YXIgY29tcG9uZW50cyA9IGdvLkdl' +
	'dENvbXBvbmVudHM8Q29tcG9uZW50PigpOwogICAgICAgIGZvciAoaW50IGMgPSAwOyBjIDwgY29tcG9uZW50cy5MZW5ndGg7IGMr' +
	'KykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChjb21wb25lbnRzW2NdID09IG51bGwpIGNvbnRpbnVlOwogICAgICAgICAgICBp' +
	'ZiAoYyA+IDApIHNiLkFwcGVuZCgiLCIpOwogICAgICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihjb21wb25lbnRzW2NdLkdl' +
	'dFR5cGUoKS5OYW1lKSk7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgiXSxcImNoaWxkcmVuXCI6WyIpOwogICAgICAgIGZv' +
	'ciAoaW50IGkgPSAwOyBpIDwgZ28udHJhbnNmb3JtLmNoaWxkQ291bnQ7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChp' +
	'ID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIEJ1aWxkSGllcmFyY2h5SnNvbihnby50cmFuc2Zvcm0uR2V0Q2hpbGQo' +
	'aSkuZ2FtZU9iamVjdCwgc2IpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0ZVNjZW5lKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAg' +
	'IHsKICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiTmV3IFNjZW5lIik7CiAgICAgICAgdmFy' +
	'IHNjZW5lID0gRWRpdG9yU2NlbmVNYW5hZ2VyLk5ld1NjZW5lKE5ld1NjZW5lU2V0dXAuRGVmYXVsdEdhbWVPYmplY3RzLCBOZXdT' +
	'Y2VuZU1vZGUuU2luZ2xlKTsKICAgICAgICBpZiAocC5UcnlHZXRWYWx1ZSgicGF0aCIsIG91dCB2YXIgcGF0aCkpCiAgICAgICAg' +
	'ewogICAgICAgICAgICBFZGl0b3JTY2VuZU1hbmFnZXIuU2F2ZVNjZW5lKHNjZW5lLCBwYXRoKTsKICAgICAgICB9CiAgICAgICAg' +
	'cmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oc2NlbmUubmFtZSl9LFwicGF0aFwiOntFc2Nh' +
	'cGVKc29uKHNjZW5lLnBhdGgpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZVNhdmVTY2VuZShz' +
	'dHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5lKCk7CiAgICAgICAg' +
	'RWRpdG9yU2NlbmVNYW5hZ2VyLlNhdmVTY2VuZShzY2VuZSk7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJu' +
	'YW1lXCI6e0VzY2FwZUpzb24oc2NlbmUubmFtZSl9LFwicGF0aFwiOntFc2NhcGVKc29uKHNjZW5lLnBhdGgpfX19Iik7CiAgICB9' +
	'CgogICAgLy8gLS0tIEdhbWVPYmplY3QgSGFuZGxlcnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0' +
	'ZUdhbWVPYmplY3Qoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBuYW1l' +
	'ID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgibmFtZSIsICJHYW1lT2JqZWN0Iik7CgogICAgICAgIC8vIFJlc29sdmUgcGFyZW50IGZp' +
	'cnN0IHNvIHdlIGNhbiBkZWNpZGUgd2hldGhlciBhIFJlY3RUcmFuc2Zvcm0gaXMgbmVlZGVkCiAgICAgICAgR2FtZU9iamVjdCBw' +
	'YXJlbnRHbyA9IG51bGw7CiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInBhcmVudFBhdGgiLCBvdXQgdmFyIHBhcmVudFBhdGgp' +
	'ICYmICFzdHJpbmcuSXNOdWxsT3JFbXB0eShwYXJlbnRQYXRoKSkKICAgICAgICAgICAgcGFyZW50R28gPSBGaW5kR2FtZU9iamVj' +
	'dEJ5UGF0aChwYXJlbnRQYXRoKTsKCiAgICAgICAgLy8gSWYgdGhlIHBhcmVudCBsaXZlcyBpbnNpZGUgYSBDYW52YXMgaGllcmFy' +
	'Y2h5IHRoZSBuZXcgb2JqZWN0IG11c3QgdXNlIFJlY3RUcmFuc2Zvcm0KICAgICAgICAvLyBzbyB0aGF0IFVuaXR5J3MgVUkgbGF5' +
	'b3V0IHN5c3RlbSBjYW4gcG9zaXRpb24gaXQgY29ycmVjdGx5LgogICAgICAgIGJvb2wgbmVlZHNSZWN0ID0gcGFyZW50R28gIT0g' +
	'bnVsbCAmJiBJc0luQ2FudmFzSGllcmFyY2h5KHBhcmVudEdvLnRyYW5zZm9ybSk7CiAgICAgICAgdmFyIGdvID0gbmVlZHNSZWN0' +
	'ID8gbmV3IEdhbWVPYmplY3QobmFtZSwgdHlwZW9mKFJlY3RUcmFuc2Zvcm0pKSA6IG5ldyBHYW1lT2JqZWN0KG5hbWUpOwoKICAg' +
	'ICAgICBpZiAocGFyZW50R28gIT0gbnVsbCkKICAgICAgICAgICAgZ28udHJhbnNmb3JtLlNldFBhcmVudChwYXJlbnRHby50cmFu' +
	'c2Zvcm0sIGZhbHNlKTsKCiAgICAgICAgVW5kby5SZWdpc3RlckNyZWF0ZWRPYmplY3RVbmRvKGdvLCAkIkNyZWF0ZSB7bmFtZX0i' +
	'KTsKICAgICAgICBTZWxlY3Rpb24uYWN0aXZlR2FtZU9iamVjdCA9IGdvOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwg' +
	'JCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImluc3RhbmNlSWRcIjp7Z28uR2V0SW5zdGFuY2VJRCgpfX19Iik7' +
	'CiAgICB9CgogICAgLy8vIDxzdW1tYXJ5PlJldHVybnMgdHJ1ZSBpZiA8cGFyYW1yZWYgbmFtZT0idCIvPiBpcyB0aGUgQ2FudmFz' +
	'IGl0c2VsZiBvciBhbnkgb2YgaXRzIGRlc2NlbmRhbnRzLjwvc3VtbWFyeT4KICAgIHByaXZhdGUgc3RhdGljIGJvb2wgSXNJbkNh' +
	'bnZhc0hpZXJhcmNoeShUcmFuc2Zvcm0gdCkKICAgIHsKICAgICAgICB3aGlsZSAodCAhPSBudWxsKQogICAgICAgIHsKICAgICAg' +
	'ICAgICAgaWYgKHQuR2V0Q29tcG9uZW50PENhbnZhcz4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg' +
	'ICAgICAgICAgIHQgPSB0LnBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHByaXZhdGUg' +
	'c3RhdGljIHN0cmluZyBIYW5kbGVDcmVhdGVQcmltaXRpdmUoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBw' +
	'KQogICAgewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgibmFtZSIsICJQcmltaXRpdmUiKTsKICAgICAg' +
	'ICB2YXIgdHlwZVN0ciA9IHAuR2V0VmFsdWVPckRlZmF1bHQoInByaW1pdGl2ZVR5cGUiLCAiQ3ViZSIpOwoKICAgICAgICBpZiAo' +
	'IUVudW0uVHJ5UGFyc2U8UHJpbWl0aXZlVHlwZT4odHlwZVN0ciwgdHJ1ZSwgb3V0IHZhciBwcmltaXRpdmVUeXBlKSkKICAgICAg' +
	'ICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJVbmtub3duIHByaW1pdGl2ZSB0eXBlOiB7dHlwZVN0cn0uIFZhbGlkOiBTcGhl' +
	'cmUsIENhcHN1bGUsIEN5bGluZGVyLCBDdWJlLCBQbGFuZSwgUXVhZCIpOwoKICAgICAgICB2YXIgZ28gPSBHYW1lT2JqZWN0LkNy' +
	'ZWF0ZVByaW1pdGl2ZShwcmltaXRpdmVUeXBlKTsKICAgICAgICBnby5uYW1lID0gbmFtZTsKCiAgICAgICAgaWYgKHAuVHJ5R2V0' +
	'VmFsdWUoInBhcmVudFBhdGgiLCBvdXQgdmFyIHBhcmVudFBhdGgpICYmICFzdHJpbmcuSXNOdWxsT3JFbXB0eShwYXJlbnRQYXRo' +
	'KSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChwYXJlbnRQYXRoKTsKICAg' +
	'ICAgICAgICAgaWYgKHBhcmVudCAhPSBudWxsKQogICAgICAgICAgICAgICAgZ28udHJhbnNmb3JtLlNldFBhcmVudChwYXJlbnQu' +
	'dHJhbnNmb3JtLCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBVbmRvLlJlZ2lzdGVyQ3JlYXRlZE9iamVjdFVuZG8oZ28sICQi' +
	'Q3JlYXRlIHtuYW1lfSIpOwogICAgICAgIFNlbGVjdGlvbi5hY3RpdmVHYW1lT2JqZWN0ID0gZ287CiAgICAgICAgcmV0dXJuIE1h' +
	'a2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwiaW5zdGFuY2VJZFwiOntnby5HZXRJbnN0' +
	'YW5jZUlEKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlRmluZEdhbWVPYmplY3Qoc3RyaW5n' +
	'IGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVm' +
	'YXVsdCgibmFtZSIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChuYW1lKTsKICAgICAgICBpZiAo' +
	'Z28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge25hbWV9' +
	'Iik7CgogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImlu' +
	'c3RhbmNlSWRcIjp7Z28uR2V0SW5zdGFuY2VJRCgpfSxcImFjdGl2ZVwiOntnby5hY3RpdmVTZWxmLlRvU3RyaW5nKCkuVG9Mb3dl' +
	'cigpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZURlc3Ryb3lHYW1lT2JqZWN0KHN0cmluZyBp' +
	'ZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1' +
	'bHQoImdhbWVPYmplY3RQYXRoIiwgcC5HZXRWYWx1ZU9yRGVmYXVsdCgibmFtZSIsICIiKSk7CiAgICAgICAgdmFyIGdvID0gRmlu' +
	'ZEdhbWVPYmplY3RCeVBhdGgobmFtZSk7CiAgICAgICAgaWYgKGdvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJy' +
	'b3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtuYW1lfSIpOwoKICAgICAgICBVbmRvLkRlc3Ryb3lPYmplY3RJbW1lZGlh' +
	'dGUoZ28pOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgInt9Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3Ry' +
	'aW5nIEhhbmRsZVNldEFjdGl2ZShzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAg' +
	'dmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5k' +
	'R2FtZU9iamVjdEJ5UGF0aChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJv' +
	'cihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAgIHZhciBhY3RpdmUgPSBwLkdldFZhbHVlT3JE' +
	'ZWZhdWx0KCJhY3RpdmUiLCAidHJ1ZSIpID09ICJ0cnVlIjsKICAgICAgICBVbmRvLlJlY29yZE9iamVjdChnbywgJCJTZXQgQWN0' +
	'aXZlIHtnby5uYW1lfSIpOwogICAgICAgIGdvLlNldEFjdGl2ZShhY3RpdmUpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2Vzcyhp' +
	'ZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImFjdGl2ZVwiOntnby5hY3RpdmVTZWxmLlRvU3RyaW5nKCku' +
	'VG9Mb3dlcigpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZVNldFRyYW5zZm9ybShzdHJpbmcg' +
	'aWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZh' +
	'dWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChwYXRoKTsKICAg' +
	'ICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3Vu' +
	'ZDoge3BhdGh9Iik7CgogICAgICAgIFVuZG8uUmVjb3JkT2JqZWN0KGdvLnRyYW5zZm9ybSwgJCJUcmFuc2Zvcm0ge2dvLm5hbWV9' +
	'Iik7CgogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJwb3NpdGlvbiIsIG91dCB2YXIgcG9zU3RyKSkKICAgICAgICAgICAgZ28u' +
	'dHJhbnNmb3JtLnBvc2l0aW9uID0gUGFyc2VWZWN0b3IzKHBvc1N0cik7CiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInJvdGF0' +
	'aW9uIiwgb3V0IHZhciByb3RTdHIpKQogICAgICAgICAgICBnby50cmFuc2Zvcm0uZXVsZXJBbmdsZXMgPSBQYXJzZVZlY3RvcjMo' +
	'cm90U3RyKTsKICAgICAgICBpZiAocC5UcnlHZXRWYWx1ZSgic2NhbGUiLCBvdXQgdmFyIHNjYWxlU3RyKSkKICAgICAgICAgICAg' +
	'Z28udHJhbnNmb3JtLmxvY2FsU2NhbGUgPSBQYXJzZVZlY3RvcjMoc2NhbGVTdHIpOwoKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nl' +
	'c3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJwb3NpdGlvblwiOlwie2dvLnRyYW5zZm9ybS5wb3Np' +
	'dGlvbn1cIixcInJvdGF0aW9uXCI6XCJ7Z28udHJhbnNmb3JtLmV1bGVyQW5nbGVzfVwiLFwic2NhbGVcIjpcIntnby50cmFuc2Zv' +
	'cm0ubG9jYWxTY2FsZX1cIn19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFNlbGVjdGVkKHN0' +
	'cmluZyBpZCkKICAgIHsKICAgICAgICB2YXIgc2VsZWN0ZWQgPSBTZWxlY3Rpb24uZ2FtZU9iamVjdHM7CiAgICAgICAgdmFyIHNi' +
	'ID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcInNlbGVjdGVkXCI6WyIpOwogICAgICAgIGZvciAo' +
	'aW50IGkgPSAwOyBpIDwgc2VsZWN0ZWQuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFw' +
	'cGVuZCgiLCIpOwogICAgICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihzZWxlY3RlZFtpXS5uYW1lKSk7CiAgICAgICAgfQog' +
	'ICAgICAgIHNiLkFwcGVuZCgiXX0iKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsIHNiLlRvU3RyaW5nKCkpOwogICAg' +
	'fQoKICAgIC8vIC0tLSBDb21wb25lbnQgSGFuZGxlcnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUFkZENv' +
	'bXBvbmVudChzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBw' +
	'LkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5' +
	'UGF0aChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1l' +
	'T2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAgIHZhciB0eXBlTmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImNv' +
	'bXBvbmVudFR5cGUiLCAiIik7CiAgICAgICAgdmFyIHR5cGUgPSBGaW5kQ29tcG9uZW50VHlwZSh0eXBlTmFtZSk7CiAgICAgICAg' +
	'aWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJDb21wb25lbnQgdHlwZSBub3QgZm91' +
	'bmQ6IHt0eXBlTmFtZX0iKTsKCiAgICAgICAgVW5kby5BZGRDb21wb25lbnQoZ28sIHR5cGUpOwogICAgICAgIHJldHVybiBNYWtl' +
	'U3VjY2VzcyhpZCwgJCJ7e1wiZ2FtZU9iamVjdFwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImNvbXBvbmVudFwiOntFc2NhcGVK' +
	'c29uKHR5cGUuTmFtZSl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlUmVtb3ZlQ29tcG9uZW50' +
	'KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcGF0aCA9IHAuR2V0VmFs' +
	'dWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKHBh' +
	'dGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmplY3Qg' +
	'bm90IGZvdW5kOiB7cGF0aH0iKTsKCiAgICAgICAgdmFyIHR5cGVOYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiY29tcG9uZW50' +
	'VHlwZSIsICIiKTsKICAgICAgICB2YXIgY29tcCA9IGdvLkdldENvbXBvbmVudCh0eXBlTmFtZSk7CiAgICAgICAgaWYgKGNvbXAg' +
	'PT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJDb21wb25lbnQgbm90IGZvdW5kOiB7dHlwZU5hbWV9' +
	'IG9uIHtnby5uYW1lfSIpOwoKICAgICAgICBVbmRvLkRlc3Ryb3lPYmplY3RJbW1lZGlhdGUoY29tcCk7CiAgICAgICAgcmV0dXJu' +
	'IE1ha2VTdWNjZXNzKGlkLCAie30iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0Q29tcG9uZW50' +
	'cyhzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZh' +
	'bHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0aChw' +
	'YXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0' +
	'IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAgIHZhciBjb21wb25lbnRzID0gZ28uR2V0Q29tcG9uZW50czxDb21wb25lbnQ+' +
	'KCk7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcImNvbXBvbmVudHNc' +
	'IjpbIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb21wb25lbnRzLkxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAg' +
	'ICAgICAgaWYgKGNvbXBvbmVudHNbaV0gPT0gbnVsbCkgY29udGludWU7CiAgICAgICAgICAgIGlmIChpID4gMCkgc2IuQXBwZW5k' +
	'KCIsIik7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKGNvbXBvbmVudHNbaV0uR2V0VHlwZSgpLk5hbWUpKTsKICAg' +
	'ICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmco' +
	'KSk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZVNldFByb3BlcnR5KHN0cmluZyBpZCwgRGljdGlvbmFy' +
	'eTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImdhbWVPYmpl' +
	'Y3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKHBhdGgpOwogICAgICAgIGlmIChnbyA9' +
	'PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7cGF0aH0iKTsK' +
	'CiAgICAgICAgdmFyIHR5cGVOYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiY29tcG9uZW50VHlwZSIsICIiKTsKICAgICAgICB2' +
	'YXIgY29tcCA9IGdvLkdldENvbXBvbmVudCh0eXBlTmFtZSk7CiAgICAgICAgaWYgKGNvbXAgPT0gbnVsbCkKICAgICAgICAgICAg' +
	'cmV0dXJuIE1ha2VFcnJvcihpZCwgJCJDb21wb25lbnQgbm90IGZvdW5kOiB7dHlwZU5hbWV9IG9uIHtnby5uYW1lfSIpOwoKICAg' +
	'ICAgICB2YXIgcHJvcE5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJwcm9wZXJ0eU5hbWUiLCAiIik7CiAgICAgICAgdmFyIHZh' +
	'bHVlU3RyID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgidmFsdWUiLCAiIik7CgogICAgICAgIFVuZG8uUmVjb3JkT2JqZWN0KGNvbXAs' +
	'ICQiU2V0IHtwcm9wTmFtZX0gb24ge2dvLm5hbWV9Iik7CgogICAgICAgIC8vIFRyeSBzZXR0aW5nIHZpYSBTZXJpYWxpemVkT2Jq' +
	'ZWN0IGZvciBwcm9wZXIgdW5kbyBzdXBwb3J0CiAgICAgICAgdmFyIHNvID0gbmV3IFNlcmlhbGl6ZWRPYmplY3QoY29tcCk7CiAg' +
	'ICAgICAgdmFyIHByb3AgPSBzby5GaW5kUHJvcGVydHkocHJvcE5hbWUpOwogICAgICAgIGlmIChwcm9wICE9IG51bGwpCiAgICAg' +
	'ICAgewogICAgICAgICAgICBTZXRTZXJpYWxpemVkUHJvcGVydHlWYWx1ZShwcm9wLCB2YWx1ZVN0cik7CiAgICAgICAgICAgIHNv' +
	'LkFwcGx5TW9kaWZpZWRQcm9wZXJ0aWVzKCk7CiAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wicHJvcGVy' +
	'dHlcIjp7RXNjYXBlSnNvbihwcm9wTmFtZSl9LFwic2V0XCI6dHJ1ZX19Iik7CiAgICAgICAgfQoKICAgICAgICAvLyBGYWxsYmFj' +
	'azogcmVmbGVjdGlvbiB3aXRoIHNtYXJ0IHR5cGUgY29udmVyc2lvbgogICAgICAgIHZhciBmaWVsZCA9IGNvbXAuR2V0VHlwZSgp' +
	'LkdldEZpZWxkKHByb3BOYW1lLCBCaW5kaW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLk5vblB1YmxpYyB8IEJpbmRpbmdG' +
	'bGFncy5JbnN0YW5jZSk7CiAgICAgICAgaWYgKGZpZWxkICE9IG51bGwpCiAgICAgICAgewogICAgICAgICAgICB2YXIgY29udmVy' +
	'dGVkID0gU21hcnRDb252ZXJ0KHZhbHVlU3RyLCBmaWVsZC5GaWVsZFR5cGUpOwogICAgICAgICAgICBmaWVsZC5TZXRWYWx1ZShj' +
	'b21wLCBjb252ZXJ0ZWQpOwogICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInByb3BlcnR5XCI6e0VzY2Fw' +
	'ZUpzb24ocHJvcE5hbWUpfSxcInNldFwiOnRydWV9fSIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHByb3BlcnR5ID0gY29tcC5H' +
	'ZXRUeXBlKCkuR2V0UHJvcGVydHkocHJvcE5hbWUsIEJpbmRpbmdGbGFncy5QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuSW5zdGFuY2Up' +
	'OwogICAgICAgIGlmIChwcm9wZXJ0eSAhPSBudWxsICYmIHByb3BlcnR5LkNhbldyaXRlKQogICAgICAgIHsKICAgICAgICAgICAg' +
	'dmFyIGNvbnZlcnRlZCA9IFNtYXJ0Q29udmVydCh2YWx1ZVN0ciwgcHJvcGVydHkuUHJvcGVydHlUeXBlKTsKICAgICAgICAgICAg' +
	'cHJvcGVydHkuU2V0VmFsdWUoY29tcCwgY29udmVydGVkKTsKICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7' +
	'XCJwcm9wZXJ0eVwiOntFc2NhcGVKc29uKHByb3BOYW1lKX0sXCJzZXRcIjp0cnVlfX0iKTsKICAgICAgICB9CgogICAgICAgIHJl' +
	'dHVybiBNYWtlRXJyb3IoaWQsICQiUHJvcGVydHkgbm90IGZvdW5kOiB7cHJvcE5hbWV9IG9uIHt0eXBlTmFtZX0iKTsKICAgIH0K' +
	'CiAgICAvLyAtLS0gUHJlZmFiIEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVDcmVhdGVQcmVm' +
	'YWIoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBnb1BhdGggPSBwLkdl' +
	'dFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBGaW5kR2FtZU9iamVjdEJ5UGF0' +
	'aChnb1BhdGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVP' +
	'YmplY3Qgbm90IGZvdW5kOiB7Z29QYXRofSIpOwoKICAgICAgICB2YXIgYXNzZXRQYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgi' +
	'YXNzZXRQYXRoIiwgJCJBc3NldHMvUHJlZmFicy97Z28ubmFtZX0ucHJlZmFiIik7CgogICAgICAgIC8vIEVuc3VyZSBkaXJlY3Rv' +
	'cnkgZXhpc3RzCiAgICAgICAgdmFyIGRpciA9IFBhdGguR2V0RGlyZWN0b3J5TmFtZShhc3NldFBhdGgpOwogICAgICAgIGlmICgh' +
	'c3RyaW5nLklzTnVsbE9yRW1wdHkoZGlyKSAmJiAhQXNzZXREYXRhYmFzZS5Jc1ZhbGlkRm9sZGVyKGRpcikpCiAgICAgICAgewog' +
	'ICAgICAgICAgICBDcmVhdGVGb2xkZXJSZWN1cnNpdmUoZGlyKTsKICAgICAgICB9CgogICAgICAgIHZhciBwcmVmYWIgPSBQcmVm' +
	'YWJVdGlsaXR5LlNhdmVBc1ByZWZhYkFzc2V0KGdvLCBhc3NldFBhdGgpOwogICAgICAgIGlmIChwcmVmYWIgPT0gbnVsbCkKICAg' +
	'ICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJGYWlsZWQgdG8gY3JlYXRlIHByZWZhYiBhdCB7YXNzZXRQYXRofSIpOwoK' +
	'ICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInBhdGhcIjp7RXNjYXBlSnNvbihhc3NldFBhdGgpfSxcIm5hbWVc' +
	'Ijp7RXNjYXBlSnNvbihwcmVmYWIubmFtZSl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlSW5z' +
	'dGFudGlhdGVQcmVmYWIoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBw' +
	'cmVmYWJQYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgicHJlZmFiUGF0aCIsICIiKTsKICAgICAgICB2YXIgcHJlZmFiID0gQXNz' +
	'ZXREYXRhYmFzZS5Mb2FkQXNzZXRBdFBhdGg8R2FtZU9iamVjdD4ocHJlZmFiUGF0aCk7CiAgICAgICAgaWYgKHByZWZhYiA9PSBu' +
	'dWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIlByZWZhYiBub3QgZm91bmQgYXQ6IHtwcmVmYWJQYXRofSIp' +
	'OwoKICAgICAgICB2YXIgaW5zdGFuY2UgPSAoR2FtZU9iamVjdClQcmVmYWJVdGlsaXR5Lkluc3RhbnRpYXRlUHJlZmFiKHByZWZh' +
	'Yik7CiAgICAgICAgVW5kby5SZWdpc3RlckNyZWF0ZWRPYmplY3RVbmRvKGluc3RhbmNlLCAkIkluc3RhbnRpYXRlIHtwcmVmYWIu' +
	'bmFtZX0iKTsKICAgICAgICBTZWxlY3Rpb24uYWN0aXZlR2FtZU9iamVjdCA9IGluc3RhbmNlOwoKICAgICAgICByZXR1cm4gTWFr' +
	'ZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihpbnN0YW5jZS5uYW1lKX0sXCJpbnN0YW5jZUlkXCI6e2luc3Rh' +
	'bmNlLkdldEluc3RhbmNlSUQoKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRBbGxQcmVm' +
	'YWJzKHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2YXIgZ3VpZHMgPSBBc3NldERhdGFiYXNlLkZpbmRBc3NldHMoInQ6UHJlZmFi' +
	'Iik7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcInByZWZhYnNcIjpb' +
	'Iik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBndWlkcy5MZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlm' +
	'IChpID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIHZhciBwYXRoID0gQXNzZXREYXRhYmFzZS5HVUlEVG9Bc3NldFBh' +
	'dGgoZ3VpZHNbaV0pOwogICAgICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihwYXRoKSk7CiAgICAgICAgfQogICAgICAgIHNi' +
	'LkFwcGVuZCgiXX0iKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsIHNiLlRvU3RyaW5nKCkpOwogICAgfQoKICAgIC8v' +
	'IC0tLSBBc3NldCBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRlQXNzZXQoc3RyaW5n' +
	'IGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBhc3NldFR5cGUgPSBwLkdldFZhbHVl' +
	'T3JEZWZhdWx0KCJhc3NldFR5cGUiLCAiTWF0ZXJpYWwiKTsKICAgICAgICB2YXIgYXNzZXRQYXRoID0gcC5HZXRWYWx1ZU9yRGVm' +
	'YXVsdCgicGF0aCIsICIiKTsKCiAgICAgICAgaWYgKHN0cmluZy5Jc051bGxPckVtcHR5KGFzc2V0UGF0aCkpCiAgICAgICAgICAg' +
	'IHJldHVybiBNYWtlRXJyb3IoaWQsICJwYXRoIGlzIHJlcXVpcmVkIik7CgogICAgICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhp' +
	'c3RzCiAgICAgICAgdmFyIGRpciA9IFBhdGguR2V0RGlyZWN0b3J5TmFtZShhc3NldFBhdGgpOwogICAgICAgIGlmICghc3RyaW5n' +
	'LklzTnVsbE9yRW1wdHkoZGlyKSAmJiAhQXNzZXREYXRhYmFzZS5Jc1ZhbGlkRm9sZGVyKGRpcikpCiAgICAgICAgewogICAgICAg' +
	'ICAgICBDcmVhdGVGb2xkZXJSZWN1cnNpdmUoZGlyKTsKICAgICAgICB9CgogICAgICAgIFVuaXR5RW5naW5lLk9iamVjdCBhc3Nl' +
	'dCA9IG51bGw7CiAgICAgICAgc3dpdGNoIChhc3NldFR5cGUuVG9Mb3dlcigpKQogICAgICAgIHsKICAgICAgICAgICAgY2FzZSAi' +
	'bWF0ZXJpYWwiOgogICAgICAgICAgICAgICAgdmFyIHNoYWRlciA9IFNoYWRlci5GaW5kKHAuR2V0VmFsdWVPckRlZmF1bHQoInNo' +
	'YWRlciIsICJTdGFuZGFyZCIpKTsKICAgICAgICAgICAgICAgIGFzc2V0ID0gbmV3IE1hdGVyaWFsKHNoYWRlcik7CiAgICAgICAg' +
	'ICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicGh5c2ljbWF0ZXJpYWwiOgogICAgICAgICAgICAgICAgYXNzZXQgPSBu' +
	'ZXcgUGh5c2ljTWF0ZXJpYWwoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg' +
	'ICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJVbnN1cHBvcnRlZCBhc3NldCB0eXBlOiB7YXNzZXRUeXBlfS4gU3VwcG9ydGVk' +
	'OiBNYXRlcmlhbCwgUGh5c2ljTWF0ZXJpYWwiKTsKICAgICAgICB9CgogICAgICAgIEFzc2V0RGF0YWJhc2UuQ3JlYXRlQXNzZXQo' +
	'YXNzZXQsIGFzc2V0UGF0aCk7CiAgICAgICAgQXNzZXREYXRhYmFzZS5SZWZyZXNoKCk7CgogICAgICAgIHJldHVybiBNYWtlU3Vj' +
	'Y2VzcyhpZCwgJCJ7e1wicGF0aFwiOntFc2NhcGVKc29uKGFzc2V0UGF0aCl9LFwidHlwZVwiOntFc2NhcGVKc29uKGFzc2V0VHlw' +
	'ZSl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlRmluZEFzc2V0cyhzdHJpbmcgaWQsIERpY3Rp' +
	'b25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIGZpbHRlciA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImZp' +
	'bHRlciIsICIiKTsKICAgICAgICB2YXIgZ3VpZHMgPSBBc3NldERhdGFiYXNlLkZpbmRBc3NldHMoZmlsdGVyKTsKICAgICAgICB2' +
	'YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFwcGVuZCgie1wiYXNzZXRzXCI6WyIpOwogICAgICAgIHZh' +
	'ciBjb3VudCA9IE1hdGguTWluKGd1aWRzLkxlbmd0aCwgNTApOyAvLyBDYXAgYXQgNTAKICAgICAgICBmb3IgKGludCBpID0gMDsg' +
	'aSA8IGNvdW50OyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIpOwogICAgICAgICAg' +
	'ICB2YXIgcGF0aCA9IEFzc2V0RGF0YWJhc2UuR1VJRFRvQXNzZXRQYXRoKGd1aWRzW2ldKTsKICAgICAgICAgICAgc2IuQXBwZW5k' +
	'KEVzY2FwZUpzb24ocGF0aCkpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoJCJdLFwidG90YWxcIjp7Z3VpZHMuTGVuZ3Ro' +
	'fX19Iik7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICAvLyAtLS0gUHJv' +
	'amVjdCAvIEVkaXRvciBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0UHJvamVjdEluZm8o' +
	'c3RyaW5nIGlkKQogICAgewogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKEFw' +
	'cGxpY2F0aW9uLnByb2R1Y3ROYW1lKX0sXCJ1bml0eVZlcnNpb25cIjp7RXNjYXBlSnNvbihBcHBsaWNhdGlvbi51bml0eVZlcnNp' +
	'b24pfSxcInBsYXRmb3JtXCI6e0VzY2FwZUpzb24oRWRpdG9yVXNlckJ1aWxkU2V0dGluZ3MuYWN0aXZlQnVpbGRUYXJnZXQuVG9T' +
	'dHJpbmcoKSl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0UGxheU1vZGUoc3RyaW5nIGlk' +
	'KQogICAgewogICAgICAgIHZhciBzdGF0ZSA9IEVkaXRvckFwcGxpY2F0aW9uLmlzUGxheWluZwogICAgICAgICAgICA/IChFZGl0' +
	'b3JBcHBsaWNhdGlvbi5pc1BhdXNlZCA/ICJwYXVzZWQiIDogInBsYXlpbmciKQogICAgICAgICAgICA6ICJzdG9wcGVkIjsKICAg' +
	'ICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInN0YXRlXCI6XCJ7c3RhdGV9XCJ9fSIpOwogICAgfQoKICAgIHByaXZh' +
	'dGUgc3RhdGljIHN0cmluZyBIYW5kbGVFeGVjdXRlTWVudUl0ZW0oc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5n' +
	'PiBwKQogICAgewogICAgICAgIHZhciBtZW51UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm1lbnVQYXRoIiwgIiIpOwogICAg' +
	'ICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShtZW51UGF0aCkpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICJt' +
	'ZW51UGF0aCBpcyByZXF1aXJlZCIpOwoKICAgICAgICB2YXIgcmVzdWx0ID0gRWRpdG9yQXBwbGljYXRpb24uRXhlY3V0ZU1lbnVJ' +
	'dGVtKG1lbnVQYXRoKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcImV4ZWN1dGVkXCI6e3Jlc3VsdC5Ub1N0' +
	'cmluZygpLlRvTG93ZXIoKX0sXCJtZW51UGF0aFwiOntFc2NhcGVKc29uKG1lbnVQYXRoKX19fSIpOwogICAgfQoKICAgIC8vIC0t' +
	'LSBVdGlsaXRpZXMgLS0tCgogICAgLy8vIDxzdW1tYXJ5PgogICAgLy8vIEZpbmQgYSBHYW1lT2JqZWN0IGJ5IGhpZXJhcmNoeSBw' +
	'YXRoLCBpbmNsdWRpbmcgaW5hY3RpdmUgb2JqZWN0cy4KICAgIC8vLyBVbml0eSdzIEdhbWVPYmplY3QuRmluZCgpIG9ubHkgZmlu' +
	'ZHMgYWN0aXZlIG9iamVjdHMsIHdoaWNoIGZhaWxzIHdoZW4KICAgIC8vLyBhIHBhcmVudCBoYXMgYmVlbiBzZXQgaW5hY3RpdmUu' +
	'IFRoaXMgbWV0aG9kIHdhbGtzIHRoZSBoaWVyYXJjaHkgbWFudWFsbHkuCiAgICAvLy8gSWYgdGhlIHBhdGggY29udGFpbnMgbm8g' +
	'Jy8nIHNlcGFyYXRvciBhbmQgbm8gcm9vdCBvYmplY3QgbWF0Y2hlcywgZmFsbHMKICAgIC8vLyBiYWNrIHRvIGEgZnVsbC1zY2Vu' +
	'ZSBuYW1lIHNlYXJjaCBzbyBhZ2VudHMgY2FuIHVzZSBiYXJlIG5hbWVzIGxpa2UKICAgIC8vLyAiTWFpbiBNZW51IFBhbmVsIiBl' +
	'dmVuIHdoZW4gdGhlIG9iamVjdCBpcyBhIGNoaWxkIG9yIGluYWN0aXZlLgogICAgLy8vIDwvc3VtbWFyeT4KICAgIHByaXZhdGUg' +
	'c3RhdGljIEdhbWVPYmplY3QgRmluZEdhbWVPYmplY3RCeVBhdGgoc3RyaW5nIHBhdGgpCiAgICB7CiAgICAgICAgaWYgKHN0cmlu' +
	'Zy5Jc051bGxPckVtcHR5KHBhdGgpKSByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gRmlyc3QgdHJ5IHRoZSBmYXN0IHBhdGgg4oCU' +
	'IFVuaXR5J3MgYnVpbHQtaW4gKG9ubHkgd29ya3MgZm9yIGFjdGl2ZSBvYmplY3RzKQogICAgICAgIHZhciBmb3VuZCA9IEdhbWVP' +
	'YmplY3QuRmluZChwYXRoKTsKICAgICAgICBpZiAoZm91bmQgIT0gbnVsbCkgcmV0dXJuIGZvdW5kOwoKICAgICAgICAvLyBTbG93' +
	'IHBhdGg6IG1hbnVhbGx5IHdhbGsgdGhlIGhpZXJhcmNoeSAod29ya3MgZm9yIGluYWN0aXZlIG9iamVjdHMgdG9vKQogICAgICAg' +
	'IHZhciBwYXJ0cyA9IHBhdGguU3BsaXQoJy8nKTsKICAgICAgICB2YXIgcm9vdE5hbWUgPSBwYXJ0c1swXTsKCiAgICAgICAgLy8g' +
	'U2VhcmNoIHRocm91Z2ggYWxsIHNjZW5lIHJvb3Qgb2JqZWN0cwogICAgICAgIHZhciBzY2VuZSA9IFNjZW5lTWFuYWdlci5HZXRB' +
	'Y3RpdmVTY2VuZSgpOwogICAgICAgIHZhciByb290cyA9IHNjZW5lLkdldFJvb3RHYW1lT2JqZWN0cygpOwogICAgICAgIEdhbWVP' +
	'YmplY3Qgcm9vdCA9IG51bGw7CiAgICAgICAgZm9yZWFjaCAodmFyIHIgaW4gcm9vdHMpCiAgICAgICAgewogICAgICAgICAgICBp' +
	'ZiAoci5uYW1lID09IHJvb3ROYW1lKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByb290ID0gcjsKICAgICAgICAgICAg' +
	'ICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocm9vdCA9PSBudWxsKQogICAgICAgIHsKICAg' +
	'ICAgICAgICAgLy8gTGFzdCByZXNvcnQgZm9yIHNpbmdsZS1uYW1lIHF1ZXJpZXM6IGRlZXAgc2VhcmNoIGFjcm9zcyBldmVyeSBv' +
	'YmplY3QgaW4gdGhlIHNjZW5lLgogICAgICAgICAgICAvLyBIYW5kbGVzIGluYWN0aXZlIGNoaWxkcmVuIChlLmcuIGEgcGFuZWwg' +
	'aGlkZGVuIHVuZGVyIENhbnZhcykgdGhhdCBuZWl0aGVyCiAgICAgICAgICAgIC8vIEdhbWVPYmplY3QuRmluZCBub3Igcm9vdC1v' +
	'bmx5IGVudW1lcmF0aW9uIGNhbiBsb2NhdGUuCiAgICAgICAgICAgIGlmIChwYXJ0cy5MZW5ndGggPT0gMSkKICAgICAgICAgICAg' +
	'ICAgIHJldHVybiBGaW5kR2FtZU9iamVjdEJ5TmFtZUluU2NlbmUocm9vdE5hbWUpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsK' +
	'ICAgICAgICB9CgogICAgICAgIGlmIChwYXJ0cy5MZW5ndGggPT0gMSkgcmV0dXJuIHJvb3Q7CgogICAgICAgIC8vIFdhbGsgZG93' +
	'biB0aGUgcGF0aCB1c2luZyBUcmFuc2Zvcm0uRmluZCAoc3VwcG9ydHMgJy8nIHBhdGhzIGFuZCBmaW5kcyBpbmFjdGl2ZSBjaGls' +
	'ZHJlbikKICAgICAgICB2YXIgc3ViUGF0aCA9IHN0cmluZy5Kb2luKCIvIiwgcGFydHMsIDEsIHBhcnRzLkxlbmd0aCAtIDEpOwog' +
	'ICAgICAgIHZhciBjaGlsZCA9IHJvb3QudHJhbnNmb3JtLkZpbmQoc3ViUGF0aCk7CiAgICAgICAgcmV0dXJuIGNoaWxkICE9IG51' +
	'bGwgPyBjaGlsZC5nYW1lT2JqZWN0IDogbnVsbDsKICAgIH0KCiAgICAvLy8gPHN1bW1hcnk+CiAgICAvLy8gUmVjdXJzaXZlbHkg' +
	'c2VhcmNoIGV2ZXJ5IEdhbWVPYmplY3QgaW4gdGhlIGFjdGl2ZSBzY2VuZSAoaW5jbHVkaW5nIGluYWN0aXZlKQogICAgLy8vIGFu' +
	'ZCByZXR1cm4gdGhlIGZpcnN0IG9uZSB3aG9zZSBuYW1lIG1hdGNoZXMgZXhhY3RseS4KICAgIC8vLyA8L3N1bW1hcnk+CiAgICBw' +
	'cml2YXRlIHN0YXRpYyBHYW1lT2JqZWN0IEZpbmRHYW1lT2JqZWN0QnlOYW1lSW5TY2VuZShzdHJpbmcgbmFtZSkKICAgIHsKICAg' +
	'ICAgICBmb3JlYWNoICh2YXIgcm9vdCBpbiBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKS5HZXRSb290R2FtZU9iamVjdHMo' +
	'KSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBGaW5kSW5IaWVyYXJjaHlCeU5hbWUocm9vdC50cmFuc2Zvcm0s' +
	'IG5hbWUpOwogICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHJl' +
	'dHVybiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEdhbWVPYmplY3QgRmluZEluSGllcmFyY2h5QnlOYW1lKFRyYW5z' +
	'Zm9ybSB0LCBzdHJpbmcgbmFtZSkKICAgIHsKICAgICAgICBpZiAodC5uYW1lID09IG5hbWUpIHJldHVybiB0LmdhbWVPYmplY3Q7' +
	'CiAgICAgICAgZm9yZWFjaCAoVHJhbnNmb3JtIGNoaWxkIGluIHQpCiAgICAgICAgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0g' +
	'RmluZEluSGllcmFyY2h5QnlOYW1lKGNoaWxkLCBuYW1lKTsKICAgICAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsKSByZXR1cm4g' +
	'cmVzdWx0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBUeXBlIEZpbmRD' +
	'b21wb25lbnRUeXBlKHN0cmluZyB0eXBlTmFtZSkKICAgIHsKICAgICAgICAvLyBDb21tb24gbmFtZXNwYWNlIHByZWZpeGVzIGZv' +
	'ciBVbml0eSBjb21wb25lbnQgdHlwZXMuCiAgICAgICAgLy8gVUkgY29tcG9uZW50cyBsaXZlIGluIFVuaXR5RW5naW5lLlVJLCBU' +
	'TVBybywgRXZlbnRTeXN0ZW1zIOKAlCBub3QganVzdCBVbml0eUVuZ2luZS4KICAgICAgICBzdHJpbmdbXSBuYW1lc3BhY2VQcmVm' +
	'aXhlcyA9IG5ld1tdCiAgICAgICAgewogICAgICAgICAgICAiVW5pdHlFbmdpbmUuIiwgICAgICAgICAgICAgIC8vIFJpZ2lkYm9k' +
	'eSwgQ2FudmFzLCBBdWRpb1NvdXJjZSwgZXRjLgogICAgICAgICAgICAiVW5pdHlFbmdpbmUuVUkuIiwgICAgICAgICAgIC8vIEJ1' +
	'dHRvbiwgSW1hZ2UsIFNsaWRlciwgQ2FudmFzU2NhbGVyLCBHcmFwaGljUmF5Y2FzdGVyLCBWZXJ0aWNhbExheW91dEdyb3VwLCBl' +
	'dGMuCiAgICAgICAgICAgICJVbml0eUVuZ2luZS5FdmVudFN5c3RlbXMuIiwgLy8gRXZlbnRTeXN0ZW0sIFN0YW5kYWxvbmVJbnB1' +
	'dE1vZHVsZSwgZXRjLgogICAgICAgICAgICAiVE1Qcm8uIiwgICAgICAgICAgICAgICAgICAgIC8vIFRleHRNZXNoUHJvVUdVSSwg' +
	'VE1QX0lucHV0RmllbGQsIGV0Yy4KICAgICAgICAgICAgIiIsICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXN0b20gc2Ny' +
	'aXB0cyAoYmFyZSBjbGFzcyBuYW1lIGluIEFzc2VtYmx5LUNTaGFycCkKICAgICAgICB9OwoKICAgICAgICBmb3JlYWNoICh2YXIg' +
	'YXNzZW1ibHkgaW4gQXBwRG9tYWluLkN1cnJlbnREb21haW4uR2V0QXNzZW1ibGllcygpKQogICAgICAgIHsKICAgICAgICAgICAg' +
	'Zm9yZWFjaCAodmFyIHByZWZpeCBpbiBuYW1lc3BhY2VQcmVmaXhlcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFy' +
	'IGZ1bGxOYW1lID0gcHJlZml4ICsgdHlwZU5hbWU7CiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGFzc2VtYmx5LkdldFR5cGUo' +
	'ZnVsbE5hbWUpOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCAmJiB0eXBlb2YoQ29tcG9uZW50KS5Jc0Fzc2lnbmFi' +
	'bGVGcm9tKHR5cGUpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg' +
	'ICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvLy8gPHN1bW1hcnk+CiAgICAvLy8gU21hcnQgdHlwZSBjb252ZXJzaW9uIHRo' +
	'YXQgaGFuZGxlcyBlbnVtcywgVmVjdG9yMiwgVmVjdG9yMywgQ29sb3IsIHByaW1pdGl2ZXMsCiAgICAvLy8gYW5kIFVuaXR5IE9i' +
	'amVjdCByZWZlcmVuY2VzIChHYW1lT2JqZWN0L0NvbXBvbmVudCBieSBzY2VuZSBwYXRoLCBhc3NldHMgYnkgYXNzZXQgcGF0aCku' +
	'CiAgICAvLy8gRmFsbHMgYmFjayB0byBDb252ZXJ0LkNoYW5nZVR5cGUgZm9yIHNpbXBsZSB0eXBlcy4KICAgIC8vLyA8L3N1bW1h' +
	'cnk+CiAgICBwcml2YXRlIHN0YXRpYyBvYmplY3QgU21hcnRDb252ZXJ0KHN0cmluZyB2YWx1ZVN0ciwgVHlwZSB0YXJnZXRUeXBl' +
	'KQogICAgewogICAgICAgIC8vIEhhbmRsZSBudWxsYWJsZQogICAgICAgIHZhciB1bmRlcmx5aW5nVHlwZSA9IE51bGxhYmxlLkdl' +
	'dFVuZGVybHlpbmdUeXBlKHRhcmdldFR5cGUpOwogICAgICAgIGlmICh1bmRlcmx5aW5nVHlwZSAhPSBudWxsKQogICAgICAgICAg' +
	'ICB0YXJnZXRUeXBlID0gdW5kZXJseWluZ1R5cGU7CgogICAgICAgIC8vIEdhbWVPYmplY3QgcmVmZXJlbmNlIOKAlCByZXNvbHZl' +
	'IGJ5IHNjZW5lIHBhdGgvbmFtZSwgdGhlbiBhc3NldCBkYXRhYmFzZQogICAgICAgIGlmICh0YXJnZXRUeXBlID09IHR5cGVvZihH' +
	'YW1lT2JqZWN0KSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciByZWZHbyA9IEZpbmRHYW1lT2JqZWN0QnlQYXRoKHZhbHVlU3Ry' +
	'KTsKICAgICAgICAgICAgaWYgKHJlZkdvICE9IG51bGwpIHJldHVybiByZWZHbzsKICAgICAgICAgICAgdmFyIGFzc2V0ID0gQXNz' +
	'ZXREYXRhYmFzZS5Mb2FkQXNzZXRBdFBhdGg8R2FtZU9iamVjdD4odmFsdWVTdHIpOwogICAgICAgICAgICBpZiAoYXNzZXQgIT0g' +
	'bnVsbCkgcmV0dXJuIGFzc2V0OwogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbigKICAgICAg' +
	'ICAgICAgICAgICQiQ2Fubm90IGFzc2lnbiByZWZlcmVuY2U6ICd7dmFsdWVTdHJ9JyB3YXMgbm90IGZvdW5kIGluIHRoZSBzY2Vu' +
	'ZSBoaWVyYXJjaHkgb3IgdGhlIGFzc2V0IGRhdGFiYXNlLiIpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29tcG9uZW50IHJlZmVy' +
	'ZW5jZSDigJQgZmluZCB0aGUgR2FtZU9iamVjdCB0aGVuIGdldCB0aGUgY29tcG9uZW50CiAgICAgICAgaWYgKHR5cGVvZihDb21w' +
	'b25lbnQpLklzQXNzaWduYWJsZUZyb20odGFyZ2V0VHlwZSkpCiAgICAgICAgewogICAgICAgICAgICB2YXIgcmVmR28gPSBGaW5k' +
	'R2FtZU9iamVjdEJ5UGF0aCh2YWx1ZVN0cik7CiAgICAgICAgICAgIGlmIChyZWZHbyAhPSBudWxsKSByZXR1cm4gcmVmR28uR2V0' +
	'Q29tcG9uZW50KHRhcmdldFR5cGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbigKICAg' +
	'ICAgICAgICAgICAgICQiQ2Fubm90IGFzc2lnbiByZWZlcmVuY2U6ICd7dmFsdWVTdHJ9JyB3YXMgbm90IGZvdW5kIGluIHRoZSBz' +
	'Y2VuZSBoaWVyYXJjaHkuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlciBVbml0eUVuZ2luZS5PYmplY3QgKFNwcml0ZSwg' +
	'TWF0ZXJpYWwsIEF1ZGlvQ2xpcCwgZXRjLikg4oCUIGxvYWQgZnJvbSBhc3NldCBEQgogICAgICAgIGlmICh0eXBlb2YoVW5pdHlF' +
	'bmdpbmUuT2JqZWN0KS5Jc0Fzc2lnbmFibGVGcm9tKHRhcmdldFR5cGUpKQogICAgICAgICAgICByZXR1cm4gQXNzZXREYXRhYmFz' +
	'ZS5Mb2FkQXNzZXRBdFBhdGgodmFsdWVTdHIsIHRhcmdldFR5cGUpOwoKICAgICAgICAvLyBFbnVtIHR5cGVzIChSZW5kZXJNb2Rl' +
	'LCBTY2FsZU1vZGUsIFRleHRBbGlnbm1lbnRPcHRpb25zLCBldGMuKQogICAgICAgIGlmICh0YXJnZXRUeXBlLklzRW51bSkKICAg' +
	'ICAgICB7CiAgICAgICAgICAgIC8vIFRyeSBwYXJzaW5nIGJ5IG5hbWUgZmlyc3QgKGUuZy4gIlNjcmVlblNwYWNlT3ZlcmxheSIs' +
	'ICJTY2FsZVdpdGhTY3JlZW5TaXplIikKICAgICAgICAgICAgaWYgKEVudW0uVHJ5UGFyc2UodGFyZ2V0VHlwZSwgdmFsdWVTdHIs' +
	'IHRydWUsIG91dCB2YXIgZW51bVZhbCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZW51bVZhbDsKICAgICAgICAgICAgLy8gVHJ5' +
	'IHBhcnNpbmcgYXMgaW50ZWdlcgogICAgICAgICAgICBpZiAoaW50LlRyeVBhcnNlKHZhbHVlU3RyLCBvdXQgdmFyIGludFZhbCkp' +
	'CiAgICAgICAgICAgICAgICByZXR1cm4gRW51bS5Ub09iamVjdCh0YXJnZXRUeXBlLCBpbnRWYWwpOwogICAgICAgICAgICB0aHJv' +
	'dyBuZXcgSW52YWxpZENhc3RFeGNlcHRpb24oJCJDYW5ub3QgY29udmVydCAne3ZhbHVlU3RyfScgdG8ge3RhcmdldFR5cGUuTmFt' +
	'ZX0uIFZhbGlkIHZhbHVlczoge3N0cmluZy5Kb2luKCIsICIsIEVudW0uR2V0TmFtZXModGFyZ2V0VHlwZSkpfSIpOwogICAgICAg' +
	'IH0KCiAgICAgICAgLy8gVmVjdG9yMgogICAgICAgIGlmICh0YXJnZXRUeXBlID09IHR5cGVvZihWZWN0b3IyKSkKICAgICAgICAg' +
	'ICAgcmV0dXJuIFBhcnNlVmVjdG9yMih2YWx1ZVN0cik7CgogICAgICAgIC8vIFZlY3RvcjMKICAgICAgICBpZiAodGFyZ2V0VHlw' +
	'ZSA9PSB0eXBlb2YoVmVjdG9yMykpCiAgICAgICAgICAgIHJldHVybiBQYXJzZVZlY3RvcjModmFsdWVTdHIpOwoKICAgICAgICAv' +
	'LyBWZWN0b3I0CiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKFZlY3RvcjQpKQogICAgICAgICAgICByZXR1cm4gUGFy' +
	'c2VWZWN0b3I0KHZhbHVlU3RyKTsKCiAgICAgICAgLy8gQ29sb3IKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2YoQ29s' +
	'b3IpKQogICAgICAgICAgICByZXR1cm4gUGFyc2VDb2xvcih2YWx1ZVN0cik7CgogICAgICAgIC8vIEJvb2wKICAgICAgICBpZiAo' +
	'dGFyZ2V0VHlwZSA9PSB0eXBlb2YoYm9vbCkpCiAgICAgICAgICAgIHJldHVybiB2YWx1ZVN0ci5Ub0xvd2VyKCkgPT0gInRydWUi' +
	'IHx8IHZhbHVlU3RyID09ICIxIjsKCiAgICAgICAgLy8gSW50CiAgICAgICAgaWYgKHRhcmdldFR5cGUgPT0gdHlwZW9mKGludCkp' +
	'CiAgICAgICAgewogICAgICAgICAgICBpbnQuVHJ5UGFyc2UodmFsdWVTdHIsIG91dCB2YXIgdik7CiAgICAgICAgICAgIHJldHVy' +
	'biB2OwogICAgICAgIH0KCiAgICAgICAgLy8gRmxvYXQKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSB0eXBlb2YoZmxvYXQpKQog' +
	'ICAgICAgIHsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UodmFsdWVTdHIsIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0' +
	'eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB2KTsK' +
	'ICAgICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgfQoKICAgICAgICAvLyBTdHJpbmcKICAgICAgICBpZiAodGFyZ2V0VHlwZSA9' +
	'PSB0eXBlb2Yoc3RyaW5nKSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlU3RyOwoKICAgICAgICAvLyBGYWxsYmFjawogICAgICAg' +
	'IHJldHVybiBDb252ZXJ0LkNoYW5nZVR5cGUodmFsdWVTdHIsIHRhcmdldFR5cGUpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj' +
	'IFZlY3RvcjIgUGFyc2VWZWN0b3IyKHN0cmluZyBzdHIpCiAgICB7CiAgICAgICAgc3RyID0gc3RyLlRyaW0oJ1snLCAnXScsICco' +
	'JywgJyknKS5UcmltKCk7CiAgICAgICAgdmFyIHBhcnRzID0gc3RyLlNwbGl0KCcsJyk7CiAgICAgICAgaWYgKHBhcnRzLkxlbmd0' +
	'aCA+PSAyKQogICAgICAgIHsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMF0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFs' +
	'aXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1' +
	'cmUsIG91dCB2YXIgeCk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzFdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6' +
	'YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJl' +
	'LCBvdXQgdmFyIHkpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIoeCwgeSk7CiAgICAgICAgfQogICAgICAgIHJldHVy' +
	'biBWZWN0b3IyLnplcm87CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgVmVjdG9yMyBQYXJzZVZlY3RvcjMoc3RyaW5nIHN0cikK' +
	'ICAgIHsKICAgICAgICAvLyBIYW5kbGUgYm90aCAiW3gseSx6XSIgYW5kICJ4LHkseiIgZm9ybWF0cwogICAgICAgIHN0ciA9IHN0' +
	'ci5UcmltKCdbJywgJ10nLCAnKCcsICcpJykuVHJpbSgpOwogICAgICAgIHZhciBwYXJ0cyA9IHN0ci5TcGxpdCgnLCcpOwogICAg' +
	'ICAgIGlmIChwYXJ0cy5MZW5ndGggPj0gMykKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzBdLlRy' +
	'aW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJl' +
	'SW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHgpOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1sxXS5Ucmlt' +
	'KCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUlu' +
	'Zm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB5KTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMl0uVHJpbSgp' +
	'LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZv' +
	'LkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgeik7CiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMyh4LCB5LCB6KTsKICAg' +
	'ICAgICB9CiAgICAgICAgcmV0dXJuIFZlY3RvcjMuemVybzsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3I0IFBhcnNl' +
	'VmVjdG9yNChzdHJpbmcgc3RyKQogICAgewogICAgICAgIHN0ciA9IHN0ci5UcmltKCdbJywgJ10nLCAnKCcsICcpJykuVHJpbSgp' +
	'OwogICAgICAgIHZhciBwYXJ0cyA9IHN0ci5TcGxpdCgnLCcpOwogICAgICAgIGlmIChwYXJ0cy5MZW5ndGggPj0gNCkKICAgICAg' +
	'ICB7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzBdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVy' +
	'U3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHgp' +
	'OwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1sxXS5UcmltKCksIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0' +
	'eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciB5KTsK' +
	'ICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMl0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJTdHls' +
	'ZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCB2YXIgeik7CiAg' +
	'ICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzNdLlRyaW0oKSwgU3lzdGVtLkdsb2JhbGl6YXRpb24uTnVtYmVyU3R5bGVz' +
	'LkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0dXJlLCBvdXQgdmFyIHcpOwogICAg' +
	'ICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjQoeCwgeSwgeiwgdyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBWZWN0b3I0Lnpl' +
	'cm87CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgQ29sb3IgUGFyc2VDb2xvcihzdHJpbmcgc3RyKQogICAgewogICAgICAgIC8v' +
	'IFRyeSBoZXggY29sb3IgKCNSUkdHQkIgb3IgI1JSR0dCQkFBKQogICAgICAgIGlmIChzdHIuU3RhcnRzV2l0aCgiIyIpICYmIENv' +
	'bG9yVXRpbGl0eS5UcnlQYXJzZUh0bWxTdHJpbmcoc3RyLCBvdXQgdmFyIGh0bWxDb2xvcikpCiAgICAgICAgICAgIHJldHVybiBo' +
	'dG1sQ29sb3I7CiAgICAgICAgLy8gVHJ5IFJHQkEgY29tcG9uZW50cwogICAgICAgIHN0ciA9IHN0ci5UcmltKCdbJywgJ10nLCAn' +
	'KCcsICcpJykuVHJpbSgpOwogICAgICAgIHZhciBwYXJ0cyA9IHN0ci5TcGxpdCgnLCcpOwogICAgICAgIGlmIChwYXJ0cy5MZW5n' +
	'dGggPj0gMykKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzBdLlRyaW0oKSwgU3lzdGVtLkdsb2Jh' +
	'bGl6YXRpb24uTnVtYmVyU3R5bGVzLkZsb2F0LCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mby5JbnZhcmlhbnRDdWx0' +
	'dXJlLCBvdXQgdmFyIHIpOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1sxXS5UcmltKCksIFN5c3RlbS5HbG9iYWxp' +
	'emF0aW9uLk51bWJlclN0eWxlcy5GbG9hdCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVy' +
	'ZSwgb3V0IHZhciBnKTsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbMl0uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXph' +
	'dGlvbi5OdW1iZXJTdHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUs' +
	'IG91dCB2YXIgYik7CiAgICAgICAgICAgIGZsb2F0IGEgPSAxZjsKICAgICAgICAgICAgaWYgKHBhcnRzLkxlbmd0aCA+PSA0KQog' +
	'ICAgICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2UocGFydHNbM10uVHJpbSgpLCBTeXN0ZW0uR2xvYmFsaXphdGlvbi5OdW1iZXJT' +
	'dHlsZXMuRmxvYXQsIFN5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvLkludmFyaWFudEN1bHR1cmUsIG91dCBhKTsKICAg' +
	'ICAgICAgICAgcmV0dXJuIG5ldyBDb2xvcihyLCBnLCBiLCBhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIENvbG9yLndoaXRl' +
	'OwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgU2V0U2VyaWFsaXplZFByb3BlcnR5VmFsdWUoU2VyaWFsaXplZFByb3Bl' +
	'cnR5IHByb3AsIHN0cmluZyB2YWx1ZSkKICAgIHsKICAgICAgICBzd2l0Y2ggKHByb3AucHJvcGVydHlUeXBlKQogICAgICAgIHsK' +
	'ICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkludGVnZXI6CiAgICAgICAgICAgICAgICBpZiAoaW50LlRy' +
	'eVBhcnNlKHZhbHVlLCBvdXQgdmFyIGludFZhbCkpCiAgICAgICAgICAgICAgICAgICAgcHJvcC5pbnRWYWx1ZSA9IGludFZhbDsK' +
	'ICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuRmxvYXQ6CiAgICAg' +
	'ICAgICAgICAgICBpZiAoZmxvYXQuVHJ5UGFyc2UodmFsdWUsIFN5c3RlbS5HbG9iYWxpemF0aW9uLk51bWJlclN0eWxlcy5GbG9h' +
	'dCwgU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm8uSW52YXJpYW50Q3VsdHVyZSwgb3V0IHZhciBmbG9hdFZhbCkpCiAg' +
	'ICAgICAgICAgICAgICAgICAgcHJvcC5mbG9hdFZhbHVlID0gZmxvYXRWYWw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg' +
	'ICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkJvb2xlYW46CiAgICAgICAgICAgICAgICBwcm9wLmJvb2xWYWx1ZSA9' +
	'IHZhbHVlLlRvTG93ZXIoKSA9PSAidHJ1ZSIgfHwgdmFsdWUgPT0gIjEiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg' +
	'ICAgIGNhc2UgU2VyaWFsaXplZFByb3BlcnR5VHlwZS5TdHJpbmc6CiAgICAgICAgICAgICAgICBwcm9wLnN0cmluZ1ZhbHVlID0g' +
	'dmFsdWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkVudW06' +
	'CiAgICAgICAgICAgICAgICAvLyBUcnkgbmFtZSBmaXJzdCwgdGhlbiBpbnRlZ2VyCiAgICAgICAgICAgICAgICB2YXIgZW51bU5h' +
	'bWVzID0gcHJvcC5lbnVtTmFtZXM7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVudW1OYW1lcy5MZW5ndGg7' +
	'IGkrKykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RyaW5nLkVxdWFscyhlbnVtTmFtZXNbaV0s' +
	'IHZhbHVlLCBTdHJpbmdDb21wYXJpc29uLk9yZGluYWxJZ25vcmVDYXNlKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAg' +
	'ICAgICAgICAgICAgICAgIHByb3AuZW51bVZhbHVlSW5kZXggPSBpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg' +
	'ICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGludC5UcnlQYXJzZSh2YWx1' +
	'ZSwgb3V0IHZhciBlbnVtSW50KSkKICAgICAgICAgICAgICAgICAgICBwcm9wLmVudW1WYWx1ZUluZGV4ID0gZW51bUludDsKICAg' +
	'ICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuVmVjdG9yMjoKICAgICAg' +
	'ICAgICAgICAgIHByb3AudmVjdG9yMlZhbHVlID0gUGFyc2VWZWN0b3IyKHZhbHVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog' +
	'ICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuVmVjdG9yMzoKICAgICAgICAgICAgICAgIHByb3AudmVjdG9y' +
	'M1ZhbHVlID0gUGFyc2VWZWN0b3IzKHZhbHVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlh' +
	'bGl6ZWRQcm9wZXJ0eVR5cGUuQ29sb3I6CiAgICAgICAgICAgICAgICBwcm9wLmNvbG9yVmFsdWUgPSBQYXJzZUNvbG9yKHZhbHVl' +
	'KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuT2JqZWN0UmVm' +
	'ZXJlbmNlOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyBhIHNjZW5lIHBhdGgvbmFtZSAoZS5nLiAi' +
	'TWFpbiBNZW51IFBhbmVsIiwgIkNhbnZhcy9QYW5lbCIpIG9yIGFuCiAgICAgICAgICAgICAgICAvLyBhc3NldCBwYXRoICgiQXNz' +
	'ZXRzLy4uLiIpLiBUcnkgc2NlbmUgZmlyc3QsIHRoZW4gYXNzZXQgZGF0YWJhc2UuCiAgICAgICAgICAgICAgICB2YXIgcmVmR28g' +
	'PSBGaW5kR2FtZU9iamVjdEJ5UGF0aCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAocmVmR28gIT0gbnVsbCkKICAgICAgICAg' +
	'ICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAvLyBwcm9wLnR5cGUgcmV0dXJucyBlLmcuICJQUHRyPCRCdXR0b24+IiwgIlBQ' +
	'dHI8JEdhbWVPYmplY3Q+IiwgIlBQdHI8JFRyYW5zZm9ybT4iCiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gUmVnZXgu' +
	'TWF0Y2gocHJvcC50eXBlLCBAIlBQdHI8XCQoLispPiIpOwogICAgICAgICAgICAgICAgICAgIHZhciBleHBlY3RlZFR5cGVOYW1l' +
	'ID0gbWF0Y2guU3VjY2VzcyA/IG1hdGNoLkdyb3Vwc1sxXS5WYWx1ZSA6IHByb3AudHlwZTsKCiAgICAgICAgICAgICAgICAgICAg' +
	'aWYgKGV4cGVjdGVkVHlwZU5hbWUgPT0gIkdhbWVPYmplY3QiKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'ICAgICAgICAgcHJvcC5vYmplY3RSZWZlcmVuY2VWYWx1ZSA9IHJlZkdvOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg' +
	'ICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcmVz' +
	'b2x2ZSB0aGUgZXhwZWN0ZWQgY29tcG9uZW50L29iamVjdCB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21wVHlw' +
	'ZSA9IEZpbmRDb21wb25lbnRUeXBlKGV4cGVjdGVkVHlwZU5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tcFR5' +
	'cGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3Aub2JqZWN0UmVmZXJlbmNlVmFsdWUgPSByZWZHby5H' +
	'ZXRDb21wb25lbnQoY29tcFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAg' +
	'ICAgICBwcm9wLm9iamVjdFJlZmVyZW5jZVZhbHVlID0gcmVmR287IC8vIGJlc3QtZWZmb3J0IGZhbGxiYWNrCiAgICAgICAgICAg' +
	'ICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAg' +
	'ICAgICAgICAgICAgIC8vIFRyeSBsb2FkaW5nIGZyb20gdGhlIGFzc2V0IGRhdGFiYXNlIChzcHJpdGVzLCBwcmVmYWJzLCBtYXRl' +
	'cmlhbHPigKYpCiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2V0ID0gQXNzZXREYXRhYmFzZS5Mb2FkTWFpbkFzc2V0QXRQYXRo' +
	'KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAg' +
	'ICAgICAgICAgICAgICAgICAgIHByb3Aub2JqZWN0UmVmZXJlbmNlVmFsdWUgPSBhc3NldDsKICAgICAgICAgICAgICAgICAgICB9' +
	'CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g' +
	'TmVpdGhlciBzY2VuZSBub3IgYXNzZXQgZGF0YWJhc2UgcmVzb2x2ZWQgdGhlIHJlZmVyZW5jZS4KICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgLy8gVGhyb3cgc28gdGhlIGNhbGxlciByZXR1cm5zIGEgcHJvcGVyIGVycm9yIGluc3RlYWQgb2Ygc2lsZW50bHkKICAg' +
	'ICAgICAgICAgICAgICAgICAgICAgLy8gbGVhdmluZyB0aGUgZmllbGQgbnVsbCBhbmQgcmV0dXJuaW5nIHN1Y2Nlc3MuCiAgICAg' +
	'ICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgICAgJCJDYW5ub3QgYXNzaWduIHJlZmVyZW5jZTogJ3t2YWx1ZX0nIHdhcyBub3QgZm91bmQgaW4gdGhlIHNjZW5lIGhp' +
	'ZXJhcmNoeSBvciB0aGUgYXNzZXQgZGF0YWJhc2UuICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCJNYWtlIHN1cmUg' +
	'dGhlIEdhbWVPYmplY3QgbmFtZSBvciBwYXRoIGlzIGNvcnJlY3QuIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg' +
	'ICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBDcmVhdGVGb2xkZXJSZWN1cnNpdmUoc3RyaW5nIHBhdGgpCiAgICB7CiAgICAgICAgdmFyIHBhcnRzID0gcGF0' +
	'aC5SZXBsYWNlKCJcXCIsICIvIikuU3BsaXQoJy8nKTsKICAgICAgICB2YXIgY3VycmVudCA9IHBhcnRzWzBdOwogICAgICAgIGZv' +
	'ciAoaW50IGkgPSAxOyBpIDwgcGFydHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICB2YXIgbmV4dCA9IGN1cnJl' +
	'bnQgKyAiLyIgKyBwYXJ0c1tpXTsKICAgICAgICAgICAgaWYgKCFBc3NldERhdGFiYXNlLklzVmFsaWRGb2xkZXIobmV4dCkpCiAg' +
	'ICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEFzc2V0RGF0YWJhc2UuQ3JlYXRlRm9sZGVyKGN1cnJlbnQsIHBhcnRzW2ldKTsK' +
	'ICAgICAgICAgICAgfQogICAgICAgICAgICBjdXJyZW50ID0gbmV4dDsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0' +
	'aWMgc3RyaW5nIEVzY2FwZUpzb24oc3RyaW5nIHMpCiAgICB7CiAgICAgICAgaWYgKHMgPT0gbnVsbCkgcmV0dXJuICJudWxsIjsK' +
	'ICAgICAgICByZXR1cm4gIlwiIiArIHMuUmVwbGFjZSgiXFwiLCAiXFxcXCIpLlJlcGxhY2UoIlwiIiwgIlxcXCIiKS5SZXBsYWNl' +
	'KCJcbiIsICJcXG4iKS5SZXBsYWNlKCJcciIsICJcXHIiKS5SZXBsYWNlKCJcdCIsICJcXHQiKSArICJcIiI7CiAgICB9CgogICAg' +
	'cHJpdmF0ZSBzdGF0aWMgc3RyaW5nIE1ha2VTdWNjZXNzKHN0cmluZyBpZCwgc3RyaW5nIHJlc3VsdEpzb24pCiAgICB7CiAgICAg' +
	'ICAgcmV0dXJuICQie3tcImlkXCI6e0VzY2FwZUpzb24oaWQpfSxcInR5cGVcIjpcInJlc3BvbnNlXCIsXCJzdWNjZXNzXCI6dHJ1' +
	'ZSxcInJlc3VsdFwiOntyZXN1bHRKc29ufX19IjsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgTWFrZUVycm9yKHN0' +
	'cmluZyBpZCwgc3RyaW5nIGVycm9yKQogICAgewogICAgICAgIHJldHVybiAkInt7XCJpZFwiOntFc2NhcGVKc29uKGlkKX0sXCJ0' +
	'eXBlXCI6XCJyZXNwb25zZVwiLFwic3VjY2Vzc1wiOmZhbHNlLFwiZXJyb3JcIjp7RXNjYXBlSnNvbihlcnJvcil9fX0iOwogICAg' +
	'fQoKICAgIC8vIC0tLSBTZXJpYWxpemF0aW9uIEhlbHBlcnMgLS0tCiAgICAvLyBKc29uVXRpbGl0eSBuZWVkcyBzZXJpYWxpemFi' +
	'bGUgY2xhc3NlcyBmb3IgRnJvbUpzb24KCiAgICBbU2VyaWFsaXphYmxlXQogICAgcHJpdmF0ZSBjbGFzcyBTZXJpYWxpemFibGVS' +
	'ZXF1ZXN0CiAgICB7CiAgICAgICAgcHVibGljIHN0cmluZyBpZDsKICAgICAgICBwdWJsaWMgc3RyaW5nIHR5cGU7CiAgICAgICAg' +
	'cHVibGljIHN0cmluZyBjYXRlZ29yeTsKICAgICAgICBwdWJsaWMgc3RyaW5nIGFjdGlvbjsKICAgICAgICBwdWJsaWMgc3RyaW5n' +
	'IHBhcmFtc0pzb247IC8vIFBhcmFtcyBhcyByYXcgSlNPTiBzdHJpbmcKCiAgICAgICAgLy8vIDxzdW1tYXJ5PgogICAgICAgIC8v' +
	'LyBQYXJzZSBwYXJhbXMgZnJvbSB0aGUgcmF3IEpTT04uIFNpbmNlIFVuaXR5J3MgSnNvblV0aWxpdHkgZG9lc24ndCBoYW5kbGUK' +
	'ICAgICAgICAvLy8gRGljdGlvbmFyeSBvciBkeW5hbWljIG9iamVjdHMsIHdlIGRvIG1hbnVhbCBwYXJzaW5nIGZvciB0aGUgc2lt' +
	'cGxlIGtleS12YWx1ZSBwYXJhbXMuCiAgICAgICAgLy8vIDwvc3VtbWFyeT4KICAgICAgICBwdWJsaWMgRGljdGlvbmFyeTxzdHJp' +
	'bmcsIHN0cmluZz4gR2V0UGFyYW1zKCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgRGljdGlvbmFyeTxz' +
	'dHJpbmcsIHN0cmluZz4oKTsKICAgICAgICAgICAgaWYgKHN0cmluZy5Jc051bGxPckVtcHR5KHBhcmFtc0pzb24pKSByZXR1cm4g' +
	'cmVzdWx0OwoKICAgICAgICAgICAgLy8gU2ltcGxlIEpTT04gb2JqZWN0IHBhcnNlciBmb3IgZmxhdCBrZXktdmFsdWUgcGFpcnMK' +
	'ICAgICAgICAgICAgdmFyIGpzb24gPSBwYXJhbXNKc29uLlRyaW0oKTsKICAgICAgICAgICAgaWYgKCFqc29uLlN0YXJ0c1dpdGgo' +
	'InsiKSkgcmV0dXJuIHJlc3VsdDsKCiAgICAgICAgICAgIGpzb24gPSBqc29uLlN1YnN0cmluZygxLCBqc29uLkxlbmd0aCAtIDIp' +
	'LlRyaW0oKTsKICAgICAgICAgICAgaWYgKHN0cmluZy5Jc051bGxPckVtcHR5KGpzb24pKSByZXR1cm4gcmVzdWx0OwoKICAgICAg' +
	'ICAgICAgLy8gU3BsaXQgYnkgY29tbWFzIHRoYXQgYXJlbid0IGluc2lkZSBzdHJpbmdzCiAgICAgICAgICAgIHZhciBwYWlycyA9' +
	'IFNwbGl0SnNvblBhaXJzKGpzb24pOwogICAgICAgICAgICBmb3JlYWNoICh2YXIgcGFpciBpbiBwYWlycykKICAgICAgICAgICAg' +
	'ewogICAgICAgICAgICAgICAgdmFyIGNvbG9uSWR4ID0gcGFpci5JbmRleE9mKCc6Jyk7CiAgICAgICAgICAgICAgICBpZiAoY29s' +
	'b25JZHggPCAwKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICB2YXIga2V5ID0gcGFpci5TdWJzdHJpbmcoMCwgY29sb25JZHgp' +
	'LlRyaW0oKS5UcmltKCciJyk7CiAgICAgICAgICAgICAgICB2YXIgdmFsID0gcGFpci5TdWJzdHJpbmcoY29sb25JZHggKyAxKS5U' +
	'cmltKCkuVHJpbSgnIicpOwoKICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBhcnJheSB2YWx1ZXMgKGtlZXAgYXMgc3RyaW5nIGZv' +
	'ciBub3cpCiAgICAgICAgICAgICAgICBpZiAodmFsLlN0YXJ0c1dpdGgoIlsiKSkKICAgICAgICAgICAgICAgICAgICB2YWwgPSB2' +
	'YWwuVHJpbSgpOwoKICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBy' +
	'ZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgTGlzdDxzdHJpbmc+IFNwbGl0SnNvblBhaXJz' +
	'KHN0cmluZyBqc29uKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBMaXN0PHN0cmluZz4oKTsKICAgICAg' +
	'ICAgICAgdmFyIGRlcHRoID0gMDsKICAgICAgICAgICAgdmFyIGluU3RyaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBzdGFy' +
	'dCA9IDA7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpzb24uTGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAg' +
	'ICAgICAgICAgICAgIHZhciBjID0ganNvbltpXTsKICAgICAgICAgICAgICAgIGlmIChjID09ICciJyAmJiAoaSA9PSAwIHx8IGpz' +
	'b25baSAtIDFdICE9ICdcXCcpKQogICAgICAgICAgICAgICAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nOwogICAgICAgICAgICAg' +
	'ICAgZWxzZSBpZiAoIWluU3RyaW5nKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmIChjID09ICd7JyB8' +
	'fCBjID09ICdbJykgZGVwdGgrKzsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjID09ICd9JyB8fCBjID09ICddJykgZGVw' +
	'dGgtLTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjID09ICcsJyAmJiBkZXB0aCA9PSAwKQogICAgICAgICAgICAgICAg' +
	'ICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LkFkZChqc29uLlN1YnN0cmluZyhzdGFydCwgaSAtIHN0YXJ0KS5U' +
	'cmltKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhcnQgPCBqc29uLkxlbmd0aCkKICAgICAgICAgICAg' +
	'ICAgIHJlc3VsdC5BZGQoanNvbi5TdWJzdHJpbmcoc3RhcnQpLlRyaW0oKSk7CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0Owog' +
	'ICAgICAgIH0KICAgIH0KCn0K';

/** Decode and return the C# plugin source */
export function getBridgePluginSource(): string {
	return VSBuffer.wrap(Uint8Array.from(atob(BRIDGE_PLUGIN_BASE64), c => c.charCodeAt(0))).toString();
}
