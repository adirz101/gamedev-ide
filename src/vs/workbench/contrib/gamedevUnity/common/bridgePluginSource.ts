/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Embedded source of the Unity Editor Bridge C# plugin (base64 encoded).
 * Auto-deployed into the user's Unity project at Assets/Editor/GameDevIDEBridge.cs.
 *
 * The readable source is at: unity-editor-plugin/GameDevIDEBridge.cs
 * To regenerate after editing the C# file, run from the repo root:
 *   node scripts/generate-bridge-plugin-source.js
 */

import { VSBuffer } from '../../../../base/common/buffer.js';

/** Version marker â€” bump when the plugin changes to trigger re-deploy */
export const BRIDGE_PLUGIN_VERSION = '1.0.0';

/** Path relative to Unity project root where the plugin is installed */
export const BRIDGE_PLUGIN_INSTALL_PATH = 'Assets/Editor/GameDevIDEBridge.cs';

/** Base64-encoded C# source of the Unity Editor Bridge plugin */
const BRIDGE_PLUGIN_BASE64 = '' +
	'LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIEdhbWVEZXYgSURFIEJyaWRnZSDigJQgVW5pdHkgRWRpdG9yIFBsdWdpbiAgKEFVVE8t' +
	'SU5TVEFMTEVEIGJ5IEdhbWVEZXYgSURFKQogKgogKiAgVGhpcyBmaWxlIGlzIGF1dG9tYXRpY2FsbHkgbWFuYWdlZCBieSBHYW1l' +
	'RGV2IElERS4gRG8gbm90IGVkaXQgbWFudWFsbHkuCiAqICBJdCBvcGVucyBhIFdlYlNvY2tldCBzZXJ2ZXIgb24gbG9jYWxob3N0' +
	'IHNvIHRoZSBJREUgY2FuIGNvbW11bmljYXRlIHdpdGgKICogIHRoZSBydW5uaW5nIFVuaXR5IEVkaXRvciB0byBjcmVhdGUgR2Ft' +
	'ZU9iamVjdHMsIHNjZW5lcywgcHJlZmFicywgZXRjLgogKgogKiAgUHJvdG9jb2wgdmVyc2lvbjogMS4wCiAqICBQbHVnaW4gdmVy' +
	'c2lvbjogMS4wLjAKICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t' +
	'LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgp1c2luZyBVbml0eUVuZ2luZTsKdXNpbmcgVW5pdHlFZGl0b3I7CnVz' +
	'aW5nIFVuaXR5RWRpdG9yLlNjZW5lTWFuYWdlbWVudDsKdXNpbmcgVW5pdHlFbmdpbmUuU2NlbmVNYW5hZ2VtZW50Owp1c2luZyBT' +
	'eXN0ZW07CnVzaW5nIFN5c3RlbS5JTzsKdXNpbmcgU3lzdGVtLk5ldDsKdXNpbmcgU3lzdGVtLk5ldC5Tb2NrZXRzOwp1c2luZyBT' +
	'eXN0ZW0uTmV0LldlYlNvY2tldHM7CnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHk7CnVzaW5nIFN5c3RlbS5UZXh0' +
	'Owp1c2luZyBTeXN0ZW0uVGV4dC5SZWd1bGFyRXhwcmVzc2lvbnM7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7CnVzaW5nIFN5c3Rl' +
	'bS5UaHJlYWRpbmcuVGFza3M7CnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5Db25jdXJyZW50Owp1c2luZyBTeXN0ZW0uQ29sbGVj' +
	'dGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247CnVzaW5nIFN5c3RlbS5MaW5xOwoKW0luaXRpYWxpemVPbkxv' +
	'YWRdCnB1YmxpYyBzdGF0aWMgY2xhc3MgR2FtZURldklERUJyaWRnZQp7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBQUk9UT0NP' +
	'TF9WRVJTSU9OID0gIjEuMCI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRElSID0gIkxpYnJhcnkvR2FtZURl' +
	'dklERSI7CiAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBESVNDT1ZFUllfRklMRSA9ICJMaWJyYXJ5L0dhbWVEZXZJREUvYnJpZGdl' +
	'Lmpzb24iOwoKICAgIHByaXZhdGUgc3RhdGljIFRjcExpc3RlbmVyIF9saXN0ZW5lcjsKICAgIHByaXZhdGUgc3RhdGljIFRjcENs' +
	'aWVudCBfdGNwQ2xpZW50OwogICAgcHJpdmF0ZSBzdGF0aWMgTmV0d29ya1N0cmVhbSBfY2xpZW50U3RyZWFtOwogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UgX2N0czsKICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENvbmN1cnJl' +
	'bnRRdWV1ZTxzdHJpbmc+IF9pbmNvbWluZ01lc3NhZ2VzID0gbmV3IENvbmN1cnJlbnRRdWV1ZTxzdHJpbmc+KCk7CiAgICBwcml2' +
	'YXRlIHN0YXRpYyByZWFkb25seSBDb25jdXJyZW50UXVldWU8c3RyaW5nPiBfb3V0Z29pbmdNZXNzYWdlcyA9IG5ldyBDb25jdXJy' +
	'ZW50UXVldWU8c3RyaW5nPigpOwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IF9wb3J0OwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBf' +
	'cnVubmluZzsKICAgIHByaXZhdGUgc3RhdGljIGJvb2wgX2NsaWVudENvbm5lY3RlZDsKCiAgICBzdGF0aWMgR2FtZURldklERUJy' +
	'aWRnZSgpCiAgICB7CiAgICAgICAgRWRpdG9yQXBwbGljYXRpb24udXBkYXRlICs9IFByb2Nlc3NNZXNzYWdlczsKICAgICAgICBF' +
	'ZGl0b3JBcHBsaWNhdGlvbi5xdWl0dGluZyArPSBTaHV0ZG93bjsKICAgICAgICBBc3NlbWJseVJlbG9hZEV2ZW50cy5iZWZvcmVB' +
	'c3NlbWJseVJlbG9hZCArPSBPbkJlZm9yZVJlbG9hZDsKICAgICAgICBBcHBsaWNhdGlvbi5sb2dNZXNzYWdlUmVjZWl2ZWQgKz0g' +
	'T25Mb2dNZXNzYWdlOwogICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLnBsYXlNb2RlU3RhdGVDaGFuZ2VkICs9IE9uUGxheU1vZGVD' +
	'aGFuZ2VkOwogICAgICAgIFN0YXJ0U2VydmVyKCk7CiAgICB9CgogICAgLy8gLS0tIFNlcnZlciBMaWZlY3ljbGUgKFRjcExpc3Rl' +
	'bmVyICsgbWFudWFsIFdlYlNvY2tldCBoYW5kc2hha2UpIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIGFzeW5jIHZvaWQgU3RhcnRT' +
	'ZXJ2ZXIoKQogICAgewogICAgICAgIGlmIChfcnVubmluZykgcmV0dXJuOwoKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAg' +
	'ICAgIF9jdHMgPSBuZXcgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTsKCiAgICAgICAgICAgIC8vIEJpbmQgdG8gcG9ydCAwIGZv' +
	'ciBhdXRvLWFzc2lnbm1lbnQKICAgICAgICAgICAgX2xpc3RlbmVyID0gbmV3IFRjcExpc3RlbmVyKElQQWRkcmVzcy5Mb29wYmFj' +
	'aywgMCk7CiAgICAgICAgICAgIF9saXN0ZW5lci5TdGFydCgpOwogICAgICAgICAgICBfcG9ydCA9ICgoSVBFbmRQb2ludClfbGlz' +
	'dGVuZXIuTG9jYWxFbmRwb2ludCkuUG9ydDsKICAgICAgICAgICAgX3J1bm5pbmcgPSB0cnVlOwoKICAgICAgICAgICAgV3JpdGVE' +
	'aXNjb3ZlcnlGaWxlKCk7CiAgICAgICAgICAgIERlYnVnLkxvZygkIltHYW1lRGV2SURFIEJyaWRnZV0gU3RhcnRlZCBvbiBwb3J0' +
	'IHtfcG9ydH0gKHZ7UFJPVE9DT0xfVkVSU0lPTn0pIik7CgogICAgICAgICAgICAvLyBBY2NlcHQgY29ubmVjdGlvbnMgaW4gYmFj' +
	'a2dyb3VuZAogICAgICAgICAgICBhd2FpdCBBY2NlcHRDb25uZWN0aW9ucyhfY3RzLlRva2VuKTsKICAgICAgICB9CiAgICAgICAg' +
	'Y2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIERlYnVnLkxvZ0Vycm9yKCQiW0dhbWVEZXZJREUgQnJp' +
	'ZGdlXSBGYWlsZWQgdG8gc3RhcnQ6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICBfcnVubmluZyA9IGZhbHNlOwogICAgICAg' +
	'IH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIEFjY2VwdENvbm5lY3Rpb25zKENhbmNlbGxhdGlvblRva2Vu' +
	'IHRva2VuKQogICAgewogICAgICAgIHdoaWxlICghdG9rZW4uSXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQgJiYgX3J1bm5pbmcpCiAg' +
	'ICAgICAgewogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IGF3YWl0IF9s' +
	'aXN0ZW5lci5BY2NlcHRUY3BDbGllbnRBc3luYygpOwogICAgICAgICAgICAgICAgdmFyIHN0cmVhbSA9IGNsaWVudC5HZXRTdHJl' +
	'YW0oKTsKCiAgICAgICAgICAgICAgICAvLyBSZWFkIHRoZSBIVFRQIHVwZ3JhZGUgcmVxdWVzdAogICAgICAgICAgICAgICAgdmFy' +
	'IGJ1ZmZlciA9IG5ldyBieXRlWzQwOTZdOwogICAgICAgICAgICAgICAgaW50IGJ5dGVzUmVhZCA9IGF3YWl0IHN0cmVhbS5SZWFk' +
	'QXN5bmMoYnVmZmVyLCAwLCBidWZmZXIuTGVuZ3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IEVuY29k' +
	'aW5nLlVURjguR2V0U3RyaW5nKGJ1ZmZlciwgMCwgYnl0ZXNSZWFkKTsKCiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5Db250' +
	'YWlucygiVXBncmFkZTogd2Vic29ja2V0IikgfHwgcmVxdWVzdC5Db250YWlucygiVXBncmFkZTogV2ViU29ja2V0IikpCiAgICAg' +
	'ICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBhbGxvdyBvbmUgY2xpZW50IGF0IGEgdGltZQogICAgICAg' +
	'ICAgICAgICAgICAgIGlmIChfY2xpZW50Q29ubmVjdGVkKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg' +
	'ICAgICAgdmFyIHJlamVjdCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMoIkhUVFAvMS4xIDQwOSBDb25mbGljdFxyXG5cclxuIik7' +
	'CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHJlamVjdCwgMCwgcmVqZWN0Lkxlbmd0aCwg' +
	'dG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQuQ2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29u' +
	'dGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIFdlYlNvY2tldCBoYW5k' +
	'c2hha2UKICAgICAgICAgICAgICAgICAgICBpZiAoUGVyZm9ybVdlYlNvY2tldEhhbmRzaGFrZShzdHJlYW0sIHJlcXVlc3QpKQog' +
	'ICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RjcENsaWVudCA9IGNsaWVudDsKICAgICAgICAg' +
	'ICAgICAgICAgICAgICAgX2NsaWVudFN0cmVhbSA9IHN0cmVhbTsKICAgICAgICAgICAgICAgICAgICAgICAgX2NsaWVudENvbm5l' +
	'Y3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLkxvZygiW0dhbWVEZXZJREUgQnJpZGdlXSBJREUgY29u' +
	'bmVjdGVkIik7CgogICAgICAgICAgICAgICAgICAgICAgICBfID0gUmVjZWl2ZU1lc3NhZ2VzKHN0cmVhbSwgdG9rZW4pOwogICAg' +
	'ICAgICAgICAgICAgICAgICAgICBfID0gU2VuZE1lc3NhZ2VzKHN0cmVhbSwgdG9rZW4pOwogICAgICAgICAgICAgICAgICAgIH0K' +
	'ICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjbGll' +
	'bnQuQ2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAg' +
	'ICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2ltcGxlIGhlYWx0aCBjaGVjawogICAgICAgICAgICAgICAg' +
	'ICAgIHZhciBib2R5ID0gIntcInN0YXR1c1wiOlwib2tcIixcInZlcnNpb25cIjpcIiIgKyBQUk9UT0NPTF9WRVJTSU9OICsgIlwi' +
	'fSI7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gIkhUVFAvMS4xIDIwMCBPS1xyXG5Db250ZW50LVR5cGU6IGFw' +
	'cGxpY2F0aW9uL2pzb25cclxuQ29udGVudC1MZW5ndGg6ICIgKyBib2R5Lkxlbmd0aCArICJcclxuQ29ubmVjdGlvbjogY2xvc2Vc' +
	'clxuXHJcbiIgKyBib2R5OwogICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUJ5dGVzID0gRW5jb2RpbmcuVVRGOC5HZXRC' +
	'eXRlcyhyZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3RyZWFtLldyaXRlQXN5bmMocmVzcG9uc2VCeXRlcywg' +
	'MCwgcmVzcG9uc2VCeXRlcy5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgICAgICBjbGllbnQuQ2xvc2UoKTsKICAgICAg' +
	'ICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoT2JqZWN0RGlzcG9zZWRFeGNlcHRpb24pIHsgYnJl' +
	'YWs7IH0KICAgICAgICAgICAgY2F0Y2ggKFNvY2tldEV4Y2VwdGlvbikgeyBicmVhazsgfQogICAgICAgICAgICBjYXRjaCAoRXhj' +
	'ZXB0aW9uIGV4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIXRva2VuLklzQ2FuY2VsbGF0aW9uUmVxdWVzdGVk' +
	'KQogICAgICAgICAgICAgICAgICAgIERlYnVnLkxvZ1dhcm5pbmcoJCJbR2FtZURldklERSBCcmlkZ2VdIENvbm5lY3Rpb24gZXJy' +
	'b3I6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGJvb2wg' +
	'UGVyZm9ybVdlYlNvY2tldEhhbmRzaGFrZShOZXR3b3JrU3RyZWFtIHN0cmVhbSwgc3RyaW5nIHJlcXVlc3QpCiAgICB7CiAgICAg' +
	'ICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICAvLyBFeHRyYWN0IFNlYy1XZWJTb2NrZXQtS2V5IGZyb20gdGhlIHJlcXVlc3Qg' +
	'aGVhZGVycwogICAgICAgICAgICB2YXIga2V5TWF0Y2ggPSBSZWdleC5NYXRjaChyZXF1ZXN0LCBAIlNlYy1XZWJTb2NrZXQtS2V5' +
	'OlxzKiguKz8pXHJcbiIpOwogICAgICAgICAgICBpZiAoIWtleU1hdGNoLlN1Y2Nlc3MpIHJldHVybiBmYWxzZTsKCiAgICAgICAg' +
	'ICAgIHZhciBrZXkgPSBrZXlNYXRjaC5Hcm91cHNbMV0uVmFsdWUuVHJpbSgpOwogICAgICAgICAgICB2YXIgYWNjZXB0S2V5ID0g' +
	'Q29udmVydC5Ub0Jhc2U2NFN0cmluZygKICAgICAgICAgICAgICAgIFNIQTEuQ3JlYXRlKCkuQ29tcHV0ZUhhc2goCiAgICAgICAg' +
	'ICAgICAgICAgICAgRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhrZXkgKyAiMjU4RUFGQTUtRTkxNC00N0RBLTk1Q0EtQzVBQjBEQzg1' +
	'QjExIikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHZhciByZXNwb25zZSA9CiAgICAgICAg' +
	'ICAgICAgICAiSFRUUC8xLjEgMTAxIFN3aXRjaGluZyBQcm90b2NvbHNcclxuIiArCiAgICAgICAgICAgICAgICAiVXBncmFkZTog' +
	'd2Vic29ja2V0XHJcbiIgKwogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb246IFVwZ3JhZGVcclxuIiArCiAgICAgICAgICAgICAg' +
	'ICAiU2VjLVdlYlNvY2tldC1BY2NlcHQ6ICIgKyBhY2NlcHRLZXkgKyAiXHJcblxyXG4iOwoKICAgICAgICAgICAgdmFyIHJlc3Bv' +
	'bnNlQnl0ZXMgPSBFbmNvZGluZy5VVEY4LkdldEJ5dGVzKHJlc3BvbnNlKTsKICAgICAgICAgICAgc3RyZWFtLldyaXRlKHJlc3Bv' +
	'bnNlQnl0ZXMsIDAsIHJlc3BvbnNlQnl0ZXMuTGVuZ3RoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAg' +
	'ICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAgICAgICAgICBEZWJ1Zy5Mb2dXYXJuaW5nKCQiW0dhbWVEZXZJ' +
	'REUgQnJpZGdlXSBIYW5kc2hha2UgZmFpbGVkOiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg' +
	'ICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBUYXNrIFJlY2VpdmVNZXNzYWdlcyhOZXR3b3JrU3RyZWFtIHN0' +
	'cmVhbSwgQ2FuY2VsbGF0aW9uVG9rZW4gdG9rZW4pCiAgICB7CiAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBieXRlWzgxOTJdOwoK' +
	'ICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIHdoaWxlIChfY2xpZW50Q29ubmVjdGVkICYmICF0b2tlbi5Jc0NhbmNl' +
	'bGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCFzdHJlYW0uRGF0YUF2YWlsYWJsZSkK' +
	'ICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDgsIHRva2VuKTsKICAgICAgICAg' +
	'ICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbnQgYnl0ZXNSZWFkID0gYXdh' +
	'aXQgc3RyZWFtLlJlYWRBc3luYyhidWZmZXIsIDAsIGJ1ZmZlci5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAgIGlmIChi' +
	'eXRlc1JlYWQgPT0gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURF' +
	'IEJyaWRnZV0gSURFIGRpc2Nvbm5lY3RlZCIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoK' +
	'ICAgICAgICAgICAgICAgIC8vIERlY29kZSBXZWJTb2NrZXQgZnJhbWUocykKICAgICAgICAgICAgICAgIGludCBvZmZzZXQgPSAw' +
	'OwogICAgICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IGJ5dGVzUmVhZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAg' +
	'ICAgICAgICB2YXIgZnJhbWUgPSBEZWNvZGVXZWJTb2NrZXRGcmFtZShidWZmZXIsIG9mZnNldCwgYnl0ZXNSZWFkIC0gb2Zmc2V0' +
	'KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUgPT0gbnVsbCkgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIG9mZnNl' +
	'dCArPSBmcmFtZS5Ub3RhbExlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1lLk9wY29kZSA9PSAweDgpIC8vIENs' +
	'b3NlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGNsb3NlIGZyYW1lIGJhY2sK' +
	'ICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsb3NlRnJhbWUgPSBuZXcgYnl0ZVtdIHsgMHg4OCwgMHgwMCB9OwogICAgICAg' +
	'ICAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYW0uV3JpdGVBc3luYyhjbG9zZUZyYW1lLCAwLCBjbG9zZUZyYW1lLkxlbmd0aCwg' +
	'dG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy5Mb2coIltHYW1lRGV2SURFIEJyaWRnZV0gSURFIGRpc2Nvbm5l' +
	'Y3RlZCAoY2xvc2UgZnJhbWUpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIERpc2Nvbm5lY3RDbGllbnQoKTsKICAgICAgICAg' +
	'ICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1l' +
	'Lk9wY29kZSA9PSAweDkpIC8vIFBpbmcKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNl' +
	'bmQgcG9uZwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9uZyA9IEVuY29kZVdlYlNvY2tldEZyYW1lKGZyYW1lLlBheWxv' +
	'YWQsIDB4QSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKHBvbmcsIDAsIHBvbmcuTGVu' +
	'Z3RoLCB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAg' +
	'ICAgICAgICAgICAgICAgaWYgKGZyYW1lLk9wY29kZSA9PSAweDEgfHwgZnJhbWUuT3Bjb2RlID09IDB4MikgLy8gVGV4dCBvciBC' +
	'aW5hcnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gRW5jb2Rpbmcu' +
	'VVRGOC5HZXRTdHJpbmcoZnJhbWUuUGF5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pbmNvbWluZ01lc3NhZ2VzLkVu' +
	'cXVldWUobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg' +
	'ICAgfQogICAgICAgIGNhdGNoIChJT0V4Y2VwdGlvbikgeyAvKiBDbGllbnQgZGlzY29ubmVjdGVkICovIH0KICAgICAgICBjYXRj' +
	'aCAoT3BlcmF0aW9uQ2FuY2VsZWRFeGNlcHRpb24pIHsgLyogU2h1dHRpbmcgZG93biAqLyB9CiAgICAgICAgY2F0Y2ggKEV4Y2Vw' +
	'dGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIERlYnVnLkxvZ1dhcm5pbmcoJCJbR2FtZURldklERSBCcmlkZ2VdIFJlY2Vp' +
	'dmUgZXJyb3I6IHtleC5NZXNzYWdlfSIpOwogICAgICAgIH0KCiAgICAgICAgRGlzY29ubmVjdENsaWVudCgpOwogICAgfQoKICAg' +
	'IHByaXZhdGUgc3RhdGljIGFzeW5jIFRhc2sgU2VuZE1lc3NhZ2VzKE5ldHdvcmtTdHJlYW0gc3RyZWFtLCBDYW5jZWxsYXRpb25U' +
	'b2tlbiB0b2tlbikKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIHdoaWxlIChfY2xpZW50Q29ubmVjdGVk' +
	'ICYmICF0b2tlbi5Jc0NhbmNlbGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKF9vdXRn' +
	'b2luZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZhciBtZXNzYWdlKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'ICAgICB2YXIgcGF5bG9hZCA9IEVuY29kaW5nLlVURjguR2V0Qnl0ZXMobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgdmFy' +
	'IGZyYW1lID0gRW5jb2RlV2ViU29ja2V0RnJhbWUocGF5bG9hZCwgMHgxKTsgLy8gVGV4dCBmcmFtZQogICAgICAgICAgICAgICAg' +
	'ICAgIGF3YWl0IHN0cmVhbS5Xcml0ZUFzeW5jKGZyYW1lLCAwLCBmcmFtZS5MZW5ndGgsIHRva2VuKTsKICAgICAgICAgICAgICAg' +
	'IH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRl' +
	'bGF5KDE2LCB0b2tlbik7IC8vIH42MEh6IHBvbGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg' +
	'ICAgICBjYXRjaCAoSU9FeGNlcHRpb24pIHsgfQogICAgICAgIGNhdGNoIChPcGVyYXRpb25DYW5jZWxlZEV4Y2VwdGlvbikgeyB9' +
	'CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBEaXNjb25uZWN0Q2xpZW50KCkKICAgIHsKICAgICAgICBfY2xpZW50Q29u' +
	'bmVjdGVkID0gZmFsc2U7CiAgICAgICAgdHJ5IHsgX2NsaWVudFN0cmVhbT8uQ2xvc2UoKTsgfSBjYXRjaCB7IH0KICAgICAgICB0' +
	'cnkgeyBfdGNwQ2xpZW50Py5DbG9zZSgpOyB9IGNhdGNoIHsgfQogICAgICAgIF9jbGllbnRTdHJlYW0gPSBudWxsOwogICAgICAg' +
	'IF90Y3BDbGllbnQgPSBudWxsOwogICAgfQoKICAgIC8vIC0tLSBXZWJTb2NrZXQgRnJhbWUgRW5jb2RpbmcvRGVjb2RpbmcgLS0t' +
	'CgogICAgcHJpdmF0ZSBjbGFzcyBXZWJTb2NrZXRGcmFtZQogICAgewogICAgICAgIHB1YmxpYyBieXRlIE9wY29kZTsKICAgICAg' +
	'ICBwdWJsaWMgYnl0ZVtdIFBheWxvYWQ7CiAgICAgICAgcHVibGljIGludCBUb3RhbExlbmd0aDsgLy8gVG90YWwgYnl0ZXMgY29u' +
	'c3VtZWQgZnJvbSBidWZmZXIKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBXZWJTb2NrZXRGcmFtZSBEZWNvZGVXZWJTb2NrZXRG' +
	'cmFtZShieXRlW10gYnVmZmVyLCBpbnQgb2Zmc2V0LCBpbnQgbGVuZ3RoKQogICAgewogICAgICAgIGlmIChsZW5ndGggPCAyKSBy' +
	'ZXR1cm4gbnVsbDsKCiAgICAgICAgdmFyIG9wY29kZSA9IChieXRlKShidWZmZXJbb2Zmc2V0XSAmIDB4MEYpOwogICAgICAgIHZh' +
	'ciBtYXNrZWQgPSAoYnVmZmVyW29mZnNldCArIDFdICYgMHg4MCkgIT0gMDsKICAgICAgICBsb25nIHBheWxvYWRMZW4gPSBidWZm' +
	'ZXJbb2Zmc2V0ICsgMV0gJiAweDdGOwogICAgICAgIGludCBoZWFkZXJMZW4gPSAyOwoKICAgICAgICBpZiAocGF5bG9hZExlbiA9' +
	'PSAxMjYpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgNCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHBheWxv' +
	'YWRMZW4gPSAoYnVmZmVyW29mZnNldCArIDJdIDw8IDgpIHwgYnVmZmVyW29mZnNldCArIDNdOwogICAgICAgICAgICBoZWFkZXJM' +
	'ZW4gPSA0OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChwYXlsb2FkTGVuID09IDEyNykKICAgICAgICB7CiAgICAgICAgICAg' +
	'IGlmIChsZW5ndGggPCAxMCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHBheWxvYWRMZW4gPSAwOwogICAgICAgICAgICBmb3Ig' +
	'KGludCBpID0gMDsgaSA8IDg7IGkrKykKICAgICAgICAgICAgICAgIHBheWxvYWRMZW4gPSAocGF5bG9hZExlbiA8PCA4KSB8IGJ1' +
	'ZmZlcltvZmZzZXQgKyAyICsgaV07CiAgICAgICAgICAgIGhlYWRlckxlbiA9IDEwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZVtd' +
	'IG1hc2tLZXkgPSBudWxsOwogICAgICAgIGlmIChtYXNrZWQpCiAgICAgICAgewogICAgICAgICAgICBpZiAobGVuZ3RoIDwgaGVh' +
	'ZGVyTGVuICsgNCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIG1hc2tLZXkgPSBuZXcgYnl0ZVs0XTsKICAgICAgICAgICAgQXJy' +
	'YXkuQ29weShidWZmZXIsIG9mZnNldCArIGhlYWRlckxlbiwgbWFza0tleSwgMCwgNCk7CiAgICAgICAgICAgIGhlYWRlckxlbiAr' +
	'PSA0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGxlbmd0aCA8IGhlYWRlckxlbiArIHBheWxvYWRMZW4pIHJldHVybiBudWxsOwoK' +
	'ICAgICAgICB2YXIgcGF5bG9hZCA9IG5ldyBieXRlW3BheWxvYWRMZW5dOwogICAgICAgIEFycmF5LkNvcHkoYnVmZmVyLCBvZmZz' +
	'ZXQgKyBoZWFkZXJMZW4sIHBheWxvYWQsIDAsIChpbnQpcGF5bG9hZExlbik7CgogICAgICAgIGlmIChtYXNrZWQgJiYgbWFza0tl' +
	'eSAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXlsb2FkLkxlbmd0aDsgaSsrKQog' +
	'ICAgICAgICAgICAgICAgcGF5bG9hZFtpXSBePSBtYXNrS2V5W2kgJSA0XTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXcg' +
	'V2ViU29ja2V0RnJhbWUKICAgICAgICB7CiAgICAgICAgICAgIE9wY29kZSA9IG9wY29kZSwKICAgICAgICAgICAgUGF5bG9hZCA9' +
	'IHBheWxvYWQsCiAgICAgICAgICAgIFRvdGFsTGVuZ3RoID0gaGVhZGVyTGVuICsgKGludClwYXlsb2FkTGVuCiAgICAgICAgfTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBieXRlW10gRW5jb2RlV2ViU29ja2V0RnJhbWUoYnl0ZVtdIHBheWxvYWQsIGJ5dGUg' +
	'b3Bjb2RlKQogICAgewogICAgICAgIHZhciBsZW4gPSBwYXlsb2FkLkxlbmd0aDsKICAgICAgICBieXRlW10gZnJhbWU7CgogICAg' +
	'ICAgIGlmIChsZW4gPCAxMjYpCiAgICAgICAgewogICAgICAgICAgICBmcmFtZSA9IG5ldyBieXRlWzIgKyBsZW5dOwogICAgICAg' +
	'ICAgICBmcmFtZVswXSA9IChieXRlKSgweDgwIHwgb3Bjb2RlKTsgLy8gRklOICsgb3Bjb2RlCiAgICAgICAgICAgIGZyYW1lWzFd' +
	'ID0gKGJ5dGUpbGVuOwogICAgICAgICAgICBBcnJheS5Db3B5KHBheWxvYWQsIDAsIGZyYW1lLCAyLCBsZW4pOwogICAgICAgIH0K' +
	'ICAgICAgICBlbHNlIGlmIChsZW4gPCA2NTUzNikKICAgICAgICB7CiAgICAgICAgICAgIGZyYW1lID0gbmV3IGJ5dGVbNCArIGxl' +
	'bl07CiAgICAgICAgICAgIGZyYW1lWzBdID0gKGJ5dGUpKDB4ODAgfCBvcGNvZGUpOwogICAgICAgICAgICBmcmFtZVsxXSA9IDEy' +
	'NjsKICAgICAgICAgICAgZnJhbWVbMl0gPSAoYnl0ZSkobGVuID4+IDgpOwogICAgICAgICAgICBmcmFtZVszXSA9IChieXRlKShs' +
	'ZW4gJiAweEZGKTsKICAgICAgICAgICAgQXJyYXkuQ29weShwYXlsb2FkLCAwLCBmcmFtZSwgNCwgbGVuKTsKICAgICAgICB9CiAg' +
	'ICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgZnJhbWUgPSBuZXcgYnl0ZVsxMCArIGxlbl07CiAgICAgICAgICAgIGZy' +
	'YW1lWzBdID0gKGJ5dGUpKDB4ODAgfCBvcGNvZGUpOwogICAgICAgICAgICBmcmFtZVsxXSA9IDEyNzsKICAgICAgICAgICAgZm9y' +
	'IChpbnQgaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgICAgICBmcmFtZVsyICsgaV0gPSAoYnl0ZSkoKGxlbiA+PiAoNTYg' +
	'LSBpICogOCkpICYgMHhGRik7CiAgICAgICAgICAgIEFycmF5LkNvcHkocGF5bG9hZCwgMCwgZnJhbWUsIDEwLCBsZW4pOwogICAg' +
	'ICAgIH0KCiAgICAgICAgcmV0dXJuIGZyYW1lOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgV3JpdGVEaXNjb3ZlcnlG' +
	'aWxlKCkKICAgIHsKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgIGlmICghRGlyZWN0b3J5LkV4aXN0cyhESVNDT1ZF' +
	'UllfRElSKSkKICAgICAgICAgICAgICAgIERpcmVjdG9yeS5DcmVhdGVEaXJlY3RvcnkoRElTQ09WRVJZX0RJUik7CgogICAgICAg' +
	'ICAgICB2YXIganNvbiA9ICQie3tcInBvcnRcIjp7X3BvcnR9LFwicGlkXCI6e1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLkdl' +
	'dEN1cnJlbnRQcm9jZXNzKCkuSWR9LFwidmVyc2lvblwiOlwie1BST1RPQ09MX1ZFUlNJT059XCIsXCJ0aW1lc3RhbXBcIjp7RGF0' +
	'ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVTZWNvbmRzKCl9fX0iOwogICAgICAgICAgICBGaWxlLldyaXRlQWxsVGV4dChE' +
	'SVNDT1ZFUllfRklMRSwganNvbik7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgewogICAg' +
	'ICAgICAgICBEZWJ1Zy5Mb2dFcnJvcigkIltHYW1lRGV2SURFIEJyaWRnZV0gRmFpbGVkIHRvIHdyaXRlIGRpc2NvdmVyeSBmaWxl' +
	'OiB7ZXguTWVzc2FnZX0iKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBTaHV0ZG93bigpCiAgICB7' +
	'CiAgICAgICAgX3J1bm5pbmcgPSBmYWxzZTsKICAgICAgICBfY3RzPy5DYW5jZWwoKTsKCiAgICAgICAgRGlzY29ubmVjdENsaWVu' +
	'dCgpOwoKICAgICAgICB0cnkgeyBfbGlzdGVuZXI/LlN0b3AoKTsgfQogICAgICAgIGNhdGNoIHsgfQoKICAgICAgICB0cnkgeyBp' +
	'ZiAoRmlsZS5FeGlzdHMoRElTQ09WRVJZX0ZJTEUpKSBGaWxlLkRlbGV0ZShESVNDT1ZFUllfRklMRSk7IH0KICAgICAgICBjYXRj' +
	'aCB7IH0KCiAgICAgICAgRGVidWcuTG9nKCJbR2FtZURldklERSBCcmlkZ2VdIFN0b3BwZWQiKTsKICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyB2b2lkIE9uQmVmb3JlUmVsb2FkKCkKICAgIHsKICAgICAgICAvLyBDbGVhbiB1cCBiZWZvcmUgZG9tYWluIHJlbG9h' +
	'ZCAoc2NyaXB0IHJlY29tcGlsYXRpb24pCiAgICAgICAgU2h1dGRvd24oKTsKICAgIH0KCiAgICAvLyAtLS0gVW5pdHkgRXZlbnQg' +
	'Rm9yd2FyZGluZyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIE9uTG9nTWVzc2FnZShzdHJpbmcgY29uZGl0aW9uLCBzdHJp' +
	'bmcgc3RhY2tUcmFjZSwgTG9nVHlwZSB0eXBlKQogICAgewogICAgICAgIGlmICghX2NsaWVudENvbm5lY3RlZCkgcmV0dXJuOwoK' +
	'ICAgICAgICB2YXIgbG9nVHlwZSA9IHR5cGUgc3dpdGNoCiAgICAgICAgewogICAgICAgICAgICBMb2dUeXBlLkVycm9yID0+ICJF' +
	'cnJvciIsCiAgICAgICAgICAgIExvZ1R5cGUuV2FybmluZyA9PiAiV2FybmluZyIsCiAgICAgICAgICAgIExvZ1R5cGUuRXhjZXB0' +
	'aW9uID0+ICJFeGNlcHRpb24iLAogICAgICAgICAgICBMb2dUeXBlLkFzc2VydCA9PiAiQXNzZXJ0IiwKICAgICAgICAgICAgXyA9' +
	'PiAiTG9nIgogICAgICAgIH07CgogICAgICAgIHZhciBldmVudEpzb24gPSAkInt7XCJpZFwiOlwie0d1aWQuTmV3R3VpZCgpfVwi' +
	'LFwidHlwZVwiOlwiZXZlbnRcIixcImV2ZW50XCI6XCJjb25zb2xlLmxvZ1wiLFwiZGF0YVwiOnt7XCJtZXNzYWdlXCI6e0VzY2Fw' +
	'ZUpzb24oY29uZGl0aW9uKX0sXCJzdGFja1RyYWNlXCI6e0VzY2FwZUpzb24oc3RhY2tUcmFjZSA/PyAiIil9LFwibG9nVHlwZVwi' +
	'Olwie2xvZ1R5cGV9XCIsXCJ0aW1lc3RhbXBcIjp7RGF0ZVRpbWVPZmZzZXQuVXRjTm93LlRvVW5peFRpbWVNaWxsaXNlY29uZHMo' +
	'KX19fX19IjsKICAgICAgICBfb3V0Z29pbmdNZXNzYWdlcy5FbnF1ZXVlKGV2ZW50SnNvbik7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBPblBsYXlNb2RlQ2hhbmdlZChQbGF5TW9kZVN0YXRlQ2hhbmdlIHN0YXRlKQogICAgewogICAgICAgIGlmICgh' +
	'X2NsaWVudENvbm5lY3RlZCkgcmV0dXJuOwoKICAgICAgICB2YXIgcGxheVN0YXRlID0gc3RhdGUgc3dpdGNoCiAgICAgICAgewog' +
	'ICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkVudGVyZWRQbGF5TW9kZSA9PiAicGxheWluZyIsCiAgICAgICAgICAgIFBs' +
	'YXlNb2RlU3RhdGVDaGFuZ2UuRXhpdGluZ1BsYXlNb2RlID0+ICJzdG9wcGVkIiwKICAgICAgICAgICAgUGxheU1vZGVTdGF0ZUNo' +
	'YW5nZS5FbnRlcmVkRWRpdE1vZGUgPT4gInN0b3BwZWQiLAogICAgICAgICAgICBQbGF5TW9kZVN0YXRlQ2hhbmdlLkV4aXRpbmdF' +
	'ZGl0TW9kZSA9PiAicGxheWluZyIsCiAgICAgICAgICAgIF8gPT4gInN0b3BwZWQiCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGV2' +
	'ZW50SnNvbiA9ICQie3tcImlkXCI6XCJ7R3VpZC5OZXdHdWlkKCl9XCIsXCJ0eXBlXCI6XCJldmVudFwiLFwiZXZlbnRcIjpcInBs' +
	'YXlNb2RlQ2hhbmdlZFwiLFwiZGF0YVwiOnt7XCJzdGF0ZVwiOlwie3BsYXlTdGF0ZX1cIn19fX0iOwogICAgICAgIF9vdXRnb2lu' +
	'Z01lc3NhZ2VzLkVucXVldWUoZXZlbnRKc29uKTsKICAgIH0KCiAgICAvLyAtLS0gTWVzc2FnZSBQcm9jZXNzaW5nIChNYWluIFRo' +
	'cmVhZCkgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBQcm9jZXNzTWVzc2FnZXMoKQogICAgewogICAgICAgIC8vIFByb2Nl' +
	'c3MgdXAgdG8gMTAgbWVzc2FnZXMgcGVyIGZyYW1lIHRvIGF2b2lkIGJsb2NraW5nCiAgICAgICAgaW50IHByb2Nlc3NlZCA9IDA7' +
	'CiAgICAgICAgd2hpbGUgKF9pbmNvbWluZ01lc3NhZ2VzLlRyeURlcXVldWUob3V0IHZhciBtZXNzYWdlKSAmJiBwcm9jZXNzZWQg' +
	'PCAxMCkKICAgICAgICB7CiAgICAgICAgICAgIHByb2Nlc3NlZCsrOwogICAgICAgICAgICBzdHJpbmcgcmVxdWVzdElkID0gInVu' +
	'a25vd24iOwogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBQYXJzZVJl' +
	'cXVlc3QobWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXF1ZXN0SWQgPSByZXF1ZXN0LmlkOwogICAgICAgICAgICAgICAgdmFy' +
	'IHJlc3BvbnNlID0gSGFuZGxlQ29tbWFuZChyZXF1ZXN0KTsKICAgICAgICAgICAgICAgIF9vdXRnb2luZ01lc3NhZ2VzLkVucXVl' +
	'dWUocmVzcG9uc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgIHsK' +
	'ICAgICAgICAgICAgICAgIERlYnVnLkxvZ0Vycm9yKCQiW0dhbWVEZXZJREUgQnJpZGdlXSBFcnJvciBwcm9jZXNzaW5nIG1lc3Nh' +
	'Z2U6IHtleC5NZXNzYWdlfSIpOwogICAgICAgICAgICAgICAgX291dGdvaW5nTWVzc2FnZXMuRW5xdWV1ZShNYWtlRXJyb3IocmVx' +
	'dWVzdElkLCBleC5NZXNzYWdlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIDxzdW1tYXJ5PgogICAg' +
	'Ly8vIE1hbnVhbGx5IHBhcnNlIGEgSlNPTiByZXF1ZXN0IHNpbmNlIFVuaXR5J3MgSnNvblV0aWxpdHkgY2FuJ3QgaGFuZGxlCiAg' +
	'ICAvLy8gbmVzdGVkIGRpY3Rpb25hcmllcyBvciB0aGUgJ3BhcmFtcycgZmllbGQgcHJvcGVybHkuCiAgICAvLy8gPC9zdW1tYXJ5' +
	'PgogICAgcHJpdmF0ZSBzdGF0aWMgU2VyaWFsaXphYmxlUmVxdWVzdCBQYXJzZVJlcXVlc3Qoc3RyaW5nIGpzb24pCiAgICB7CiAg' +
	'ICAgICAgdmFyIHJlcSA9IG5ldyBTZXJpYWxpemFibGVSZXF1ZXN0KCk7CiAgICAgICAgcmVxLmlkID0gRXh0cmFjdEpzb25TdHJp' +
	'bmcoanNvbiwgImlkIikgPz8gR3VpZC5OZXdHdWlkKCkuVG9TdHJpbmcoKTsKICAgICAgICByZXEudHlwZSA9IEV4dHJhY3RKc29u' +
	'U3RyaW5nKGpzb24sICJ0eXBlIikgPz8gInJlcXVlc3QiOwogICAgICAgIHJlcS5jYXRlZ29yeSA9IEV4dHJhY3RKc29uU3RyaW5n' +
	'KGpzb24sICJjYXRlZ29yeSIpID8/ICIiOwogICAgICAgIHJlcS5hY3Rpb24gPSBFeHRyYWN0SnNvblN0cmluZyhqc29uLCAiYWN0' +
	'aW9uIikgPz8gIiI7CgogICAgICAgIC8vIEV4dHJhY3QgdGhlIHBhcmFtcyBvYmplY3QgYXMgYSByYXcgSlNPTiBzdWJzdHJpbmcK' +
	'ICAgICAgICB2YXIgcGFyYW1zSWR4ID0ganNvbi5JbmRleE9mKCJcInBhcmFtc1wiIik7CiAgICAgICAgaWYgKHBhcmFtc0lkeCA+' +
	'PSAwKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNvbG9uSWR4ID0ganNvbi5JbmRleE9mKCc6JywgcGFyYW1zSWR4KTsKICAg' +
	'ICAgICAgICAgaWYgKGNvbG9uSWR4ID49IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlcS5wYXJhbXNKc29uID0g' +
	'RXh0cmFjdEpzb25PYmplY3QoanNvbiwgY29sb25JZHggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0' +
	'dXJuIHJlcTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRXh0cmFjdEpzb25TdHJpbmcoc3RyaW5nIGpzb24sIHN0' +
	'cmluZyBrZXkpCiAgICB7CiAgICAgICAgdmFyIHBhdHRlcm4gPSAkIlwie2tleX1cIiI7CiAgICAgICAgdmFyIGlkeCA9IGpzb24u' +
	'SW5kZXhPZihwYXR0ZXJuKTsKICAgICAgICBpZiAoaWR4IDwgMCkgcmV0dXJuIG51bGw7CgogICAgICAgIHZhciBjb2xvbklkeCA9' +
	'IGpzb24uSW5kZXhPZignOicsIGlkeCArIHBhdHRlcm4uTGVuZ3RoKTsKICAgICAgICBpZiAoY29sb25JZHggPCAwKSByZXR1cm4g' +
	'bnVsbDsKCiAgICAgICAgLy8gU2tpcCB3aGl0ZXNwYWNlCiAgICAgICAgdmFyIHN0YXJ0SWR4ID0gY29sb25JZHggKyAxOwogICAg' +
	'ICAgIHdoaWxlIChzdGFydElkeCA8IGpzb24uTGVuZ3RoICYmIGNoYXIuSXNXaGl0ZVNwYWNlKGpzb25bc3RhcnRJZHhdKSkgc3Rh' +
	'cnRJZHgrKzsKCiAgICAgICAgaWYgKHN0YXJ0SWR4ID49IGpzb24uTGVuZ3RoIHx8IGpzb25bc3RhcnRJZHhdICE9ICciJykgcmV0' +
	'dXJuIG51bGw7CgogICAgICAgIC8vIFJlYWQgdW50aWwgY2xvc2luZyBxdW90ZSAoaGFuZGxpbmcgZXNjYXBlcykKICAgICAgICB2' +
	'YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGZvciAoaW50IGkgPSBzdGFydElkeCArIDE7IGkgPCBqc29uLkxl' +
	'bmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGpzb25baV0gPT0gJ1xcJyAmJiBpICsgMSA8IGpzb24uTGVuZ3Ro' +
	'KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzYi5BcHBlbmQoanNvbltpICsgMV0pOwogICAgICAgICAgICAgICAgaSsr' +
	'OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGpzb25baV0gPT0gJyInKQogICAgICAgICAgICB7CiAgICAgICAg' +
	'ICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAg' +
	'IHNiLkFwcGVuZChqc29uW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2IuVG9TdHJpbmcoKTsK' +
	'ICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRXh0cmFjdEpzb25PYmplY3Qoc3RyaW5nIGpzb24sIGludCBzdGFydElk' +
	'eCkKICAgIHsKICAgICAgICAvLyBTa2lwIHdoaXRlc3BhY2UKICAgICAgICB3aGlsZSAoc3RhcnRJZHggPCBqc29uLkxlbmd0aCAm' +
	'JiBjaGFyLklzV2hpdGVTcGFjZShqc29uW3N0YXJ0SWR4XSkpIHN0YXJ0SWR4Kys7CiAgICAgICAgaWYgKHN0YXJ0SWR4ID49IGpz' +
	'b24uTGVuZ3RoIHx8IGpzb25bc3RhcnRJZHhdICE9ICd7JykgcmV0dXJuICJ7fSI7CgogICAgICAgIHZhciBkZXB0aCA9IDA7CiAg' +
	'ICAgICAgdmFyIGluU3RyaW5nID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0SWR4OyBpIDwganNvbi5MZW5ndGg7' +
	'IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChqc29uW2ldID09ICciJyAmJiAoaSA9PSAwIHx8IGpzb25baSAtIDFdICE9' +
	'ICdcXCcpKQogICAgICAgICAgICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7CiAgICAgICAgICAgIGVsc2UgaWYgKCFpblN0cmlu' +
	'ZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGpzb25baV0gPT0gJ3snKSBkZXB0aCsrOwogICAgICAgICAgICAg' +
	'ICAgZWxzZSBpZiAoanNvbltpXSA9PSAnfScpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTsK' +
	'ICAgICAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb24uU3Vi' +
	'c3RyaW5nKHN0YXJ0SWR4LCBpIC0gc3RhcnRJZHggKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg' +
	'IH0KICAgICAgICByZXR1cm4gInt9IjsKICAgIH0KCiAgICAvLyAtLS0gQ29tbWFuZCBEaXNwYXRjaCAtLS0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyBzdHJpbmcgSGFuZGxlQ29tbWFuZChTZXJpYWxpemFibGVSZXF1ZXN0IHJlcXVlc3QpCiAgICB7CiAgICAgICAgdmFy' +
	'IGtleSA9ICQie3JlcXVlc3QuY2F0ZWdvcnl9LntyZXF1ZXN0LmFjdGlvbn0iOwogICAgICAgIHZhciBwID0gcmVxdWVzdC5HZXRQ' +
	'YXJhbXMoKTsKCiAgICAgICAgc3dpdGNoIChrZXkpCiAgICAgICAgewogICAgICAgICAgICAvLyAtLS0gU2NlbmUgLS0tCiAgICAg' +
	'ICAgICAgIGNhc2UgInNjZW5lLmdldEFjdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlR2V0QWN0aXZlU2NlbmUo' +
	'cmVxdWVzdC5pZCk7CiAgICAgICAgICAgIGNhc2UgInNjZW5lLmdldEhpZXJhcmNoeSI6CiAgICAgICAgICAgICAgICByZXR1cm4g' +
	'SGFuZGxlR2V0SGllcmFyY2h5KHJlcXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJzY2VuZS5jcmVhdGUiOgogICAgICAgICAg' +
	'ICAgICAgcmV0dXJuIEhhbmRsZUNyZWF0ZVNjZW5lKHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJzY2VuZS5zYXZl' +
	'IjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTYXZlU2NlbmUocmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0g' +
	'R2FtZU9iamVjdCAtLS0KICAgICAgICAgICAgY2FzZSAiZ2FtZU9iamVjdC5jcmVhdGUiOgogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IEhhbmRsZUNyZWF0ZUdhbWVPYmplY3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuY3JlYXRl' +
	'UHJpbWl0aXZlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVDcmVhdGVQcmltaXRpdmUocmVxdWVzdC5pZCwgcCk7CiAg' +
	'ICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZmluZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlRmluZEdhbWVPYmpl' +
	'Y3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZGVzdHJveSI6CiAgICAgICAgICAgICAgICBy' +
	'ZXR1cm4gSGFuZGxlRGVzdHJveUdhbWVPYmplY3QocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3Qu' +
	'c2V0QWN0aXZlIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRBY3RpdmUocmVxdWVzdC5pZCwgcCk7CiAgICAgICAg' +
	'ICAgIGNhc2UgImdhbWVPYmplY3Quc2V0VHJhbnNmb3JtIjoKICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVTZXRUcmFuc2Zv' +
	'cm0ocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImdhbWVPYmplY3QuZ2V0U2VsZWN0ZWQiOgogICAgICAgICAgICAg' +
	'ICAgcmV0dXJuIEhhbmRsZUdldFNlbGVjdGVkKHJlcXVlc3QuaWQpOwoKICAgICAgICAgICAgLy8gLS0tIENvbXBvbmVudCAtLS0K' +
	'ICAgICAgICAgICAgY2FzZSAiY29tcG9uZW50LmFkZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQWRkQ29tcG9uZW50' +
	'KHJlcXVlc3QuaWQsIHApOwogICAgICAgICAgICBjYXNlICJjb21wb25lbnQucmVtb3ZlIjoKICAgICAgICAgICAgICAgIHJldHVy' +
	'biBIYW5kbGVSZW1vdmVDb21wb25lbnQocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImNvbXBvbmVudC5nZXRBbGwi' +
	'OgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldENvbXBvbmVudHMocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNh' +
	'c2UgImNvbXBvbmVudC5zZXRQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlU2V0UHJvcGVydHkocmVxdWVz' +
	'dC5pZCwgcCk7CgogICAgICAgICAgICAvLyAtLS0gUHJlZmFiIC0tLQogICAgICAgICAgICBjYXNlICJwcmVmYWIuY3JlYXRlIjoK' +
	'ICAgICAgICAgICAgICAgIHJldHVybiBIYW5kbGVDcmVhdGVQcmVmYWIocmVxdWVzdC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2Ug' +
	'InByZWZhYi5pbnN0YW50aWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlSW5zdGFudGlhdGVQcmVmYWIocmVxdWVz' +
	'dC5pZCwgcCk7CiAgICAgICAgICAgIGNhc2UgInByZWZhYi5nZXRBbGwiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdl' +
	'dEFsbFByZWZhYnMocmVxdWVzdC5pZCk7CgogICAgICAgICAgICAvLyAtLS0gQXNzZXQgLS0tCiAgICAgICAgICAgIGNhc2UgImFz' +
	'c2V0LmNyZWF0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGFuZGxlQ3JlYXRlQXNzZXQocmVxdWVzdC5pZCwgcCk7CiAgICAg' +
	'ICAgICAgIGNhc2UgImFzc2V0LmZpbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUZpbmRBc3NldHMocmVxdWVzdC5p' +
	'ZCwgcCk7CiAgICAgICAgICAgIGNhc2UgImFzc2V0LmltcG9ydCI6CiAgICAgICAgICAgICAgICBBc3NldERhdGFiYXNlLlJlZnJl' +
	'c2goKTsKICAgICAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhyZXF1ZXN0LmlkLCAie30iKTsKCiAgICAgICAgICAgIC8v' +
	'IC0tLSBQcm9qZWN0IC0tLQogICAgICAgICAgICBjYXNlICJwcm9qZWN0LmdldEluZm8iOgogICAgICAgICAgICAgICAgcmV0dXJu' +
	'IEhhbmRsZUdldFByb2plY3RJbmZvKHJlcXVlc3QuaWQpOwogICAgICAgICAgICBjYXNlICJwcm9qZWN0LnJlZnJlc2giOgogICAg' +
	'ICAgICAgICAgICAgQXNzZXREYXRhYmFzZS5SZWZyZXNoKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVx' +
	'dWVzdC5pZCwgInt9Iik7CgogICAgICAgICAgICAvLyAtLS0gRWRpdG9yIC0tLQogICAgICAgICAgICBjYXNlICJlZGl0b3IuZ2V0' +
	'UGxheU1vZGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhhbmRsZUdldFBsYXlNb2RlKHJlcXVlc3QuaWQpOwogICAgICAgICAg' +
	'ICBjYXNlICJlZGl0b3IucGxheSI6CiAgICAgICAgICAgICAgICBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcgPSB0cnVlOwog' +
	'ICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7XCJzdGF0ZVwiOlwicGxheWluZ1wifSIpOwog' +
	'ICAgICAgICAgICBjYXNlICJlZGl0b3IucGF1c2UiOgogICAgICAgICAgICAgICAgRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQg' +
	'PSAhRWRpdG9yQXBwbGljYXRpb24uaXNQYXVzZWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MocmVxdWVzdC5p' +
	'ZCwgJCJ7e1wicGF1c2VkXCI6e0VkaXRvckFwcGxpY2F0aW9uLmlzUGF1c2VkLlRvU3RyaW5nKCkuVG9Mb3dlcigpfX19Iik7CiAg' +
	'ICAgICAgICAgIGNhc2UgImVkaXRvci5zdG9wIjoKICAgICAgICAgICAgICAgIEVkaXRvckFwcGxpY2F0aW9uLmlzUGxheWluZyA9' +
	'IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKHJlcXVlc3QuaWQsICJ7XCJzdGF0ZVwiOlwic3RvcHBl' +
	'ZFwifSIpOwogICAgICAgICAgICBjYXNlICJlZGl0b3IuZXhlY3V0ZU1lbnVJdGVtIjoKICAgICAgICAgICAgICAgIHJldHVybiBI' +
	'YW5kbGVFeGVjdXRlTWVudUl0ZW0ocmVxdWVzdC5pZCwgcCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg' +
	'cmV0dXJuIE1ha2VFcnJvcihyZXF1ZXN0LmlkLCAkIlVua25vd24gY29tbWFuZDoge2tleX0iKTsKICAgICAgICB9CiAgICB9Cgog' +
	'ICAgLy8gLS0tIFNjZW5lIEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVHZXRBY3RpdmVTY2Vu' +
	'ZShzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5lKCk7CiAgICAg' +
	'ICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oc2NlbmUubmFtZSl9LFwicGF0aFwiOntF' +
	'c2NhcGVKc29uKHNjZW5lLnBhdGgpfSxcInJvb3RDb3VudFwiOntzY2VuZS5yb290Q291bnR9LFwiaXNEaXJ0eVwiOntzY2VuZS5p' +
	'c0RpcnR5LlRvU3RyaW5nKCkuVG9Mb3dlcigpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdl' +
	'dEhpZXJhcmNoeShzdHJpbmcgaWQpCiAgICB7CiAgICAgICAgdmFyIHNjZW5lID0gU2NlbmVNYW5hZ2VyLkdldEFjdGl2ZVNjZW5l' +
	'KCk7CiAgICAgICAgdmFyIHJvb3RzID0gc2NlbmUuR2V0Um9vdEdhbWVPYmplY3RzKCk7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0' +
	'cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcInNjZW5lXCI6Iik7CiAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpz' +
	'b24oc2NlbmUubmFtZSkpOwogICAgICAgIHNiLkFwcGVuZCgiLFwiaGllcmFyY2h5XCI6WyIpOwogICAgICAgIGZvciAoaW50IGkg' +
	'PSAwOyBpIDwgcm9vdHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVuZCgiLCIp' +
	'OwogICAgICAgICAgICBCdWlsZEhpZXJhcmNoeUpzb24ocm9vdHNbaV0sIHNiKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5k' +
	'KCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBz' +
	'dGF0aWMgdm9pZCBCdWlsZEhpZXJhcmNoeUpzb24oR2FtZU9iamVjdCBnbywgU3RyaW5nQnVpbGRlciBzYikKICAgIHsKICAgICAg' +
	'ICBzYi5BcHBlbmQoIntcIm5hbWVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoRXNjYXBlSnNvbihnby5uYW1lKSk7CiAgICAgICAg' +
	'c2IuQXBwZW5kKCIsXCJhY3RpdmVcIjoiKTsKICAgICAgICBzYi5BcHBlbmQoZ28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93' +
	'ZXIoKSk7CiAgICAgICAgc2IuQXBwZW5kKCIsXCJjb21wb25lbnRzXCI6WyIpOwogICAgICAgIHZhciBjb21wb25lbnRzID0gZ28u' +
	'R2V0Q29tcG9uZW50czxDb21wb25lbnQ+KCk7CiAgICAgICAgZm9yIChpbnQgYyA9IDA7IGMgPCBjb21wb25lbnRzLkxlbmd0aDsg' +
	'YysrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGNvbXBvbmVudHNbY10gPT0gbnVsbCkgY29udGludWU7CiAgICAgICAgICAg' +
	'IGlmIChjID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKGNvbXBvbmVudHNbY10u' +
	'R2V0VHlwZSgpLk5hbWUpKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCJdLFwiY2hpbGRyZW5cIjpbIik7CiAgICAgICAg' +
	'Zm9yIChpbnQgaSA9IDA7IGkgPCBnby50cmFuc2Zvcm0uY2hpbGRDb3VudDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYg' +
	'KGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgQnVpbGRIaWVyYXJjaHlKc29uKGdvLnRyYW5zZm9ybS5HZXRDaGls' +
	'ZChpKS5nYW1lT2JqZWN0LCBzYik7CiAgICAgICAgfQogICAgICAgIHNiLkFwcGVuZCgiXX0iKTsKICAgIH0KCiAgICBwcml2YXRl' +
	'IHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3JlYXRlU2NlbmUoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQog' +
	'ICAgewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgibmFtZSIsICJOZXcgU2NlbmUiKTsKICAgICAgICB2' +
	'YXIgc2NlbmUgPSBFZGl0b3JTY2VuZU1hbmFnZXIuTmV3U2NlbmUoTmV3U2NlbmVTZXR1cC5EZWZhdWx0R2FtZU9iamVjdHMsIE5l' +
	'd1NjZW5lTW9kZS5TaW5nbGUpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJwYXRoIiwgb3V0IHZhciBwYXRoKSkKICAgICAg' +
	'ICB7CiAgICAgICAgICAgIEVkaXRvclNjZW5lTWFuYWdlci5TYXZlU2NlbmUoc2NlbmUsIHBhdGgpOwogICAgICAgIH0KICAgICAg' +
	'ICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0Vz' +
	'Y2FwZUpzb24oc2NlbmUucGF0aCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlU2F2ZVNjZW5l' +
	'KHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2YXIgc2NlbmUgPSBTY2VuZU1hbmFnZXIuR2V0QWN0aXZlU2NlbmUoKTsKICAgICAg' +
	'ICBFZGl0b3JTY2VuZU1hbmFnZXIuU2F2ZVNjZW5lKHNjZW5lKTsKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tc' +
	'Im5hbWVcIjp7RXNjYXBlSnNvbihzY2VuZS5uYW1lKX0sXCJwYXRoXCI6e0VzY2FwZUpzb24oc2NlbmUucGF0aCl9fX0iKTsKICAg' +
	'IH0KCiAgICAvLyAtLS0gR2FtZU9iamVjdCBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlQ3Jl' +
	'YXRlR2FtZU9iamVjdChzdHJpbmcgaWQsIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIG5h' +
	'bWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJuYW1lIiwgIkdhbWVPYmplY3QiKTsKICAgICAgICB2YXIgZ28gPSBuZXcgR2FtZU9i' +
	'amVjdChuYW1lKTsKCiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInBhcmVudFBhdGgiLCBvdXQgdmFyIHBhcmVudFBhdGgpICYm' +
	'ICFzdHJpbmcuSXNOdWxsT3JFbXB0eShwYXJlbnRQYXRoKSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBHYW1l' +
	'T2JqZWN0LkZpbmQocGFyZW50UGF0aCk7CiAgICAgICAgICAgIGlmIChwYXJlbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGdv' +
	'LnRyYW5zZm9ybS5TZXRQYXJlbnQocGFyZW50LnRyYW5zZm9ybSk7CiAgICAgICAgfQoKICAgICAgICBVbmRvLlJlZ2lzdGVyQ3Jl' +
	'YXRlZE9iamVjdFVuZG8oZ28sICQiQ3JlYXRlIHtuYW1lfSIpOwogICAgICAgIFNlbGVjdGlvbi5hY3RpdmVHYW1lT2JqZWN0ID0g' +
	'Z287CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwiaW5z' +
	'dGFuY2VJZFwiOntnby5HZXRJbnN0YW5jZUlEKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxl' +
	'Q3JlYXRlUHJpbWl0aXZlKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIg' +
	'bmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiUHJpbWl0aXZlIik7CiAgICAgICAgdmFyIHR5cGVTdHIgPSBwLkdl' +
	'dFZhbHVlT3JEZWZhdWx0KCJwcmltaXRpdmVUeXBlIiwgIkN1YmUiKTsKCiAgICAgICAgaWYgKCFFbnVtLlRyeVBhcnNlPFByaW1p' +
	'dGl2ZVR5cGU+KHR5cGVTdHIsIHRydWUsIG91dCB2YXIgcHJpbWl0aXZlVHlwZSkpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJy' +
	'b3IoaWQsICQiVW5rbm93biBwcmltaXRpdmUgdHlwZToge3R5cGVTdHJ9LiBWYWxpZDogU3BoZXJlLCBDYXBzdWxlLCBDeWxpbmRl' +
	'ciwgQ3ViZSwgUGxhbmUsIFF1YWQiKTsKCiAgICAgICAgdmFyIGdvID0gR2FtZU9iamVjdC5DcmVhdGVQcmltaXRpdmUocHJpbWl0' +
	'aXZlVHlwZSk7CiAgICAgICAgZ28ubmFtZSA9IG5hbWU7CgogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJwYXJlbnRQYXRoIiwg' +
	'b3V0IHZhciBwYXJlbnRQYXRoKSAmJiAhc3RyaW5nLklzTnVsbE9yRW1wdHkocGFyZW50UGF0aCkpCiAgICAgICAgewogICAgICAg' +
	'ICAgICB2YXIgcGFyZW50ID0gR2FtZU9iamVjdC5GaW5kKHBhcmVudFBhdGgpOwogICAgICAgICAgICBpZiAocGFyZW50ICE9IG51' +
	'bGwpCiAgICAgICAgICAgICAgICBnby50cmFuc2Zvcm0uU2V0UGFyZW50KHBhcmVudC50cmFuc2Zvcm0pOwogICAgICAgIH0KCiAg' +
	'ICAgICAgVW5kby5SZWdpc3RlckNyZWF0ZWRPYmplY3RVbmRvKGdvLCAkIkNyZWF0ZSB7bmFtZX0iKTsKICAgICAgICBTZWxlY3Rp' +
	'b24uYWN0aXZlR2FtZU9iamVjdCA9IGdvOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2Nh' +
	'cGVKc29uKGdvLm5hbWUpfSxcImluc3RhbmNlSWRcIjp7Z28uR2V0SW5zdGFuY2VJRCgpfX19Iik7CiAgICB9CgogICAgcHJpdmF0' +
	'ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUZpbmRHYW1lT2JqZWN0KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4g' +
	'cCkKICAgIHsKICAgICAgICB2YXIgbmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1bHQoIm5hbWUiLCAiIik7CiAgICAgICAgdmFyIGdv' +
	'ID0gR2FtZU9iamVjdC5GaW5kKG5hbWUpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVy' +
	'cm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7bmFtZX0iKTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAk' +
	'Int7XCJuYW1lXCI6e0VzY2FwZUpzb24oZ28ubmFtZSl9LFwiaW5zdGFuY2VJZFwiOntnby5HZXRJbnN0YW5jZUlEKCl9LFwiYWN0' +
	'aXZlXCI6e2dvLmFjdGl2ZVNlbGYuVG9TdHJpbmcoKS5Ub0xvd2VyKCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBz' +
	'dHJpbmcgSGFuZGxlRGVzdHJveUdhbWVPYmplY3Qoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAg' +
	'ewogICAgICAgIHZhciBuYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCBwLkdldFZhbHVlT3JEZWZh' +
	'dWx0KCJuYW1lIiwgIiIpKTsKICAgICAgICB2YXIgZ28gPSBHYW1lT2JqZWN0LkZpbmQobmFtZSk7CiAgICAgICAgaWYgKGdvID09' +
	'IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtuYW1lfSIpOwoK' +
	'ICAgICAgICBVbmRvLkRlc3Ryb3lPYmplY3RJbW1lZGlhdGUoZ28pOwogICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgInt9' +
	'Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZVNldEFjdGl2ZShzdHJpbmcgaWQsIERpY3Rpb25hcnk8' +
	'c3RyaW5nLCBzdHJpbmc+IHApCiAgICB7CiAgICAgICAgdmFyIHBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJnYW1lT2JqZWN0' +
	'UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBHYW1lT2JqZWN0LkZpbmQocGF0aCk7CiAgICAgICAgaWYgKGdvID09IG51bGwp' +
	'CiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiR2FtZU9iamVjdCBub3QgZm91bmQ6IHtwYXRofSIpOwoKICAgICAg' +
	'ICB2YXIgYWN0aXZlID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiYWN0aXZlIiwgInRydWUiKSA9PSAidHJ1ZSI7CiAgICAgICAgVW5k' +
	'by5SZWNvcmRPYmplY3QoZ28sICQiU2V0IEFjdGl2ZSB7Z28ubmFtZX0iKTsKICAgICAgICBnby5TZXRBY3RpdmUoYWN0aXZlKTsK' +
	'ICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihnby5uYW1lKX0sXCJhY3RpdmVc' +
	'Ijp7Z28uYWN0aXZlU2VsZi5Ub1N0cmluZygpLlRvTG93ZXIoKX19fSIpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmlu' +
	'ZyBIYW5kbGVTZXRUcmFuc2Zvcm0oc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAg' +
	'IHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gR2Ft' +
	'ZU9iamVjdC5GaW5kKHBhdGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlk' +
	'LCAkIkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7cGF0aH0iKTsKCiAgICAgICAgVW5kby5SZWNvcmRPYmplY3QoZ28udHJhbnNmb3Jt' +
	'LCAkIlRyYW5zZm9ybSB7Z28ubmFtZX0iKTsKCiAgICAgICAgaWYgKHAuVHJ5R2V0VmFsdWUoInBvc2l0aW9uIiwgb3V0IHZhciBw' +
	'b3NTdHIpKQogICAgICAgICAgICBnby50cmFuc2Zvcm0ucG9zaXRpb24gPSBQYXJzZVZlY3RvcjMocG9zU3RyKTsKICAgICAgICBp' +
	'ZiAocC5UcnlHZXRWYWx1ZSgicm90YXRpb24iLCBvdXQgdmFyIHJvdFN0cikpCiAgICAgICAgICAgIGdvLnRyYW5zZm9ybS5ldWxl' +
	'ckFuZ2xlcyA9IFBhcnNlVmVjdG9yMyhyb3RTdHIpOwogICAgICAgIGlmIChwLlRyeUdldFZhbHVlKCJzY2FsZSIsIG91dCB2YXIg' +
	'c2NhbGVTdHIpKQogICAgICAgICAgICBnby50cmFuc2Zvcm0ubG9jYWxTY2FsZSA9IFBhcnNlVmVjdG9yMyhzY2FsZVN0cik7Cgog' +
	'ICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wibmFtZVwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcInBvc2l0aW9u' +
	'XCI6XCJ7Z28udHJhbnNmb3JtLnBvc2l0aW9ufVwiLFwicm90YXRpb25cIjpcIntnby50cmFuc2Zvcm0uZXVsZXJBbmdsZXN9XCIs' +
	'XCJzY2FsZVwiOlwie2dvLnRyYW5zZm9ybS5sb2NhbFNjYWxlfVwifX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJp' +
	'bmcgSGFuZGxlR2V0U2VsZWN0ZWQoc3RyaW5nIGlkKQogICAgewogICAgICAgIHZhciBzZWxlY3RlZCA9IFNlbGVjdGlvbi5nYW1l' +
	'T2JqZWN0czsKICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFwcGVuZCgie1wic2VsZWN0' +
	'ZWRcIjpbIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWxlY3RlZC5MZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAg' +
	'ICAgICAgIGlmIChpID4gMCkgc2IuQXBwZW5kKCIsIik7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKHNlbGVjdGVk' +
	'W2ldLm5hbWUpKTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCJdfSIpOwogICAgICAgIHJldHVybiBNYWtlU3VjY2Vzcyhp' +
	'ZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgLy8gLS0tIENvbXBvbmVudCBIYW5kbGVycyAtLS0KCiAgICBwcml2YXRlIHN0' +
	'YXRpYyBzdHJpbmcgSGFuZGxlQWRkQ29tcG9uZW50KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAg' +
	'IHsKICAgICAgICB2YXIgcGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZh' +
	'ciBnbyA9IEdhbWVPYmplY3QuRmluZChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1h' +
	'a2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAgIHZhciB0eXBlTmFtZSA9IHAuR2V0' +
	'VmFsdWVPckRlZmF1bHQoImNvbXBvbmVudFR5cGUiLCAiIik7CiAgICAgICAgdmFyIHR5cGUgPSBGaW5kQ29tcG9uZW50VHlwZSh0' +
	'eXBlTmFtZSk7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJDb21w' +
	'b25lbnQgdHlwZSBub3QgZm91bmQ6IHt0eXBlTmFtZX0iKTsKCiAgICAgICAgVW5kby5BZGRDb21wb25lbnQoZ28sIHR5cGUpOwog' +
	'ICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wiZ2FtZU9iamVjdFwiOntFc2NhcGVKc29uKGdvLm5hbWUpfSxcImNv' +
	'bXBvbmVudFwiOntFc2NhcGVKc29uKHR5cGUuTmFtZSl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFu' +
	'ZGxlUmVtb3ZlQ29tcG9uZW50KHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2' +
	'YXIgcGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImdhbWVPYmplY3RQYXRoIiwgIiIpOwogICAgICAgIHZhciBnbyA9IEdhbWVP' +
	'YmplY3QuRmluZChwYXRoKTsKICAgICAgICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwg' +
	'JCJHYW1lT2JqZWN0IG5vdCBmb3VuZDoge3BhdGh9Iik7CgogICAgICAgIHZhciB0eXBlTmFtZSA9IHAuR2V0VmFsdWVPckRlZmF1' +
	'bHQoImNvbXBvbmVudFR5cGUiLCAiIik7CiAgICAgICAgdmFyIGNvbXAgPSBnby5HZXRDb21wb25lbnQodHlwZU5hbWUpOwogICAg' +
	'ICAgIGlmIChjb21wID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBNYWtlRXJyb3IoaWQsICQiQ29tcG9uZW50IG5vdCBmb3Vu' +
	'ZDoge3R5cGVOYW1lfSBvbiB7Z28ubmFtZX0iKTsKCiAgICAgICAgVW5kby5EZXN0cm95T2JqZWN0SW1tZWRpYXRlKGNvbXApOwog' +
	'ICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgInt9Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRs' +
	'ZUdldENvbXBvbmVudHMoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBw' +
	'YXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiZ2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gR2FtZU9iamVj' +
	'dC5GaW5kKHBhdGgpOwogICAgICAgIGlmIChnbyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdh' +
	'bWVPYmplY3Qgbm90IGZvdW5kOiB7cGF0aH0iKTsKCiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBnby5HZXRDb21wb25lbnRzPENv' +
	'bXBvbmVudD4oKTsKICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLkFwcGVuZCgie1wiY29t' +
	'cG9uZW50c1wiOlsiKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbXBvbmVudHMuTGVuZ3RoOyBpKyspCiAgICAgICAg' +
	'ewogICAgICAgICAgICBpZiAoY29tcG9uZW50c1tpXSA9PSBudWxsKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGkgPiAwKSBz' +
	'Yi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24oY29tcG9uZW50c1tpXS5HZXRUeXBlKCkuTmFt' +
	'ZSkpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5U' +
	'b1N0cmluZygpKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlU2V0UHJvcGVydHkoc3RyaW5nIGlkLCBE' +
	'aWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBwYXRoID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgi' +
	'Z2FtZU9iamVjdFBhdGgiLCAiIik7CiAgICAgICAgdmFyIGdvID0gR2FtZU9iamVjdC5GaW5kKHBhdGgpOwogICAgICAgIGlmIChn' +
	'byA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAkIkdhbWVPYmplY3Qgbm90IGZvdW5kOiB7cGF0aH0i' +
	'KTsKCiAgICAgICAgdmFyIHR5cGVOYW1lID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiY29tcG9uZW50VHlwZSIsICIiKTsKICAgICAg' +
	'ICB2YXIgY29tcCA9IGdvLkdldENvbXBvbmVudCh0eXBlTmFtZSk7CiAgICAgICAgaWYgKGNvbXAgPT0gbnVsbCkKICAgICAgICAg' +
	'ICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJDb21wb25lbnQgbm90IGZvdW5kOiB7dHlwZU5hbWV9IG9uIHtnby5uYW1lfSIpOwoK' +
	'ICAgICAgICB2YXIgcHJvcE5hbWUgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJwcm9wZXJ0eU5hbWUiLCAiIik7CiAgICAgICAgdmFy' +
	'IHZhbHVlU3RyID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgidmFsdWUiLCAiIik7CgogICAgICAgIFVuZG8uUmVjb3JkT2JqZWN0KGNv' +
	'bXAsICQiU2V0IHtwcm9wTmFtZX0gb24ge2dvLm5hbWV9Iik7CgogICAgICAgIC8vIFRyeSBzZXR0aW5nIHZpYSBTZXJpYWxpemVk' +
	'T2JqZWN0IGZvciBwcm9wZXIgdW5kbyBzdXBwb3J0CiAgICAgICAgdmFyIHNvID0gbmV3IFNlcmlhbGl6ZWRPYmplY3QoY29tcCk7' +
	'CiAgICAgICAgdmFyIHByb3AgPSBzby5GaW5kUHJvcGVydHkocHJvcE5hbWUpOwogICAgICAgIGlmIChwcm9wICE9IG51bGwpCiAg' +
	'ICAgICAgewogICAgICAgICAgICBTZXRTZXJpYWxpemVkUHJvcGVydHlWYWx1ZShwcm9wLCB2YWx1ZVN0cik7CiAgICAgICAgICAg' +
	'IHNvLkFwcGx5TW9kaWZpZWRQcm9wZXJ0aWVzKCk7CiAgICAgICAgICAgIHJldHVybiBNYWtlU3VjY2VzcyhpZCwgJCJ7e1wicHJv' +
	'cGVydHlcIjp7RXNjYXBlSnNvbihwcm9wTmFtZSl9LFwic2V0XCI6dHJ1ZX19Iik7CiAgICAgICAgfQoKICAgICAgICAvLyBGYWxs' +
	'YmFjazogcmVmbGVjdGlvbgogICAgICAgIHZhciBmaWVsZCA9IGNvbXAuR2V0VHlwZSgpLkdldEZpZWxkKHByb3BOYW1lLCBCaW5k' +
	'aW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLk5vblB1YmxpYyB8IEJpbmRpbmdGbGFncy5JbnN0YW5jZSk7CiAgICAgICAg' +
	'aWYgKGZpZWxkICE9IG51bGwpCiAgICAgICAgewogICAgICAgICAgICB2YXIgY29udmVydGVkID0gQ29udmVydC5DaGFuZ2VUeXBl' +
	'KHZhbHVlU3RyLCBmaWVsZC5GaWVsZFR5cGUpOwogICAgICAgICAgICBmaWVsZC5TZXRWYWx1ZShjb21wLCBjb252ZXJ0ZWQpOwog' +
	'ICAgICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInByb3BlcnR5XCI6e0VzY2FwZUpzb24ocHJvcE5hbWUpfSxc' +
	'InNldFwiOnRydWV9fSIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHByb3BlcnR5ID0gY29tcC5HZXRUeXBlKCkuR2V0UHJvcGVy' +
	'dHkocHJvcE5hbWUsIEJpbmRpbmdGbGFncy5QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuSW5zdGFuY2UpOwogICAgICAgIGlmIChwcm9w' +
	'ZXJ0eSAhPSBudWxsICYmIHByb3BlcnR5LkNhbldyaXRlKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGNvbnZlcnRlZCA9IENv' +
	'bnZlcnQuQ2hhbmdlVHlwZSh2YWx1ZVN0ciwgcHJvcGVydHkuUHJvcGVydHlUeXBlKTsKICAgICAgICAgICAgcHJvcGVydHkuU2V0' +
	'VmFsdWUoY29tcCwgY29udmVydGVkKTsKICAgICAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJwcm9wZXJ0eVwi' +
	'OntFc2NhcGVKc29uKHByb3BOYW1lKX0sXCJzZXRcIjp0cnVlfX0iKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBNYWtlRXJy' +
	'b3IoaWQsICQiUHJvcGVydHkgbm90IGZvdW5kOiB7cHJvcE5hbWV9IG9uIHt0eXBlTmFtZX0iKTsKICAgIH0KCiAgICAvLyAtLS0g' +
	'UHJlZmFiIEhhbmRsZXJzIC0tLQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBIYW5kbGVDcmVhdGVQcmVmYWIoc3RyaW5nIGlk' +
	'LCBEaWN0aW9uYXJ5PHN0cmluZywgc3RyaW5nPiBwKQogICAgewogICAgICAgIHZhciBnb1BhdGggPSBwLkdldFZhbHVlT3JEZWZh' +
	'dWx0KCJnYW1lT2JqZWN0UGF0aCIsICIiKTsKICAgICAgICB2YXIgZ28gPSBHYW1lT2JqZWN0LkZpbmQoZ29QYXRoKTsKICAgICAg' +
	'ICBpZiAoZ28gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ha2VFcnJvcihpZCwgJCJHYW1lT2JqZWN0IG5vdCBmb3VuZDog' +
	'e2dvUGF0aH0iKTsKCiAgICAgICAgdmFyIGFzc2V0UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoImFzc2V0UGF0aCIsICQiQXNz' +
	'ZXRzL1ByZWZhYnMve2dvLm5hbWV9LnByZWZhYiIpOwoKICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0cwogICAgICAg' +
	'IHZhciBkaXIgPSBQYXRoLkdldERpcmVjdG9yeU5hbWUoYXNzZXRQYXRoKTsKICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVt' +
	'cHR5KGRpcikgJiYgIUFzc2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihkaXIpKQogICAgICAgIHsKICAgICAgICAgICAgQ3JlYXRl' +
	'Rm9sZGVyUmVjdXJzaXZlKGRpcik7CiAgICAgICAgfQoKICAgICAgICB2YXIgcHJlZmFiID0gUHJlZmFiVXRpbGl0eS5TYXZlQXNQ' +
	'cmVmYWJBc3NldChnbywgYXNzZXRQYXRoKTsKICAgICAgICBpZiAocHJlZmFiID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBN' +
	'YWtlRXJyb3IoaWQsICQiRmFpbGVkIHRvIGNyZWF0ZSBwcmVmYWIgYXQge2Fzc2V0UGF0aH0iKTsKCiAgICAgICAgcmV0dXJuIE1h' +
	'a2VTdWNjZXNzKGlkLCAkInt7XCJwYXRoXCI6e0VzY2FwZUpzb24oYXNzZXRQYXRoKX0sXCJuYW1lXCI6e0VzY2FwZUpzb24ocHJl' +
	'ZmFiLm5hbWUpfX19Iik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUluc3RhbnRpYXRlUHJlZmFiKHN0' +
	'cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgcHJlZmFiUGF0aCA9IHAuR2V0' +
	'VmFsdWVPckRlZmF1bHQoInByZWZhYlBhdGgiLCAiIik7CiAgICAgICAgdmFyIHByZWZhYiA9IEFzc2V0RGF0YWJhc2UuTG9hZEFz' +
	'c2V0QXRQYXRoPEdhbWVPYmplY3Q+KHByZWZhYlBhdGgpOwogICAgICAgIGlmIChwcmVmYWIgPT0gbnVsbCkKICAgICAgICAgICAg' +
	'cmV0dXJuIE1ha2VFcnJvcihpZCwgJCJQcmVmYWIgbm90IGZvdW5kIGF0OiB7cHJlZmFiUGF0aH0iKTsKCiAgICAgICAgdmFyIGlu' +
	'c3RhbmNlID0gKEdhbWVPYmplY3QpUHJlZmFiVXRpbGl0eS5JbnN0YW50aWF0ZVByZWZhYihwcmVmYWIpOwogICAgICAgIFVuZG8u' +
	'UmVnaXN0ZXJDcmVhdGVkT2JqZWN0VW5kbyhpbnN0YW5jZSwgJCJJbnN0YW50aWF0ZSB7cHJlZmFiLm5hbWV9Iik7CiAgICAgICAg' +
	'U2VsZWN0aW9uLmFjdGl2ZUdhbWVPYmplY3QgPSBpbnN0YW5jZTsKCiAgICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7' +
	'XCJuYW1lXCI6e0VzY2FwZUpzb24oaW5zdGFuY2UubmFtZSl9LFwiaW5zdGFuY2VJZFwiOntpbnN0YW5jZS5HZXRJbnN0YW5jZUlE' +
	'KCl9fX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgSGFuZGxlR2V0QWxsUHJlZmFicyhzdHJpbmcgaWQpCiAg' +
	'ICB7CiAgICAgICAgdmFyIGd1aWRzID0gQXNzZXREYXRhYmFzZS5GaW5kQXNzZXRzKCJ0OlByZWZhYiIpOwogICAgICAgIHZhciBz' +
	'YiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuQXBwZW5kKCJ7XCJwcmVmYWJzXCI6WyIpOwogICAgICAgIGZvciAo' +
	'aW50IGkgPSAwOyBpIDwgZ3VpZHMuTGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAoaSA+IDApIHNiLkFwcGVu' +
	'ZCgiLCIpOwogICAgICAgICAgICB2YXIgcGF0aCA9IEFzc2V0RGF0YWJhc2UuR1VJRFRvQXNzZXRQYXRoKGd1aWRzW2ldKTsKICAg' +
	'ICAgICAgICAgc2IuQXBwZW5kKEVzY2FwZUpzb24ocGF0aCkpOwogICAgICAgIH0KICAgICAgICBzYi5BcHBlbmQoIl19Iik7CiAg' +
	'ICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCBzYi5Ub1N0cmluZygpKTsKICAgIH0KCiAgICAvLyAtLS0gQXNzZXQgSGFuZGxl' +
	'cnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUNyZWF0ZUFzc2V0KHN0cmluZyBpZCwgRGljdGlvbmFyeTxz' +
	'dHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAgICB2YXIgYXNzZXRUeXBlID0gcC5HZXRWYWx1ZU9yRGVmYXVsdCgiYXNzZXRU' +
	'eXBlIiwgIk1hdGVyaWFsIik7CiAgICAgICAgdmFyIGFzc2V0UGF0aCA9IHAuR2V0VmFsdWVPckRlZmF1bHQoInBhdGgiLCAiIik7' +
	'CgogICAgICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShhc3NldFBhdGgpKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9y' +
	'KGlkLCAicGF0aCBpcyByZXF1aXJlZCIpOwoKICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0cwogICAgICAgIHZhciBk' +
	'aXIgPSBQYXRoLkdldERpcmVjdG9yeU5hbWUoYXNzZXRQYXRoKTsKICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KGRp' +
	'cikgJiYgIUFzc2V0RGF0YWJhc2UuSXNWYWxpZEZvbGRlcihkaXIpKQogICAgICAgIHsKICAgICAgICAgICAgQ3JlYXRlRm9sZGVy' +
	'UmVjdXJzaXZlKGRpcik7CiAgICAgICAgfQoKICAgICAgICBVbml0eUVuZ2luZS5PYmplY3QgYXNzZXQgPSBudWxsOwogICAgICAg' +
	'IHN3aXRjaCAoYXNzZXRUeXBlLlRvTG93ZXIoKSkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgIm1hdGVyaWFsIjoKICAgICAg' +
	'ICAgICAgICAgIHZhciBzaGFkZXIgPSBTaGFkZXIuRmluZChwLkdldFZhbHVlT3JEZWZhdWx0KCJzaGFkZXIiLCAiU3RhbmRhcmQi' +
	'KSk7CiAgICAgICAgICAgICAgICBhc3NldCA9IG5ldyBNYXRlcmlhbChzaGFkZXIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg' +
	'ICAgICAgICAgIGNhc2UgInBoeXNpY21hdGVyaWFsIjoKICAgICAgICAgICAgICAgIGFzc2V0ID0gbmV3IFBoeXNpY01hdGVyaWFs' +
	'KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBNYWtl' +
	'RXJyb3IoaWQsICQiVW5zdXBwb3J0ZWQgYXNzZXQgdHlwZToge2Fzc2V0VHlwZX0uIFN1cHBvcnRlZDogTWF0ZXJpYWwsIFBoeXNp' +
	'Y01hdGVyaWFsIik7CiAgICAgICAgfQoKICAgICAgICBBc3NldERhdGFiYXNlLkNyZWF0ZUFzc2V0KGFzc2V0LCBhc3NldFBhdGgp' +
	'OwogICAgICAgIEFzc2V0RGF0YWJhc2UuUmVmcmVzaCgpOwoKICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcInBh' +
	'dGhcIjp7RXNjYXBlSnNvbihhc3NldFBhdGgpfSxcInR5cGVcIjp7RXNjYXBlSnNvbihhc3NldFR5cGUpfX19Iik7CiAgICB9Cgog' +
	'ICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUZpbmRBc3NldHMoc3RyaW5nIGlkLCBEaWN0aW9uYXJ5PHN0cmluZywgc3Ry' +
	'aW5nPiBwKQogICAgewogICAgICAgIHZhciBmaWx0ZXIgPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJmaWx0ZXIiLCAiIik7CiAgICAg' +
	'ICAgdmFyIGd1aWRzID0gQXNzZXREYXRhYmFzZS5GaW5kQXNzZXRzKGZpbHRlcik7CiAgICAgICAgdmFyIHNiID0gbmV3IFN0cmlu' +
	'Z0J1aWxkZXIoKTsKICAgICAgICBzYi5BcHBlbmQoIntcImFzc2V0c1wiOlsiKTsKICAgICAgICB2YXIgY291bnQgPSBNYXRoLk1p' +
	'bihndWlkcy5MZW5ndGgsIDUwKTsgLy8gQ2FwIGF0IDUwCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKQog' +
	'ICAgICAgIHsKICAgICAgICAgICAgaWYgKGkgPiAwKSBzYi5BcHBlbmQoIiwiKTsKICAgICAgICAgICAgdmFyIHBhdGggPSBBc3Nl' +
	'dERhdGFiYXNlLkdVSURUb0Fzc2V0UGF0aChndWlkc1tpXSk7CiAgICAgICAgICAgIHNiLkFwcGVuZChFc2NhcGVKc29uKHBhdGgp' +
	'KTsKICAgICAgICB9CiAgICAgICAgc2IuQXBwZW5kKCQiXSxcInRvdGFsXCI6e2d1aWRzLkxlbmd0aH19fSIpOwogICAgICAgIHJl' +
	'dHVybiBNYWtlU3VjY2VzcyhpZCwgc2IuVG9TdHJpbmcoKSk7CiAgICB9CgogICAgLy8gLS0tIFByb2plY3QgLyBFZGl0b3IgSGFu' +
	'ZGxlcnMgLS0tCgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFByb2plY3RJbmZvKHN0cmluZyBpZCkKICAgIHsK' +
	'ICAgICAgICByZXR1cm4gTWFrZVN1Y2Nlc3MoaWQsICQie3tcIm5hbWVcIjp7RXNjYXBlSnNvbihBcHBsaWNhdGlvbi5wcm9kdWN0' +
	'TmFtZSl9LFwidW5pdHlWZXJzaW9uXCI6e0VzY2FwZUpzb24oQXBwbGljYXRpb24udW5pdHlWZXJzaW9uKX0sXCJwbGF0Zm9ybVwi' +
	'OntFc2NhcGVKc29uKEVkaXRvclVzZXJCdWlsZFNldHRpbmdzLmFjdGl2ZUJ1aWxkVGFyZ2V0LlRvU3RyaW5nKCkpfX19Iik7CiAg' +
	'ICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIEhhbmRsZUdldFBsYXlNb2RlKHN0cmluZyBpZCkKICAgIHsKICAgICAgICB2' +
	'YXIgc3RhdGUgPSBFZGl0b3JBcHBsaWNhdGlvbi5pc1BsYXlpbmcKICAgICAgICAgICAgPyAoRWRpdG9yQXBwbGljYXRpb24uaXNQ' +
	'YXVzZWQgPyAicGF1c2VkIiA6ICJwbGF5aW5nIikKICAgICAgICAgICAgOiAic3RvcHBlZCI7CiAgICAgICAgcmV0dXJuIE1ha2VT' +
	'dWNjZXNzKGlkLCAkInt7XCJzdGF0ZVwiOlwie3N0YXRlfVwifX0iKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcg' +
	'SGFuZGxlRXhlY3V0ZU1lbnVJdGVtKHN0cmluZyBpZCwgRGljdGlvbmFyeTxzdHJpbmcsIHN0cmluZz4gcCkKICAgIHsKICAgICAg' +
	'ICB2YXIgbWVudVBhdGggPSBwLkdldFZhbHVlT3JEZWZhdWx0KCJtZW51UGF0aCIsICIiKTsKICAgICAgICBpZiAoc3RyaW5nLklz' +
	'TnVsbE9yRW1wdHkobWVudVBhdGgpKQogICAgICAgICAgICByZXR1cm4gTWFrZUVycm9yKGlkLCAibWVudVBhdGggaXMgcmVxdWly' +
	'ZWQiKTsKCiAgICAgICAgdmFyIHJlc3VsdCA9IEVkaXRvckFwcGxpY2F0aW9uLkV4ZWN1dGVNZW51SXRlbShtZW51UGF0aCk7CiAg' +
	'ICAgICAgcmV0dXJuIE1ha2VTdWNjZXNzKGlkLCAkInt7XCJleGVjdXRlZFwiOntyZXN1bHQuVG9TdHJpbmcoKS5Ub0xvd2VyKCl9' +
	'LFwibWVudVBhdGhcIjp7RXNjYXBlSnNvbihtZW51UGF0aCl9fX0iKTsKICAgIH0KCiAgICAvLyAtLS0gVXRpbGl0aWVzIC0tLQoK' +
	'ICAgIHByaXZhdGUgc3RhdGljIFR5cGUgRmluZENvbXBvbmVudFR5cGUoc3RyaW5nIHR5cGVOYW1lKQogICAgewogICAgICAgIC8v' +
	'IENoZWNrIFVuaXR5RW5naW5lIHR5cGVzIGZpcnN0CiAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YoQ29tcG9uZW50KS5Bc3NlbWJs' +
	'eS5HZXRUeXBlKCQiVW5pdHlFbmdpbmUue3R5cGVOYW1lfSIpOwogICAgICAgIGlmICh0eXBlICE9IG51bGwpIHJldHVybiB0eXBl' +
	'OwoKICAgICAgICAvLyBDaGVjayBhbGwgbG9hZGVkIGFzc2VtYmxpZXMgZm9yIGN1c3RvbSBzY3JpcHRzCiAgICAgICAgZm9yZWFj' +
	'aCAodmFyIGFzc2VtYmx5IGluIEFwcERvbWFpbi5DdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSkKICAgICAgICB7CiAgICAg' +
	'ICAgICAgIHR5cGUgPSBhc3NlbWJseS5HZXRUeXBlKHR5cGVOYW1lKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCAmJiB0' +
	'eXBlb2YoQ29tcG9uZW50KS5Jc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAg' +
	'ICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzIFBhcnNlVmVjdG9yMyhz' +
	'dHJpbmcgc3RyKQogICAgewogICAgICAgIC8vIEhhbmRsZSBib3RoICJbeCx5LHpdIiBhbmQgIngseSx6IiBmb3JtYXRzCiAgICAg' +
	'ICAgc3RyID0gc3RyLlRyaW0oJ1snLCAnXScsICcoJywgJyknKS5UcmltKCk7CiAgICAgICAgdmFyIHBhcnRzID0gc3RyLlNwbGl0' +
	'KCcsJyk7CiAgICAgICAgaWYgKHBhcnRzLkxlbmd0aCA+PSAzKQogICAgICAgIHsKICAgICAgICAgICAgZmxvYXQuVHJ5UGFyc2Uo' +
	'cGFydHNbMF0uVHJpbSgpLCBvdXQgdmFyIHgpOwogICAgICAgICAgICBmbG9hdC5UcnlQYXJzZShwYXJ0c1sxXS5UcmltKCksIG91' +
	'dCB2YXIgeSk7CiAgICAgICAgICAgIGZsb2F0LlRyeVBhcnNlKHBhcnRzWzJdLlRyaW0oKSwgb3V0IHZhciB6KTsKICAgICAgICAg' +
	'ICAgcmV0dXJuIG5ldyBWZWN0b3IzKHgsIHksIHopOwogICAgICAgIH0KICAgICAgICByZXR1cm4gVmVjdG9yMy56ZXJvOwogICAg' +
	'fQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgU2V0U2VyaWFsaXplZFByb3BlcnR5VmFsdWUoU2VyaWFsaXplZFByb3BlcnR5IHBy' +
	'b3AsIHN0cmluZyB2YWx1ZSkKICAgIHsKICAgICAgICBzd2l0Y2ggKHByb3AucHJvcGVydHlUeXBlKQogICAgICAgIHsKICAgICAg' +
	'ICAgICAgY2FzZSBTZXJpYWxpemVkUHJvcGVydHlUeXBlLkludGVnZXI6CiAgICAgICAgICAgICAgICBpZiAoaW50LlRyeVBhcnNl' +
	'KHZhbHVlLCBvdXQgdmFyIGludFZhbCkpCiAgICAgICAgICAgICAgICAgICAgcHJvcC5pbnRWYWx1ZSA9IGludFZhbDsKICAgICAg' +
	'ICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9wZXJ0eVR5cGUuRmxvYXQ6CiAgICAgICAgICAg' +
	'ICAgICBpZiAoZmxvYXQuVHJ5UGFyc2UodmFsdWUsIG91dCB2YXIgZmxvYXRWYWwpKQogICAgICAgICAgICAgICAgICAgIHByb3Au' +
	'ZmxvYXRWYWx1ZSA9IGZsb2F0VmFsOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU2VyaWFsaXplZFBy' +
	'b3BlcnR5VHlwZS5Cb29sZWFuOgogICAgICAgICAgICAgICAgcHJvcC5ib29sVmFsdWUgPSB2YWx1ZS5Ub0xvd2VyKCkgPT0gInRy' +
	'dWUiIHx8IHZhbHVlID09ICIxIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFNlcmlhbGl6ZWRQcm9w' +
	'ZXJ0eVR5cGUuU3RyaW5nOgogICAgICAgICAgICAgICAgcHJvcC5zdHJpbmdWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAg' +
	'YnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgQ3JlYXRlRm9sZGVyUmVjdXJzaXZlKHN0cmlu' +
	'ZyBwYXRoKQogICAgewogICAgICAgIHZhciBwYXJ0cyA9IHBhdGguUmVwbGFjZSgiXFwiLCAiLyIpLlNwbGl0KCcvJyk7CiAgICAg' +
	'ICAgdmFyIGN1cnJlbnQgPSBwYXJ0c1swXTsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHBhcnRzLkxlbmd0aDsgaSsrKQog' +
	'ICAgICAgIHsKICAgICAgICAgICAgdmFyIG5leHQgPSBjdXJyZW50ICsgIi8iICsgcGFydHNbaV07CiAgICAgICAgICAgIGlmICgh' +
	'QXNzZXREYXRhYmFzZS5Jc1ZhbGlkRm9sZGVyKG5leHQpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBBc3NldERhdGFi' +
	'YXNlLkNyZWF0ZUZvbGRlcihjdXJyZW50LCBwYXJ0c1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3VycmVudCA9IG5l' +
	'eHQ7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBFc2NhcGVKc29uKHN0cmluZyBzKQogICAgewog' +
	'ICAgICAgIGlmIChzID09IG51bGwpIHJldHVybiAibnVsbCI7CiAgICAgICAgcmV0dXJuICJcIiIgKyBzLlJlcGxhY2UoIlxcIiwg' +
	'IlxcXFwiKS5SZXBsYWNlKCJcIiIsICJcXFwiIikuUmVwbGFjZSgiXG4iLCAiXFxuIikuUmVwbGFjZSgiXHIiLCAiXFxyIikuUmVw' +
	'bGFjZSgiXHQiLCAiXFx0IikgKyAiXCIiOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBNYWtlU3VjY2VzcyhzdHJp' +
	'bmcgaWQsIHN0cmluZyByZXN1bHRKc29uKQogICAgewogICAgICAgIHJldHVybiAkInt7XCJpZFwiOntFc2NhcGVKc29uKGlkKX0s' +
	'XCJ0eXBlXCI6XCJyZXNwb25zZVwiLFwic3VjY2Vzc1wiOnRydWUsXCJyZXN1bHRcIjp7cmVzdWx0SnNvbn19fSI7CiAgICB9Cgog' +
	'ICAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5nIE1ha2VFcnJvcihzdHJpbmcgaWQsIHN0cmluZyBlcnJvcikKICAgIHsKICAgICAgICBy' +
	'ZXR1cm4gJCJ7e1wiaWRcIjp7RXNjYXBlSnNvbihpZCl9LFwidHlwZVwiOlwicmVzcG9uc2VcIixcInN1Y2Nlc3NcIjpmYWxzZSxc' +
	'ImVycm9yXCI6e0VzY2FwZUpzb24oZXJyb3IpfX19IjsKICAgIH0KCiAgICAvLyAtLS0gU2VyaWFsaXphdGlvbiBIZWxwZXJzIC0t' +
	'LQogICAgLy8gSnNvblV0aWxpdHkgbmVlZHMgc2VyaWFsaXphYmxlIGNsYXNzZXMgZm9yIEZyb21Kc29uCgogICAgW1NlcmlhbGl6' +
	'YWJsZV0KICAgIHByaXZhdGUgY2xhc3MgU2VyaWFsaXphYmxlUmVxdWVzdAogICAgewogICAgICAgIHB1YmxpYyBzdHJpbmcgaWQ7' +
	'CiAgICAgICAgcHVibGljIHN0cmluZyB0eXBlOwogICAgICAgIHB1YmxpYyBzdHJpbmcgY2F0ZWdvcnk7CiAgICAgICAgcHVibGlj' +
	'IHN0cmluZyBhY3Rpb247CiAgICAgICAgcHVibGljIHN0cmluZyBwYXJhbXNKc29uOyAvLyBQYXJhbXMgYXMgcmF3IEpTT04gc3Ry' +
	'aW5nCgogICAgICAgIC8vLyA8c3VtbWFyeT4KICAgICAgICAvLy8gUGFyc2UgcGFyYW1zIGZyb20gdGhlIHJhdyBKU09OLiBTaW5j' +
	'ZSBVbml0eSdzIEpzb25VdGlsaXR5IGRvZXNuJ3QgaGFuZGxlCiAgICAgICAgLy8vIERpY3Rpb25hcnkgb3IgZHluYW1pYyBvYmpl' +
	'Y3RzLCB3ZSBkbyBtYW51YWwgcGFyc2luZyBmb3IgdGhlIHNpbXBsZSBrZXktdmFsdWUgcGFyYW1zLgogICAgICAgIC8vLyA8L3N1' +
	'bW1hcnk+CiAgICAgICAgcHVibGljIERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+IEdldFBhcmFtcygpCiAgICAgICAgewogICAg' +
	'ICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IERpY3Rpb25hcnk8c3RyaW5nLCBzdHJpbmc+KCk7CiAgICAgICAgICAgIGlmIChzdHJp' +
	'bmcuSXNOdWxsT3JFbXB0eShwYXJhbXNKc29uKSkgcmV0dXJuIHJlc3VsdDsKCiAgICAgICAgICAgIC8vIFNpbXBsZSBKU09OIG9i' +
	'amVjdCBwYXJzZXIgZm9yIGZsYXQga2V5LXZhbHVlIHBhaXJzCiAgICAgICAgICAgIHZhciBqc29uID0gcGFyYW1zSnNvbi5Ucmlt' +
	'KCk7CiAgICAgICAgICAgIGlmICghanNvbi5TdGFydHNXaXRoKCJ7IikpIHJldHVybiByZXN1bHQ7CgogICAgICAgICAgICBqc29u' +
	'ID0ganNvbi5TdWJzdHJpbmcoMSwganNvbi5MZW5ndGggLSAyKS5UcmltKCk7CiAgICAgICAgICAgIGlmIChzdHJpbmcuSXNOdWxs' +
	'T3JFbXB0eShqc29uKSkgcmV0dXJuIHJlc3VsdDsKCiAgICAgICAgICAgIC8vIFNwbGl0IGJ5IGNvbW1hcyB0aGF0IGFyZW4ndCBp' +
	'bnNpZGUgc3RyaW5ncwogICAgICAgICAgICB2YXIgcGFpcnMgPSBTcGxpdEpzb25QYWlycyhqc29uKTsKICAgICAgICAgICAgZm9y' +
	'ZWFjaCAodmFyIHBhaXIgaW4gcGFpcnMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBjb2xvbklkeCA9IHBhaXIu' +
	'SW5kZXhPZignOicpOwogICAgICAgICAgICAgICAgaWYgKGNvbG9uSWR4IDwgMCkgY29udGludWU7CgogICAgICAgICAgICAgICAg' +
	'dmFyIGtleSA9IHBhaXIuU3Vic3RyaW5nKDAsIGNvbG9uSWR4KS5UcmltKCkuVHJpbSgnIicpOwogICAgICAgICAgICAgICAgdmFy' +
	'IHZhbCA9IHBhaXIuU3Vic3RyaW5nKGNvbG9uSWR4ICsgMSkuVHJpbSgpLlRyaW0oJyInKTsKCiAgICAgICAgICAgICAgICAvLyBI' +
	'YW5kbGUgYXJyYXkgdmFsdWVzIChrZWVwIGFzIHN0cmluZyBmb3Igbm93KQogICAgICAgICAgICAgICAgaWYgKHZhbC5TdGFydHNX' +
	'aXRoKCJbIikpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsLlRyaW0oKTsKCiAgICAgICAgICAgICAgICByZXN1bHRba2V5' +
	'XSA9IHZhbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIHByaXZh' +
	'dGUgc3RhdGljIExpc3Q8c3RyaW5nPiBTcGxpdEpzb25QYWlycyhzdHJpbmcganNvbikKICAgICAgICB7CiAgICAgICAgICAgIHZh' +
	'ciByZXN1bHQgPSBuZXcgTGlzdDxzdHJpbmc+KCk7CiAgICAgICAgICAgIHZhciBkZXB0aCA9IDA7CiAgICAgICAgICAgIHZhciBp' +
	'blN0cmluZyA9IGZhbHNlOwogICAgICAgICAgICB2YXIgc3RhcnQgPSAwOwoKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg' +
	'PCBqc29uLkxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGpzb25baV07CiAgICAgICAg' +
	'ICAgICAgICBpZiAoYyA9PSAnIicgJiYgKGkgPT0gMCB8fCBqc29uW2kgLSAxXSAhPSAnXFwnKSkKICAgICAgICAgICAgICAgICAg' +
	'ICBpblN0cmluZyA9ICFpblN0cmluZzsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFpblN0cmluZykKICAgICAgICAgICAgICAg' +
	'IHsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSAneycgfHwgYyA9PSAnWycpIGRlcHRoKys7CiAgICAgICAgICAgICAgICAg' +
	'ICAgZWxzZSBpZiAoYyA9PSAnfScgfHwgYyA9PSAnXScpIGRlcHRoLS07CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYyA9' +
	'PSAnLCcgJiYgZGVwdGggPT0gMCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5B' +
	'ZGQoanNvbi5TdWJzdHJpbmcoc3RhcnQsIGkgLSBzdGFydCkuVHJpbSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQg' +
	'PSBpICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg' +
	'aWYgKHN0YXJ0IDwganNvbi5MZW5ndGgpCiAgICAgICAgICAgICAgICByZXN1bHQuQWRkKGpzb24uU3Vic3RyaW5nKHN0YXJ0KS5U' +
	'cmltKCkpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9Cgp9Cg==';

/** Decode and return the C# plugin source */
export function getBridgePluginSource(): string {
	return VSBuffer.wrap(Uint8Array.from(atob(BRIDGE_PLUGIN_BASE64), c => c.charCodeAt(0))).toString();
}
